{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"themes/next/source/css/darkmode.styl","path":"css/darkmode.styl","modified":0,"renderable":1},{"_id":"themes/next/source/css/lightmode.styl","path":"css/lightmode.styl","modified":0,"renderable":1},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/css/noscript.styl","path":"css/noscript.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo-algolia-nebula-blue-full.svg","path":"images/logo-algolia-nebula-blue-full.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.webp","path":"images/logo.webp","modified":0,"renderable":1},{"_id":"themes/next/source/js/bookmark.js","path":"js/bookmark.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/comments-buttons.js","path":"js/comments-buttons.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/comments.js","path":"js/comments.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/config.js","path":"js/config.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/pjax.js","path":"js/pjax.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schedule.js","path":"js/schedule.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/fancybox.js","path":"js/third-party/fancybox.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/pace.js","path":"js/third-party/pace.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/quicklink.js","path":"js/third-party/quicklink.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/rating.js","path":"js/third-party/rating.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/baidu-analytics.js","path":"js/third-party/analytics/baidu-analytics.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/google-analytics.js","path":"js/third-party/analytics/google-analytics.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/growingio.js","path":"js/third-party/analytics/growingio.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/chatra.js","path":"js/third-party/chat/chatra.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/gitter.js","path":"js/third-party/chat/gitter.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/tidio.js","path":"js/third-party/chat/tidio.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/changyan.js","path":"js/third-party/comments/changyan.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/disqus.js","path":"js/third-party/comments/disqus.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/disqusjs.js","path":"js/third-party/comments/disqusjs.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/gitalk.js","path":"js/third-party/comments/gitalk.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/isso.js","path":"js/third-party/comments/isso.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/livere.js","path":"js/third-party/comments/livere.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/utterances.js","path":"js/third-party/comments/utterances.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/math/katex.js","path":"js/third-party/math/katex.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/math/mathjax.js","path":"js/third-party/math/mathjax.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/search/algolia-search.js","path":"js/third-party/search/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/search/local-search.js","path":"js/third-party/search/local-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/statistics/firestore.js","path":"js/third-party/statistics/firestore.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/statistics/lean-analytics.js","path":"js/third-party/statistics/lean-analytics.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/mermaid.js","path":"js/third-party/tags/mermaid.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/pdf.js","path":"js/third-party/tags/pdf.js","modified":0,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon.png","path":"images/apple-touch-icon.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16.png","path":"images/favicon-16x16.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32.png","path":"images/favicon-32x32.png","modified":0,"renderable":1},{"_id":"source/images/1617782228929766s.png","path":"images/1617782228929766s.png","modified":0,"renderable":0},{"_id":"source/images/9644d159a79fb11b4a8416cc72a1bdc44fcb718c-fp-2000-500-0-0.jpeg","path":"images/9644d159a79fb11b4a8416cc72a1bdc44fcb718c-fp-2000-500-0-0.jpeg","modified":0,"renderable":0},{"_id":"source/images/b9be3cae2d0a1c308d21909145aebf70.jpeg","path":"images/b9be3cae2d0a1c308d21909145aebf70.jpeg","modified":0,"renderable":0},{"_id":"source/images/nps1.jpg","path":"images/nps1.jpg","modified":0,"renderable":0},{"_id":"source/images/nps2.jpg","path":"images/nps2.jpg","modified":0,"renderable":0},{"_id":"source/images/nps3.jpg","path":"images/nps3.jpg","modified":0,"renderable":0},{"_id":"source/images/qrcode.jpeg","path":"images/qrcode.jpeg","modified":0,"renderable":0}],"Cache":[{"_id":"source/categories/index.md","hash":"4ade9ba4f3a910bb049e3b5239b44ab88336912c","modified":1648216842055},{"_id":"source/_posts/hello-world.md","hash":"6a3f0d400b47d0f8ddf108e4580d57afa3059737","modified":1648217240905},{"_id":"source/.DS_Store","hash":"74d660f5c556be6d5a527398baeae7b6373d21fa","modified":1653304501506},{"_id":"source/tags/index.md","hash":"489a632f9690efba860445aee3cb8bbb80e86038","modified":1648216857334},{"_id":"source/about/index.md","hash":"a5ae90304110ccee5e0fa661666ee3bca5a6a07e","modified":1652363292003},{"_id":"themes/next/source/css/lightmode.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1648227253728},{"_id":"themes/next/.editorconfig","hash":"8570735a8d8d034a3a175afd1dd40b39140b3e6a","modified":1648185750703},{"_id":"themes/next/.eslintrc.json","hash":"9c0762486f24a8c5e60f8b6c875e4c4728942649","modified":1648185750704},{"_id":"themes/next/.gitattributes","hash":"ec43734985e1cafd53d88ded3020103f7416123c","modified":1648185750704},{"_id":"themes/next/.gitignore","hash":"cdff561cee5ebd8962c19134d3e68c28c7d2e1fa","modified":1648223314720},{"_id":"themes/next/.gitmodules","hash":"5d8e0d1eb36554e53d6e3fa9da9a9bf366820594","modified":1648223349174},{"_id":"themes/next/LICENSE.md","hash":"68fc9a03d50fd4b5ea97092b05967d1819dea2c4","modified":1648185750709},{"_id":"themes/next/README.md","hash":"c8fab0d6caf50be68662a4f9b86b87bde3ae354b","modified":1648185750710},{"_id":"themes/next/_vendors.yml","hash":"519510ce94c6e09ffee76f0ef515b1c9501aaaaf","modified":1648224096267},{"_id":"themes/next/package.json","hash":"196c358209e374cc6abfb76030b394a3f05ef7df","modified":1648185750743},{"_id":"themes/next/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1648185750710},{"_id":"themes/next/renovate.json","hash":"cb29cc16e61b0b8a6dac34657d76822ae29ad5aa","modified":1648185750743},{"_id":"themes/next/.githooks/pre-commit","hash":"f473eac1aaaa96c947d67988bbed140bbab1a821","modified":1648185750704},{"_id":"themes/next/.githooks/install.js","hash":"4d77dbddf2eac1f3fc78f151d12ed22208ed655b","modified":1648185750704},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"330656d93b6c03df9fb1f2f0e3534c971969473b","modified":1648185750705},{"_id":"themes/next/.github/CODE_OF_CONDUCT.md","hash":"21cbff565a0445d3a880fff1ee417e309740a9ab","modified":1648185750705},{"_id":"themes/next/.github/config.yml","hash":"7984e665e9de481a0e0e51fca5668337713f810b","modified":1648185750707},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"3e9fbb78e3dee0ca1dc886d0c28b0148ba0ca499","modified":1648185750707},{"_id":"themes/next/.github/issue_label_bot.yaml","hash":"fca600ddef6f80c5e61aeed21722d191e5606e5b","modified":1648185750707},{"_id":"themes/next/.github/label-commenter-config.yml","hash":"1097fc47beeacfc1edb0248c27b17bf64bde3565","modified":1648185750707},{"_id":"themes/next/.github/release-drafter.yml","hash":"423275ec021104b263cd88776936a8c8d6872b66","modified":1648185750708},{"_id":"themes/next/.github/labeler.yml","hash":"5c4bc2bd561e6d9b33ee118cc12218c5de46f72d","modified":1648185750707},{"_id":"themes/next/docs/AUTHORS.md","hash":"a648823121563c34a177ae91f5a774b5e29f01a0","modified":1648185750711},{"_id":"themes/next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1648185750711},{"_id":"themes/next/docs/LICENSE.txt","hash":"f5b14f791b7cfa1d16da981d929152e088a5d1b8","modified":1648185750711},{"_id":"themes/next/languages/README.md","hash":"b2567e32805dda79601157351a07e5ca9fe01315","modified":1648185750713},{"_id":"themes/next/languages/ar.yml","hash":"bca66db21c015dbd32970d8708b898518a773e1e","modified":1648185750713},{"_id":"themes/next/languages/de.yml","hash":"4be7b8b76c81bf1853eb36d2e874b17546a0e792","modified":1648185750713},{"_id":"themes/next/languages/bn.yml","hash":"b5e2a35eb6fff56b6e32ce479e63b6fc5e44d5cb","modified":1648185750713},{"_id":"themes/next/languages/en.yml","hash":"814d81c27fed736055ee300e0a6505b26ff4313c","modified":1648185750713},{"_id":"themes/next/.DS_Store","hash":"c751546e22da87172c1cdbaa1fdc5dbea0fdb638","modified":1650743717977},{"_id":"themes/next/_config.yml","hash":"8a257bf51f464f17555225ccc4b8a56619461767","modified":1650335163719},{"_id":"themes/next/languages/default.yml","hash":"814d81c27fed736055ee300e0a6505b26ff4313c","modified":1648185750713},{"_id":"themes/next/languages/es.yml","hash":"b813da5aed9d73b809133db4dfb08f90ec56afd9","modified":1648185750714},{"_id":"themes/next/languages/fa.yml","hash":"6456d40dd42f44101d9d6e7054e9884e9163f948","modified":1648185750714},{"_id":"themes/next/languages/fr.yml","hash":"b15dc05afdc94de02e5d3fee4f8d3dc5594dd37e","modified":1648185750714},{"_id":"themes/next/languages/id.yml","hash":"14e794db4eca36b257994d81eb513e61d1edcbd6","modified":1648185750714},{"_id":"themes/next/languages/it.yml","hash":"c1eeab4992c76bfd436bb205ce58b1cfeef55ee6","modified":1648185750715},{"_id":"themes/next/languages/ja.yml","hash":"d48c4157e0e02e847aac7b513580d3364c81948c","modified":1648185750715},{"_id":"themes/next/languages/ko.yml","hash":"6387357ac2dd498e8b8d630d27050a59180d7e8f","modified":1648185750715},{"_id":"themes/next/languages/nl.yml","hash":"ecb8e39c6225f3c068a5fdd569ee7dafd5c41a1f","modified":1648185750715},{"_id":"themes/next/languages/pt-BR.yml","hash":"a1f27b3a592fc58f17d247f5563ff4a90a3da5f2","modified":1648185750716},{"_id":"themes/next/languages/pt.yml","hash":"63a3e1e728ba5e6e22150de7331bb8a654f34960","modified":1648185750716},{"_id":"themes/next/languages/ru.yml","hash":"8c2b6361f2de17561c1a3eede2bf47b4e2ba6ce5","modified":1648185750716},{"_id":"themes/next/languages/si.yml","hash":"615d18d044f44df476d6bfbf73f7b0edc2632168","modified":1648185750717},{"_id":"themes/next/languages/tk.yml","hash":"519239e35c3bda7b62b00ff5d34644f45b16fe6a","modified":1648185750717},{"_id":"themes/next/languages/tr.yml","hash":"0bebba73d6f06c7dad61f80c0d7ad5f6f1791a01","modified":1648185750717},{"_id":"themes/next/languages/uk.yml","hash":"7dd24580c0865c5a7bc4d391855045366a598936","modified":1648185750718},{"_id":"themes/next/languages/vi.yml","hash":"c669c34da544a563ceae3e196addc9df6a78e024","modified":1648185750718},{"_id":"themes/next/languages/zh-TW.yml","hash":"92256b90028de9a1e79c6bc0e5885b93e7fb4b17","modified":1648185750719},{"_id":"themes/next/languages/zh-HK.yml","hash":"f195bb0502ffe66e850077a1af1033455ea65f93","modified":1648185750719},{"_id":"themes/next/layout/_layout.njk","hash":"d588f7b11d46fd41ec7c460554d316773ee3d556","modified":1653304663089},{"_id":"themes/next/layout/archive.njk","hash":"d759f4d2cf5ddc6875ea250113a00662c1caf6d1","modified":1648185750741},{"_id":"themes/next/layout/category.njk","hash":"c68b7343d0f8145010f93351908cc36ef6212ec1","modified":1648185750741},{"_id":"themes/next/layout/page.njk","hash":"6c40aa438c658eb7f0cd0f6a759f18b43e7e8f93","modified":1648185750742},{"_id":"themes/next/layout/index.njk","hash":"dd63e488ae8cc144335a5958acedf6a16edd7a92","modified":1648185750741},{"_id":"themes/next/languages/zh-CN.yml","hash":"642c70d01ef741a468c0a536cd90a40ff11fe4f4","modified":1648219827974},{"_id":"themes/next/layout/.DS_Store","hash":"fddcfc31de9ec7a3723e0979f5ba78f66524dee7","modified":1648221462962},{"_id":"themes/next/layout/tag.njk","hash":"9e16ba20c28a7f2c6bc75aa427f48122301a30aa","modified":1648185750742},{"_id":"themes/next/layout/post.njk","hash":"6abeb85fb3e4c382ed4bb6049b12a807e6226e67","modified":1648185750742},{"_id":"themes/next/test/index.js","hash":"6bf0289846538be3e9a63809af98f00e1fbdd90b","modified":1648185750793},{"_id":"themes/next/.github/ISSUE_TEMPLATE/bug-report.md","hash":"fc4dce84ed9a5d21d3a8833ff6d776c46f876115","modified":1648185750706},{"_id":"themes/next/.github/ISSUE_TEMPLATE/config.yml","hash":"c40ae7903b6cc99f94c9d45ac7ba8c2850bb1309","modified":1648185750706},{"_id":"themes/next/.github/ISSUE_TEMPLATE/feature-request.md","hash":"4ecac91716eac59d7c2bc53cf6e95612d44da97b","modified":1648185750706},{"_id":"themes/next/.github/ISSUE_TEMPLATE/other.md","hash":"8cc5b5c116f6a052865a324512362f145d699202","modified":1648185750706},{"_id":"themes/next/.github/workflows/label-commenter.yml","hash":"44405477660289d4ed9beba1d054b15bb67bba06","modified":1648185750708},{"_id":"themes/next/source/.DS_Store","hash":"ec49606d6b60c1f04ac1d5e2b174ab01202b2ba4","modified":1650354424542},{"_id":"themes/next/.github/workflows/labeler.yml","hash":"8b73c439dc796be141d521a4546bcfb7a5485534","modified":1648185750708},{"_id":"themes/next/.github/workflows/linter.yml","hash":"97bca6c7da379dc1136399230820a0687d321cec","modified":1648185750708},{"_id":"themes/next/.github/workflows/release-drafter.yml","hash":"4f3af81009cb922be91f718a67425377515ea69d","modified":1648185750709},{"_id":"themes/next/.github/workflows/tester.yml","hash":"86e092157a90b6fce6933af69568664fca300798","modified":1648185750709},{"_id":"themes/next/docs/ru/README.md","hash":"7d39204791687179576e22891a1a31766a089171","modified":1648185750711},{"_id":"themes/next/.github/workflows/lock.yml","hash":"e48d1ced9a673d3f0911a700d3e68c0f4ca79263","modified":1648185750708},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"7a06d443f374bd1e84294067a0ac796afd9fbe60","modified":1648185750712},{"_id":"themes/next/docs/zh-CN/README.md","hash":"3d09c345d2e2ae2ab0fca10ff39b3b543b152c09","modified":1648185750712},{"_id":"themes/next/layout/_macro/post-collapse.njk","hash":"1a30d751871dabfa80940042ddb1f77d07d830b9","modified":1648185750720},{"_id":"themes/next/layout/_macro/sidebar.njk","hash":"eb786e8b35e354287cda345c524cd35ec955f692","modified":1648185750721},{"_id":"themes/next/layout/_partials/comments.njk","hash":"d0c470b0f6690aa217e9ada848c5e2e73fb27c6f","modified":1648185750721},{"_id":"themes/next/layout/_partials/footer.njk","hash":"19713f472972caac33ae5fbcfe9105da61257de4","modified":1648218649334},{"_id":"themes/next/layout/_partials/languages.njk","hash":"e43f22198cccb5f6e306b1ce0d28d12a4fb891f8","modified":1648185750724},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"a089f7a8368ab0b7d7b9b7ec0ac3767a453435df","modified":1648185750712},{"_id":"themes/next/layout/_scripts/index.njk","hash":"6668878a0f9a1166c6a879755f54a08d942da870","modified":1648185750730},{"_id":"themes/next/layout/_partials/.DS_Store","hash":"ba001f0632a0cc02bb91ad89b5eca8eec4f28324","modified":1648221462965},{"_id":"themes/next/layout/_macro/post.njk","hash":"d88b7851ae781febcd043796dbd8e1011b4c2fee","modified":1652415589612},{"_id":"themes/next/layout/_scripts/vendors.njk","hash":"172d7cfc3ba60676017d6213dc2dea30f4994a89","modified":1648230983546},{"_id":"themes/next/layout/_third-party/fancybox.njk","hash":"844559f46e2ff1c8be234d5763703106e2072a7b","modified":1648185750736},{"_id":"themes/next/layout/_third-party/pace.njk","hash":"d7ad5714079f7f65446f880baf14722435ca9061","modified":1648185750737},{"_id":"themes/next/layout/_third-party/index.njk","hash":"d41eeb262978e34de4679d8971a9e7ac5d90ecbc","modified":1648185750736},{"_id":"themes/next/layout/_third-party/quicklink.njk","hash":"0efed71ed530447718c4ea5bbd5fc8695b0b0d5f","modified":1648185750737},{"_id":"themes/next/layout/_third-party/rating.njk","hash":"1bcdbc7fde26d6d9ef4e7fa43ffcff5a9506b20e","modified":1648185750738},{"_id":"themes/next/scripts/filters/default-injects.js","hash":"872f01cb10e422a648ea505436532e776e92926b","modified":1648185750748},{"_id":"themes/next/scripts/events/index.js","hash":"3ce10d4cce94e3d4c482c2e18bb6f0f0ca380d3d","modified":1648185750743},{"_id":"themes/next/scripts/filters/minify.js","hash":"3abdcb715562414063e0fb3eeb6244ce59c477e0","modified":1648185750749},{"_id":"themes/next/scripts/filters/locals.js","hash":"9eb5310664759931287dd28ea39165dfb67f12ed","modified":1648185750748},{"_id":"themes/next/scripts/filters/post.js","hash":"ab8bb12e4d55640b1ac4252514468ce37ebcb0b0","modified":1648185750749},{"_id":"themes/next/scripts/helpers/engine.js","hash":"72d4464cf01f8f34e524f26a1e9b1d063504e92d","modified":1648185750749},{"_id":"themes/next/scripts/helpers/font.js","hash":"3394185a7f0393c16ce52c8028f90da3e9239c55","modified":1648185750749},{"_id":"themes/next/scripts/helpers/navigation.js","hash":"78107021101553c3d23e89290f7530b60cf4aa86","modified":1648185750750},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"a11b71ba0c5012e2cdcab31c15439156b215563e","modified":1648185750751},{"_id":"themes/next/scripts/helpers/next-config.js","hash":"5de208a7ce28db47d133be00d7dcf5275d4505ff","modified":1648225568922},{"_id":"themes/next/scripts/helpers/next-vendors.js","hash":"afdd6a188a74c188f0dd154fac70efd4080ca262","modified":1648185750751},{"_id":"themes/next/scripts/tags/button.js","hash":"c6ad2ed544fbb25ecb5d820c36e76302504271b7","modified":1648185750751},{"_id":"themes/next/scripts/tags/caniuse.js","hash":"935a311142a409c1896b3ae3f01fe7a9e2db1134","modified":1648185750751},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"92c19d796bdb3320df9caea59bf52df7a95d9da9","modified":1648185750752},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"9ed799c329abf830f623689d7e136991256a24ca","modified":1648185750752},{"_id":"themes/next/scripts/tags/index.js","hash":"17f9451ce1f10f78437f52218757d38d4e1591b0","modified":1648185750752},{"_id":"themes/next/scripts/tags/label.js","hash":"8a73348186113bae0a51ea2f891c1bb882fab05a","modified":1648185750752},{"_id":"themes/next/scripts/tags/link-grid.js","hash":"18a483c2d5afd701f6080ffdddf2d1321370336c","modified":1648185750753},{"_id":"themes/next/scripts/tags/mermaid.js","hash":"4fb01ca650fa8b256b8d48f50dc1b18350bd3d6d","modified":1648185750753},{"_id":"themes/next/scripts/tags/note.js","hash":"7b94ddb46b7d4b0fe815f2fbe4bd375f07f55363","modified":1648185750753},{"_id":"themes/next/scripts/tags/pdf.js","hash":"344636b6fd7e27e8831c1e194039afc0d61931cd","modified":1648185750753},{"_id":"themes/next/scripts/tags/tabs.js","hash":"0eabe51da40b4b13e16419c8fe02452d9a4fef73","modified":1648185750754},{"_id":"themes/next/scripts/tags/video.js","hash":"2ee926448583be8f95af1f2884ae2c9c4830151d","modified":1648185750754},{"_id":"themes/next/source/css/_colors.styl","hash":"f15b44d30521b5863b5bc3f01a0cbaf4033e7387","modified":1648228499336},{"_id":"themes/next/source/css/_mixins.styl","hash":"67496ecd37ffdbb49aa7d664ac021d59e72ba8e7","modified":1650353183565},{"_id":"themes/next/source/css/darkmode.styl","hash":"0669ce3014289533ae38ae0d264c1e4173f13c04","modified":1648257928216},{"_id":"themes/next/source/css/main.styl","hash":"78ce791cc4ac95386cf6839ca72f5f7b51f86ee9","modified":1648227078363},{"_id":"themes/next/source/css/.DS_Store","hash":"d3694404f489bd81e7af0ccaa94c14c4e7d6932c","modified":1648223366779},{"_id":"themes/next/source/css/noscript.styl","hash":"76bba5d7916e9930e68215a0fce3a7d81c44510f","modified":1648185750781},{"_id":"themes/next/source/images/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1648221649585},{"_id":"themes/next/source/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1648185750781},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1648185750781},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1648185750781},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1648185750782},{"_id":"themes/next/source/images/logo-algolia-nebula-blue-full.svg","hash":"b85e274207b1392782476a0430feac98db1e7da0","modified":1648185750782},{"_id":"themes/next/source/js/bookmark.js","hash":"0f563ffbf05fad30e854e413ab17ff7164ab5a53","modified":1648185750782},{"_id":"themes/next/source/images/logo.svg","hash":"f280334038d4e8aa2212cc15a1bb9720120822d2","modified":1650334703595},{"_id":"themes/next/source/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1648185750783},{"_id":"themes/next/source/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1648185750783},{"_id":"themes/next/source/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1648185750783},{"_id":"themes/next/source/images/logo.webp","hash":"b4d7e069ccf4896a09480b68e7000f8658633069","modified":1648221610312},{"_id":"themes/next/source/js/.DS_Store","hash":"bc5e1d0c71924df8f6ff913444d68a30863f47c9","modified":1648223366786},{"_id":"themes/next/source/js/next-boot.js","hash":"52dc9e11b167efd6be68b076a01dd6a3eb0eb644","modified":1650352052764},{"_id":"themes/next/source/js/motion.js","hash":"6d4bd07a6f8e1b4083119dca0acb5b289533b619","modified":1648185750783},{"_id":"themes/next/source/js/pjax.js","hash":"919f5281c4a04d11cfd94573ecf57b3dbabd3cc8","modified":1648185750784},{"_id":"themes/next/source/js/schedule.js","hash":"a1333258726caf84f368a8f8454639c7dc1626bb","modified":1648185750784},{"_id":"themes/next/source/js/utils.js","hash":"e447160d342b1f93df5214b6a733441039ced439","modified":1648185750792},{"_id":"themes/next/test/helpers/font.js","hash":"342ef3c6fd2dcca2a8802a516ed6d7f389fd2ca2","modified":1648185750792},{"_id":"themes/next/test/helpers/index.js","hash":"63ba28afed697f7b3574436b1133b8ecc9c0c357","modified":1648185750792},{"_id":"themes/next/test/helpers/next-url.js","hash":"a91d880cb75e0a8e65a7be4c7362b2c8ebfb7c4f","modified":1648185750793},{"_id":"themes/next/test/tags/button.js","hash":"48f2aa4c513e9e24bd6a811410520b74cd7ea88b","modified":1648185750793},{"_id":"themes/next/test/tags/center-quote.js","hash":"7667342fd1a1417eaf6a254012b84ae40e8d13dd","modified":1648185750794},{"_id":"themes/next/test/tags/caniuse.js","hash":"aa5e728445caeaf7c2ccd0f3fcb2cad0c93ca6d1","modified":1648185750793},{"_id":"themes/next/test/tags/group-pictures.js","hash":"5c68ae0184f9da6e00ba199f2554d503d8e6da71","modified":1648185750794},{"_id":"themes/next/test/tags/index.js","hash":"e8779e54f0979b221858f8bb74dd081bb503b910","modified":1648185750794},{"_id":"themes/next/test/tags/label.js","hash":"4ebf3698c258ca978b997acbdd0dece44069c09d","modified":1648185750794},{"_id":"themes/next/test/tags/link-grid.js","hash":"43d298fafb7c45a874b766d443843bd26346e689","modified":1648185750795},{"_id":"themes/next/test/tags/mermaid.js","hash":"ab77be5f3c6d9a57c7b9dda6decf1906a736fef9","modified":1648185750795},{"_id":"themes/next/test/tags/note.js","hash":"3dcfcd65bf9f326972ea7571fdb1444200f5d07e","modified":1648185750795},{"_id":"themes/next/test/tags/pdf.js","hash":"fd6ea5123560a90f7e7c1eface23dbe1455db25f","modified":1648185750795},{"_id":"themes/next/test/tags/tabs.js","hash":"d63722919f9da2e44d6b952801e10a2915ea9c12","modified":1648185750795},{"_id":"themes/next/test/tags/video.js","hash":"b796fc4dceb20a30e730c322bb5474c0162464cc","modified":1648185750795},{"_id":"themes/next/layout/_partials/head/head-unique.njk","hash":"8da52a144060db1a0a088ccb2e6cc8376d1fce70","modified":1648185750722},{"_id":"themes/next/test/validate/index.js","hash":"5a95ccc8598667535bd022e988055c0e019f3670","modified":1648185750796},{"_id":"themes/next/layout/_partials/header/index.njk","hash":"650de421a8ce4cf685428ffbe0087ff84cbd1356","modified":1648185750723},{"_id":"themes/next/layout/_partials/header/brand.njk","hash":"aff4613756456be26415febc668860fdab8d33c5","modified":1648221789351},{"_id":"themes/next/layout/_partials/header/menu-item.njk","hash":"41a8b0cc16f60fa085cb719d07216d86b6bc4bf8","modified":1648185750724},{"_id":"themes/next/layout/_partials/header/menu.njk","hash":"ee6fc2f111572d3eeab0a2fecbb2d6b3e37ab26b","modified":1648185750724},{"_id":"themes/next/layout/_partials/header/sub-menu.njk","hash":"06480d8ec5f0b87eafd47f082f07968d7282dd5c","modified":1648185750724},{"_id":"themes/next/layout/_partials/page/breadcrumb.njk","hash":"89825e75cc45e9709fa6ba89883669eedaff6f46","modified":1648185750725},{"_id":"themes/next/layout/_partials/page/categories.njk","hash":"17156d99941f28a225951ffdcfa9a115e20dc2d2","modified":1648185750725},{"_id":"themes/next/layout/_partials/head/head.njk","hash":"8e25c179d54e1c4811706873c1af9ef077f262d5","modified":1650353171185},{"_id":"themes/next/layout/_partials/page/page-header.njk","hash":"9eeb0a5b959e4322c5fcc24556bf9230927d9e00","modified":1652401029534},{"_id":"themes/next/layout/_partials/page/schedule.njk","hash":"0f4bc8e257da60f77c0c1738607b2bde55810684","modified":1648185750725},{"_id":"themes/next/layout/_partials/page/tags.njk","hash":"a18d1598e36cc72f2b0b24c3cc3c5990dfaa3254","modified":1648185750726},{"_id":"themes/next/layout/_partials/post/post-copyright.njk","hash":"133942922e34abae9e4de7ea5591d77c0caa4b37","modified":1648185750726},{"_id":"themes/next/layout/_partials/post/post-followme.njk","hash":"154df0bb323c332d8c25343f258ee865e5553423","modified":1648185750727},{"_id":"themes/next/layout/_partials/post/post-footer.njk","hash":"bde2c7356d9362972bde41cc206d5816f8ed714d","modified":1648185750727},{"_id":"themes/next/layout/_partials/post/post-related.njk","hash":"57eca76cfbbe9a65bc2a77f1deebf003ed335673","modified":1648185750727},{"_id":"themes/next/layout/_partials/post/post-reward.njk","hash":"002b51d0cae3f2e2e008bdc58be90c728282de5b","modified":1648185750728},{"_id":"themes/next/layout/_partials/search/localsearch.njk","hash":"661f7acae43f0be694266323320f977d84119abe","modified":1648185750729},{"_id":"themes/next/layout/_partials/search/index.njk","hash":"8f6f256ab3b351ffc80f1f3f1d9834e9a7cfac31","modified":1648185750728},{"_id":"themes/next/layout/_partials/widgets.njk","hash":"852a750524decf1efa587cd52b09e387ed8315de","modified":1648185750729},{"_id":"themes/next/layout/_partials/pagination.njk","hash":"9876dbfc15713c7a47d4bcaa301f4757bd978269","modified":1648185750726},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.njk","hash":"6215309aee028dcb734452beec448c5afb6c63fc","modified":1648185750731},{"_id":"themes/next/layout/_partials/search/algolia-search.njk","hash":"efb2b6f19df02ba5ae623a1f274fff52aed21e6f","modified":1648185750728},{"_id":"themes/next/layout/_third-party/analytics/cloudflare.njk","hash":"c978e9efd472c4825f93b83524b11f1c4f7efaab","modified":1648185750731},{"_id":"themes/next/layout/_partials/sidebar/site-overview.njk","hash":"b2ad8efb4cadda3d90569e7e69a6cfb73a075c7c","modified":1648225334950},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.njk","hash":"d89066ff53879693f023e540d59c86137172c529","modified":1648185750731},{"_id":"themes/next/layout/_third-party/analytics/index.njk","hash":"45477a04cf2b3c077061c8c3ada216c1ae288e0e","modified":1648185750732},{"_id":"themes/next/layout/_partials/post/post-meta.njk","hash":"fc0266a02b98590e899e62ac24c9dd4e6c6c1976","modified":1648258122722},{"_id":"themes/next/layout/_third-party/analytics/microsoft-clarity.njk","hash":"9dc00fcb0a05899f048eace9f9160b78956655d5","modified":1648185750733},{"_id":"themes/next/layout/_third-party/analytics/growingio.njk","hash":"8afaa772c390bd9d53a5cff9645ac3168334eb98","modified":1648185750732},{"_id":"themes/next/layout/_third-party/chat/tidio.njk","hash":"02aab857c27fc103216029be991688b12a73a525","modified":1648185750734},{"_id":"themes/next/layout/_third-party/chat/chatra.njk","hash":"d7263fca16d0278ccf1f6aa1c6df6902a6344a09","modified":1648185750733},{"_id":"themes/next/layout/_third-party/chat/gitter.njk","hash":"f8cc14b7aa949999a1faaeb7855e2f20b59a386d","modified":1648185750733},{"_id":"themes/next/layout/_third-party/comments/changyan.njk","hash":"d1c950f8fbdf85e7a3eae5463767a89e858e8220","modified":1648185750734},{"_id":"themes/next/layout/_third-party/comments/disqus.njk","hash":"9375b19a89b7fa9474e558d085af5448d4c5c50c","modified":1648185750734},{"_id":"themes/next/layout/_third-party/comments/disqusjs.njk","hash":"0749cb6902baecdfd01f779a2a2513f6d2f6a823","modified":1648185750735},{"_id":"themes/next/layout/_third-party/comments/gitalk.njk","hash":"b63b7e2ede0d3e66e732fa1a06bda9b19e1e85d4","modified":1648185750735},{"_id":"themes/next/layout/_third-party/comments/isso.njk","hash":"64cc3bdaf644fd32c0d0a247f29f5b6904da9af3","modified":1648185750735},{"_id":"themes/next/layout/_third-party/comments/livere.njk","hash":"3b13b09fba84ec6000886890a6710736a2b8fafe","modified":1648185750735},{"_id":"themes/next/layout/_third-party/comments/utterances.njk","hash":"5a94032bc3512a10ad4328fc19ec07b819a1d687","modified":1648185750736},{"_id":"themes/next/layout/_third-party/math/katex.njk","hash":"d82c24136bbd3443b85f07f5579845833b594684","modified":1648185750737},{"_id":"themes/next/layout/_third-party/math/index.njk","hash":"abf37fc55aa86702118e8fdf5bf2d389dd589aa0","modified":1648185750736},{"_id":"themes/next/layout/_third-party/math/mathjax.njk","hash":"3677017fd4572b158311f5f5d870590ab25184e0","modified":1648185750737},{"_id":"themes/next/layout/_third-party/search/algolia-search.njk","hash":"24ed76e0c72a25ac152820c750a05826a706b6f4","modified":1648185750738},{"_id":"themes/next/layout/_third-party/search/localsearch.njk","hash":"e45ea3542cdc9ed7ec8447b5e6f35df4c5e82758","modified":1648185750738},{"_id":"themes/next/layout/_third-party/statistics/busuanzi-counter.njk","hash":"a4bc501da0f22f7e420f0ca47e83988ce90b1368","modified":1648185750739},{"_id":"themes/next/layout/_third-party/statistics/firestore.njk","hash":"d32ebe94560fa95824478ebbff531bffc47b194d","modified":1648185750739},{"_id":"themes/next/layout/_third-party/statistics/index.njk","hash":"568ddf7955d11d93fb5e842b403a7ac8b1b7fdb1","modified":1648185750740},{"_id":"themes/next/layout/_third-party/statistics/lean-analytics.njk","hash":"2446e748cdc102c78492216319ac02148db7daf6","modified":1648185750740},{"_id":"themes/next/layout/_third-party/tags/mermaid.njk","hash":"099e031f52fb8e47b3af5b2684737efc9e643ee7","modified":1648185750740},{"_id":"themes/next/scripts/events/lib/config.js","hash":"c8b59b404f5d2a0b3b5cd1a6c9a10af5f30e43b5","modified":1648185750744},{"_id":"themes/next/layout/_third-party/tags/pdf.njk","hash":"2c81984cc4f5123103460442f6e046f5b6c97127","modified":1648185750741},{"_id":"themes/next/scripts/events/lib/injects.js","hash":"d987709267a1bc6e5014411e9983d7c49c102c16","modified":1648185750744},{"_id":"themes/next/scripts/events/lib/highlight.js","hash":"6aec7b2c38c50989a23bfaa0d560e75c7f553e12","modified":1648185750744},{"_id":"themes/next/scripts/events/lib/navigation.js","hash":"dd3562686d95a50375e6fd32e717ccb0d99c1e3d","modified":1648185750744},{"_id":"themes/next/scripts/events/lib/utils.js","hash":"672dce0632af589b7fe47fa45c2094fa013885f7","modified":1648185750745},{"_id":"themes/next/scripts/events/lib/vendors.js","hash":"299664182f502447c07301461db99bfd6993fdac","modified":1648185750745},{"_id":"themes/next/scripts/filters/comment/changyan.js","hash":"7fa8701c86485b2fe7324e017101a32417902397","modified":1648185750746},{"_id":"themes/next/scripts/filters/comment/default-config.js","hash":"93ee5f9109dad885dc38c49bcee630c10f9dce6e","modified":1648185750746},{"_id":"themes/next/scripts/filters/comment/common.js","hash":"19a402a225c31edffc50f202a14e0d582d3db23e","modified":1648185750746},{"_id":"themes/next/scripts/filters/comment/disqus.js","hash":"7f71d6b271ba65ff333d5682e7575711d368c0d2","modified":1648185750747},{"_id":"themes/next/scripts/filters/comment/disqusjs.js","hash":"135b87d151055eefdbc711d9e704b112b3214a84","modified":1648185750747},{"_id":"themes/next/scripts/filters/comment/isso.js","hash":"ff8b5b5145220a17d0ecd9508ba9bd2d3b2da47d","modified":1648185750747},{"_id":"themes/next/scripts/filters/comment/gitalk.js","hash":"7bb7dafdd7f6bca8464b54e17e552ce7f1714195","modified":1648185750747},{"_id":"themes/next/scripts/filters/comment/utterances.js","hash":"d3bded697bc32dace689d2a6dfb6eb7514169d15","modified":1648185750748},{"_id":"themes/next/scripts/filters/comment/livere.js","hash":"5a07d8bb52bc1d51a624ca8db54be144566c306b","modified":1648185750748},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"96e0a7c2a65ce68215e17e369085b2ea2f1334f2","modified":1648185750779},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"e1fbf169b9b6a194b518240cbd06ec3c48b83d61","modified":1648185750779},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"e3be898f5ebcf435a26542653a9297ff2c71aeb0","modified":1648185750780},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"c65536a128b9bc9dbe2fbb1b235a3cded2891002","modified":1648185750780},{"_id":"themes/next/source/css/_variables/base.styl","hash":"163c7441d777bee87042d475e6ce0fde199add28","modified":1648185750780},{"_id":"themes/next/source/js/schemes/muse.js","hash":"9a836d2bcc3defe4bd1ee51f5f4eb7006ebdd41b","modified":1648185750784},{"_id":"themes/next/source/js/third-party/fancybox.js","hash":"c098d14e65dd170537134358d4b8359ad0539c2c","modified":1648185750788},{"_id":"themes/next/source/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1648185750789},{"_id":"themes/next/source/js/third-party/quicklink.js","hash":"eed02e6fced8e5a653077205d4d4d7834ca71472","modified":1648185750789},{"_id":"themes/next/source/js/third-party/rating.js","hash":"4e92c2d107ba47b47826829f9668030d5ea9bfb8","modified":1648185750790},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"bab653bcf226311381e8411a0492202f1bf1fce9","modified":1648185750756},{"_id":"themes/next/source/css/_common/components/index.styl","hash":"fe1868f47681e00a33a96199302be85377282f63","modified":1648185750756},{"_id":"themes/next/source/css/_common/components/reading-progress.styl","hash":"90a86045a33c1bae49fc2f6fa1e1b53170c7f77b","modified":1648185750760},{"_id":"themes/next/source/css/_common/outline/mobile.styl","hash":"64775c729512b30b144ab5ae9dc4a4dfd4e13f35","modified":1648185750765},{"_id":"themes/next/source/css/_common/outline/index.styl","hash":"8e34df131830d4fa3725e4590a672ba1cf1903e5","modified":1648185750764},{"_id":"themes/next/source/css/_common/scaffolding/buttons.styl","hash":"a042571d85ff7265f799004239a45f36b716b8a6","modified":1648185750769},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"d0a7c99095f490b0d2ed6b1be43d435960798cec","modified":1648185750768},{"_id":"themes/next/source/css/_common/scaffolding/comments.styl","hash":"e4fecc889ba3317a64e9abba5842c79dff9b7827","modified":1648185750769},{"_id":"themes/next/source/css/_common/scaffolding/index.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":1648185750770},{"_id":"themes/next/source/css/_common/scaffolding/pagination.styl","hash":"b5c7782368889fa9fd93807d28ff2daf270e3703","modified":1648185750771},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":1648185750770},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"e840b23d33023e6d45e018f6e84b683dd56efd8d","modified":1648185750771},{"_id":"themes/next/source/css/_common/scaffolding/toggles.styl","hash":"572a41499391677d84b16d8dbd6a996a3d5ce041","modified":1648185750774},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"fd49b521d67eaccc629f77b4e095cb7310327565","modified":1648185750775},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"2aa359bf080f4c52a40ad2c44cc16b93fc0a434e","modified":1652415407722},{"_id":"themes/next/source/css/_schemes/Mist/_layout.styl","hash":"5604ac1e161099a4d3e5657d53507268866dc717","modified":1648185750775},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expand.styl","hash":"be6cf377ae8f4a01ee76f9b3014e74161d4d5d17","modified":1648185750776},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"fb550935d374e0bdf1097fce187337dc05cad3e1","modified":1648185750775},{"_id":"themes/next/.stylintrc","hash":"2cf4d637b56d8eb423f59656a11f6403aa90f550","modified":1648185750709},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"82a29572dd90451f75358a2ee2522b87304a0bb8","modified":1648185750776},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"b7f48be3c43bfa393d62142544a5487a67871713","modified":1648185750777},{"_id":"themes/next/source/css/_schemes/Muse/_sidebar.styl","hash":"944364893bd7160d954c10ba931af641c91515a4","modified":1648185750777},{"_id":"themes/next/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":1648185750777},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1648185750777},{"_id":"themes/next/source/css/_schemes/Pisces/_header.styl","hash":"b741ab96e73370711c63a6581159f2ea8b5bfa1b","modified":1648185750778},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"6eee86c8f0175d6c09e434053516cd8556f78d44","modified":1648185750778},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"d6419827e799c28459cc42f26658f4620b8eb77e","modified":1650333686295},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"778ed2ad5643b93970c95626b325defeb586733f","modified":1648185750779},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"d9141e6e14a56b5952488101e9a8388c2170e270","modified":1648185750779},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"c0694dcbd756533c17e6ab4729874b4f764c6749","modified":1650354424414},{"_id":"themes/next/source/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1648185750785},{"_id":"themes/next/source/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1648185750785},{"_id":"themes/next/source/js/third-party/analytics/google-analytics.js","hash":"59684383385059dc4f8a1ff85dbbeb703bcdbcb5","modified":1648185750785},{"_id":"themes/next/source/js/third-party/chat/gitter.js","hash":"cc38c94125f90dadde11b5ebac7d8bf99a1a08a2","modified":1648185750786},{"_id":"themes/next/source/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1648185750785},{"_id":"themes/next/source/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1648185750786},{"_id":"themes/next/source/js/third-party/comments/changyan.js","hash":"260d1a77d6a3bb33a579d3e4cca1997003e799b5","modified":1648185750786},{"_id":"themes/next/source/js/third-party/comments/disqus.js","hash":"e1cc671b0d524864fd445e3ab4ade9ee6d07e565","modified":1648185750787},{"_id":"themes/next/source/js/third-party/comments/disqusjs.js","hash":"b6c58f098473b526d6a3cd35655caf34b77f7cff","modified":1648185750787},{"_id":"themes/next/source/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1648185750788},{"_id":"themes/next/source/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1648185750787},{"_id":"themes/next/source/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1648185750788},{"_id":"themes/next/source/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1648185750788},{"_id":"themes/next/source/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1648185750789},{"_id":"themes/next/source/js/third-party/math/mathjax.js","hash":"5c749b9c1c3bb738122d0516211ecff6496d4907","modified":1648185750789},{"_id":"themes/next/source/js/third-party/search/local-search.js","hash":"45c485f82258d246f37deb66884bd2643323ef3a","modified":1648185750790},{"_id":"themes/next/source/js/third-party/search/algolia-search.js","hash":"a8737ff19eeba48654b835129c9cebdf90f758c8","modified":1648185750790},{"_id":"themes/next/source/js/third-party/statistics/firestore.js","hash":"411a72df581f5b21317dc28633c7993207eb9e1c","modified":1648185750790},{"_id":"themes/next/source/js/third-party/statistics/lean-analytics.js","hash":"5a928990856b8e456f0663cf3b6b406733672e39","modified":1648185750791},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"ab16a3dcdc0393b9b582ef59dcc13db9320e917c","modified":1648185750776},{"_id":"themes/next/source/js/third-party/tags/mermaid.js","hash":"f27d817b0c2138dd3215b1f46af0753f60a008f3","modified":1648185750791},{"_id":"themes/next/source/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1648185750791},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"b6e2eb1550a7845cb2adf86081a4ab6c7bde1e68","modified":1648185750756},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"8afdc311c6b8db121758371f95cf1c5e77354f42","modified":1648185750756},{"_id":"themes/next/source/css/_common/components/pages/index.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1648185750757},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"6b816c2511242ee503fb5f34cd3e4dcdafc06b85","modified":1648185750757},{"_id":"themes/next/source/css/_common/components/post/index.styl","hash":"d0805a763176b3c0003967401644f41dfe3bc9e8","modified":1648185750758},{"_id":"themes/next/source/css/_common/components/post/post-body.styl","hash":"ea351936d71e0b6259febac3d7d56d1be6927bf9","modified":1648185750758},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"ec37a36e94ba791663607a5022f763915778578f","modified":1648185750758},{"_id":"themes/next/source/css/_common/components/post/post-followme.styl","hash":"fc1a7bac6493f24aa50665574f37f3dd954f210c","modified":1648185750759},{"_id":"themes/next/source/css/_common/components/post/post-footer.styl","hash":"1d284f3ea03ba9b4feb76b375e539a8e0bccf1c3","modified":1648185750759},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"e27885f5454f3b9e949143b6e15edb5005333b46","modified":1653198538284},{"_id":"themes/next/source/css/_common/components/post/post-header.styl","hash":"010c901e4ef49a606f8a350efbf09044e76d2ff3","modified":1648185750759},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"9ac6f477177264c26a46e8333b8456720a0444dc","modified":1648185750760},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"07cff69f2d57e6321595f64c16d8b763dc88df6a","modified":1648185750760},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"b6677dc2a2368084ab82bb4f145ac79e5966c150","modified":1648185750760},{"_id":"themes/next/source/css/_common/components/third-party/disqusjs.styl","hash":"c2326ee3e8b724d99c24a818ddee32813ea5bf89","modified":1648185750761},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"070737d101e7cd58e997e8c7af09958268c43a21","modified":1648185750761},{"_id":"themes/next/source/css/_common/components/third-party/gitter.styl","hash":"35104dc6883a61c31e0e368dac8ac2f697be62fe","modified":1648185750761},{"_id":"themes/next/source/css/_common/components/third-party/index.styl","hash":"979486a41a81f2a9fd8b0b87c4f87d6416c68c7d","modified":1648185750761},{"_id":"themes/next/source/css/_common/components/third-party/math.styl","hash":"9d995eb4871a6c273d9d51558676a1fdabf69e72","modified":1648185750761},{"_id":"themes/next/source/css/_common/components/third-party/search.styl","hash":"e72799ce3f9b79753e365b2f8c8ef6c310668d4a","modified":1648185750762},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"41ed817e1eb64078074e245e771446ee041e5790","modified":1648185750762},{"_id":"themes/next/source/css/_common/components/third-party/utterances.styl","hash":"56d90ae0559caa55b75f3c300ff2711f9ed65fc4","modified":1648185750762},{"_id":"themes/next/source/css/_common/outline/header/bookmark.styl","hash":"e74f4bb47a101b014ee2a1783c87f3b87323f9a0","modified":1648185750763},{"_id":"themes/next/source/css/_common/outline/footer/index.styl","hash":"8b9407e5cfd0571ef8de7df19022b268f962fa2f","modified":1648185750763},{"_id":"themes/next/source/css/_common/outline/header/github-banner.styl","hash":"38c64c2d04e46848382bfa246a0e9c508294767b","modified":1648185750763},{"_id":"themes/next/source/css/_common/outline/header/index.styl","hash":"82f4deba865c7fce1cd82a0ea39b05f143bd0fb1","modified":1650354018919},{"_id":"themes/next/source/css/_common/outline/header/menu.styl","hash":"d74114e18cd42e1675eed7822fb4e7c251b95e3a","modified":1650333941676},{"_id":"themes/next/source/css/_common/outline/header/site-meta.styl","hash":"accaa214ea94ff36cb6792ebe32ee396d9bde98d","modified":1652415402120},{"_id":"themes/next/source/css/_common/outline/header/site-nav.styl","hash":"bce930e5f0565ec6cd6b7b837821846e6d480460","modified":1650353994796},{"_id":"themes/next/source/css/_common/outline/sidebar/index.styl","hash":"cee43480eba028c37d51cb620c2d81486aa24e01","modified":1648185750765},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"52fc98b1435129eb3edb9293ced9e507741f1350","modified":1648185750765},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"5b38ac4a0f1ade0e681aff0e3366c481d9cf3dcd","modified":1648185750765},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"9950c3188a28e1c63b5498b7bdcd14b12ace3e28","modified":1648185750766},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"b926e368f702f8686aaa2eb98d3d2e533418958c","modified":1648185750766},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"ee94a1a27090ad24e3ed579093088d97ff96d77d","modified":1648185750767},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-dimmer.styl","hash":"fbdb63c6a8887d19b7137325ba7d6806f728139c","modified":1648185750766},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"021a37cf178440cc341940a299d3bca359996c6b","modified":1648185750767},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"3103b81fc76b59e1e2c161e2c484625c770ed66f","modified":1648185750767},{"_id":"themes/next/source/css/_common/outline/sidebar/site-state.styl","hash":"26dd0adfcb1db6df29c6090c8d7e9b5a43583fb0","modified":1648185750768},{"_id":"themes/next/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"83ee4993710fc8daa1c8dbfccd5d5091fd244c30","modified":1648185750769},{"_id":"themes/next/source/css/_common/scaffolding/highlight/index.styl","hash":"f2328caa94645836e06fb39a6a9c9a84ed68a8b5","modified":1648185750770},{"_id":"themes/next/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"d6418fd2bbfba7b73ddf11ec62db9637fdf5d8af","modified":1648185750771},{"_id":"themes/next/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"393ff96234e4196b569d4b11496774eb78e147de","modified":1648185750772},{"_id":"themes/next/source/css/_common/scaffolding/tags/index.styl","hash":"3f76c73a891bbc10679753e702feba9e8a5ffdd2","modified":1648185750772},{"_id":"themes/next/source/css/_common/scaffolding/tags/label.styl","hash":"debee14539272fbe3835a7d3853af2230baa3501","modified":1648185750772},{"_id":"themes/next/source/css/_common/scaffolding/tags/link-grid.styl","hash":"7f8a7345e6537a62cd9e9a94c8f7065b541d9b04","modified":1648185750773},{"_id":"themes/next/source/css/_common/scaffolding/tags/mermaid.styl","hash":"48d35dba575a7c9e8845b16652e76b7d4a4646de","modified":1648185750773},{"_id":"themes/next/source/css/_common/scaffolding/tags/note.styl","hash":"d27fbf7799695295dd5860a161a13ac4d90c5ba4","modified":1648185750773},{"_id":"themes/next/source/css/_common/scaffolding/tags/pdf.styl","hash":"b6654a1d7cf82577d8263faffee8af3ad4a5c0e8","modified":1648185750773},{"_id":"themes/next/source/css/_common/scaffolding/tags/tabs.styl","hash":"7a39bcce7274284e87388743db62afc847fe6897","modified":1648185750774},{"_id":"themes/next/source/css/_common/components/pages/tag-cloud.styl","hash":"1a81d1a71fcf0699629ce6e72dfd0a15f3a2dd0a","modified":1648185750757},{"_id":"themes/next/source/css/_schemes/Muse/_header.styl","hash":"06080fd963c904d96c00eff098a284e337953013","modified":1648185750776},{"_id":"public/search.xml","hash":"c343b4d8fbf57fa1e78d41fe61738562dd7deb28","modified":1653305271616},{"_id":"public/categories/index.html","hash":"615ebfb8cec32a113cf74f983b248331c6f62ce6","modified":1653305271616},{"_id":"public/about/index.html","hash":"149bd0b58ba84c01c6176e5ffc7d182efe25f43d","modified":1653305271616},{"_id":"public/tags/index.html","hash":"148fe9ab4a38d9894a645e51c22ac256138f67bd","modified":1653305271616},{"_id":"public/categories//index.html","hash":"3cdc5070b8ddd8488f5784a3e2d9b9e381576a19","modified":1653305271616},{"_id":"public/archives/index.html","hash":"4d323dd238fbc5075aadbd3139cc248802facc7d","modified":1653305271616},{"_id":"public/index.html","hash":"5fd0e02e90076ee74337395a9d0d8bdaf9bd8247","modified":1653305271616},{"_id":"public/archives/2022/index.html","hash":"92c166fc4147f8361ebf7ed94e47c8691e80d560","modified":1653305271616},{"_id":"public/archives/2022/03/index.html","hash":"ff75f739684b3d02381bf2f46a50c850036eef1c","modified":1650293009186},{"_id":"public/tags/hello/index.html","hash":"961fbfe8c5ec49db9b22cdfdea8cbfb37a01f389","modified":1653305271616},{"_id":"public/tags/hi/index.html","hash":"1facdde494b58e3a1536a6df22443f03093dca8e","modified":1653305271616},{"_id":"public/hello.html","hash":"b1e3fe3c7d788819fdbdd12faca965430bedccd0","modified":1650293009186},{"_id":"public/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1653305271616},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1650293009186},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1650293009186},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1650293009186},{"_id":"public/images/logo-algolia-nebula-blue-full.svg","hash":"b85e274207b1392782476a0430feac98db1e7da0","modified":1653305271616},{"_id":"public/images/logo.svg","hash":"f280334038d4e8aa2212cc15a1bb9720120822d2","modified":1653305271616},{"_id":"public/images/logo.webp","hash":"b4d7e069ccf4896a09480b68e7000f8658633069","modified":1653305271616},{"_id":"public/css/lightmode.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1653305271616},{"_id":"public/css/noscript.css","hash":"54d14cd43dc297950a4a8d39ec9644dd5fc3499f","modified":1653305271616},{"_id":"public/css/darkmode.css","hash":"d994b718a323ca0d5fb68ad5ac616a421d89c554","modified":1653305271616},{"_id":"public/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1653305271616},{"_id":"public/js/motion.js","hash":"6d4bd07a6f8e1b4083119dca0acb5b289533b619","modified":1653305271616},{"_id":"public/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1653305271616},{"_id":"public/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1653305271616},{"_id":"public/js/bookmark.js","hash":"0f563ffbf05fad30e854e413ab17ff7164ab5a53","modified":1653305271616},{"_id":"public/js/schedule.js","hash":"a1333258726caf84f368a8f8454639c7dc1626bb","modified":1653305271616},{"_id":"public/js/pjax.js","hash":"919f5281c4a04d11cfd94573ecf57b3dbabd3cc8","modified":1653305271616},{"_id":"public/js/next-boot.js","hash":"52dc9e11b167efd6be68b076a01dd6a3eb0eb644","modified":1653305271616},{"_id":"public/js/schemes/muse.js","hash":"9a836d2bcc3defe4bd1ee51f5f4eb7006ebdd41b","modified":1653305271616},{"_id":"public/js/utils.js","hash":"e447160d342b1f93df5214b6a733441039ced439","modified":1653305271616},{"_id":"public/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1653305271616},{"_id":"public/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1653305271616},{"_id":"public/js/third-party/fancybox.js","hash":"c098d14e65dd170537134358d4b8359ad0539c2c","modified":1653305271616},{"_id":"public/js/third-party/analytics/google-analytics.js","hash":"59684383385059dc4f8a1ff85dbbeb703bcdbcb5","modified":1653305271616},{"_id":"public/js/third-party/quicklink.js","hash":"eed02e6fced8e5a653077205d4d4d7834ca71472","modified":1653305271616},{"_id":"public/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1653305271616},{"_id":"public/js/third-party/chat/gitter.js","hash":"cc38c94125f90dadde11b5ebac7d8bf99a1a08a2","modified":1653305271616},{"_id":"public/js/third-party/comments/changyan.js","hash":"260d1a77d6a3bb33a579d3e4cca1997003e799b5","modified":1653305271616},{"_id":"public/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1653305271616},{"_id":"public/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1653305271616},{"_id":"public/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1653305271616},{"_id":"public/js/third-party/comments/disqus.js","hash":"e1cc671b0d524864fd445e3ab4ade9ee6d07e565","modified":1653305271616},{"_id":"public/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1653305271616},{"_id":"public/js/third-party/comments/disqusjs.js","hash":"b6c58f098473b526d6a3cd35655caf34b77f7cff","modified":1653305271616},{"_id":"public/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1653305271616},{"_id":"public/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1653305271616},{"_id":"public/js/third-party/rating.js","hash":"4e92c2d107ba47b47826829f9668030d5ea9bfb8","modified":1653305271616},{"_id":"public/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1653305271616},{"_id":"public/js/third-party/math/mathjax.js","hash":"5c749b9c1c3bb738122d0516211ecff6496d4907","modified":1653305271616},{"_id":"public/js/third-party/statistics/firestore.js","hash":"411a72df581f5b21317dc28633c7993207eb9e1c","modified":1653305271616},{"_id":"public/js/third-party/search/local-search.js","hash":"45c485f82258d246f37deb66884bd2643323ef3a","modified":1653305271616},{"_id":"public/js/third-party/tags/mermaid.js","hash":"f27d817b0c2138dd3215b1f46af0753f60a008f3","modified":1653305271616},{"_id":"public/js/third-party/search/algolia-search.js","hash":"a8737ff19eeba48654b835129c9cebdf90f758c8","modified":1653305271616},{"_id":"public/js/third-party/statistics/lean-analytics.js","hash":"5a928990856b8e456f0663cf3b6b406733672e39","modified":1653305271616},{"_id":"public/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1653305271616},{"_id":"public/css/main.css","hash":"09034813e2b458ce292755b63a4ccd06fb650541","modified":1653305271616},{"_id":"source/_posts/AtomSSH.md","hash":"f0015e4b181d2e992111111bfcd9d9d0aecbce13","modified":1652375263650},{"_id":"source/_posts/Linuxecho+tee.md","hash":"20f6c6add2588e4e8a8c7a659accf732d8702f10","modified":1652375287530},{"_id":"source/_posts/New Blog, New Start.md","hash":"62c9adffa2ccaa10bbd1f982d67974ad9da01e66","modified":1652375298151},{"_id":"source/_posts/Linuxsupervisor.md","hash":"c0e85b7203d7393a87d23ce688f877d8ab0fa0e7","modified":1652375281897},{"_id":"source/_posts/Firewalld.md","hash":"2758b8f461529fe10c0063b7ef78bdae5471f5dd","modified":1653198318560},{"_id":"source/_posts/nginx+lua.md","hash":"36c1450a52d5410d9275e5615a4e48f88c46d408","modified":1652375302952},{"_id":"source/_posts/iOSwebviewiframe.md","hash":"d161e0b9ee72961cd8cc0bd83570bcd4e4e5e7f2","modified":1652375275021},{"_id":"source/_posts/mysqlemoji.md","hash":"aad73e0d0fbf0e338a9d461c0c58f5e7a5b81d70","modified":1652375293618},{"_id":"source/_posts/Google Chrome.md","hash":"a8a11e7998263b34c63451be3922a1a0b5219223","modified":1652375194355},{"_id":"source/_posts/ipsetiptables.md","hash":"537cee20b90ddcf1ff66faf7ebf0cf26f926e0fb","modified":1652375222795},{"_id":"source/_posts/sshLinux.md","hash":"5de4898d80ebc6c5db997f9dda7322675512e2dc","modified":1652375213924},{"_id":"source/_posts/inotify+rsync.md","hash":"8543e081acc980fab9065220725f9a36b1dcbba7","modified":1652375147586},{"_id":"source/_posts/inotify+rsync.md","hash":"f4c243460faa1025819fcaf1afbc482e4cda2813","modified":1652375141269},{"_id":"source/_posts/Google AuthenticatorLinux SSH.md","hash":"cf44d95a2ec603bed21279997f06922c42fcd72e","modified":1652375153269},{"_id":"source/_posts/centos7OpenCCPHP Copencc4php.md","hash":"f5af48a74917d4a8f6b3861c7460ae4926eb58d3","modified":1652375235065},{"_id":"source/_posts/Centos7ffmpegffmpeg-devel.md","hash":"516339d382209cf0a8f72b317a4b7f0f904a963e","modified":1652375243196},{"_id":"source/_posts/centos7iptables.md","hash":"9020ed6d516f2e31a39cfd95d8d2179154c6d92a","modified":1652375229612},{"_id":"source/_posts/centos7Kafka.md","hash":"ecbfa1f5540b7cc660f109428d5922b06f25b33c","modified":1652375248941},{"_id":"source/_posts/linuxrabbitmq.md","hash":"8b26c95b27c5b7ae06040f1a8f0d9f4725f7989c","modified":1652375253763},{"_id":"source/_posts/NPS.md","hash":"c9db77ab5aa6bdfa8d77d2a014ff5e63e50c3f05","modified":1653198911471},{"_id":"source/_posts/OpenWRTLED.md","hash":"6003c284cb21fa95140e9d4465622e7fedd61744","modified":1652492458752},{"_id":"source/_posts/Docker.md","hash":"e3125f3d9ab3eba4da926a07eef9501f0b6d91cc","modified":1652375136443},{"_id":"source/_posts/mysql.md","hash":"448be302a5b3c38c6d6ae5a243b1140061aa981c","modified":1652375208791},{"_id":"source/_posts/.md","hash":"39a74cdbcadf2a8e582e4ad03af60ce3b35146e2","modified":1653198255595},{"_id":"source/_posts/Safari.md","hash":"0381cac157cdd7effe4a70da29f0f9415b1e15fc","modified":1652375201915},{"_id":"source/_posts/ESXIUSB.md","hash":"0c59270c9c66dce95c4fe734a8469c5f92c7fc6e","modified":1652375122123},{"_id":"source/_posts/OpenWRT.md","hash":"fe4a4abf3f0b1e7d94b5474c8af5f0dd2528dd92","modified":1652375258532},{"_id":"source/_posts/denyhostsIP.md","hash":"a3dd95787fa44f1548f73afc7092474f85d48484","modified":1652375131169},{"_id":"source/_posts/Leanote.md","hash":"8ffa7b80e90c1a49125141be355d73c7965427ae","modified":1652375181445},{"_id":"source/_posts/NAS.md","hash":"3d8d563b989b80c55fa61fda96a83242dc0ef34a","modified":1652375157910},{"_id":"source/_posts/swoole.md","hash":"1489d7fec1ed32f0c1c6d57d0d80f464c1e67592","modified":1652375188208},{"_id":"source/_posts/inotify+rsync.md","hash":"3527e85f546c135e86085d1390bd8657531cca49","modified":1652375176341},{"_id":"source/_posts/frmibdibdata1mysql.md","hash":"2f798efb758968746c6d63e21d3dead017b9932a","modified":1652375169142},{"_id":"source/_posts/Dockerpm2.md","hash":"43a1061ba2e1ccaec80e5e6bf9ca31906de4e68c","modified":1652375268542},{"_id":"source/_posts/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1652366380479},{"_id":"source/images/b9be3cae2d0a1c308d21909145aebf70.jpeg","hash":"43e2501cb07f9bbd99bfece1eef2382740754253","modified":1653198701393},{"_id":"source/about/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1652363495311},{"_id":"source/images/qrcode.jpeg","hash":"ca9f55e55c0096169026413c918b11fcb2acb0aa","modified":1650332245657},{"_id":"source/images/9644d159a79fb11b4a8416cc72a1bdc44fcb718c-fp-2000-500-0-0.jpeg","hash":"109dd55b08fd74bcec79276265aa30e3b8a30914","modified":1653198027390},{"_id":"source/images/nps3.jpg","hash":"c9b8e7bb106b51498c70a7dc3fa9b4ac8485e857","modified":1583311032000},{"_id":"source/images/nps1.jpg","hash":"9a77d6fbcb2b639bb1a4e96b4b2384b097725a7e","modified":1583310200000},{"_id":"source/images/nps2.jpg","hash":"d49f491b5ff30e39ea86460de9b6ad972e6a57cb","modified":1583310099000},{"_id":"source/_posts/waf.md","hash":"4cbd098f72ee9211a9673c2d411b6bdf43b811bf","modified":1652375309998},{"_id":"themes/next/source/images/favicon-32x32.png","hash":"6bc4a65ff953e1a7643e656ca65826dce7d986fd","modified":1650334447567},{"_id":"themes/next/source/images/favicon-16x16.png","hash":"aaef66600bbe15d36bdd2867db4cc0aea5f0fc6f","modified":1650334562820},{"_id":"themes/next/source/images/apple-touch-icon.png","hash":"5c2c69ebe3fee831d3dcd35e8f4ff26f8fcdf490","modified":1650334409360},{"_id":"source/images/1617782228929766s.png","hash":"f6e89ee284b62c61362ac406f5211eb3e91fcc36","modified":1653198200081},{"_id":"public/atom.xml","hash":"670e1e86b72d50074317f66c50d42fd6c85e214b","modified":1653305271616},{"_id":"public/new-blog-new-start.html","hash":"bdeecee377919c608f9950cb3cf782f18b84d3cc","modified":1653305271616},{"_id":"public/archives/page/4/index.html","hash":"4fd81fac6a08424122d460453822589057207582","modified":1653305271616},{"_id":"public/archives/2017/index.html","hash":"ceceaa0113caf91115bbf95196d756715a5e12fd","modified":1653305271616},{"_id":"public/archives/2017/11/index.html","hash":"4a44dc7e871fb82d7befce01fd94a0988dc5bdcf","modified":1653305271616},{"_id":"public/archives/2018/page/3/index.html","hash":"f599350cfd217b9c2e59166e32b7e8698905a55f","modified":1653305271616},{"_id":"public/archives/2018/01/index.html","hash":"2281c3d58bdd437e2890e68418f2a5efa9acc20b","modified":1653305271616},{"_id":"public/archives/2018/02/index.html","hash":"8315211ec35e347e7a9e56c9be3c422212a0a7c5","modified":1653305271616},{"_id":"public/archives/2018/03/index.html","hash":"076e6bd5a611c0b5c2ed0824573fff3a35ef313c","modified":1653305271616},{"_id":"public/archives/2018/04/index.html","hash":"5e57bf001004b795b612bb18e47d7164c8610c4d","modified":1653305271616},{"_id":"public/archives/2018/05/index.html","hash":"9d6fc91689762b35418f914d73233a2580935c54","modified":1653305271616},{"_id":"public/archives/2018/06/index.html","hash":"cd0a67126283aa608955f0d1e572ee2b4698b7b0","modified":1653305271616},{"_id":"public/archives/2018/07/index.html","hash":"047fa4384987af9322a5798e7e23b9c233721137","modified":1653305271616},{"_id":"public/archives/2018/08/index.html","hash":"d0ff5425d50c19300735e652341fa060db6126ae","modified":1653305271616},{"_id":"public/archives/2018/09/index.html","hash":"8b246eeab47711aa750559a3682831125b388a48","modified":1653305271616},{"_id":"public/archives/2018/10/index.html","hash":"0b16c1978919692f75f38d531fc7c802d5b8a834","modified":1653305271616},{"_id":"public/archives/2018/11/index.html","hash":"a370a5c871cd04b9b3802a3c7307407a0fe3e4bc","modified":1653305271616},{"_id":"public/archives/2020/index.html","hash":"36a32bf98eed1110a614ec2e24fff3fccdd0e894","modified":1653305271616},{"_id":"public/archives/2020/02/index.html","hash":"3c75aa13d79da145e6096119d67e3a4a27650a59","modified":1653305271616},{"_id":"public/archives/2020/03/index.html","hash":"270ba62b54a6e50dc58f95a258a4b9ea60624d50","modified":1653305271616},{"_id":"public/archives/2022/04/index.html","hash":"e8e816b4f177b2eabf0e55adad61dd277ba56f96","modified":1653305271616},{"_id":"public/archives/2022/05/index.html","hash":"e8a1a631372ccfe16689ad3887d1283ea3a28e4f","modified":1653305271616},{"_id":"public/tags/Atom/index.html","hash":"09714c215b15ed5954a1e7f4575d31388dee932a","modified":1653305271616},{"_id":"public/tags/SSH/index.html","hash":"07d40c6612cbf21bf175a7116fba585cc09440ec","modified":1653305271616},{"_id":"public/tags/docker/index.html","hash":"859a036e5c877dd8d47d235429908991930925a9","modified":1653305271616},{"_id":"public/tags/pm2/index.html","hash":"5923646372b9be412894cbc2cf20dd7d1a6e4c77","modified":1653305271616},{"_id":"public/tags//index.html","hash":"c8ca7deb3533dedff9f5e1727743dd0c47b862b9","modified":1653305271616},{"_id":"public/tags/Firewalld/index.html","hash":"33fed279f35d82a71e21107ea23a253fa5d72852","modified":1653305271616},{"_id":"public/tags//index.html","hash":"e6f75f4f50877deec7b9f894ac68b294eb60cd22","modified":1653305271616},{"_id":"public/tags/ipset/index.html","hash":"f79661a02eb15fd7b15be67e3f1f1a2bb9dd4710","modified":1653305271616},{"_id":"public/tags//index.html","hash":"9cfb8c440db763644503a90c118770a94488d1b6","modified":1653305271616},{"_id":"public/tags/supervisor/index.html","hash":"afc5797e4ad2d05efa36c42117875dbc5a164b62","modified":1653305271616},{"_id":"public/tags//index.html","hash":"a6456df255b9d293dd42b0e1702021ead4cdc252","modified":1653305271616},{"_id":"public/tags/echo/index.html","hash":"0b50b128a8b4ef4023b804c3c9996ce31eb93d3b","modified":1653305271616},{"_id":"public/tags/tee/index.html","hash":"0f9419864d9a90f3847163370f8648352c8cd80f","modified":1653305271616},{"_id":"public/tags//index.html","hash":"605c24bdc9fbf88d6399a381d76d103d689fcf63","modified":1653305271616},{"_id":"public/tags/iframe/index.html","hash":"8ff63dddd0ef2991711bd520b68c25bd83996821","modified":1653305271616},{"_id":"public/tags//index.html","hash":"16ab6bf1bc56be33609a08cce9b76d7f29854553","modified":1653305271616},{"_id":"public/tags/mysql/index.html","hash":"23c7ba1eef4bd9fadc00d8f10e32831466fa4c25","modified":1653305271616},{"_id":"public/tags/emoji/index.html","hash":"9b3faf10c795f406cfab54473d1e482eaaf57ad6","modified":1653305271616},{"_id":"public/tags/nginx/index.html","hash":"8154fee8be00b5647613c63519d5c11cc573e45b","modified":1653305271616},{"_id":"public/tags/lua/index.html","hash":"a68b1497a31f9213cfc39b9c75e64735f072ff40","modified":1653305271616},{"_id":"public/tags/waf/index.html","hash":"a61fd64ed615f5d3b383d13dc4b23cc1e521b74a","modified":1653305271616},{"_id":"public/tags/google-chrome/index.html","hash":"758149c84d609dbae0100ee78a8124159103a4f2","modified":1653305271616},{"_id":"public/tags/iptables/index.html","hash":"7db63ed74093f94d89b7b20e141f5d4a2350b7ad","modified":1653305271616},{"_id":"public/tags/ssh/index.html","hash":"efc6cb4c527fc586e484e60f4cb336b81cd909fe","modified":1653305271616},{"_id":"public/tags/inotify/index.html","hash":"58cc42ad79b826a2fdd63bad2013cd46dc0915ee","modified":1653305271616},{"_id":"public/tags/rsync/index.html","hash":"68255bded0a5e31dd3a2343f57361f3655467284","modified":1653305271616},{"_id":"public/tags//index.html","hash":"9805da3faa57b2e562e7663aeca5b3bb53447417","modified":1653305271616},{"_id":"public/tags/SSH/index.html","hash":"da08e5db827ce75c39d388f21669b620bf42785a","modified":1653305271616},{"_id":"public/tags//index.html","hash":"928529d20477bac6dc1b1307627803e3bedd6915","modified":1653305271616},{"_id":"public/tags/ffmpeg/index.html","hash":"107d3a64a346e2a81e2b370e15404ae58eae3ab7","modified":1653305271616},{"_id":"public/tags/OpenCC/index.html","hash":"bb7a9df7816c136f9e2a4b75080a90abb48557db","modified":1653305271616},{"_id":"public/tags/kafka/index.html","hash":"94bdbcac6cbfba801836fd339cc054c6fc08a38a","modified":1653305271616},{"_id":"public/tags//index.html","hash":"7c23645a7c0262cdd42e3e30d51c2ca7c9d7f9a2","modified":1653305271616},{"_id":"public/tags/rabbitmq/index.html","hash":"28bfa1b114dc7e487d1d365fb72f74e676d25bd0","modified":1653305271616},{"_id":"public/tags/nps/index.html","hash":"88fee391a7c1eac754d8ce93d3c9a8ebc738edd3","modified":1653305271616},{"_id":"public/tags//index.html","hash":"e3e3d156445f577373a30c3023fda050660a17d3","modified":1653305271616},{"_id":"public/tags//index.html","hash":"08c0effaf1334d97e942da3d759d16875b78be6a","modified":1653305271616},{"_id":"public/tags/OpenWRT/index.html","hash":"3d784971a89cde5e6f501dd29ad9773c081c2174","modified":1653305271616},{"_id":"public/tags//index.html","hash":"dda784b9ee3e2602ce887d1cd3a2dea59f3ad81b","modified":1653305271616},{"_id":"public/tags/Docker/index.html","hash":"d980f51ce025f10a78977bc38b22f8b218a0f6ee","modified":1653305271616},{"_id":"public/tags//index.html","hash":"7fe06b7a6dc7d78c555319190b46655c74144021","modified":1653305271616},{"_id":"public/tags//index.html","hash":"dc462e271f97c627f0b17ee59522a66335d065e3","modified":1653305271616},{"_id":"public/tags/safari/index.html","hash":"c2bd95a5a0468093c58d54d69fc2846325be4a3a","modified":1653305271616},{"_id":"public/tags/esxi/index.html","hash":"1cc2f0e0f719359aa4205b3e79aef361cf50de4c","modified":1653305271616},{"_id":"public/tags//index.html","hash":"9ae68a0a290fb6ccdefd052008d23ecb9e38911b","modified":1653305271616},{"_id":"public/tags//index.html","hash":"0f5d32ae6f5bd0aa100e5b93ab932c00827add4b","modified":1653305271616},{"_id":"public/tags/denyhosts/index.html","hash":"6c2d99926ded736d053cf03e2f9cd165390b709d","modified":1653305271616},{"_id":"public/the-most-common-usage-firewalld.html","hash":"7e5220da0f49b5452814286e26a067b95074d281","modified":1653305271616},{"_id":"public/ransom-email.html","hash":"f9be5b57d6f51b97585650ccbcca3ade96669e35","modified":1653305271616},{"_id":"public/a-light-weight-network-penetration-tool-nps.html","hash":"a9e95ad7526cb9c261d0dd005fc1f679c8919be7","modified":1653305271616},{"_id":"public/ding-shi-kai-guan-openwrtde-led.html","hash":"82e573689619b30abccae5218cd13f54d399620d","modified":1653305271616},{"_id":"public/zi-ding-yi-openwrtde-qi-dong-jiao-ben.html","hash":"dc396b3d212b831e3ec89b041a2fd5ab4432da9f","modified":1653305271616},{"_id":"public/shuo-yi-shuo-qun-hui-ban-ben-de-inotify-rsynctong-bu.html","hash":"9dc96f10bc73ab6d945f2804ddbdd0319e5d0e2b","modified":1653305271616},{"_id":"public/create-and-remove-use-partition-on-esxi.html","hash":"f4d74051667da60c0ecfbdfc0d3b7a3018aba7c3","modified":1653305271616},{"_id":"public/login-ssh-with-2fa-authentication-by-google-authencator.html","hash":"70ac9cd436abed6701a22960105da2d177ed28aa","modified":1653305271616},{"_id":"public/sync-data-realtime-with-inotify-rsync.html","hash":"a3df42463b4c7fda51e08fde42105e4bdb0448a1","modified":1653305271616},{"_id":"public/quickly-delete-dockers-containtor-and-images.html","hash":"2fd60ce349206f93a3b06e98dde5f451ccf82c11","modified":1653305271616},{"_id":"public/install-google-chrome-local-extensions.html","hash":"4977722e35e44d0e7afdfb82085828bd61e05f95","modified":1653305271616},{"_id":"public/the-right-way-of-startup-to-docker-and-pm2.html","hash":"8885eca2a4a28adb3d3effdb961fae964fc36467","modified":1653305271616},{"_id":"public/operate-many-files-in-echo-and-tee-on-linux.html","hash":"179091b090191759680ac6ad3b1a2dca8fdc5c7f","modified":1653305271616},{"_id":"public/connecting-server-through-said-agent.html","hash":"a37881b21d713d1562a307a9aa67154eefa8c34d","modified":1653305271616},{"_id":"public/the-modification-of-waf-firewall.html","hash":"9e7f69f1b56c6efedcfb15f4ae2f76352d5f4506","modified":1653305271616},{"_id":"public/about-swoole-installtion.html","hash":"583253012d1a4ccdd4393f6daf113f8eba4d2dfb","modified":1653305271616},{"_id":"public/shutdown-after-offline-on-pc-and-nas.html","hash":"3c44317205661785814ab5004ad880faa676a228","modified":1653305271616},{"_id":"public/install-rabbitmq-on-linux.html","hash":"2aa5dc32a84b5b7954c361c1656e2a8709f76185","modified":1653305271616},{"_id":"public/a-backup-method-for-mini-mysql-database.html","hash":"432cdc73fd89e459bb58a2840573f43e265129fa","modified":1653305271616},{"_id":"public/sync-data-realtime-with-inotify-rsync-v2.html","hash":"20c445d3d9ba173d6521d10e01838c8785c1717e","modified":1653305271616},{"_id":"public/run-daemon-process-with-supervisor-on-linux.html","hash":"68eb98a274dceff8a33afbd06d64f897464d8ed0","modified":1653305271616},{"_id":"public/storing-emoji-in-mysql.html","hash":"4d03384ec58d207e9e72dc50a4418f9e8865a9f2","modified":1653305271616},{"_id":"public/install-ffpmeg-and-ffmpeg-devel-on-centos7.html","hash":"1d8124c5abd5788634698a97ebd048659b22b273","modified":1653305271616},{"_id":"public/the-use-of-feelings-on-leanote.html","hash":"1e2cef7662d12cba7dc64c6170e96d26cac5a5ed","modified":1653305271616},{"_id":"public/install-the-php-c-extension-opencc.html","hash":"2792eeee1a0f3b4d9febebfc6a96d513fab642d7","modified":1653305271616},{"_id":"public/recovering-mysql-database-with-frm-ibd-ibdata1.html","hash":"044673678d9c2a727f6a1f4eb6354e56c4ff51e7","modified":1653305271616},{"_id":"public/logining-ssh-without-password-on-linux.html","hash":"6e752c4f1fc245855c4b169a8e6779b1d83369cf","modified":1653305271616},{"_id":"public/delete-all-safari-bookmarks.html","hash":"e19a5f1a720344dca0720ebcc1d8bf0a2cc0b4df","modified":1653305271616},{"_id":"public/install-nginx-and-lua.html","hash":"751290f6b744fd51e305368254550c77d28be72f","modified":1653305271616},{"_id":"public/install-iptables-as-firewall-on-centos7.html","hash":"2b852ffac36c2da36b9ce04a614ab4298425fed9","modified":1653305271616},{"_id":"public/talking-about-iptables-and-ipset.html","hash":"026ab030aed1de57bfe4777cfd18a5262ba00003","modified":1653305271616},{"_id":"public/remove-the-ip-blocked-by-denyhosts.html","hash":"77ee140593f41e9dcf808b1aefdc467d826878f1","modified":1653305271616},{"_id":"public/install-kafka-on-centos-7.html","hash":"2ff9608a210bc5fbf96e8952d91cdce690c1bbae","modified":1653305271616},{"_id":"public/rolling-iframe-webpage-content-in-webview-of-ios.html","hash":"a4e1bae64bf62bada488dfd72c46e32a6073e97d","modified":1653305271616},{"_id":"public/categories//index.html","hash":"2a72cac646890fe6b091ba75d13a293bf246ca77","modified":1653305271616},{"_id":"public/categories//page/2/index.html","hash":"67f39c3d480759b2d206834b93c3c79559e1f10b","modified":1653305271616},{"_id":"public/categories//page/3/index.html","hash":"7a18c35af8ac5b5495ea23185a7e79b286f0876d","modified":1653305271616},{"_id":"public/archives/page/2/index.html","hash":"bac185a93c56fcffd64314561584d2c1624d4bcf","modified":1653305271616},{"_id":"public/archives/page/3/index.html","hash":"efaa9465e636e12693b6d51542ae7ac9b05a54d5","modified":1653305271616},{"_id":"public/archives/2018/index.html","hash":"8855df16946a1132dbe2aec7fea7bacbae3a95be","modified":1653305271616},{"_id":"public/archives/2018/page/2/index.html","hash":"851a6f1f71b74d2de2eab63155845240c88f2d4a","modified":1653305271616},{"_id":"public/tags/ups/index.html","hash":"68598fa3ad5de19cb20e2067d47afddd10b78dff","modified":1653305271616},{"_id":"public/tags/NAS/index.html","hash":"da1fee84d456c077f57059a73700c00538b7d5a3","modified":1653305271616},{"_id":"public/tags//index.html","hash":"12ad042da368ddf9b3d73fe49995c5ae17f2e5d4","modified":1653305271616},{"_id":"public/tags/Leanote/index.html","hash":"9d9f552aa14e116cd02aa1f8eade4b1b0382b194","modified":1653305271616},{"_id":"public/tags//index.html","hash":"17982288f915caea8bcbaa0b7d19b2b592b28bee","modified":1653305271616},{"_id":"public/tags//index.html","hash":"4e3b2aa0aec63da9e483393fe4e99dcf176d0d1a","modified":1653305271616},{"_id":"public/tags/swoole/index.html","hash":"732676ebc644d8f05749bc54dc7a2389363b1cfb","modified":1653305271616},{"_id":"public/page/2/index.html","hash":"30fcd04c56e4a62f22735076c6132ffa72d67136","modified":1653305271616},{"_id":"public/page/3/index.html","hash":"493bf97f1ed66e66fc454e6ae7644a9144a8ffef","modified":1653305271616},{"_id":"public/page/4/index.html","hash":"a3b830e9f5f2091294935dddf016608dde34f378","modified":1653305271616},{"_id":"public/images/favicon-16x16.png","hash":"aaef66600bbe15d36bdd2867db4cc0aea5f0fc6f","modified":1653305271616},{"_id":"public/images/favicon-32x32.png","hash":"6bc4a65ff953e1a7643e656ca65826dce7d986fd","modified":1653305271616},{"_id":"public/images/b9be3cae2d0a1c308d21909145aebf70.jpeg","hash":"43e2501cb07f9bbd99bfece1eef2382740754253","modified":1653305271616},{"_id":"public/images/apple-touch-icon.png","hash":"5c2c69ebe3fee831d3dcd35e8f4ff26f8fcdf490","modified":1653305271616},{"_id":"public/images/nps3.jpg","hash":"c9b8e7bb106b51498c70a7dc3fa9b4ac8485e857","modified":1653305271616},{"_id":"public/images/qrcode.jpeg","hash":"ca9f55e55c0096169026413c918b11fcb2acb0aa","modified":1653305271616},{"_id":"public/images/nps1.jpg","hash":"9a77d6fbcb2b639bb1a4e96b4b2384b097725a7e","modified":1653305271616},{"_id":"public/images/9644d159a79fb11b4a8416cc72a1bdc44fcb718c-fp-2000-500-0-0.jpeg","hash":"109dd55b08fd74bcec79276265aa30e3b8a30914","modified":1653305271616},{"_id":"public/images/nps2.jpg","hash":"d49f491b5ff30e39ea86460de9b6ad972e6a57cb","modified":1653305271616},{"_id":"public/images/1617782228929766s.png","hash":"f6e89ee284b62c61362ac406f5211eb3e91fcc36","modified":1653305271616}],"Category":[{"name":"","_id":"cl16op5qv00036itd16gc2ooy"},{"name":"","_id":"cl3in6atv0002lvtdaeui7ixh"}],"Data":[],"Page":[{"title":"","date":"2022-03-25T13:59:03.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: \ndate: 2022-03-25 21:59:03\ntype: \"categories\"\n---\n","updated":"2022-03-25T14:00:42.055Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cl16op5ql00006itd2mpphkx9","content":"","site":{"data":{}},"length":0,"excerpt":"","more":""},{"title":"","date":"2022-03-25T05:27:31.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: \ndate: 2022-03-25 13:27:31\ntype: tags\n---\n","updated":"2022-03-25T14:00:57.334Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cl16op5qt00026itd3bdd4d10","content":"","site":{"data":{}},"length":0,"excerpt":"","more":""},{"title":"","date":"2018-10-28T00:42:30.000Z","type":"about","_content":"\n## 1.0\n\nrelease\n\n\n\n\n\n## 2.0\n\nrelease\n\n\n\n\n\n","source":"about/index.md","raw":"---\ntitle: \ndate: 2018-10-28 08:42:30\ntype: about\n---\n\n## 1.0\n\nrelease\n\n\n\n\n\n## 2.0\n\nrelease\n\n\n\n\n\n","updated":"2022-05-12T13:48:12.003Z","path":"about/index.html","_id":"cl16op5qx00056itdabqh2m9n","comments":1,"layout":"page","content":"<h2 id=\"1-0\"><a href=\"#1-0\" class=\"headerlink\" title=\"1.0\"></a>1.0</h2><p>release</p>\n<p></p>\n<p></p>\n<h2 id=\"2-0\"><a href=\"#2-0\" class=\"headerlink\" title=\"2.0\"></a>2.0</h2><p>release</p>\n<p></p>\n<p></p>\n<p></p>\n","site":{"data":{}},"length":582,"excerpt":"","more":"<h2 id=\"1-0\"><a href=\"#1-0\" class=\"headerlink\" title=\"1.0\"></a>1.0</h2><p>release</p>\n<p></p>\n<p></p>\n<h2 id=\"2-0\"><a href=\"#2-0\" class=\"headerlink\" title=\"2.0\"></a>2.0</h2><p>release</p>\n<p></p>\n<p></p>\n<p></p>\n"}],"Post":[{"title":"AtomSSH","date":"2018-10-28T00:15:59.000Z","url":"connecting-server-through-said-agent","description":"AtomXshell","_content":"\n> AtomXshell\n\n## \n\n\n\n## \n\nshadowsocks1080\n\n## windows\n\nwindowssocks5windowsproxifierproxifierproxifier-127.0.0.11080SOCKS\nVersion 5proxifier\n\n## Mac\n\nMacProxychains-ngRelease4.13Githubhttps://github.com/rofl0r/proxychains-ng\n\n### \n\n```\nwget https://github.com/rofl0r/proxychains-ng/archive/v4.13.tar.gz\ntar xzf v4.13.tar.gz\ncd proxychains-ng*\n./configure --prefix=/usr --sysconfdir=/etc\nmake\nmake install\nmake install-config\n```\n\n### homebrew\n\n```\nbrew install proxychains-ng\n```\n\nhomebrewhomebrewhttps://brew.shhomebrew\n\n### SIP\n\nmacOS 10.11  SIPSystem Integrity ProtectionProxychains-ngSIP\n\n 1. Mac + RRecovery\n 2. Utilities-> Terminal\n 3. csrutil disable\n 4.  csrutil statusSystem Integrity Protection\n    status:disabled\n\n### Proxychains-ng\n\n * /etc/proxychains.conf\n * homebrew/usr/local/etc/proxychains.conf\n\n[ProxyList]socks5 127.0.0.1 1080\n\n### Proxychains-ng\n\n```\nproxychains \n```\n\natom\n\n```\nln -s /Applications/Atom.app/Contents/Resources/app/atom.sh /usr/local/bin/atom\nproxychains atom\n```\n\nproxychains\n\n## Linux\n\nLinuxproxychainsGithubhttps://github.com/haad/proxychains\n\n```\nwget https://github.com/haad/proxychains/archive/proxychains-4.2.0.tar.gz\ncd proxychains-proxychains*\n./configure\nmake\nsudo make install\n```\n\nproxychains-ngproxychains-ngproxychains\n\n## \n\nproxifierMacproxifierhttps://www.proxifier.com","source":"_posts/AtomSSH.md","raw":"---\ntitle: AtomSSH\ndate: 2018-10-28 08:15:59\ntags: \n  - Atom\n  - SSH\ncategories:\n  - \nurl: connecting-server-through-said-agent\ndescription: AtomXshell\n---\n\n> AtomXshell\n\n## \n\n\n\n## \n\nshadowsocks1080\n\n## windows\n\nwindowssocks5windowsproxifierproxifierproxifier-127.0.0.11080SOCKS\nVersion 5proxifier\n\n## Mac\n\nMacProxychains-ngRelease4.13Githubhttps://github.com/rofl0r/proxychains-ng\n\n### \n\n```\nwget https://github.com/rofl0r/proxychains-ng/archive/v4.13.tar.gz\ntar xzf v4.13.tar.gz\ncd proxychains-ng*\n./configure --prefix=/usr --sysconfdir=/etc\nmake\nmake install\nmake install-config\n```\n\n### homebrew\n\n```\nbrew install proxychains-ng\n```\n\nhomebrewhomebrewhttps://brew.shhomebrew\n\n### SIP\n\nmacOS 10.11  SIPSystem Integrity ProtectionProxychains-ngSIP\n\n 1. Mac + RRecovery\n 2. Utilities-> Terminal\n 3. csrutil disable\n 4.  csrutil statusSystem Integrity Protection\n    status:disabled\n\n### Proxychains-ng\n\n * /etc/proxychains.conf\n * homebrew/usr/local/etc/proxychains.conf\n\n[ProxyList]socks5 127.0.0.1 1080\n\n### Proxychains-ng\n\n```\nproxychains \n```\n\natom\n\n```\nln -s /Applications/Atom.app/Contents/Resources/app/atom.sh /usr/local/bin/atom\nproxychains atom\n```\n\nproxychains\n\n## Linux\n\nLinuxproxychainsGithubhttps://github.com/haad/proxychains\n\n```\nwget https://github.com/haad/proxychains/archive/proxychains-4.2.0.tar.gz\ncd proxychains-proxychains*\n./configure\nmake\nsudo make install\n```\n\nproxychains-ngproxychains-ngproxychains\n\n## \n\nproxifierMacproxifierhttps://www.proxifier.com","slug":"AtomSSH","published":1,"updated":"2022-05-12T17:07:43.650Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6atq0000lvtdg9zkf6jo","content":"<blockquote>\n<p>AtomXshell</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>shadowsocks1080</p>\n<h2 id=\"windows\"><a href=\"#windows\" class=\"headerlink\" title=\"windows\"></a>windows</h2><p>windowssocks5windowsproxifierproxifierproxifier-127.0.0.11080SOCKS<br>Version 5proxifier</p>\n<h2 id=\"Mac\"><a href=\"#Mac\" class=\"headerlink\" title=\"Mac\"></a>Mac</h2><p>MacProxychains-ngRelease4.13Github<a href=\"https://github.com/rofl0r/proxychains-ng%E3%80%82\">https://github.com/rofl0r/proxychains-ng</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/rofl0r/proxychains-ng/archive/v4.13.tar.gz</span><br><span class=\"line\">tar xzf v4.13.tar.gz</span><br><span class=\"line\">cd proxychains-ng*</span><br><span class=\"line\">./configure --prefix=/usr --sysconfdir=/etc</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br><span class=\"line\">make install-config</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"homebrew\"><a href=\"#homebrew\" class=\"headerlink\" title=\"homebrew\"></a>homebrew</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install proxychains-ng</span><br></pre></td></tr></table></figure>\n\n<p>homebrewhomebrew<a href=\"https://brew.sh.homebrew,./\">https://brew.shhomebrew</a></p>\n<h3 id=\"SIP\"><a href=\"#SIP\" class=\"headerlink\" title=\"SIP\"></a>SIP</h3><p>macOS 10.11  SIPSystem Integrity ProtectionProxychains-ngSIP</p>\n<ol>\n<li>Mac + RRecovery</li>\n<li>Utilities-&gt; Terminal</li>\n<li>csrutil disable</li>\n<li> csrutil statusSystem Integrity Protection<br>status:disabled</li>\n</ol>\n<h3 id=\"Proxychains-ng\"><a href=\"#Proxychains-ng\" class=\"headerlink\" title=\"Proxychains-ng\"></a>Proxychains-ng</h3><ul>\n<li>&#x2F;etc&#x2F;proxychains.conf</li>\n<li>homebrew&#x2F;usr&#x2F;local&#x2F;etc&#x2F;proxychains.conf</li>\n</ul>\n<p>[ProxyList]socks5 127.0.0.1 1080</p>\n<h3 id=\"Proxychains-ng\"><a href=\"#Proxychains-ng\" class=\"headerlink\" title=\"Proxychains-ng\"></a>Proxychains-ng</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">proxychains </span><br></pre></td></tr></table></figure>\n\n<p>atom</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s /Applications/Atom.app/Contents/Resources/app/atom.sh /usr/local/bin/atom</span><br><span class=\"line\">proxychains atom</span><br></pre></td></tr></table></figure>\n\n<p>proxychains</p>\n<h2 id=\"Linux\"><a href=\"#Linux\" class=\"headerlink\" title=\"Linux\"></a>Linux</h2><p>LinuxproxychainsGithub<a href=\"https://github.com/haad/proxychains%E3%80%82%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4%E5%A6%82%E4%B8%8B%EF%BC%9A\">https://github.com/haad/proxychains</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/haad/proxychains/archive/proxychains-4.2.0.tar.gz</span><br><span class=\"line\">cd proxychains-proxychains*</span><br><span class=\"line\">./configure</span><br><span class=\"line\">make</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure>\n\n<p>proxychains-ngproxychains-ngproxychains</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>proxifierMacproxifier<a href=\"https://www.proxifier.com/\">https://www.proxifier.com</a></p>\n","site":{"data":{}},"length":2088,"excerpt":"","more":"<blockquote>\n<p>AtomXshell</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>shadowsocks1080</p>\n<h2 id=\"windows\"><a href=\"#windows\" class=\"headerlink\" title=\"windows\"></a>windows</h2><p>windowssocks5windowsproxifierproxifierproxifier-127.0.0.11080SOCKS<br>Version 5proxifier</p>\n<h2 id=\"Mac\"><a href=\"#Mac\" class=\"headerlink\" title=\"Mac\"></a>Mac</h2><p>MacProxychains-ngRelease4.13Github<a href=\"https://github.com/rofl0r/proxychains-ng%E3%80%82\">https://github.com/rofl0r/proxychains-ng</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/rofl0r/proxychains-ng/archive/v4.13.tar.gz</span><br><span class=\"line\">tar xzf v4.13.tar.gz</span><br><span class=\"line\">cd proxychains-ng*</span><br><span class=\"line\">./configure --prefix=/usr --sysconfdir=/etc</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br><span class=\"line\">make install-config</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"homebrew\"><a href=\"#homebrew\" class=\"headerlink\" title=\"homebrew\"></a>homebrew</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install proxychains-ng</span><br></pre></td></tr></table></figure>\n\n<p>homebrewhomebrew<a href=\"https://brew.sh.homebrew,./\">https://brew.shhomebrew</a></p>\n<h3 id=\"SIP\"><a href=\"#SIP\" class=\"headerlink\" title=\"SIP\"></a>SIP</h3><p>macOS 10.11  SIPSystem Integrity ProtectionProxychains-ngSIP</p>\n<ol>\n<li>Mac + RRecovery</li>\n<li>Utilities-&gt; Terminal</li>\n<li>csrutil disable</li>\n<li> csrutil statusSystem Integrity Protection<br>status:disabled</li>\n</ol>\n<h3 id=\"Proxychains-ng\"><a href=\"#Proxychains-ng\" class=\"headerlink\" title=\"Proxychains-ng\"></a>Proxychains-ng</h3><ul>\n<li>&#x2F;etc&#x2F;proxychains.conf</li>\n<li>homebrew&#x2F;usr&#x2F;local&#x2F;etc&#x2F;proxychains.conf</li>\n</ul>\n<p>[ProxyList]socks5 127.0.0.1 1080</p>\n<h3 id=\"Proxychains-ng\"><a href=\"#Proxychains-ng\" class=\"headerlink\" title=\"Proxychains-ng\"></a>Proxychains-ng</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">proxychains </span><br></pre></td></tr></table></figure>\n\n<p>atom</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s /Applications/Atom.app/Contents/Resources/app/atom.sh /usr/local/bin/atom</span><br><span class=\"line\">proxychains atom</span><br></pre></td></tr></table></figure>\n\n<p>proxychains</p>\n<h2 id=\"Linux\"><a href=\"#Linux\" class=\"headerlink\" title=\"Linux\"></a>Linux</h2><p>LinuxproxychainsGithub<a href=\"https://github.com/haad/proxychains%E3%80%82%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4%E5%A6%82%E4%B8%8B%EF%BC%9A\">https://github.com/haad/proxychains</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/haad/proxychains/archive/proxychains-4.2.0.tar.gz</span><br><span class=\"line\">cd proxychains-proxychains*</span><br><span class=\"line\">./configure</span><br><span class=\"line\">make</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure>\n\n<p>proxychains-ngproxychains-ngproxychains</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>proxifierMacproxifier<a href=\"https://www.proxifier.com/\">https://www.proxifier.com</a></p>\n"},{"title":"Dockerpm2","date":"2018-10-28T12:08:13.000Z","url":"the-right-way-of-startup-to-docker-and-pm2","description":"Dockerpm2Dockerpm2","_content":"\n> Dockerpm2Dockerpm2\n\n## Docker\n\ndockerinit.drc.localdocker\n\n```\ndocker run --restart=always \n```\n\n## pm2\n\npm2nodejspm2pm2pm2\n\n```\npm2 start /home/node/web/pm2.json\npm2 save\npm2 startup\npm2 stop all\npm2 kill\n```\n\n**/etc/systemd/system**pm2.servicepm2.service\n\n```\nsystemctl enable pm2.service\n```\n\n\n## \n\ncentos7centoslinuxmacOS\n\n","source":"_posts/Dockerpm2.md","raw":"---\ntitle: Dockerpm2\ndate: 2018-10-28 20:08:13\ntags: \n  - docker\n  - pm2\n  - \ncategories:\n  - \nurl: the-right-way-of-startup-to-docker-and-pm2\ndescription: Dockerpm2Dockerpm2\n---\n\n> Dockerpm2Dockerpm2\n\n## Docker\n\ndockerinit.drc.localdocker\n\n```\ndocker run --restart=always \n```\n\n## pm2\n\npm2nodejspm2pm2pm2\n\n```\npm2 start /home/node/web/pm2.json\npm2 save\npm2 startup\npm2 stop all\npm2 kill\n```\n\n**/etc/systemd/system**pm2.servicepm2.service\n\n```\nsystemctl enable pm2.service\n```\n\n\n## \n\ncentos7centoslinuxmacOS\n\n","slug":"Dockerpm2","published":1,"updated":"2022-05-12T17:07:48.542Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6atu0001lvtdfh2c3tpa","content":"<blockquote>\n<p>Dockerpm2Dockerpm2</p>\n</blockquote>\n<h2 id=\"Docker\"><a href=\"#Docker\" class=\"headerlink\" title=\"Docker\"></a>Docker</h2><p>dockerinit.drc.localdocker</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --restart=always </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"pm2\"><a href=\"#pm2\" class=\"headerlink\" title=\"pm2\"></a>pm2</h2><p>pm2nodejspm2pm2pm2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pm2 start /home/node/web/pm2.json</span><br><span class=\"line\">pm2 save</span><br><span class=\"line\">pm2 startup</span><br><span class=\"line\">pm2 stop all</span><br><span class=\"line\">pm2 kill</span><br></pre></td></tr></table></figure>\n\n<p>**&#x2F;etc&#x2F;systemd&#x2F;system**pm2.servicepm2.service</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl enable pm2.service</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>centos7centoslinuxmacOS</p>\n","site":{"data":{}},"length":593,"excerpt":"","more":"<blockquote>\n<p>Dockerpm2Dockerpm2</p>\n</blockquote>\n<h2 id=\"Docker\"><a href=\"#Docker\" class=\"headerlink\" title=\"Docker\"></a>Docker</h2><p>dockerinit.drc.localdocker</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --restart=always </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"pm2\"><a href=\"#pm2\" class=\"headerlink\" title=\"pm2\"></a>pm2</h2><p>pm2nodejspm2pm2pm2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pm2 start /home/node/web/pm2.json</span><br><span class=\"line\">pm2 save</span><br><span class=\"line\">pm2 startup</span><br><span class=\"line\">pm2 stop all</span><br><span class=\"line\">pm2 kill</span><br></pre></td></tr></table></figure>\n\n<p>**&#x2F;etc&#x2F;systemd&#x2F;system**pm2.servicepm2.service</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl enable pm2.service</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>centos7centoslinuxmacOS</p>\n"},{"title":"Firewalld","date":"2022-05-21T18:37:38.000Z","photos":["/images/9644d159a79fb11b4a8416cc72a1bdc44fcb718c-fp-2000-500-0-0.jpeg"],"url":"the-most-common-usage-firewalld","description":"7.0centosFirewalldLinuxFirewalldFirewalld","_content":"\n> 7.0centosFirewalldLinuxFirewalldFirewalldcentos8Firewalld\n\n## Firewalld\n\ncentos8FirewalldFirewalld\n\n```\nsystemctl unmask firewalld.service\nsystemctl enable firewalld.service\nsystemctl start firewalld.service\n```\n\n## Firewalld\n\n```\nfirewall-cmd --state\n```\n\nrunningFirewalld\n\n## Firewalld\n\n```\nfirewall-cmd --get-active-zone\n```\n\npublicpublic\n\n## \n\nhttphttpshttphttps\n\n```\nfirewall-cmd --zone=public --add-service=http --permanent\nfirewall-cmd --zone=public --add-service=https --permanent\n//\nfirewall-cmd --zone=public --add-service=http --add-service=https --permanent\n```\n\n## \n\nipv6 DHCPcockpit\n\n```\nfirewall-cmd --zone=public --remove-service=dhcpv6-client --permanent\nfirewall-cmd --zone=public --remove-service=cockpit --permanent\n//\nfirewall-cmd --zone=public --remove-service=dhcpv6-client --remove-service=cockpit --permanent\n```\n\n## \n\n```\nfirewall-cmd --zone=public --add-port=22222/tcp --permanent\nfirewall-cmd --zone=public --add-port=22223/udp --permanent\nfirewall-cmd --zone=public --add-port=22224-22229/tcp --permanent\n//\nfirewall-cmd --zone=public --add-port=22222/tcp --add-port=22223/udp --add-port=22224-22229/tcp --permanent\n```\n\ntcpudp\n\n## \n\n```\nfirewall-cmd --zone=public --remove-port=22222/tcp --permanent\nfirewall-cmd --zone=public --remove-port=22223/udp --permanent\nfirewall-cmd --zone=public --remove-port=22224-22229/tcp --permanent\n//\nfirewall-cmd --zone=public --remove-port=22222/tcp --remove-port=22223/udp --remove-port=22224-22229/tcp --permanent\n```\n\n## \n\nIPIP\n\n```\nfirewall-cmd --zone=public --add-source=10.10.10.1 --permanent\nfirewall-cmd --zone=public --add-source=10.10.10.0/24 --permanent\n//\nfirewall-cmd --zone=public --add-source=10.10.10.1 --add-source=10.10.10.0/24 --permanent\n```\n\n## \n\n```\nfirewall-cmd --zone=public --remove-source=10.10.10.1 --permanent\nfirewall-cmd --zone=public --remove-source=10.10.10.0/24 --permanent\n//\nfirewall-cmd --zone=public --remove-source=10.10.10.1 --remove-source=10.10.10.0/24 --permanent\n```\n\n## \n\n```\n//tcp808022222\nfirewall-cmd --zone=public --add-forward-port=\"port=8080:proto=tcp:toport=22222\" --permanent\n//tcp80802222210.10.10.2masquerade\nfirewall-cmd --zone=public --add-masquerade --permanent\nfirewall-cmd --zone=public --add-forward-port=\"port=8080:proto=tcp:toport=22222:toaddr=10.10.10.2\" --permanent\n```\n\n## \n\n```\n//\nfirewall-cmd --zone=public --add-forward-port=\"port=8080:proto=tcp:toport=22222\" --permanent\n//\nfirewall-cmd --zone=public --remove-forward-port=\"port=8080:proto=tcp:toport=22222:toaddr=10.10.10.2\" --permanent\nfirewall-cmd --zone=public --remove-masquerade --permanent\n```\n\n## ipset\n\n```\n//leochanhash:ipipset\nfirewall-cmd --permanent --new-ipset=leochan --type='hash:ip'\n//leochanhash:ipipsetIPipv6\nfirewall-cmd --permanent --new-ipset=leochan --type='hash:ip' --option='family=inet6'\n//ipset\nfirewall-cmd --get-ipset-types\n//leochanipset\nfirewall-cmd --permanent --delete-ipset=leochan\n//leochanipset\nfirewall-cmd --permanent --path-ipset=leochan\n//leochanipset10.10.10.10\nfirewall-cmd --permanent --ipset=leochan --add-entry=10.10.10.10\n//leochanipset10.10.10.10\nfirewall-cmd --permanent --ipset=leochan --remove-entry=10.10.10.10\n//leochanipset10.10.10.10\nfirewall-cmd --permanent --ipset=leochan --query-entry=10.10.10.10\n```\n\nipset\n\nhash:ip IP\nhash:ip,mark IP\nhash:ip,port IP\nhash:ip,port,ip IPIP\nhash:ip,port,net IP\nhash:mac MAC\nhash:net \nhash:net,iface \nhash:net,net \nhash:net,port \nhash:net,port,net \n\n## \n\n\n\n```\nfirewall-cmd --zone=public --add-masquerade --permanent\n```\n\n```\n//10.10.10.10ipv4\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" accept' --permanent\n//10.10.10.1022222tcpipv4\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\n//10.10.10.1022222tcpipv4\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" port port=\"22222\" protocol=\"tcp\" reject' --permanent\n//10.10.10.1022222tcpipv422223\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" forward-port port=\"22222\" protocol=\"tcp\" to-port=\"22223\" accept' --permanent\n//10.10.10.1022222tcpipv410.10.10.322223\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" forward-port port=\"22222\" protocol=\"tcp\" to-port=\"22223\" to-addr=\"10.10.10.3\" accept' --permanent\n//mac00:11:22:33:44:55ssh\nfirewall-cmd --zone=public --add-rich-rule='rule source mac=\"00:11:22:33:44:55\" service name=\"ssh\" accept' --permanent\n//mac00:11:22:33:44:55ipv4ssh\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source mac=\"00:11:22:33:44:55\" service name=\"ssh\" accept' --permanent\n//mac00:11:22:33:44:5522222tcp\nfirewall-cmd --zone=public --add-rich-rule='rule source mac=\"00:11:22:33:44:55\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\n//mac00:11:22:33:44:55ipv422222tcp\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source mac=\"00:11:22:33:44:55\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\n//leochanipsetipv422222tcp\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source ipset=\"leochan\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\n//leochanipsetipv422222tcp\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source ipset=\"leochan\" port port=\"22222\" protocol=\"tcp\" reject' --permanent\n```\n\n## \n\n\n\n```\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" port port=\"22222\" protocol=\"tcp\" reject' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" forward-port port=\"22222\" protocol=\"tcp\" to-port=\"22223\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" forward-port port=\"22222\" protocol=\"tcp\" to-port=\"22223\" to-addr=\"10.10.10.3\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule source mac=\"00:11:22:33:44:55\" service name=\"ssh\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source mac=\"00:11:22:33:44:55\" service name=\"ssh\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule source mac=\"00:11:22:33:44:55\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source mac=\"00:11:22:33:44:55\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source ipset=\"leochan\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source ipset=\"leochan\" port port=\"22222\" protocol=\"tcp\" reject' --permanent\n```\n\n## \n\nacceptrejectdropreject/ipsetIPMAC","source":"_posts/Firewalld.md","raw":"---\ntitle: Firewalld\ndate: 2022-05-22 02:37:38\ntags: \n  - Firewalld\n  - \n  - ipset\n  - \ncategories:\n  - \nphotos:\n  - \"/images/9644d159a79fb11b4a8416cc72a1bdc44fcb718c-fp-2000-500-0-0.jpeg\"\nurl: the-most-common-usage-firewalld\ndescription: 7.0centosFirewalldLinuxFirewalldFirewalld\n---\n\n> 7.0centosFirewalldLinuxFirewalldFirewalldcentos8Firewalld\n\n## Firewalld\n\ncentos8FirewalldFirewalld\n\n```\nsystemctl unmask firewalld.service\nsystemctl enable firewalld.service\nsystemctl start firewalld.service\n```\n\n## Firewalld\n\n```\nfirewall-cmd --state\n```\n\nrunningFirewalld\n\n## Firewalld\n\n```\nfirewall-cmd --get-active-zone\n```\n\npublicpublic\n\n## \n\nhttphttpshttphttps\n\n```\nfirewall-cmd --zone=public --add-service=http --permanent\nfirewall-cmd --zone=public --add-service=https --permanent\n//\nfirewall-cmd --zone=public --add-service=http --add-service=https --permanent\n```\n\n## \n\nipv6 DHCPcockpit\n\n```\nfirewall-cmd --zone=public --remove-service=dhcpv6-client --permanent\nfirewall-cmd --zone=public --remove-service=cockpit --permanent\n//\nfirewall-cmd --zone=public --remove-service=dhcpv6-client --remove-service=cockpit --permanent\n```\n\n## \n\n```\nfirewall-cmd --zone=public --add-port=22222/tcp --permanent\nfirewall-cmd --zone=public --add-port=22223/udp --permanent\nfirewall-cmd --zone=public --add-port=22224-22229/tcp --permanent\n//\nfirewall-cmd --zone=public --add-port=22222/tcp --add-port=22223/udp --add-port=22224-22229/tcp --permanent\n```\n\ntcpudp\n\n## \n\n```\nfirewall-cmd --zone=public --remove-port=22222/tcp --permanent\nfirewall-cmd --zone=public --remove-port=22223/udp --permanent\nfirewall-cmd --zone=public --remove-port=22224-22229/tcp --permanent\n//\nfirewall-cmd --zone=public --remove-port=22222/tcp --remove-port=22223/udp --remove-port=22224-22229/tcp --permanent\n```\n\n## \n\nIPIP\n\n```\nfirewall-cmd --zone=public --add-source=10.10.10.1 --permanent\nfirewall-cmd --zone=public --add-source=10.10.10.0/24 --permanent\n//\nfirewall-cmd --zone=public --add-source=10.10.10.1 --add-source=10.10.10.0/24 --permanent\n```\n\n## \n\n```\nfirewall-cmd --zone=public --remove-source=10.10.10.1 --permanent\nfirewall-cmd --zone=public --remove-source=10.10.10.0/24 --permanent\n//\nfirewall-cmd --zone=public --remove-source=10.10.10.1 --remove-source=10.10.10.0/24 --permanent\n```\n\n## \n\n```\n//tcp808022222\nfirewall-cmd --zone=public --add-forward-port=\"port=8080:proto=tcp:toport=22222\" --permanent\n//tcp80802222210.10.10.2masquerade\nfirewall-cmd --zone=public --add-masquerade --permanent\nfirewall-cmd --zone=public --add-forward-port=\"port=8080:proto=tcp:toport=22222:toaddr=10.10.10.2\" --permanent\n```\n\n## \n\n```\n//\nfirewall-cmd --zone=public --add-forward-port=\"port=8080:proto=tcp:toport=22222\" --permanent\n//\nfirewall-cmd --zone=public --remove-forward-port=\"port=8080:proto=tcp:toport=22222:toaddr=10.10.10.2\" --permanent\nfirewall-cmd --zone=public --remove-masquerade --permanent\n```\n\n## ipset\n\n```\n//leochanhash:ipipset\nfirewall-cmd --permanent --new-ipset=leochan --type='hash:ip'\n//leochanhash:ipipsetIPipv6\nfirewall-cmd --permanent --new-ipset=leochan --type='hash:ip' --option='family=inet6'\n//ipset\nfirewall-cmd --get-ipset-types\n//leochanipset\nfirewall-cmd --permanent --delete-ipset=leochan\n//leochanipset\nfirewall-cmd --permanent --path-ipset=leochan\n//leochanipset10.10.10.10\nfirewall-cmd --permanent --ipset=leochan --add-entry=10.10.10.10\n//leochanipset10.10.10.10\nfirewall-cmd --permanent --ipset=leochan --remove-entry=10.10.10.10\n//leochanipset10.10.10.10\nfirewall-cmd --permanent --ipset=leochan --query-entry=10.10.10.10\n```\n\nipset\n\nhash:ip IP\nhash:ip,mark IP\nhash:ip,port IP\nhash:ip,port,ip IPIP\nhash:ip,port,net IP\nhash:mac MAC\nhash:net \nhash:net,iface \nhash:net,net \nhash:net,port \nhash:net,port,net \n\n## \n\n\n\n```\nfirewall-cmd --zone=public --add-masquerade --permanent\n```\n\n```\n//10.10.10.10ipv4\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" accept' --permanent\n//10.10.10.1022222tcpipv4\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\n//10.10.10.1022222tcpipv4\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" port port=\"22222\" protocol=\"tcp\" reject' --permanent\n//10.10.10.1022222tcpipv422223\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" forward-port port=\"22222\" protocol=\"tcp\" to-port=\"22223\" accept' --permanent\n//10.10.10.1022222tcpipv410.10.10.322223\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" forward-port port=\"22222\" protocol=\"tcp\" to-port=\"22223\" to-addr=\"10.10.10.3\" accept' --permanent\n//mac00:11:22:33:44:55ssh\nfirewall-cmd --zone=public --add-rich-rule='rule source mac=\"00:11:22:33:44:55\" service name=\"ssh\" accept' --permanent\n//mac00:11:22:33:44:55ipv4ssh\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source mac=\"00:11:22:33:44:55\" service name=\"ssh\" accept' --permanent\n//mac00:11:22:33:44:5522222tcp\nfirewall-cmd --zone=public --add-rich-rule='rule source mac=\"00:11:22:33:44:55\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\n//mac00:11:22:33:44:55ipv422222tcp\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source mac=\"00:11:22:33:44:55\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\n//leochanipsetipv422222tcp\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source ipset=\"leochan\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\n//leochanipsetipv422222tcp\nfirewall-cmd --zone=public --add-rich-rule='rule family=\"ipv4\" source ipset=\"leochan\" port port=\"22222\" protocol=\"tcp\" reject' --permanent\n```\n\n## \n\n\n\n```\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" port port=\"22222\" protocol=\"tcp\" reject' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" forward-port port=\"22222\" protocol=\"tcp\" to-port=\"22223\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source address=\"10.10.10.10\" forward-port port=\"22222\" protocol=\"tcp\" to-port=\"22223\" to-addr=\"10.10.10.3\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule source mac=\"00:11:22:33:44:55\" service name=\"ssh\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source mac=\"00:11:22:33:44:55\" service name=\"ssh\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule source mac=\"00:11:22:33:44:55\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source mac=\"00:11:22:33:44:55\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source ipset=\"leochan\" port port=\"22222\" protocol=\"tcp\" accept' --permanent\nfirewall-cmd --zone=public --remove-rich-rule='rule family=\"ipv4\" source ipset=\"leochan\" port port=\"22222\" protocol=\"tcp\" reject' --permanent\n```\n\n## \n\nacceptrejectdropreject/ipsetIPMAC","slug":"Firewalld","published":1,"updated":"2022-05-22T05:45:18.560Z","comments":1,"layout":"post","link":"","_id":"cl3in6atx0004lvtdcle9f4b9","content":"<blockquote>\n<p>7.0centosFirewalldLinuxFirewalldFirewalldcentos8Firewalld</p>\n</blockquote>\n<h2 id=\"Firewalld\"><a href=\"#Firewalld\" class=\"headerlink\" title=\"Firewalld\"></a>Firewalld</h2><p>centos8FirewalldFirewalld</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl unmask firewalld.service</span><br><span class=\"line\">systemctl enable firewalld.service</span><br><span class=\"line\">systemctl start firewalld.service</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Firewalld\"><a href=\"#Firewalld\" class=\"headerlink\" title=\"Firewalld\"></a>Firewalld</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --state</span><br></pre></td></tr></table></figure>\n\n<p>runningFirewalld</p>\n<h2 id=\"Firewalld\"><a href=\"#Firewalld\" class=\"headerlink\" title=\"Firewalld\"></a>Firewalld</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --get-active-zone</span><br></pre></td></tr></table></figure>\n\n<p>publicpublic</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>httphttpshttphttps</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-service=http --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-service=https --permanent</span><br><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --add-service=http --add-service=https --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>ipv6 DHCPcockpit</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --remove-service=dhcpv6-client --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-service=cockpit --permanent</span><br><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --remove-service=dhcpv6-client --remove-service=cockpit --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-port=22222/tcp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=22223/udp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=22224-22229/tcp --permanent</span><br><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=22222/tcp --add-port=22223/udp --add-port=22224-22229/tcp --permanent</span><br></pre></td></tr></table></figure>\n\n<p>tcpudp</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --remove-port=22222/tcp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-port=22223/udp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-port=22224-22229/tcp --permanent</span><br><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --remove-port=22222/tcp --remove-port=22223/udp --remove-port=22224-22229/tcp --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>IPIP</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-source=10.10.10.1 --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-source=10.10.10.0/24 --permanent</span><br><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --add-source=10.10.10.1 --add-source=10.10.10.0/24 --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --remove-source=10.10.10.1 --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-source=10.10.10.0/24 --permanent</span><br><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --remove-source=10.10.10.1 --remove-source=10.10.10.0/24 --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//tcp808022222</span><br><span class=\"line\">firewall-cmd --zone=public --add-forward-port=&quot;port=8080:proto=tcp:toport=22222&quot; --permanent</span><br><span class=\"line\">//tcp80802222210.10.10.2masquerade</span><br><span class=\"line\">firewall-cmd --zone=public --add-masquerade --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-forward-port=&quot;port=8080:proto=tcp:toport=22222:toaddr=10.10.10.2&quot; --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --add-forward-port=&quot;port=8080:proto=tcp:toport=22222&quot; --permanent</span><br><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --remove-forward-port=&quot;port=8080:proto=tcp:toport=22222:toaddr=10.10.10.2&quot; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-masquerade --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ipset\"><a href=\"#ipset\" class=\"headerlink\" title=\"ipset\"></a>ipset</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//leochanhash:ipipset</span><br><span class=\"line\">firewall-cmd --permanent --new-ipset=leochan --type=&#x27;hash:ip&#x27;</span><br><span class=\"line\">//leochanhash:ipipsetIPipv6</span><br><span class=\"line\">firewall-cmd --permanent --new-ipset=leochan --type=&#x27;hash:ip&#x27; --option=&#x27;family=inet6&#x27;</span><br><span class=\"line\">//ipset</span><br><span class=\"line\">firewall-cmd --get-ipset-types</span><br><span class=\"line\">//leochanipset</span><br><span class=\"line\">firewall-cmd --permanent --delete-ipset=leochan</span><br><span class=\"line\">//leochanipset</span><br><span class=\"line\">firewall-cmd --permanent --path-ipset=leochan</span><br><span class=\"line\">//leochanipset10.10.10.10</span><br><span class=\"line\">firewall-cmd --permanent --ipset=leochan --add-entry=10.10.10.10</span><br><span class=\"line\">//leochanipset10.10.10.10</span><br><span class=\"line\">firewall-cmd --permanent --ipset=leochan --remove-entry=10.10.10.10</span><br><span class=\"line\">//leochanipset10.10.10.10</span><br><span class=\"line\">firewall-cmd --permanent --ipset=leochan --query-entry=10.10.10.10</span><br></pre></td></tr></table></figure>\n\n<p>ipset</p>\n<p>hash:ip IP<br>hash:ip,mark IP<br>hash:ip,port IP<br>hash:ip,port,ip IPIP<br>hash:ip,port,net IP<br>hash:mac MAC<br>hash:net <br>hash:net,iface <br>hash:net,net <br>hash:net,port <br>hash:net,port,net </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-masquerade --permanent</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//10.10.10.10ipv4</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; accept&#x27; --permanent</span><br><span class=\"line\">//10.10.10.1022222tcpipv4</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">//10.10.10.1022222tcpipv4</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; reject&#x27; --permanent</span><br><span class=\"line\">//10.10.10.1022222tcpipv422223</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; forward-port port=&quot;22222&quot; protocol=&quot;tcp&quot; to-port=&quot;22223&quot; accept&#x27; --permanent</span><br><span class=\"line\">//10.10.10.1022222tcpipv410.10.10.322223</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; forward-port port=&quot;22222&quot; protocol=&quot;tcp&quot; to-port=&quot;22223&quot; to-addr=&quot;10.10.10.3&quot; accept&#x27; --permanent</span><br><span class=\"line\">//mac00:11:22:33:44:55ssh</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule source mac=&quot;00:11:22:33:44:55&quot; service name=&quot;ssh&quot; accept&#x27; --permanent</span><br><span class=\"line\">//mac00:11:22:33:44:55ipv4ssh</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source mac=&quot;00:11:22:33:44:55&quot; service name=&quot;ssh&quot; accept&#x27; --permanent</span><br><span class=\"line\">//mac00:11:22:33:44:5522222tcp</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule source mac=&quot;00:11:22:33:44:55&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">//mac00:11:22:33:44:55ipv422222tcp</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source mac=&quot;00:11:22:33:44:55&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">//leochanipsetipv422222tcp</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source ipset=&quot;leochan&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">//leochanipsetipv422222tcp</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source ipset=&quot;leochan&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; reject&#x27; --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; reject&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; forward-port port=&quot;22222&quot; protocol=&quot;tcp&quot; to-port=&quot;22223&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; forward-port port=&quot;22222&quot; protocol=&quot;tcp&quot; to-port=&quot;22223&quot; to-addr=&quot;10.10.10.3&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule source mac=&quot;00:11:22:33:44:55&quot; service name=&quot;ssh&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source mac=&quot;00:11:22:33:44:55&quot; service name=&quot;ssh&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule source mac=&quot;00:11:22:33:44:55&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source mac=&quot;00:11:22:33:44:55&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source ipset=&quot;leochan&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source ipset=&quot;leochan&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; reject&#x27; --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>acceptrejectdropreject&#x2F;ipsetIPMAC</p>\n","site":{"data":{}},"length":8608,"excerpt":"","more":"<blockquote>\n<p>7.0centosFirewalldLinuxFirewalldFirewalldcentos8Firewalld</p>\n</blockquote>\n<h2 id=\"Firewalld\"><a href=\"#Firewalld\" class=\"headerlink\" title=\"Firewalld\"></a>Firewalld</h2><p>centos8FirewalldFirewalld</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl unmask firewalld.service</span><br><span class=\"line\">systemctl enable firewalld.service</span><br><span class=\"line\">systemctl start firewalld.service</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Firewalld\"><a href=\"#Firewalld\" class=\"headerlink\" title=\"Firewalld\"></a>Firewalld</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --state</span><br></pre></td></tr></table></figure>\n\n<p>runningFirewalld</p>\n<h2 id=\"Firewalld\"><a href=\"#Firewalld\" class=\"headerlink\" title=\"Firewalld\"></a>Firewalld</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --get-active-zone</span><br></pre></td></tr></table></figure>\n\n<p>publicpublic</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>httphttpshttphttps</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-service=http --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-service=https --permanent</span><br><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --add-service=http --add-service=https --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>ipv6 DHCPcockpit</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --remove-service=dhcpv6-client --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-service=cockpit --permanent</span><br><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --remove-service=dhcpv6-client --remove-service=cockpit --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-port=22222/tcp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=22223/udp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=22224-22229/tcp --permanent</span><br><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=22222/tcp --add-port=22223/udp --add-port=22224-22229/tcp --permanent</span><br></pre></td></tr></table></figure>\n\n<p>tcpudp</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --remove-port=22222/tcp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-port=22223/udp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-port=22224-22229/tcp --permanent</span><br><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --remove-port=22222/tcp --remove-port=22223/udp --remove-port=22224-22229/tcp --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>IPIP</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-source=10.10.10.1 --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-source=10.10.10.0/24 --permanent</span><br><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --add-source=10.10.10.1 --add-source=10.10.10.0/24 --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --remove-source=10.10.10.1 --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-source=10.10.10.0/24 --permanent</span><br><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --remove-source=10.10.10.1 --remove-source=10.10.10.0/24 --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//tcp808022222</span><br><span class=\"line\">firewall-cmd --zone=public --add-forward-port=&quot;port=8080:proto=tcp:toport=22222&quot; --permanent</span><br><span class=\"line\">//tcp80802222210.10.10.2masquerade</span><br><span class=\"line\">firewall-cmd --zone=public --add-masquerade --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-forward-port=&quot;port=8080:proto=tcp:toport=22222:toaddr=10.10.10.2&quot; --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --add-forward-port=&quot;port=8080:proto=tcp:toport=22222&quot; --permanent</span><br><span class=\"line\">//</span><br><span class=\"line\">firewall-cmd --zone=public --remove-forward-port=&quot;port=8080:proto=tcp:toport=22222:toaddr=10.10.10.2&quot; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-masquerade --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ipset\"><a href=\"#ipset\" class=\"headerlink\" title=\"ipset\"></a>ipset</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//leochanhash:ipipset</span><br><span class=\"line\">firewall-cmd --permanent --new-ipset=leochan --type=&#x27;hash:ip&#x27;</span><br><span class=\"line\">//leochanhash:ipipsetIPipv6</span><br><span class=\"line\">firewall-cmd --permanent --new-ipset=leochan --type=&#x27;hash:ip&#x27; --option=&#x27;family=inet6&#x27;</span><br><span class=\"line\">//ipset</span><br><span class=\"line\">firewall-cmd --get-ipset-types</span><br><span class=\"line\">//leochanipset</span><br><span class=\"line\">firewall-cmd --permanent --delete-ipset=leochan</span><br><span class=\"line\">//leochanipset</span><br><span class=\"line\">firewall-cmd --permanent --path-ipset=leochan</span><br><span class=\"line\">//leochanipset10.10.10.10</span><br><span class=\"line\">firewall-cmd --permanent --ipset=leochan --add-entry=10.10.10.10</span><br><span class=\"line\">//leochanipset10.10.10.10</span><br><span class=\"line\">firewall-cmd --permanent --ipset=leochan --remove-entry=10.10.10.10</span><br><span class=\"line\">//leochanipset10.10.10.10</span><br><span class=\"line\">firewall-cmd --permanent --ipset=leochan --query-entry=10.10.10.10</span><br></pre></td></tr></table></figure>\n\n<p>ipset</p>\n<p>hash:ip IP<br>hash:ip,mark IP<br>hash:ip,port IP<br>hash:ip,port,ip IPIP<br>hash:ip,port,net IP<br>hash:mac MAC<br>hash:net <br>hash:net,iface <br>hash:net,net <br>hash:net,port <br>hash:net,port,net </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-masquerade --permanent</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//10.10.10.10ipv4</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; accept&#x27; --permanent</span><br><span class=\"line\">//10.10.10.1022222tcpipv4</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">//10.10.10.1022222tcpipv4</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; reject&#x27; --permanent</span><br><span class=\"line\">//10.10.10.1022222tcpipv422223</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; forward-port port=&quot;22222&quot; protocol=&quot;tcp&quot; to-port=&quot;22223&quot; accept&#x27; --permanent</span><br><span class=\"line\">//10.10.10.1022222tcpipv410.10.10.322223</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; forward-port port=&quot;22222&quot; protocol=&quot;tcp&quot; to-port=&quot;22223&quot; to-addr=&quot;10.10.10.3&quot; accept&#x27; --permanent</span><br><span class=\"line\">//mac00:11:22:33:44:55ssh</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule source mac=&quot;00:11:22:33:44:55&quot; service name=&quot;ssh&quot; accept&#x27; --permanent</span><br><span class=\"line\">//mac00:11:22:33:44:55ipv4ssh</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source mac=&quot;00:11:22:33:44:55&quot; service name=&quot;ssh&quot; accept&#x27; --permanent</span><br><span class=\"line\">//mac00:11:22:33:44:5522222tcp</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule source mac=&quot;00:11:22:33:44:55&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">//mac00:11:22:33:44:55ipv422222tcp</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source mac=&quot;00:11:22:33:44:55&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">//leochanipsetipv422222tcp</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source ipset=&quot;leochan&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">//leochanipsetipv422222tcp</span><br><span class=\"line\">firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source ipset=&quot;leochan&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; reject&#x27; --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; reject&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; forward-port port=&quot;22222&quot; protocol=&quot;tcp&quot; to-port=&quot;22223&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.10.10.10&quot; forward-port port=&quot;22222&quot; protocol=&quot;tcp&quot; to-port=&quot;22223&quot; to-addr=&quot;10.10.10.3&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule source mac=&quot;00:11:22:33:44:55&quot; service name=&quot;ssh&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source mac=&quot;00:11:22:33:44:55&quot; service name=&quot;ssh&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule source mac=&quot;00:11:22:33:44:55&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source mac=&quot;00:11:22:33:44:55&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source ipset=&quot;leochan&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; accept&#x27; --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --remove-rich-rule=&#x27;rule family=&quot;ipv4&quot; source ipset=&quot;leochan&quot; port port=&quot;22222&quot; protocol=&quot;tcp&quot; reject&#x27; --permanent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>acceptrejectdropreject&#x2F;ipsetIPMAC</p>\n"},{"title":"Linuxsupervisor","date":"2018-06-01T23:53:00.000Z","url":"run-daemon-process-with-supervisor-on-linux","description":"supervisor","_content":"\n> supervisor\n\n\n## \n\nLinuxcentos7.464bituname -a3.10.0-693.2.2.el7.x86_64\n\n## supervisor\n\nsupervisor\n\n### setuptools\n\nsetuptoolseasy_installeasy_install\nsetuptoolspythonsetuptools\n\n```\neasy_install supervisor\n```\n\n### setuptools\n\nsupervisorsupervisorpypipypi.python.org/pypi/supervisor\nsupervisor\n\n```\nwget https://files.pythonhosted.org/packages/44/60/698e54b4a4a9b956b2d709b4b7b676119c833d811d53ee2500f1b5e96dc3/supervisor-3.3.4.tar.gz\ntar xzf supervisor-3.3.4.tar.gz\ncd supervisor*\npython setup.py install\n```\n\n### \n\nLinuxsupervisorsupervisorsupervisor\n\n```\nyum info supervisor\n```\n\nubuntu\n\n```\napt-cache show supervisor\n```\n\nsupervisord\n\n### pip\n\npippython666\n\n```\npip install supervisor\n```\n\n## \n\nsupervisorecho_supervisord_conf\n\n```\necho_supervisord_conf > /etc/supervisord.conf\n```\n\nrootsudorootsudo\n\n## \n\nsupervisorsupervisordsupervisorctlsupervisordsupervisordsupervisorctlsupervisord\n\nsupervisord\n\n```\nsupervisord\n```\n\nsupervisord/etc/supervisord.conf-c\n\n```\nsupervisord -c supervisord.conf\n```\n\nsupervisord\n-c FILE, --configuration=FILEsupervisorFILE-n,\n--nodaemon-h, --help-u USER,\n--user=USERUnixID-m OCTAL, --umask=OCTAL-d PATH,\n--directory=PATHsupervisorddaemon-l FILE,\n--logfile=FILEsupervisord-y BYTES,\n--logfile_maxbytes=BYTES1MB1GB-y NUM,\n--logfile_backups=NUM-e LEVEL, --loglevel=LEVELtrace,\ndebug, info, warn, errorcritical-j FILE,\n--pidfile=FILEPIDdaemon-i STRING,\n--identifier=STRING-q PATH,\n--childlogdir=PATH-k, --nocleanupsupervisord-a\nNUM, --minfds=NUM-t, --strip_ansiANSI-v,\n--versionsupervisord--profile_options=LISTcumulative, calls,\ncallers--minprocs=NUM\n\nsupervisorctl\nsupervisorctlsupervisorctlsystemctl\n\nsupervisorctl\n-c, --configuration-h, --help-i,\n--interactive-s, --serverurl URLsupervisord\nhttp://localhost:9001-u, --usernamesupervisord-p,\n--passwordsupervisord-r, --history-filereadlinereadline\n\nsupervisordsupervisord\n\nsupervisorctaction\nhelphelp add [...]/remove\n[...]/updateclear clear\nclear allfg CTRL+CpidsupervisordIDpid\nIDpid allIDrereaddaemon/restart\nupdate/rereadrestart :*restart\nrestart allsignalstart start\n:*start start allstatusstatus\nstatus stop stop :*stop stop\nalltail [-f] [stdout/stderr]\n\n## supervisord\n\ngithubhttps://github.com/Supervisor/initscripts\n\n```\n[Unit]\nDescription=Supervisor daemon\n[Service]\nType=forking\nExecStart=/usr/bin/supervisord -c /etc/supervisord.conf\nExecStop=/usr/bin/supervisorctl $OPTIONS shutdown\nExecReload=/usr/bin/supervisorctl $OPTIONS reload\nKillMode=process\nRestart=on-failure\nRestartSec=42s\n[Install]\nWantedBy=multi-user.target\n```\n\ncentossystemctl\n\n## supervisord\n\nsupervisor[]\n\n```\n[unix_http_server]\nfile=/tmp/supervisor.sock   ;UNIX socket supervisorctl \n;chmod=0700                 ;socketmode0700\n;chown=nobody:nogroup       ;socketowneruid:gid\n\n;[inet_http_server]         ;HTTPweb\n;port=127.0.0.1:9001        ;WebIP\n;username=user              ;\n;password=123               ;\n\n[supervisord]\nlogfile=/tmp/supervisord.log ; $CWD/supervisord.log\nlogfile_maxbytes=50MB        ;rotate 50MB0\nlogfile_backups=10           ;100\nloglevel=info                ;info: debug,warn,trace\npidfile=/tmp/supervisord.pid ;pid \nnodaemon=false               ;false daemon \nminfds=1024                  ; 1024\nminprocs=200                 ; 200\n\n[supervisorctl]\nserverurl=unix:///tmp/supervisor.sock ;UNIX socketsupervisordunix_http_serverfile\n;serverurl=http://127.0.0.1:9001 ; HTTPsupervisord\n\n; [program:xx]xx\n[program:xx]\ncommand=/opt/apache-tomcat-8.0.35/bin/catalina.sh run  ; \nautostart=true       ; supervisord\nstartsecs=10         ; 101\nautorestart=true     ; ,[unexpected,true,false]unexpected\nstartretries=3       ; 3\nuser=tomcat          ; root\npriority=999         ; 999\nredirect_stderr=true ; stderrstdoutfalse\nstdout_logfile_maxbytes=20MB  ; stdout 50MB\nstdout_logfile_backups = 20   ; stdout 10\n; stdout supervisord \nstdout_logfile=/opt/apache-tomcat-8.0.35/logs/catalina.out\nstopasgroup=false     ;false,stop\nkillasgroup=false     ;falsekill\n\n;[eventlistener:theeventlistenername] ;\n;command=/bin/eventlistener    ; \n;process_name=%(program_name)s ; \n;numprocs=1                    ; \n;events=EVENT                  ; \n;buffer_size=10                ; \n;directory=/tmp                ; exec\n;umask=022                     ; \n;priority=-1                   ; \n;autostart=true                ; supervisord\n;startsecs=1                   ; # \n;startretries=3                ; \n;autorestart=unexpected        ; \n;exitcodes=0,2                 ; 'expected'\n;stopsignal=QUIT               ; \n;stopwaitsecs=10               ; \n;stopasgroup=false             ; \n;killasgroup=false             ; \n;user=chrism                   ; \n;redirect_stderr=false         ; redirect_stderr=true\n;stdout_logfile=/a/path        ; stdoutAUTO\n;stdout_logfile_maxbytes=1MB   ;  logfile50MB\n;stdout_logfile_backups=10     ;  stdout\n;stdout_events_enabled=false   ; stdout\n;stderr_logfile=/a/path        ; stderrAUTO\n;stderr_logfile_maxbytes=1MB   ; logfile50MB\n;stderr_logfile_backups=10     ; stderr\n;stderr_events_enabled=false   ; stderr\n;environment=A=\"1\",B=\"2\"       ; \n;serverurl=AUTO                ; serverurl\n\n;[group:thegroupname] ;\n;programs=progname1,progname2  ; \n;priority=999                  ; \n\n;,include\n[include]\nfiles = relative/directory/*.ini    ;.ini\n```","source":"_posts/Linuxsupervisor.md","raw":"---\ntitle: Linuxsupervisor\ndate: 2018-06-02 07:53:00\ntags: \n  - supervisor\n  - \ncategories:\n  - \nurl: run-daemon-process-with-supervisor-on-linux\ndescription: supervisor\n---\n\n> supervisor\n\n\n## \n\nLinuxcentos7.464bituname -a3.10.0-693.2.2.el7.x86_64\n\n## supervisor\n\nsupervisor\n\n### setuptools\n\nsetuptoolseasy_installeasy_install\nsetuptoolspythonsetuptools\n\n```\neasy_install supervisor\n```\n\n### setuptools\n\nsupervisorsupervisorpypipypi.python.org/pypi/supervisor\nsupervisor\n\n```\nwget https://files.pythonhosted.org/packages/44/60/698e54b4a4a9b956b2d709b4b7b676119c833d811d53ee2500f1b5e96dc3/supervisor-3.3.4.tar.gz\ntar xzf supervisor-3.3.4.tar.gz\ncd supervisor*\npython setup.py install\n```\n\n### \n\nLinuxsupervisorsupervisorsupervisor\n\n```\nyum info supervisor\n```\n\nubuntu\n\n```\napt-cache show supervisor\n```\n\nsupervisord\n\n### pip\n\npippython666\n\n```\npip install supervisor\n```\n\n## \n\nsupervisorecho_supervisord_conf\n\n```\necho_supervisord_conf > /etc/supervisord.conf\n```\n\nrootsudorootsudo\n\n## \n\nsupervisorsupervisordsupervisorctlsupervisordsupervisordsupervisorctlsupervisord\n\nsupervisord\n\n```\nsupervisord\n```\n\nsupervisord/etc/supervisord.conf-c\n\n```\nsupervisord -c supervisord.conf\n```\n\nsupervisord\n-c FILE, --configuration=FILEsupervisorFILE-n,\n--nodaemon-h, --help-u USER,\n--user=USERUnixID-m OCTAL, --umask=OCTAL-d PATH,\n--directory=PATHsupervisorddaemon-l FILE,\n--logfile=FILEsupervisord-y BYTES,\n--logfile_maxbytes=BYTES1MB1GB-y NUM,\n--logfile_backups=NUM-e LEVEL, --loglevel=LEVELtrace,\ndebug, info, warn, errorcritical-j FILE,\n--pidfile=FILEPIDdaemon-i STRING,\n--identifier=STRING-q PATH,\n--childlogdir=PATH-k, --nocleanupsupervisord-a\nNUM, --minfds=NUM-t, --strip_ansiANSI-v,\n--versionsupervisord--profile_options=LISTcumulative, calls,\ncallers--minprocs=NUM\n\nsupervisorctl\nsupervisorctlsupervisorctlsystemctl\n\nsupervisorctl\n-c, --configuration-h, --help-i,\n--interactive-s, --serverurl URLsupervisord\nhttp://localhost:9001-u, --usernamesupervisord-p,\n--passwordsupervisord-r, --history-filereadlinereadline\n\nsupervisordsupervisord\n\nsupervisorctaction\nhelphelp add [...]/remove\n[...]/updateclear clear\nclear allfg CTRL+CpidsupervisordIDpid\nIDpid allIDrereaddaemon/restart\nupdate/rereadrestart :*restart\nrestart allsignalstart start\n:*start start allstatusstatus\nstatus stop stop :*stop stop\nalltail [-f] [stdout/stderr]\n\n## supervisord\n\ngithubhttps://github.com/Supervisor/initscripts\n\n```\n[Unit]\nDescription=Supervisor daemon\n[Service]\nType=forking\nExecStart=/usr/bin/supervisord -c /etc/supervisord.conf\nExecStop=/usr/bin/supervisorctl $OPTIONS shutdown\nExecReload=/usr/bin/supervisorctl $OPTIONS reload\nKillMode=process\nRestart=on-failure\nRestartSec=42s\n[Install]\nWantedBy=multi-user.target\n```\n\ncentossystemctl\n\n## supervisord\n\nsupervisor[]\n\n```\n[unix_http_server]\nfile=/tmp/supervisor.sock   ;UNIX socket supervisorctl \n;chmod=0700                 ;socketmode0700\n;chown=nobody:nogroup       ;socketowneruid:gid\n\n;[inet_http_server]         ;HTTPweb\n;port=127.0.0.1:9001        ;WebIP\n;username=user              ;\n;password=123               ;\n\n[supervisord]\nlogfile=/tmp/supervisord.log ; $CWD/supervisord.log\nlogfile_maxbytes=50MB        ;rotate 50MB0\nlogfile_backups=10           ;100\nloglevel=info                ;info: debug,warn,trace\npidfile=/tmp/supervisord.pid ;pid \nnodaemon=false               ;false daemon \nminfds=1024                  ; 1024\nminprocs=200                 ; 200\n\n[supervisorctl]\nserverurl=unix:///tmp/supervisor.sock ;UNIX socketsupervisordunix_http_serverfile\n;serverurl=http://127.0.0.1:9001 ; HTTPsupervisord\n\n; [program:xx]xx\n[program:xx]\ncommand=/opt/apache-tomcat-8.0.35/bin/catalina.sh run  ; \nautostart=true       ; supervisord\nstartsecs=10         ; 101\nautorestart=true     ; ,[unexpected,true,false]unexpected\nstartretries=3       ; 3\nuser=tomcat          ; root\npriority=999         ; 999\nredirect_stderr=true ; stderrstdoutfalse\nstdout_logfile_maxbytes=20MB  ; stdout 50MB\nstdout_logfile_backups = 20   ; stdout 10\n; stdout supervisord \nstdout_logfile=/opt/apache-tomcat-8.0.35/logs/catalina.out\nstopasgroup=false     ;false,stop\nkillasgroup=false     ;falsekill\n\n;[eventlistener:theeventlistenername] ;\n;command=/bin/eventlistener    ; \n;process_name=%(program_name)s ; \n;numprocs=1                    ; \n;events=EVENT                  ; \n;buffer_size=10                ; \n;directory=/tmp                ; exec\n;umask=022                     ; \n;priority=-1                   ; \n;autostart=true                ; supervisord\n;startsecs=1                   ; # \n;startretries=3                ; \n;autorestart=unexpected        ; \n;exitcodes=0,2                 ; 'expected'\n;stopsignal=QUIT               ; \n;stopwaitsecs=10               ; \n;stopasgroup=false             ; \n;killasgroup=false             ; \n;user=chrism                   ; \n;redirect_stderr=false         ; redirect_stderr=true\n;stdout_logfile=/a/path        ; stdoutAUTO\n;stdout_logfile_maxbytes=1MB   ;  logfile50MB\n;stdout_logfile_backups=10     ;  stdout\n;stdout_events_enabled=false   ; stdout\n;stderr_logfile=/a/path        ; stderrAUTO\n;stderr_logfile_maxbytes=1MB   ; logfile50MB\n;stderr_logfile_backups=10     ; stderr\n;stderr_events_enabled=false   ; stderr\n;environment=A=\"1\",B=\"2\"       ; \n;serverurl=AUTO                ; serverurl\n\n;[group:thegroupname] ;\n;programs=progname1,progname2  ; \n;priority=999                  ; \n\n;,include\n[include]\nfiles = relative/directory/*.ini    ;.ini\n```","slug":"Linuxsupervisor","published":1,"updated":"2022-05-12T17:08:01.897Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6aty0005lvtd2d4l01yv","content":"<blockquote>\n<p>supervisor</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Linuxcentos7.464bituname -a3.10.0-693.2.2.el7.x86_64</p>\n<h2 id=\"supervisor\"><a href=\"#supervisor\" class=\"headerlink\" title=\"supervisor\"></a>supervisor</h2><p>supervisor</p>\n<h3 id=\"setuptools\"><a href=\"#setuptools\" class=\"headerlink\" title=\"setuptools\"></a>setuptools</h3><p>setuptoolseasy_installeasy_install<br>setuptoolspythonsetuptools</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">easy_install supervisor</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"setuptools\"><a href=\"#setuptools\" class=\"headerlink\" title=\"setuptools\"></a>setuptools</h3><p>supervisorsupervisorpypipypi.python.org&#x2F;pypi&#x2F;supervisor<br>supervisor</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://files.pythonhosted.org/packages/44/60/698e54b4a4a9b956b2d709b4b7b676119c833d811d53ee2500f1b5e96dc3/supervisor-3.3.4.tar.gz</span><br><span class=\"line\">tar xzf supervisor-3.3.4.tar.gz</span><br><span class=\"line\">cd supervisor*</span><br><span class=\"line\">python setup.py install</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Linuxsupervisorsupervisorsupervisor</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum info supervisor</span><br></pre></td></tr></table></figure>\n\n<p>ubuntu</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-cache show supervisor</span><br></pre></td></tr></table></figure>\n\n<p>supervisord</p>\n<h3 id=\"pip\"><a href=\"#pip\" class=\"headerlink\" title=\"pip\"></a>pip</h3><p>pippython666</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install supervisor</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>supervisorecho_supervisord_conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo_supervisord_conf &gt; /etc/supervisord.conf</span><br></pre></td></tr></table></figure>\n\n<p>rootsudorootsudo</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>supervisorsupervisordsupervisorctlsupervisordsupervisordsupervisorctlsupervisord</p>\n<p>supervisord</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">supervisord</span><br></pre></td></tr></table></figure>\n\n<p>supervisord&#x2F;etc&#x2F;supervisord.conf-c</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">supervisord -c supervisord.conf</span><br></pre></td></tr></table></figure>\n\n<p>supervisord<br>-c FILE, configuration&#x3D;FILEsupervisorFILE-n,<br>nodaemon-h, help-u USER,<br>user&#x3D;USERUnixID-m OCTAL, umask&#x3D;OCTAL-d PATH,<br>directory&#x3D;PATHsupervisorddaemon-l FILE,<br>logfile&#x3D;FILEsupervisord-y BYTES,<br>logfile_maxbytes&#x3D;BYTES1MB1GB-y NUM,<br>logfile_backups&#x3D;NUM-e LEVEL, loglevel&#x3D;LEVELtrace,<br>debug, info, warn, errorcritical-j FILE,<br>pidfile&#x3D;FILEPIDdaemon-i STRING,<br>identifier&#x3D;STRING-q PATH,<br>childlogdir&#x3D;PATH-k, nocleanupsupervisord-a<br>NUM, minfds&#x3D;NUM-t, strip_ansiANSI-v,<br>versionsupervisordprofile_options&#x3D;LISTcumulative, calls,<br>callersminprocs&#x3D;NUM</p>\n<p>supervisorctl<br>supervisorctlsupervisorctlsystemctl</p>\n<p>supervisorctl<br>-c, configuration-h, help-i,<br>interactive-s, serverurl URLsupervisord<br><a href=\"http://localhost:9001-u\">http://localhost:9001-u</a>, usernamesupervisord-p,<br>passwordsupervisord-r, history-filereadlinereadline</p>\n<p>supervisordsupervisord</p>\n<p>supervisorctaction<br>helphelp add []&#x2F;remove<br>[]&#x2F;updateclear clear<br>clear allfg CTRL+CpidsupervisordIDpid<br>IDpid allIDrereaddaemon&#x2F;restart<br>update&#x2F;rereadrestart :*restart<br>restart allsignalstart start<br>:*start start allstatusstatus<br>status stop stop :*stop stop<br>alltail [-f] [stdout&#x2F;stderr]</p>\n<h2 id=\"supervisord\"><a href=\"#supervisord\" class=\"headerlink\" title=\"supervisord\"></a>supervisord</h2><p>github<a href=\"https://github.com/Supervisor/initscripts\">https://github.com/Supervisor/initscripts</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Supervisor daemon</span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=forking</span><br><span class=\"line\">ExecStart=/usr/bin/supervisord -c /etc/supervisord.conf</span><br><span class=\"line\">ExecStop=/usr/bin/supervisorctl $OPTIONS shutdown</span><br><span class=\"line\">ExecReload=/usr/bin/supervisorctl $OPTIONS reload</span><br><span class=\"line\">KillMode=process</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">RestartSec=42s</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p>centossystemctl</p>\n<h2 id=\"supervisord\"><a href=\"#supervisord\" class=\"headerlink\" title=\"supervisord\"></a>supervisord</h2><p>supervisor[]</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[unix_http_server]</span><br><span class=\"line\">file=/tmp/supervisor.sock   ;UNIX socket supervisorctl </span><br><span class=\"line\">;chmod=0700                 ;socketmode0700</span><br><span class=\"line\">;chown=nobody:nogroup       ;socketowneruid:gid</span><br><span class=\"line\"></span><br><span class=\"line\">;[inet_http_server]         ;HTTPweb</span><br><span class=\"line\">;port=127.0.0.1:9001        ;WebIP</span><br><span class=\"line\">;username=user              ;</span><br><span class=\"line\">;password=123               ;</span><br><span class=\"line\"></span><br><span class=\"line\">[supervisord]</span><br><span class=\"line\">logfile=/tmp/supervisord.log ; $CWD/supervisord.log</span><br><span class=\"line\">logfile_maxbytes=50MB        ;rotate 50MB0</span><br><span class=\"line\">logfile_backups=10           ;100</span><br><span class=\"line\">loglevel=info                ;info: debug,warn,trace</span><br><span class=\"line\">pidfile=/tmp/supervisord.pid ;pid </span><br><span class=\"line\">nodaemon=false               ;false daemon </span><br><span class=\"line\">minfds=1024                  ; 1024</span><br><span class=\"line\">minprocs=200                 ; 200</span><br><span class=\"line\"></span><br><span class=\"line\">[supervisorctl]</span><br><span class=\"line\">serverurl=unix:///tmp/supervisor.sock ;UNIX socketsupervisordunix_http_serverfile</span><br><span class=\"line\">;serverurl=http://127.0.0.1:9001 ; HTTPsupervisord</span><br><span class=\"line\"></span><br><span class=\"line\">; [program:xx]xx</span><br><span class=\"line\">[program:xx]</span><br><span class=\"line\">command=/opt/apache-tomcat-8.0.35/bin/catalina.sh run  ; </span><br><span class=\"line\">autostart=true       ; supervisord</span><br><span class=\"line\">startsecs=10         ; 101</span><br><span class=\"line\">autorestart=true     ; ,[unexpected,true,false]unexpected</span><br><span class=\"line\">startretries=3       ; 3</span><br><span class=\"line\">user=tomcat          ; root</span><br><span class=\"line\">priority=999         ; 999</span><br><span class=\"line\">redirect_stderr=true ; stderrstdoutfalse</span><br><span class=\"line\">stdout_logfile_maxbytes=20MB  ; stdout 50MB</span><br><span class=\"line\">stdout_logfile_backups = 20   ; stdout 10</span><br><span class=\"line\">; stdout supervisord </span><br><span class=\"line\">stdout_logfile=/opt/apache-tomcat-8.0.35/logs/catalina.out</span><br><span class=\"line\">stopasgroup=false     ;false,stop</span><br><span class=\"line\">killasgroup=false     ;falsekill</span><br><span class=\"line\"></span><br><span class=\"line\">;[eventlistener:theeventlistenername] ;</span><br><span class=\"line\">;command=/bin/eventlistener    ; </span><br><span class=\"line\">;process_name=%(program_name)s ; </span><br><span class=\"line\">;numprocs=1                    ; </span><br><span class=\"line\">;events=EVENT                  ; </span><br><span class=\"line\">;buffer_size=10                ; </span><br><span class=\"line\">;directory=/tmp                ; exec</span><br><span class=\"line\">;umask=022                     ; </span><br><span class=\"line\">;priority=-1                   ; </span><br><span class=\"line\">;autostart=true                ; supervisord</span><br><span class=\"line\">;startsecs=1                   ; # </span><br><span class=\"line\">;startretries=3                ; </span><br><span class=\"line\">;autorestart=unexpected        ; </span><br><span class=\"line\">;exitcodes=0,2                 ; &#x27;expected&#x27;</span><br><span class=\"line\">;stopsignal=QUIT               ; </span><br><span class=\"line\">;stopwaitsecs=10               ; </span><br><span class=\"line\">;stopasgroup=false             ; </span><br><span class=\"line\">;killasgroup=false             ; </span><br><span class=\"line\">;user=chrism                   ; </span><br><span class=\"line\">;redirect_stderr=false         ; redirect_stderr=true</span><br><span class=\"line\">;stdout_logfile=/a/path        ; stdoutAUTO</span><br><span class=\"line\">;stdout_logfile_maxbytes=1MB   ;  logfile50MB</span><br><span class=\"line\">;stdout_logfile_backups=10     ;  stdout</span><br><span class=\"line\">;stdout_events_enabled=false   ; stdout</span><br><span class=\"line\">;stderr_logfile=/a/path        ; stderrAUTO</span><br><span class=\"line\">;stderr_logfile_maxbytes=1MB   ; logfile50MB</span><br><span class=\"line\">;stderr_logfile_backups=10     ; stderr</span><br><span class=\"line\">;stderr_events_enabled=false   ; stderr</span><br><span class=\"line\">;environment=A=&quot;1&quot;,B=&quot;2&quot;       ; </span><br><span class=\"line\">;serverurl=AUTO                ; serverurl</span><br><span class=\"line\"></span><br><span class=\"line\">;[group:thegroupname] ;</span><br><span class=\"line\">;programs=progname1,progname2  ; </span><br><span class=\"line\">;priority=999                  ; </span><br><span class=\"line\"></span><br><span class=\"line\">;,include</span><br><span class=\"line\">[include]</span><br><span class=\"line\">files = relative/directory/*.ini    ;.ini</span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":6725,"excerpt":"","more":"<blockquote>\n<p>supervisor</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Linuxcentos7.464bituname -a3.10.0-693.2.2.el7.x86_64</p>\n<h2 id=\"supervisor\"><a href=\"#supervisor\" class=\"headerlink\" title=\"supervisor\"></a>supervisor</h2><p>supervisor</p>\n<h3 id=\"setuptools\"><a href=\"#setuptools\" class=\"headerlink\" title=\"setuptools\"></a>setuptools</h3><p>setuptoolseasy_installeasy_install<br>setuptoolspythonsetuptools</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">easy_install supervisor</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"setuptools\"><a href=\"#setuptools\" class=\"headerlink\" title=\"setuptools\"></a>setuptools</h3><p>supervisorsupervisorpypipypi.python.org&#x2F;pypi&#x2F;supervisor<br>supervisor</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://files.pythonhosted.org/packages/44/60/698e54b4a4a9b956b2d709b4b7b676119c833d811d53ee2500f1b5e96dc3/supervisor-3.3.4.tar.gz</span><br><span class=\"line\">tar xzf supervisor-3.3.4.tar.gz</span><br><span class=\"line\">cd supervisor*</span><br><span class=\"line\">python setup.py install</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Linuxsupervisorsupervisorsupervisor</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum info supervisor</span><br></pre></td></tr></table></figure>\n\n<p>ubuntu</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-cache show supervisor</span><br></pre></td></tr></table></figure>\n\n<p>supervisord</p>\n<h3 id=\"pip\"><a href=\"#pip\" class=\"headerlink\" title=\"pip\"></a>pip</h3><p>pippython666</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install supervisor</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>supervisorecho_supervisord_conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo_supervisord_conf &gt; /etc/supervisord.conf</span><br></pre></td></tr></table></figure>\n\n<p>rootsudorootsudo</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>supervisorsupervisordsupervisorctlsupervisordsupervisordsupervisorctlsupervisord</p>\n<p>supervisord</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">supervisord</span><br></pre></td></tr></table></figure>\n\n<p>supervisord&#x2F;etc&#x2F;supervisord.conf-c</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">supervisord -c supervisord.conf</span><br></pre></td></tr></table></figure>\n\n<p>supervisord<br>-c FILE, configuration&#x3D;FILEsupervisorFILE-n,<br>nodaemon-h, help-u USER,<br>user&#x3D;USERUnixID-m OCTAL, umask&#x3D;OCTAL-d PATH,<br>directory&#x3D;PATHsupervisorddaemon-l FILE,<br>logfile&#x3D;FILEsupervisord-y BYTES,<br>logfile_maxbytes&#x3D;BYTES1MB1GB-y NUM,<br>logfile_backups&#x3D;NUM-e LEVEL, loglevel&#x3D;LEVELtrace,<br>debug, info, warn, errorcritical-j FILE,<br>pidfile&#x3D;FILEPIDdaemon-i STRING,<br>identifier&#x3D;STRING-q PATH,<br>childlogdir&#x3D;PATH-k, nocleanupsupervisord-a<br>NUM, minfds&#x3D;NUM-t, strip_ansiANSI-v,<br>versionsupervisordprofile_options&#x3D;LISTcumulative, calls,<br>callersminprocs&#x3D;NUM</p>\n<p>supervisorctl<br>supervisorctlsupervisorctlsystemctl</p>\n<p>supervisorctl<br>-c, configuration-h, help-i,<br>interactive-s, serverurl URLsupervisord<br><a href=\"http://localhost:9001-u\">http://localhost:9001-u</a>, usernamesupervisord-p,<br>passwordsupervisord-r, history-filereadlinereadline</p>\n<p>supervisordsupervisord</p>\n<p>supervisorctaction<br>helphelp add []&#x2F;remove<br>[]&#x2F;updateclear clear<br>clear allfg CTRL+CpidsupervisordIDpid<br>IDpid allIDrereaddaemon&#x2F;restart<br>update&#x2F;rereadrestart :*restart<br>restart allsignalstart start<br>:*start start allstatusstatus<br>status stop stop :*stop stop<br>alltail [-f] [stdout&#x2F;stderr]</p>\n<h2 id=\"supervisord\"><a href=\"#supervisord\" class=\"headerlink\" title=\"supervisord\"></a>supervisord</h2><p>github<a href=\"https://github.com/Supervisor/initscripts\">https://github.com/Supervisor/initscripts</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Supervisor daemon</span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=forking</span><br><span class=\"line\">ExecStart=/usr/bin/supervisord -c /etc/supervisord.conf</span><br><span class=\"line\">ExecStop=/usr/bin/supervisorctl $OPTIONS shutdown</span><br><span class=\"line\">ExecReload=/usr/bin/supervisorctl $OPTIONS reload</span><br><span class=\"line\">KillMode=process</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">RestartSec=42s</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p>centossystemctl</p>\n<h2 id=\"supervisord\"><a href=\"#supervisord\" class=\"headerlink\" title=\"supervisord\"></a>supervisord</h2><p>supervisor[]</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[unix_http_server]</span><br><span class=\"line\">file=/tmp/supervisor.sock   ;UNIX socket supervisorctl </span><br><span class=\"line\">;chmod=0700                 ;socketmode0700</span><br><span class=\"line\">;chown=nobody:nogroup       ;socketowneruid:gid</span><br><span class=\"line\"></span><br><span class=\"line\">;[inet_http_server]         ;HTTPweb</span><br><span class=\"line\">;port=127.0.0.1:9001        ;WebIP</span><br><span class=\"line\">;username=user              ;</span><br><span class=\"line\">;password=123               ;</span><br><span class=\"line\"></span><br><span class=\"line\">[supervisord]</span><br><span class=\"line\">logfile=/tmp/supervisord.log ; $CWD/supervisord.log</span><br><span class=\"line\">logfile_maxbytes=50MB        ;rotate 50MB0</span><br><span class=\"line\">logfile_backups=10           ;100</span><br><span class=\"line\">loglevel=info                ;info: debug,warn,trace</span><br><span class=\"line\">pidfile=/tmp/supervisord.pid ;pid </span><br><span class=\"line\">nodaemon=false               ;false daemon </span><br><span class=\"line\">minfds=1024                  ; 1024</span><br><span class=\"line\">minprocs=200                 ; 200</span><br><span class=\"line\"></span><br><span class=\"line\">[supervisorctl]</span><br><span class=\"line\">serverurl=unix:///tmp/supervisor.sock ;UNIX socketsupervisordunix_http_serverfile</span><br><span class=\"line\">;serverurl=http://127.0.0.1:9001 ; HTTPsupervisord</span><br><span class=\"line\"></span><br><span class=\"line\">; [program:xx]xx</span><br><span class=\"line\">[program:xx]</span><br><span class=\"line\">command=/opt/apache-tomcat-8.0.35/bin/catalina.sh run  ; </span><br><span class=\"line\">autostart=true       ; supervisord</span><br><span class=\"line\">startsecs=10         ; 101</span><br><span class=\"line\">autorestart=true     ; ,[unexpected,true,false]unexpected</span><br><span class=\"line\">startretries=3       ; 3</span><br><span class=\"line\">user=tomcat          ; root</span><br><span class=\"line\">priority=999         ; 999</span><br><span class=\"line\">redirect_stderr=true ; stderrstdoutfalse</span><br><span class=\"line\">stdout_logfile_maxbytes=20MB  ; stdout 50MB</span><br><span class=\"line\">stdout_logfile_backups = 20   ; stdout 10</span><br><span class=\"line\">; stdout supervisord </span><br><span class=\"line\">stdout_logfile=/opt/apache-tomcat-8.0.35/logs/catalina.out</span><br><span class=\"line\">stopasgroup=false     ;false,stop</span><br><span class=\"line\">killasgroup=false     ;falsekill</span><br><span class=\"line\"></span><br><span class=\"line\">;[eventlistener:theeventlistenername] ;</span><br><span class=\"line\">;command=/bin/eventlistener    ; </span><br><span class=\"line\">;process_name=%(program_name)s ; </span><br><span class=\"line\">;numprocs=1                    ; </span><br><span class=\"line\">;events=EVENT                  ; </span><br><span class=\"line\">;buffer_size=10                ; </span><br><span class=\"line\">;directory=/tmp                ; exec</span><br><span class=\"line\">;umask=022                     ; </span><br><span class=\"line\">;priority=-1                   ; </span><br><span class=\"line\">;autostart=true                ; supervisord</span><br><span class=\"line\">;startsecs=1                   ; # </span><br><span class=\"line\">;startretries=3                ; </span><br><span class=\"line\">;autorestart=unexpected        ; </span><br><span class=\"line\">;exitcodes=0,2                 ; &#x27;expected&#x27;</span><br><span class=\"line\">;stopsignal=QUIT               ; </span><br><span class=\"line\">;stopwaitsecs=10               ; </span><br><span class=\"line\">;stopasgroup=false             ; </span><br><span class=\"line\">;killasgroup=false             ; </span><br><span class=\"line\">;user=chrism                   ; </span><br><span class=\"line\">;redirect_stderr=false         ; redirect_stderr=true</span><br><span class=\"line\">;stdout_logfile=/a/path        ; stdoutAUTO</span><br><span class=\"line\">;stdout_logfile_maxbytes=1MB   ;  logfile50MB</span><br><span class=\"line\">;stdout_logfile_backups=10     ;  stdout</span><br><span class=\"line\">;stdout_events_enabled=false   ; stdout</span><br><span class=\"line\">;stderr_logfile=/a/path        ; stderrAUTO</span><br><span class=\"line\">;stderr_logfile_maxbytes=1MB   ; logfile50MB</span><br><span class=\"line\">;stderr_logfile_backups=10     ; stderr</span><br><span class=\"line\">;stderr_events_enabled=false   ; stderr</span><br><span class=\"line\">;environment=A=&quot;1&quot;,B=&quot;2&quot;       ; </span><br><span class=\"line\">;serverurl=AUTO                ; serverurl</span><br><span class=\"line\"></span><br><span class=\"line\">;[group:thegroupname] ;</span><br><span class=\"line\">;programs=progname1,progname2  ; </span><br><span class=\"line\">;priority=999                  ; </span><br><span class=\"line\"></span><br><span class=\"line\">;,include</span><br><span class=\"line\">[include]</span><br><span class=\"line\">files = relative/directory/*.ini    ;.ini</span><br></pre></td></tr></table></figure>"},{"title":"Linuxecho+tee","date":"2018-10-28T01:44:46.000Z","url":"operate-many-files-in-echo-and-tee-on-linux","description":"LinuxWindowsLinuxmacOS","_content":"\n> LinuxWindowsLinuxmacOS\n\n\necho\n\n ## echo\n\n```\necho 'test' >> test.txt\n```\n\n\n ## echo\n\n```\necho 'test' > test.txt\n```\n\nechoecho+tee\n\n### echo+tee\n\n```\necho 'test' | tee -a file1 file2 file3\n```\n\n\n## echo+tee\n\n```\necho 'test' | tee file1 file2 file3\n```\n\n\necho+tee","source":"_posts/Linuxecho+tee.md","raw":"---\ntitle: Linuxecho+tee\ndate: 2018-10-28 09:44:46\ntags: \n  - echo\n  - tee\ncategories:\n  - \nurl: operate-many-files-in-echo-and-tee-on-linux\ndescription: LinuxWindowsLinuxmacOS\n---\n\n> LinuxWindowsLinuxmacOS\n\n\necho\n\n ## echo\n\n```\necho 'test' >> test.txt\n```\n\n\n ## echo\n\n```\necho 'test' > test.txt\n```\n\nechoecho+tee\n\n### echo+tee\n\n```\necho 'test' | tee -a file1 file2 file3\n```\n\n\n## echo+tee\n\n```\necho 'test' | tee file1 file2 file3\n```\n\n\necho+tee","slug":"Linuxecho+tee","published":1,"updated":"2022-05-12T17:08:07.530Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6atz0006lvtdhslsbhtr","content":"<blockquote>\n<p>LinuxWindowsLinuxmacOS</p>\n</blockquote>\n<p>echo</p>\n<h2 id=\"echo\"><a href=\"#echo\" class=\"headerlink\" title=\"echo\"></a>echo</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;test&#x27; &gt;&gt; test.txt</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"echo\"><a href=\"#echo\" class=\"headerlink\" title=\"echo\"></a>echo</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;test&#x27; &gt; test.txt</span><br></pre></td></tr></table></figure>\n\n<p>echoecho+tee</p>\n<h3 id=\"echo-tee\"><a href=\"#echo-tee\" class=\"headerlink\" title=\"echo+tee\"></a>echo+tee</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;test&#x27; | tee -a file1 file2 file3</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"echo-tee\"><a href=\"#echo-tee\" class=\"headerlink\" title=\"echo+tee\"></a>echo+tee</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;test&#x27; | tee file1 file2 file3</span><br></pre></td></tr></table></figure>\n\n\n<p>echo+tee</p>\n","site":{"data":{}},"length":491,"excerpt":"","more":"<blockquote>\n<p>LinuxWindowsLinuxmacOS</p>\n</blockquote>\n<p>echo</p>\n<h2 id=\"echo\"><a href=\"#echo\" class=\"headerlink\" title=\"echo\"></a>echo</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;test&#x27; &gt;&gt; test.txt</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"echo\"><a href=\"#echo\" class=\"headerlink\" title=\"echo\"></a>echo</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;test&#x27; &gt; test.txt</span><br></pre></td></tr></table></figure>\n\n<p>echoecho+tee</p>\n<h3 id=\"echo-tee\"><a href=\"#echo-tee\" class=\"headerlink\" title=\"echo+tee\"></a>echo+tee</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;test&#x27; | tee -a file1 file2 file3</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"echo-tee\"><a href=\"#echo-tee\" class=\"headerlink\" title=\"echo+tee\"></a>echo+tee</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;test&#x27; | tee file1 file2 file3</span><br></pre></td></tr></table></figure>\n\n\n<p>echo+tee</p>\n"},{"title":"New Blog, New Start","date":"2017-11-10T06:13:00.000Z","url":"new-blog-new-start","description":"","_content":"\n> \n\n## \n\nwordpressghostnodejshexoweb\nui\n\n\n\n## \n\nhexo","source":"_posts/New Blog, New Start.md","raw":"---\ntitle: New Blog, New Start\ndate: 2017-11-10 14:13:00\nurl: new-blog-new-start\ntags: \n  - hello\n  - hi\ncategories:\n  - \ndescription: \n---\n\n> \n\n## \n\nwordpressghostnodejshexoweb\nui\n\n\n\n## \n\nhexo","slug":"New Blog, New Start","published":1,"updated":"2022-05-12T17:08:18.151Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6au20009lvtd3uyx113d","content":"<blockquote>\n<p></p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>wordpressghostnodejshexoweb<br>ui</p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>hexo</p>\n","site":{"data":{}},"length":227,"excerpt":"","more":"<blockquote>\n<p></p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>wordpressghostnodejshexoweb<br>ui</p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>hexo</p>\n"},{"title":"iOSwebviewiframe","date":"2017-11-17T00:20:00.000Z","url":"rolling-iframe-webpage-content-in-webview-of-ios","description":"iframe10","_content":"\n> iframe10\n\n\n## iframe\n\niframediv\n\n```\nwidth:100%;height:258px;overflow:auto!important; -webkit-overflow-scrolling:touch!important;\n```\n\n\n\n\n## iframe\n\niframeiframe\n\n```\nwidth:100%;height:258px;display:block;overflow:scroll;-webkit-overflow-scrolling:touch;\n```\n\n\n\n\n## iframe\n\niframe100%\n\n## \n\niOS\n\n","source":"_posts/iOSwebviewiframe.md","raw":"---\ntitle: iOSwebviewiframe\ndate: 2017-11-17 08:20:00\ntags: \n  - \n  - iframe\n  - \ncategories:\n  - \nurl: rolling-iframe-webpage-content-in-webview-of-ios\ndescription: iframe10\n---\n\n> iframe10\n\n\n## iframe\n\niframediv\n\n```\nwidth:100%;height:258px;overflow:auto!important; -webkit-overflow-scrolling:touch!important;\n```\n\n\n\n\n## iframe\n\niframeiframe\n\n```\nwidth:100%;height:258px;display:block;overflow:scroll;-webkit-overflow-scrolling:touch;\n```\n\n\n\n\n## iframe\n\niframe100%\n\n## \n\niOS\n\n","slug":"iOSwebviewiframe","published":1,"updated":"2022-05-12T17:07:55.021Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6au3000alvtd17vg7h3r","content":"<blockquote>\n<p>iframe10</p>\n</blockquote>\n<h2 id=\"iframe\"><a href=\"#iframe\" class=\"headerlink\" title=\"iframe\"></a>iframe</h2><p>iframediv</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">width:100%;height:258px;overflow:auto!important; -webkit-overflow-scrolling:touch!important;</span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<h2 id=\"iframe\"><a href=\"#iframe\" class=\"headerlink\" title=\"iframe\"></a>iframe</h2><p>iframeiframe</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">width:100%;height:258px;display:block;overflow:scroll;-webkit-overflow-scrolling:touch;</span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<h2 id=\"iframe\"><a href=\"#iframe\" class=\"headerlink\" title=\"iframe\"></a>iframe</h2><p>iframe100%</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>iOS</p>\n","site":{"data":{}},"length":584,"excerpt":"","more":"<blockquote>\n<p>iframe10</p>\n</blockquote>\n<h2 id=\"iframe\"><a href=\"#iframe\" class=\"headerlink\" title=\"iframe\"></a>iframe</h2><p>iframediv</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">width:100%;height:258px;overflow:auto!important; -webkit-overflow-scrolling:touch!important;</span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<h2 id=\"iframe\"><a href=\"#iframe\" class=\"headerlink\" title=\"iframe\"></a>iframe</h2><p>iframeiframe</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">width:100%;height:258px;display:block;overflow:scroll;-webkit-overflow-scrolling:touch;</span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<h2 id=\"iframe\"><a href=\"#iframe\" class=\"headerlink\" title=\"iframe\"></a>iframe</h2><p>iframe100%</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>iOS</p>\n"},{"title":"mysqlemoji","date":"2018-05-09T23:45:00.000Z","url":"storing-emoji-in-mysql","description":"emojiemoji","_content":"\n> emojiemoji\n\n## emoji\n\nemojiemoji\n\n## emoji\n\nemojiUnicodemysqlutf8mb4unicode.org\nemoji<https://unicode.org/emoji/charts/full-emoji-list.html>\n\n## emoji\n\nmysqlemojiutf8mb4utf8mb4\n\n```\nmysql -u root -p\n```\n\nmysql\n\n```\nmysql> use leo;\nmysql> alter database leo default charset = utf8mb4;\nmysql> alter table leo_table default charset = utf8mb4;\nmysql> alter table leo_table change table_emoji table_emoji VARCHAR(128) character set utf8mb4 collate utf8mb4_general_ci;\n```\n\nleoleo_tabletable_emojimysql>mysql\n\n1. ;\n2. \n3. \n4. \n\n\n\n## mysqlmy.cnf\n\n```\n[client]  \ndefault-character-set = utf8mb4  \n  \n[mysql]  \ndefault-character-set = utf8mb4  \n  \n[mysqld]  \ncharacter-set-client-handshake = FALSE  \ncharacter-set-server = utf8mb4  \ncollation-server = utf8mb4_unicode_ci  \ninit_connect='SET NAMES utf8mb4' \n```\n\n\n\n## \n\nutf8mb4mysql5.5.3mysqlmysqlemoji","source":"_posts/mysqlemoji.md","raw":"---\ntitle: mysqlemoji\ndate: 2018-05-10 07:45:00\ntags: \n  - mysql\n  - emoji\ncategories:\n  - \nurl: storing-emoji-in-mysql\ndescription: emojiemoji\n---\n\n> emojiemoji\n\n## emoji\n\nemojiemoji\n\n## emoji\n\nemojiUnicodemysqlutf8mb4unicode.org\nemoji<https://unicode.org/emoji/charts/full-emoji-list.html>\n\n## emoji\n\nmysqlemojiutf8mb4utf8mb4\n\n```\nmysql -u root -p\n```\n\nmysql\n\n```\nmysql> use leo;\nmysql> alter database leo default charset = utf8mb4;\nmysql> alter table leo_table default charset = utf8mb4;\nmysql> alter table leo_table change table_emoji table_emoji VARCHAR(128) character set utf8mb4 collate utf8mb4_general_ci;\n```\n\nleoleo_tabletable_emojimysql>mysql\n\n1. ;\n2. \n3. \n4. \n\n\n\n## mysqlmy.cnf\n\n```\n[client]  \ndefault-character-set = utf8mb4  \n  \n[mysql]  \ndefault-character-set = utf8mb4  \n  \n[mysqld]  \ncharacter-set-client-handshake = FALSE  \ncharacter-set-server = utf8mb4  \ncollation-server = utf8mb4_unicode_ci  \ninit_connect='SET NAMES utf8mb4' \n```\n\n\n\n## \n\nutf8mb4mysql5.5.3mysqlmysqlemoji","slug":"mysqlemoji","published":1,"updated":"2022-05-12T17:08:13.618Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6au5000flvtdg2zu9w43","content":"<blockquote>\n<p>emojiemoji</p>\n</blockquote>\n<h2 id=\"emoji\"><a href=\"#emoji\" class=\"headerlink\" title=\"emoji\"></a>emoji</h2><p>emojiemoji</p>\n<h2 id=\"emoji\"><a href=\"#emoji\" class=\"headerlink\" title=\"emoji\"></a>emoji</h2><p>emojiUnicodemysqlutf8mb4unicode.org<br>emoji<a href=\"https://unicode.org/emoji/charts/full-emoji-list.html\">https://unicode.org/emoji/charts/full-emoji-list.html</a></p>\n<h2 id=\"emoji\"><a href=\"#emoji\" class=\"headerlink\" title=\"emoji\"></a>emoji</h2><p>mysqlemojiutf8mb4utf8mb4</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -u root -p</span><br></pre></td></tr></table></figure>\n\n<p>mysql</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; use leo;</span><br><span class=\"line\">mysql&gt; alter database leo default charset = utf8mb4;</span><br><span class=\"line\">mysql&gt; alter table leo_table default charset = utf8mb4;</span><br><span class=\"line\">mysql&gt; alter table leo_table change table_emoji table_emoji VARCHAR(128) character set utf8mb4 collate utf8mb4_general_ci;</span><br></pre></td></tr></table></figure>\n\n<p>leoleo_tabletable_emojimysql&gt;mysql</p>\n<ol>\n<li>;</li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<h2 id=\"mysqlmy-cnf\"><a href=\"#mysqlmy-cnf\" class=\"headerlink\" title=\"mysqlmy.cnf\"></a>mysqlmy.cnf</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[client]  </span><br><span class=\"line\">default-character-set = utf8mb4  </span><br><span class=\"line\">  </span><br><span class=\"line\">[mysql]  </span><br><span class=\"line\">default-character-set = utf8mb4  </span><br><span class=\"line\">  </span><br><span class=\"line\">[mysqld]  </span><br><span class=\"line\">character-set-client-handshake = FALSE  </span><br><span class=\"line\">character-set-server = utf8mb4  </span><br><span class=\"line\">collation-server = utf8mb4_unicode_ci  </span><br><span class=\"line\">init_connect=&#x27;SET NAMES utf8mb4&#x27; </span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>utf8mb4mysql5.5.3mysqlmysqlemoji</p>\n","site":{"data":{}},"length":1223,"excerpt":"","more":"<blockquote>\n<p>emojiemoji</p>\n</blockquote>\n<h2 id=\"emoji\"><a href=\"#emoji\" class=\"headerlink\" title=\"emoji\"></a>emoji</h2><p>emojiemoji</p>\n<h2 id=\"emoji\"><a href=\"#emoji\" class=\"headerlink\" title=\"emoji\"></a>emoji</h2><p>emojiUnicodemysqlutf8mb4unicode.org<br>emoji<a href=\"https://unicode.org/emoji/charts/full-emoji-list.html\">https://unicode.org/emoji/charts/full-emoji-list.html</a></p>\n<h2 id=\"emoji\"><a href=\"#emoji\" class=\"headerlink\" title=\"emoji\"></a>emoji</h2><p>mysqlemojiutf8mb4utf8mb4</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -u root -p</span><br></pre></td></tr></table></figure>\n\n<p>mysql</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; use leo;</span><br><span class=\"line\">mysql&gt; alter database leo default charset = utf8mb4;</span><br><span class=\"line\">mysql&gt; alter table leo_table default charset = utf8mb4;</span><br><span class=\"line\">mysql&gt; alter table leo_table change table_emoji table_emoji VARCHAR(128) character set utf8mb4 collate utf8mb4_general_ci;</span><br></pre></td></tr></table></figure>\n\n<p>leoleo_tabletable_emojimysql&gt;mysql</p>\n<ol>\n<li>;</li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<h2 id=\"mysqlmy-cnf\"><a href=\"#mysqlmy-cnf\" class=\"headerlink\" title=\"mysqlmy.cnf\"></a>mysqlmy.cnf</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[client]  </span><br><span class=\"line\">default-character-set = utf8mb4  </span><br><span class=\"line\">  </span><br><span class=\"line\">[mysql]  </span><br><span class=\"line\">default-character-set = utf8mb4  </span><br><span class=\"line\">  </span><br><span class=\"line\">[mysqld]  </span><br><span class=\"line\">character-set-client-handshake = FALSE  </span><br><span class=\"line\">character-set-server = utf8mb4  </span><br><span class=\"line\">collation-server = utf8mb4_unicode_ci  </span><br><span class=\"line\">init_connect=&#x27;SET NAMES utf8mb4&#x27; </span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>utf8mb4mysql5.5.3mysqlmysqlemoji</p>\n"},{"title":"nginx+lua","date":"2018-01-31T23:19:00.000Z","url":"install-nginx-and-lua","description":"nginxluaOpenRestynginxnginx+lua","_content":"\n> nginxluaOpenRestynginxnginx+lua\n\n## \n\nnginx1.12.0luajit2.0.5lua-nginx-modulev0.10.9rc8/root/srcgithubhttps://github.com/nginx/nginx  https://github.com/LuaJIT/LuaJIT   \nhttps://github.com/openresty/lua-nginx-module\n\n```\nmkdir -p /root/src\ncd /root/src\nwget https://github.com/nginx/nginx/archive/release-1.12.0.tar.gz\nwget https://github.com/LuaJIT/LuaJIT/archive/v2.0.5.tar.gz\nwget https://github.com/openresty/lua-nginx-module/archive/v0.10.9rc8.tar.gz\n```\n\n## \n\n```\nls *.tar.gz | xargs -n1 tar xzvf\n```\n\n## luajit\n\n```\ncd LuaJIT-2.0.5\nmake\nmake install PREFIX=/usr/local/luajit\n```\n\n## nginx\n\n```\ncd nginx-1.12.0\nexport LUAJIT_LIB=/usr/local/luajit/lib\nexport LUAJIT_INC=/usr/local/luajit/include/luajit-2.0\n./configure --prefix=/usr/local/nginx --user=www --group=www --with-http_stub_status_module --with-http_v2_module --with-http_ssl_module --with-http_gzip_static_module --with-http_realip_module --add-module=/root/src/lua-nginx-module-0.10.9rc8\nmake\nmake install\n```\n\n## \n\nnginxnginxlibluajit-5.1.so.2: cannot open shared object filelibluajit-5.1.so.2\n\n```\nln -s /usr/local/luajit/lib/libluajit-5.1.so.2 /lib64/libluajit-5.1.so.2\n```","source":"_posts/nginx+lua.md","raw":"---\ntitle: nginx+lua\ndate: 2018-02-01 07:19:00\ntags: \n  - nginx\n  - lua\n  - \ncategories:\n  - \nurl: install-nginx-and-lua\ndescription: nginxluaOpenRestynginxnginx+lua\n---\n\n> nginxluaOpenRestynginxnginx+lua\n\n## \n\nnginx1.12.0luajit2.0.5lua-nginx-modulev0.10.9rc8/root/srcgithubhttps://github.com/nginx/nginx  https://github.com/LuaJIT/LuaJIT   \nhttps://github.com/openresty/lua-nginx-module\n\n```\nmkdir -p /root/src\ncd /root/src\nwget https://github.com/nginx/nginx/archive/release-1.12.0.tar.gz\nwget https://github.com/LuaJIT/LuaJIT/archive/v2.0.5.tar.gz\nwget https://github.com/openresty/lua-nginx-module/archive/v0.10.9rc8.tar.gz\n```\n\n## \n\n```\nls *.tar.gz | xargs -n1 tar xzvf\n```\n\n## luajit\n\n```\ncd LuaJIT-2.0.5\nmake\nmake install PREFIX=/usr/local/luajit\n```\n\n## nginx\n\n```\ncd nginx-1.12.0\nexport LUAJIT_LIB=/usr/local/luajit/lib\nexport LUAJIT_INC=/usr/local/luajit/include/luajit-2.0\n./configure --prefix=/usr/local/nginx --user=www --group=www --with-http_stub_status_module --with-http_v2_module --with-http_ssl_module --with-http_gzip_static_module --with-http_realip_module --add-module=/root/src/lua-nginx-module-0.10.9rc8\nmake\nmake install\n```\n\n## \n\nnginxnginxlibluajit-5.1.so.2: cannot open shared object filelibluajit-5.1.so.2\n\n```\nln -s /usr/local/luajit/lib/libluajit-5.1.so.2 /lib64/libluajit-5.1.so.2\n```","slug":"nginx+lua","published":1,"updated":"2022-05-12T17:08:22.952Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6au6000ilvtddzs83rvb","content":"<blockquote>\n<p>nginxluaOpenRestynginxnginx+lua</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>nginx1.12.0luajit2.0.5lua-nginx-modulev0.10.9rc8&#x2F;root&#x2F;srcgithub<a href=\"https://github.com/nginx/nginx\">https://github.com/nginx/nginx</a>  <a href=\"https://github.com/LuaJIT/LuaJIT\">https://github.com/LuaJIT/LuaJIT</a>  <br><a href=\"https://github.com/openresty/lua-nginx-module\">https://github.com/openresty/lua-nginx-module</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /root/src</span><br><span class=\"line\">cd /root/src</span><br><span class=\"line\">wget https://github.com/nginx/nginx/archive/release-1.12.0.tar.gz</span><br><span class=\"line\">wget https://github.com/LuaJIT/LuaJIT/archive/v2.0.5.tar.gz</span><br><span class=\"line\">wget https://github.com/openresty/lua-nginx-module/archive/v0.10.9rc8.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls *.tar.gz | xargs -n1 tar xzvf</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"luajit\"><a href=\"#luajit\" class=\"headerlink\" title=\"luajit\"></a>luajit</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd LuaJIT-2.0.5</span><br><span class=\"line\">make</span><br><span class=\"line\">make install PREFIX=/usr/local/luajit</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"nginx\"><a href=\"#nginx\" class=\"headerlink\" title=\"nginx\"></a>nginx</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd nginx-1.12.0</span><br><span class=\"line\">export LUAJIT_LIB=/usr/local/luajit/lib</span><br><span class=\"line\">export LUAJIT_INC=/usr/local/luajit/include/luajit-2.0</span><br><span class=\"line\">./configure --prefix=/usr/local/nginx --user=www --group=www --with-http_stub_status_module --with-http_v2_module --with-http_ssl_module --with-http_gzip_static_module --with-http_realip_module --add-module=/root/src/lua-nginx-module-0.10.9rc8</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>nginxnginxlibluajit-5.1.so.2: cannot open shared object filelibluajit-5.1.so.2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s /usr/local/luajit/lib/libluajit-5.1.so.2 /lib64/libluajit-5.1.so.2</span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":1195,"excerpt":"","more":"<blockquote>\n<p>nginxluaOpenRestynginxnginx+lua</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>nginx1.12.0luajit2.0.5lua-nginx-modulev0.10.9rc8&#x2F;root&#x2F;srcgithub<a href=\"https://github.com/nginx/nginx\">https://github.com/nginx/nginx</a>  <a href=\"https://github.com/LuaJIT/LuaJIT\">https://github.com/LuaJIT/LuaJIT</a>  <br><a href=\"https://github.com/openresty/lua-nginx-module\">https://github.com/openresty/lua-nginx-module</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /root/src</span><br><span class=\"line\">cd /root/src</span><br><span class=\"line\">wget https://github.com/nginx/nginx/archive/release-1.12.0.tar.gz</span><br><span class=\"line\">wget https://github.com/LuaJIT/LuaJIT/archive/v2.0.5.tar.gz</span><br><span class=\"line\">wget https://github.com/openresty/lua-nginx-module/archive/v0.10.9rc8.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls *.tar.gz | xargs -n1 tar xzvf</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"luajit\"><a href=\"#luajit\" class=\"headerlink\" title=\"luajit\"></a>luajit</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd LuaJIT-2.0.5</span><br><span class=\"line\">make</span><br><span class=\"line\">make install PREFIX=/usr/local/luajit</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"nginx\"><a href=\"#nginx\" class=\"headerlink\" title=\"nginx\"></a>nginx</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd nginx-1.12.0</span><br><span class=\"line\">export LUAJIT_LIB=/usr/local/luajit/lib</span><br><span class=\"line\">export LUAJIT_INC=/usr/local/luajit/include/luajit-2.0</span><br><span class=\"line\">./configure --prefix=/usr/local/nginx --user=www --group=www --with-http_stub_status_module --with-http_v2_module --with-http_ssl_module --with-http_gzip_static_module --with-http_realip_module --add-module=/root/src/lua-nginx-module-0.10.9rc8</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>nginxnginxlibluajit-5.1.so.2: cannot open shared object filelibluajit-5.1.so.2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s /usr/local/luajit/lib/libluajit-5.1.so.2 /lib64/libluajit-5.1.so.2</span><br></pre></td></tr></table></figure>"},{"title":"waf","date":"2018-09-12T00:10:00.000Z","url":"the-modification-of-waf-firewall","description":"luanginxluawafwafwafwafDDOSCCwaf","_content":"\n> luanginxluawafwafwafwafDDOSCCwaf\n\n## \n\nwafngx_lua_wafhttps://github.com/loveshell/ngx_lua_waf\nngx_lua_wafgithubPull\nrequestsPull requests9Pull requests\n\n## waf.lua\n\n```\nlocal content_length=tonumber(ngx.req.get_headers()['content-length'])\nlocal method=ngx.req.get_method()\n--ngx_lua0.9.2ngx.re.find\nlocal ngxmatch=ngx.re.match\n--local ngxmatch=ngx.re.find\nif whiteip() then\nelseif whiteurl() then\nelseif blockip() then\n--ip\nelseif denyhackip(1) then\nelseif denycc() then\nelseif ngx.var.http_Acunetix_Aspect then\n    ngx.exit(444)\nelseif ngx.var.http_X_Scan_Memo then\n    ngx.exit(444)\nelseif ua() then\nelseif url() then\nelseif args() then\nelseif cookie() then\nelseif PostCheck then\n    if method==\"POST\" then\n            local boundary = get_boundary()\n\t    if boundary then\n\t    local len = string.len\n            local sock, err = ngx.req.socket()\n    \t    if not sock then\n\t\t\t\t\treturn\n            end\n\t    ngx.req.init_body(128 * 1024)\n            sock:settimeout(0)\n\t    local content_length = nil\n    \t    content_length=tonumber(ngx.req.get_headers()['content-length'])\n    \t    local chunk_size = 4096\n            if content_length < chunk_size then\n\t\t\t\t\tchunk_size = content_length\n\t    end\n            local size = 0\n\t    while size < content_length do\n\t\tlocal data, err, partial = sock:receive(chunk_size)\n\t\tdata = data or partial\n\t\tif not data then\n\t\t\treturn\n\t\tend\n\t\tngx.req.append_body(data)\n        \tif body(data) then\n\t   \t        return true\n    \t    \tend\n\t\tsize = size + len(data)\n\t\tlocal m = ngxmatch(data,[[Content-Disposition: form-data;(.+)filename=\"(.+)\\.(.*)\"]],'ijo')\n        \tif m then\n            \t\tfileExtCheck(m[3])\n            \t\tfiletranslate = true\n        \telse\n            \t\tif ngxmatch(data,\"Content-Disposition:\",'isjo') then\n                \t\tfiletranslate = false\n            \t\tend\n            \t\tif filetranslate==false then\n            \t\t\tif body(data) then\n                    \t\t\treturn true\n                \t\tend\n            \t\tend\n        \tend\n\t\tlocal less = content_length - size\n\t\tif less < chunk_size then\n\t\t\tchunk_size = less\n\t\tend\n\t end\n\t ngx.req.finish_body()\n    else\n\t\t\tngx.req.read_body()\n\t\t\tlocal args = ngx.req.get_post_args()\n\t\t\tif not args then\n\t\t\t\treturn\n\t\t\tend\n\t\t\tfor key, val in pairs(args) do\n\t\t\t\tif type(val) == \"table\" then\n\t\t\t\t\tif type(val[1]) == \"boolean\" then\n\t\t\t\t\t\treturn\n\t\t\t\t\tend\n\t\t\t\t\tdata=table.concat(val, \", \")\n\t\t\t\telse\n\t\t\t\t\tdata=val\n\t\t\t\tend\n\t\t\t\tif data and type(data) ~= \"boolean\" and body(data) then\n                \t\t\tbody(key)\n\t\t\t\tend\n\t\t\tend\n\t\tend\n\t\tend\n\nelse\n    return\nend\n```\n\n## socket.lua\n\n```\n-- Copyright (C) 2013-2014 Jiale Zhi (calio), CloudFlare Inc.\n--require \"luacov\"\n\nlocal concat                = table.concat\nlocal tcp                   = ngx.socket.tcp\nlocal udp                   = ngx.socket.udp\nlocal timer_at              = ngx.timer.at\nlocal ngx_log               = ngx.log\nlocal ngx_sleep             = ngx.sleep\nlocal type                  = type\nlocal pairs                 = pairs\nlocal tostring              = tostring\nlocal debug                 = ngx.config.debug\n\nlocal DEBUG                 = ngx.DEBUG\nlocal CRIT                  = ngx.CRIT\n\nlocal MAX_PORT              = 65535\n\n\n-- table.new(narr, nrec)\nlocal succ, new_tab = pcall(require, \"table.new\")\nif not succ then\n    new_tab = function () return {} end\nend\n\nlocal _M = new_tab(0, 5)\n\nlocal is_exiting\n\nif not ngx.config or not ngx.config.ngx_lua_version\n    or ngx.config.ngx_lua_version < 9003 then\n\n    is_exiting = function() return false end\n\n    ngx_log(CRIT, \"We strongly recommend you to update your ngx_lua module to \"\n            .. \"0.9.3 or above. lua-resty-logger-socket will lose some log \"\n            .. \"messages when Nginx reloads if it works with ngx_lua module \"\n            .. \"below 0.9.3\")\nelse\n    is_exiting = ngx.worker.exiting\nend\n\n\n_M._VERSION = '0.03'\n\n-- user config\nlocal flush_limit           = 4096         -- 4KB\nlocal drop_limit            = 1048576      -- 1MB\nlocal timeout               = 1000         -- 1 sec\nlocal host\nlocal port\nlocal ssl                   = false\nlocal ssl_verify            = true\nlocal sni_host\nlocal path\nlocal max_buffer_reuse      = 10000        -- reuse buffer for at most 10000\n                                           -- times\nlocal periodic_flush        = nil\nlocal need_periodic_flush   = nil\nlocal sock_type             = 'tcp'\n\n-- internal variables\nlocal buffer_size           = 0\n-- 2nd level buffer, it stores logs ready to be sent out\nlocal send_buffer           = \"\"\n-- 1st level buffer, it stores incoming logs\nlocal log_buffer_data       = new_tab(20000, 0)\n-- number of log lines in current 1st level buffer, starts from 0\nlocal log_buffer_index      = 0\n\nlocal last_error\n\nlocal connecting\nlocal connected\nlocal exiting\nlocal retry_connect         = 0\nlocal retry_send            = 0\nlocal max_retry_times       = 3\nlocal retry_interval        = 100         -- 0.1s\nlocal pool_size             = 10\nlocal flushing\nlocal logger_initted\nlocal counter               = 0\nlocal ssl_session\n\nlocal function _write_error(msg)\n    last_error = msg\nend\n\nlocal function _do_connect()\n    local ok, err, sock\n\n    if not connected then\n        if (sock_type == 'udp') then\n            sock, err = udp()\n        else\n            sock, err = tcp()\n        end\n\n        if not sock then\n            _write_error(err)\n            return nil, err\n        end\n\n        sock:settimeout(timeout)\n    end\n\n    -- \"host\"/\"port\" and \"path\" have already been checked in init()\n    if host and port then\n        if (sock_type == 'udp') then\n            ok, err = sock:setpeername(host, port)\n        else\n            ok, err = sock:connect(host, port)\n        end\n    elseif path then\n        ok, err = sock:connect(\"unix:\" .. path)\n    end\n\n    if not ok then\n        return nil, err\n    end\n\n    return sock\nend\n\nlocal function _do_handshake(sock)\n    if not ssl then\n        return sock\n    end\n\n    local session, err = sock:sslhandshake(ssl_session, sni_host or host,\n                                           ssl_verify)\n    if not session then\n        return nil, err\n    end\n\n    ssl_session = session\n    return sock\nend\n\nlocal function _connect()\n    local err, sock\n\n    if connecting then\n        if debug then\n            ngx_log(DEBUG, \"previous connection not finished\")\n        end\n        return nil, \"previous connection not finished\"\n    end\n\n    connected = false\n    connecting = true\n\n    retry_connect = 0\n\n    while retry_connect <= max_retry_times do\n        sock, err = _do_connect()\n\n        if sock then\n            sock, err = _do_handshake(sock)\n            if sock then\n                connected = true\n                break\n            end\n        end\n\n        if debug then\n            ngx_log(DEBUG, \"reconnect to the log server: \", err)\n        end\n\n        -- ngx.sleep time is in seconds\n        if not exiting then\n            ngx_sleep(retry_interval / 1000)\n        end\n\n        retry_connect = retry_connect + 1\n    end\n\n    connecting = false\n    if not connected then\n        return nil, \"try to connect to the log server failed after \"\n                    .. max_retry_times .. \" retries: \" .. err\n    end\n\n    return sock\nend\n\nlocal function _prepare_stream_buffer()\n    local packet = concat(log_buffer_data, \"\", 1, log_buffer_index)\n    send_buffer = send_buffer .. packet\n\n    log_buffer_index = 0\n    counter = counter + 1\n    if counter > max_buffer_reuse then\n        log_buffer_data = new_tab(20000, 0)\n        counter = 0\n        if debug then\n            ngx_log(DEBUG, \"log buffer reuse limit (\" .. max_buffer_reuse\n                    .. \") reached, create a new \\\"log_buffer_data\\\"\")\n        end\n    end\nend\n\nlocal function _do_flush()\n    local ok, err, sock, bytes\n    local packet = send_buffer\n\n    sock, err = _connect()\n    if not sock then\n        return nil, err\n    end\n\n    bytes, err = sock:send(packet)\n    if not bytes then\n        -- \"sock:send\" always closes current connection on error\n        return nil, err\n    end\n\n    if debug then\n        ngx.update_time()\n        ngx_log(DEBUG, ngx.now(), \":log flush:\" .. bytes .. \":\" .. packet)\n    end\n\n    if (sock_type ~= 'udp') then\n        ok, err = sock:setkeepalive(0, pool_size)\n        if not ok then\n            return nil, err\n        end\n    end\n\n    return bytes\nend\n\nlocal function _need_flush()\n    if buffer_size > 0 then\n        return true\n    end\n\n    return false\nend\n\nlocal function _flush_lock()\n    if not flushing then\n        if debug then\n            ngx_log(DEBUG, \"flush lock acquired\")\n        end\n        flushing = true\n        return true\n    end\n    return false\nend\n\nlocal function _flush_unlock()\n    if debug then\n        ngx_log(DEBUG, \"flush lock released\")\n    end\n    flushing = false\nend\n\nlocal function _flush()\n    local err\n\n    -- pre check\n    if not _flush_lock() then\n        if debug then\n            ngx_log(DEBUG, \"previous flush not finished\")\n        end\n        -- do this later\n        return true\n    end\n\n    if not _need_flush() then\n        if debug then\n            ngx_log(DEBUG, \"no need to flush:\", log_buffer_index)\n        end\n        _flush_unlock()\n        return true\n    end\n\n    -- start flushing\n    retry_send = 0\n    if debug then\n        ngx_log(DEBUG, \"start flushing\")\n    end\n\n    local bytes\n    while retry_send <= max_retry_times do\n        if log_buffer_index > 0 then\n            _prepare_stream_buffer()\n        end\n\n        bytes, err = _do_flush()\n\n        if bytes then\n            break\n        end\n\n        if debug then\n            ngx_log(DEBUG, \"resend log messages to the log server: \", err)\n        end\n\n        -- ngx.sleep time is in seconds\n        if not exiting then\n            ngx_sleep(retry_interval / 1000)\n        end\n\n        retry_send = retry_send + 1\n    end\n\n    _flush_unlock()\n\n    if not bytes then\n        local err_msg = \"try to send log messages to the log server \"\n                        .. \"failed after \" .. max_retry_times .. \" retries: \"\n                        .. err\n        _write_error(err_msg)\n        return nil, err_msg\n    else\n        if debug then\n            ngx_log(DEBUG, \"send \" .. bytes .. \" bytes\")\n        end\n    end\n\n    buffer_size = buffer_size - #send_buffer\n    send_buffer = \"\"\n\n    return bytes\nend\n\nlocal function _periodic_flush(premature)\n    if premature then\n        exiting = true\n    end\n\n    if need_periodic_flush or exiting then\n        -- no regular flush happened after periodic flush timer had been set\n        if debug then\n            ngx_log(DEBUG, \"performing periodic flush\")\n        end\n        _flush()\n    else\n        if debug then\n            ngx_log(DEBUG, \"no need to perform periodic flush: regular flush \"\n                    .. \"happened before\")\n        end\n        need_periodic_flush = true\n    end\n\n    timer_at(periodic_flush, _periodic_flush)\nend\n\nlocal function _flush_buffer()\n    local ok, err = timer_at(0, _flush)\n\n    need_periodic_flush = false\n\n    if not ok then\n        _write_error(err)\n        return nil, err\n    end\nend\n\nlocal function _write_buffer(msg, len)\n    log_buffer_index = log_buffer_index + 1\n    log_buffer_data[log_buffer_index] = msg\n\n    buffer_size = buffer_size + len\n\n\n    return buffer_size\nend\n\nfunction _M.init(user_config)\n    if (type(user_config) ~= \"table\") then\n        return nil, \"user_config must be a table\"\n    end\n\n    for k, v in pairs(user_config) do\n        if k == \"host\" then\n            if type(v) ~= \"string\" then\n                return nil, '\"host\" must be a string'\n            end\n            host = v\n        elseif k == \"port\" then\n            if type(v) ~= \"number\" then\n                return nil, '\"port\" must be a number'\n            end\n            if v < 0 or v > MAX_PORT then\n                return nil, ('\"port\" out of range 0~%s'):format(MAX_PORT)\n            end\n            port = v\n        elseif k == \"path\" then\n            if type(v) ~= \"string\" then\n                return nil, '\"path\" must be a string'\n            end\n            path = v\n        elseif k == \"sock_type\" then\n            if type(v) ~= \"string\" then\n                return nil, '\"sock_type\" must be a string'\n            end\n            if v ~= \"tcp\" and v ~= \"udp\" then\n                return nil, '\"sock_type\" must be \"tcp\" or \"udp\"'\n            end\n            sock_type = v\n        elseif k == \"flush_limit\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"flush_limit\"'\n            end\n            flush_limit = v\n        elseif k == \"drop_limit\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"drop_limit\"'\n            end\n            drop_limit = v\n        elseif k == \"timeout\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"timeout\"'\n            end\n            timeout = v\n        elseif k == \"max_retry_times\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"max_retry_times\"'\n            end\n            max_retry_times = v\n        elseif k == \"retry_interval\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"retry_interval\"'\n            end\n            -- ngx.sleep time is in seconds\n            retry_interval = v\n        elseif k == \"pool_size\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"pool_size\"'\n            end\n            pool_size = v\n        elseif k == \"max_buffer_reuse\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"max_buffer_reuse\"'\n            end\n            max_buffer_reuse = v\n        elseif k == \"periodic_flush\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"periodic_flush\"'\n            end\n            periodic_flush = v\n        elseif k == \"ssl\" then\n            if type(v) ~= \"boolean\" then\n                return nil, '\"ssl\" must be a boolean value'\n            end\n            ssl = v\n        elseif k == \"ssl_verify\" then\n            if type(v) ~= \"boolean\" then\n                return nil, '\"ssl_verify\" must be a boolean value'\n            end\n            ssl_verify = v\n        elseif k == \"sni_host\" then\n            if type(v) ~= \"string\" then\n                return nil, '\"sni_host\" must be a string'\n            end\n            sni_host = v\n        end\n    end\n\n    if not (host and port) and not path then\n        return nil, \"no logging server configured. \\\"host\\\"/\\\"port\\\" or \"\n                .. \"\\\"path\\\" is required.\"\n    end\n\n\n    if (flush_limit >= drop_limit) then\n        return nil, \"\\\"flush_limit\\\" should be < \\\"drop_limit\\\"\"\n    end\n\n    flushing = false\n    exiting = false\n    connecting = false\n\n    connected = false\n    retry_connect = 0\n    retry_send = 0\n\n    logger_initted = true\n\n    if periodic_flush then\n        if debug then\n            ngx_log(DEBUG, \"periodic flush enabled for every \"\n                    .. periodic_flush .. \" seconds\")\n        end\n        need_periodic_flush = true\n        timer_at(periodic_flush, _periodic_flush)\n    end\n\n    return logger_initted\nend\n\nfunction _M.log(msg)\n    if not logger_initted then\n        return nil, \"not initialized\"\n    end\n\n    local bytes\n\n    if type(msg) ~= \"string\" then\n        msg = tostring(msg)\n    end\n\n    local msg_len = #msg\n\n    if (debug) then\n        ngx.update_time()\n        ngx_log(DEBUG, ngx.now(), \":log message length: \" .. msg_len)\n    end\n\n    -- response of \"_flush_buffer\" is not checked, because it writes\n    -- error buffer\n    if (is_exiting()) then\n        exiting = true\n        _write_buffer(msg, msg_len)\n        _flush_buffer()\n        if (debug) then\n            ngx_log(DEBUG, \"Nginx worker is exiting\")\n        end\n        bytes = 0\n    elseif (msg_len + buffer_size < flush_limit) then\n        _write_buffer(msg, msg_len)\n        bytes = msg_len\n    elseif (msg_len + buffer_size <= drop_limit) then\n        _write_buffer(msg, msg_len)\n        _flush_buffer()\n        bytes = msg_len\n    else\n        _flush_buffer()\n        if (debug) then\n            ngx_log(DEBUG, \"logger buffer is full, this log message will be \"\n                    .. \"dropped\")\n        end\n        bytes = 0\n        --- this log message doesn't fit in buffer, drop it\n    end\n\n    if last_error then\n        local err = last_error\n        last_error = nil\n        return bytes, err\n    end\n\n    return bytes\nend\n\nfunction _M.initted()\n    return logger_initted\nend\n\n_M.flush = _flush\n\nreturn _M\n```\n\n## init.lua\n\n```\nrequire 'config'\nlocal match = string.match\n--ngx_lua0.9.2ngx.re.find\n--nginxlua\\d\\w\\s\n--local ngxmatch=ngx.re.match\nlocal ngxmatch=ngx.re.find\nlocal unescape=ngx.unescape_uri\nlocal get_headers = ngx.req.get_headers\nlocal optionIsOn = function (options) return options == \"on\" and true or false end\nloghack=optionIsOn(loghack)\n--socket.lualogsyslog\nlocal logger = require \"socket\"\nif loghack then\n\n\n\tif not logger.initted() then\n          local ok, err = logger.init{\n              --host = '192.168.0.1',\n              host = 'logserver.local',\n              port = 514,\n              sock_type = \"udp\", --udp\n              flush_limit = 1,\t--\n              --drop_limit = 5678,\n              pool_size = 100,--\n          }\n          if not ok then\n              ngx.log(ngx.ERR, \"failed to initialize the logger: \",\n                      err)\n              return\n          end\n end\nend\n\n\nlogpath = logdir\nrulepath = RulePath\nlogtofile = optionIsOn(logtofile)\nlogtoserver = optionIsOn(logtoserver)\nUrlDeny = optionIsOn(UrlDeny)\nPostCheck = optionIsOn(postMatch)\nCookieCheck = optionIsOn(cookieMatch)\nWhiteCheck = optionIsOn(whiteModule)\nPathInfoFix = optionIsOn(PathInfoFix)\nattacklog = optionIsOn(attacklog)\nhackipdeny = optionIsOn(hackipdeny)\nCCDeny = optionIsOn(CCDeny)\nRedirect=optionIsOn(Redirect)\nlocal file = io.open('config')\n\nfunction getClientIp()\n        IP  = ngx.var.remote_addr\n        if IP == nil then\n                IP  = \"unknown\"\n        end\n        return IP\nend\nfunction write(logfile,msg)\n    local fd = io.open(logfile,\"ab\")\n    if fd == nil then return end\n    fd:write(msg)\n    fd:flush()\n    fd:close()\nend\n\nfunction swrite(msg)\n      --nginx error_log\n\t\t\tngx.log(ngx.CRIT,msg)\n\n\n\nend\n\nfunction log(method,url,data,ruletag)\n    if attacklog then\n        local realIp = getClientIp()\n        local ua = ngx.var.http_user_agent\n        if ua == nil then\n        \tua=\"null\"\n        end\n        local servername=ngx.var.host\n        local time=ngx.localtime()\n        if logtofile then\n        local filename = logpath..'/'..servername..\"_\"..ngx.today()..\"_sec.log\"\n        line=realIp..\" [\"..time..\"]\"..\"\\\"\"..method..\" \"..servername..url..\"\\\"\"..data..\"\\\"\"..ua..\"\\\"\"..ruletag..\"\\\"\"..\"\\n\"\n        write(filename,line)\n        end\n        if logtoserver then\n        line=realIp..\"\\\"\"..method..\" \"..servername..url..\"\\\"\"..data..\"\\\"\"..ua..\"\\\"\"..ruletag..\"\\\"\"\n        --line=\"lua_waf:\"..line\n        swrite(line)\n        end\n    --ipsyslog\n    if loghack then  local bytes, err = logger.log(getClientIp()) end\n\t\t--logdenyhackipip\n\t\tif hackipdeny then  denyhackip(0) end\n    end\nend\n-------------------------------------------------------------------------------------------------------\nfunction read_rule(var)\n    file = io.open(rulepath..'/'..var,\"r\")\n    if file==nil then\n        return\n    end\n    t = {}\n    for line in file:lines() do\n        table.insert(t,line)\n    end\n    file:close()\n    return(t)\nend\n\nurlrules=read_rule('url')\nargsrules=read_rule('args')\nuarules=read_rule('user-agent')\nwturlrules=read_rule('whiteurl')\npostrules=read_rule('post')\nckrules=read_rule('cookie')\n\n\nfunction say_html()\n    if Redirect then\n        ngx.header.content_type = \"text/html\"\n        ngx.status = ngx.HTTP_FORBIDDEN\n        ngx.say(html)\n        ngx.exit(ngx.status)\n    end\nend\n\nfunction whiteurl()\n    if WhiteCheck then\n        if wturlrules ~=nil then\n\t\t\t\t\t\tlocal urlpath = string.gsub(ngx.var.request_uri, \"?.*\", \"\")\n            for _,rule in pairs(wturlrules) do\n            --site:\n\t            local sitemod,_=string.find(rule,\"site:\")\n\t        \t\tif sitemod==1 then\n\t        \t\t\trule=string.gsub(rule,\"site:\",\"\",1)\n\t        \t\t\t--whiteurl\n\t        \t\t\t--if ngx.var.host=='domino.cqhrss.gov.cn' then\n\t        \t\t\t--\tlog('debug',ngx.var.uri,\"\",rule)\n\t        \t\t\t--end\n\t        \t\t\tif ngxmatch(ngx.var.host..ngx.var.uri,rule,\"isjo\") then\n                    return true\n                end\n\t        \t\telse\n            \t\tif ngxmatch(ngx.var.uri,rule,\"isjo\") then\n                    return true\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tlocal pathmod,_=string.find(rule,\"path:\")\n\t\t\t        \t\tif pathmod==1 then\n\t\t\t        \t\t\trule=string.gsub(rule,\"path:\",\"\",1)\n\t\t\t        \t\t\tif urlpath==rule then\n\t\t                    return true\n\t\t                end\n\t\t\t\t\t\t\t\t\tend\n                end\n            \tend\n            end\n        end\n    end\n    return false\nend\n\nfunction fileExtCheck(ext)\n    local items = Set(black_fileExt)\n    ext=string.lower(ext)\n    if ext then\n        for rule,_ in pairs(items) do\n            if ngxmatch(ext,rule,\"isjo\") then\n            log('POST',ngx.var.request_uri,\"-\",\"file attack with ext \"..ext)\n            say_html()\n            end\n        end\n    end\n    return false\nend\nfunction Set (list)\n  local set = {}\n  for _, l in ipairs(list) do set[l] = true end\n  return set\nend\nfunction args()\n    for _,rule in pairs(argsrules) do\n        local args = ngx.req.get_uri_args()\n        for key, val in pairs(args) do\n            if type(val)=='table' then\n                 local t={}\n                 for k,v in pairs(val) do\n                    if v == true then\n                        v=\"\"\n                    end\n                    table.insert(t,v)\n                end\n                data=table.concat(t, \" \")\n            else\n                data=val\n            end\n            if data and type(data) ~= \"boolean\" and rule ~=\"\" and ngxmatch(unescape(data),rule,\"isjo\") then\n                log('GET',ngx.var.request_uri,\"-\",rule)\n                say_html()\n                return true\n            end\n        end\n    end\n    return false\nend\n\n\nfunction url()\n    if UrlDeny then\n        for _,rule in pairs(urlrules) do\n            if rule ~=\"\" and ngxmatch(ngx.var.request_uri,rule,\"isjo\") then\n                log('GET',ngx.var.request_uri,\"-\",rule)\n                say_html()\n                return true\n            end\n        end\n    end\n    return false\nend\n\nfunction ua()\n    local ua = ngx.var.http_user_agent\n    if ua ~= nil then\n        for _,rule in pairs(uarules) do\n            if rule ~=\"\" and ngxmatch(ua,rule,\"isjo\") then\n                log('UA',ngx.var.request_uri,\"-\",rule)\n                say_html()\n            return true\n            end\n        end\n    end\n    return false\nend\nfunction body(data)\n    for _,rule in pairs(postrules) do\n        if rule ~=\"\" and data~=\"\" and ngxmatch(unescape(data),rule,\"isjo\") then\n            log('POST',ngx.var.request_uri,data,rule)\n            say_html()\n            return true\n        end\n    end\n    return false\nend\nfunction cookie()\n    local ck = ngx.var.http_cookie\n    if CookieCheck and ck then\n        for _,rule in pairs(ckrules) do\n            if rule ~=\"\" and ngxmatch(ck,rule,\"isjo\") then\n                log('Cookie',ngx.var.request_uri,\"-\",rule)\n                say_html()\n            return true\n            end\n        end\n    end\n    return false\nend\n\nfunction denycc()\n    if CCDeny then\n        local uri=ngx.var.uri\n      \tlocal m, err = ngx.re.match(CCrate,'([0-9]+)/([0-9]+)/([0-9]+)')\n      \tlocal CCcount=tonumber(m[1]) --\n        local CCseconds=tonumber(m[2]) --\n        local CClimits=tonumber(m[3]) --\n        local token = getClientIp()..uri\n        local limit = ngx.shared.limit\n        local req,_=limit:get(token) --\n\n        if req then\n            if req > CCcount then\n                ngx.exit(404)\n                return true\n            else\n            \t\tif req == CCcount then    limit:set(token,CCcount+1,CClimits)  end\n\n                limit:incr(token,1)\n\t\t\t\t\t\t\t\t--syslog\n\t\t\t\t\t\t\t\t--swrite(':'..token..''..req..':'..CClimits)\n\n            end\n        else\n            limit:set(token,1,CCseconds)\n        end\n    end\n    return false\nend\n\n--chk1\nfunction denyhackip(chk)\n    if hackipdeny then\n\n       local m, err = ngx.re.match(hackrate,'([0-9]+)/([0-9]+)/([0-9]+)')\n      \tlocal hicount=tonumber(m[1]) --\n        local hiseconds=tonumber(m[2]) --\n        local hilimits=tonumber(m[3]) --\n        local token = \"hackip\"..getClientIp()\n        local limit = ngx.shared.limit\n        local req,_=limit:get(token) --\n        if req then\n            if req > hicount then\n                ngx.exit(404)\n                return true\n            else\n\n            \t\tif req == hicount then\n            \t\t\t\tlimit:set(token,hicount+1,hilimits)\n            \t\t\t\tswrite(\"ip:\"..getClientIp()..\"\"..hilimits..\"\")\n            \t\t\t\tend\n                 if chk ~=1 then limit:incr(token,1)      end\n                --syslog\n                --swrite(\":\"..token..\":\"..chk..\"\"..req..\":\"..hilimits)\n\n\n            end\n        else\n        \t\tif chk ~=1 then limit:set(token,1,hiseconds) \tend\n\n        end\n    end\n    return false\nend\n\nfunction get_boundary()\n    local header = get_headers()[\"content-type\"]\n    if not header then\n        return nil\n    end\n\n    if type(header) == \"table\" then\n        header = header[1]\n    end\n\n    local m = match(header, \";%s*boundary=\\\"([^\\\"]+)\\\"\")\n    if m then\n        return m\n    end\n\n    return match(header, \";%s*boundary=([^\\\",;]+)\")\nend\n\nfunction whiteip()\n    if next(ipWhitelist) ~= nil then\n        for _,ip in pairs(ipWhitelist) do\n            if getClientIp()==ip then\n                return true\n            end\n        end\n    end\n        return false\nend\n\nfunction blockip()\n     if next(ipBlocklist) ~= nil then\n         for _,ip in pairs(ipBlocklist) do\n             if getClientIp()==ip then\n                 ngx.exit(403)\n                 return true\n             end\n         end\n     end\n         return false\nend\n```\n\n## config.lua\n\n```\nRulePath = \"/usr/local/nginx/conf/waf/wafconf/\"\nattacklog = \"on\"\n--\nlogtofile = \"on\"\nlogdir = \"/site/wwwlogs/waf/\"\n--syslog,nginx\nlogtoserver = \"off\"\n--sysloghack_ip\nloghack=\"off\"\nUrlDeny=\"on\"\nRedirect=\"on\"\nCookieMatch=\"on\"\npostMatch=\"on\"\nwhiteModule=\"on\"\nblack_fileExt={\"php\",\"jsp\"}\nipWhitelist={\"127.0.0.1\",\"192.168.2.1\"}\nipBlocklist={\"1.0.0.1\"}\n--ip\n--hackrate10/5,1800\nhackipdeny=\"on\"\nhackrate=\"10/60/1800\"\n--cc\nCCDeny=\"on\"\nCCrate=\"30/60/30\"\nhtml=[[\n<html><head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no\">\n<title></title>\n<style>\np {line-height:20px;}\nul{ list-style-type:none;}\nli{ list-style-type:none;}\nbody{padding:0; margin:0; font:14px/1.5 Microsoft Yahei, ,sans-serif; color:#555;}\n</style>\n</head>\n<body>\n <div style=\"margin: 0 auto; max-width:1000px; padding-top:70px; overflow:hidden;\">\n  <div style=\"padding:0 15px;\">\n    <div style=\" height:40px; line-height:40px; color:#fff; font-size:16px; overflow:hidden; background:#6bb3f6; padding-left:20px;\"></div>\n    <div style=\"border:1px dashed #cdcece; border-top:none; font-size:14px; background:#fff; color:#555; line-height:24px; height:220px; padding:20px 20px 0 20px; overflow-y:auto;background:#f3f7f9;\">\n      <p style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\" font-weight:600; color:#fc4f03;\"></span></p>\n<p style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"></p>\n<p style=\" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;\"></p>\n<ul style=\"margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;\"><li style=\" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">1</li>\n<li style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">2</li>\n<li style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">3</li></ul>\n    </div>\n  </div>\n</div>\n</body></html>\n]]\n```\n\n## whiteurl\n\n```\n^/zhaonvpengyou\nsite:^lianxiwo\\.com/\npath:/wogeiniliuyi.html\n```\n\n## \ns\nhttps://github.com/loveshell/ngx_lua_waf/pull/136request_uri","source":"_posts/waf.md","raw":"---\ntitle: waf\ndate: 2018-09-12 08:10:00\ntags: \n  - waf\n  - lua\n  - \ncategories:\n  - \nurl: the-modification-of-waf-firewall\ndescription: luanginxluawafwafwafwafDDOSCCwaf\n---\n\n> luanginxluawafwafwafwafDDOSCCwaf\n\n## \n\nwafngx_lua_wafhttps://github.com/loveshell/ngx_lua_waf\nngx_lua_wafgithubPull\nrequestsPull requests9Pull requests\n\n## waf.lua\n\n```\nlocal content_length=tonumber(ngx.req.get_headers()['content-length'])\nlocal method=ngx.req.get_method()\n--ngx_lua0.9.2ngx.re.find\nlocal ngxmatch=ngx.re.match\n--local ngxmatch=ngx.re.find\nif whiteip() then\nelseif whiteurl() then\nelseif blockip() then\n--ip\nelseif denyhackip(1) then\nelseif denycc() then\nelseif ngx.var.http_Acunetix_Aspect then\n    ngx.exit(444)\nelseif ngx.var.http_X_Scan_Memo then\n    ngx.exit(444)\nelseif ua() then\nelseif url() then\nelseif args() then\nelseif cookie() then\nelseif PostCheck then\n    if method==\"POST\" then\n            local boundary = get_boundary()\n\t    if boundary then\n\t    local len = string.len\n            local sock, err = ngx.req.socket()\n    \t    if not sock then\n\t\t\t\t\treturn\n            end\n\t    ngx.req.init_body(128 * 1024)\n            sock:settimeout(0)\n\t    local content_length = nil\n    \t    content_length=tonumber(ngx.req.get_headers()['content-length'])\n    \t    local chunk_size = 4096\n            if content_length < chunk_size then\n\t\t\t\t\tchunk_size = content_length\n\t    end\n            local size = 0\n\t    while size < content_length do\n\t\tlocal data, err, partial = sock:receive(chunk_size)\n\t\tdata = data or partial\n\t\tif not data then\n\t\t\treturn\n\t\tend\n\t\tngx.req.append_body(data)\n        \tif body(data) then\n\t   \t        return true\n    \t    \tend\n\t\tsize = size + len(data)\n\t\tlocal m = ngxmatch(data,[[Content-Disposition: form-data;(.+)filename=\"(.+)\\.(.*)\"]],'ijo')\n        \tif m then\n            \t\tfileExtCheck(m[3])\n            \t\tfiletranslate = true\n        \telse\n            \t\tif ngxmatch(data,\"Content-Disposition:\",'isjo') then\n                \t\tfiletranslate = false\n            \t\tend\n            \t\tif filetranslate==false then\n            \t\t\tif body(data) then\n                    \t\t\treturn true\n                \t\tend\n            \t\tend\n        \tend\n\t\tlocal less = content_length - size\n\t\tif less < chunk_size then\n\t\t\tchunk_size = less\n\t\tend\n\t end\n\t ngx.req.finish_body()\n    else\n\t\t\tngx.req.read_body()\n\t\t\tlocal args = ngx.req.get_post_args()\n\t\t\tif not args then\n\t\t\t\treturn\n\t\t\tend\n\t\t\tfor key, val in pairs(args) do\n\t\t\t\tif type(val) == \"table\" then\n\t\t\t\t\tif type(val[1]) == \"boolean\" then\n\t\t\t\t\t\treturn\n\t\t\t\t\tend\n\t\t\t\t\tdata=table.concat(val, \", \")\n\t\t\t\telse\n\t\t\t\t\tdata=val\n\t\t\t\tend\n\t\t\t\tif data and type(data) ~= \"boolean\" and body(data) then\n                \t\t\tbody(key)\n\t\t\t\tend\n\t\t\tend\n\t\tend\n\t\tend\n\nelse\n    return\nend\n```\n\n## socket.lua\n\n```\n-- Copyright (C) 2013-2014 Jiale Zhi (calio), CloudFlare Inc.\n--require \"luacov\"\n\nlocal concat                = table.concat\nlocal tcp                   = ngx.socket.tcp\nlocal udp                   = ngx.socket.udp\nlocal timer_at              = ngx.timer.at\nlocal ngx_log               = ngx.log\nlocal ngx_sleep             = ngx.sleep\nlocal type                  = type\nlocal pairs                 = pairs\nlocal tostring              = tostring\nlocal debug                 = ngx.config.debug\n\nlocal DEBUG                 = ngx.DEBUG\nlocal CRIT                  = ngx.CRIT\n\nlocal MAX_PORT              = 65535\n\n\n-- table.new(narr, nrec)\nlocal succ, new_tab = pcall(require, \"table.new\")\nif not succ then\n    new_tab = function () return {} end\nend\n\nlocal _M = new_tab(0, 5)\n\nlocal is_exiting\n\nif not ngx.config or not ngx.config.ngx_lua_version\n    or ngx.config.ngx_lua_version < 9003 then\n\n    is_exiting = function() return false end\n\n    ngx_log(CRIT, \"We strongly recommend you to update your ngx_lua module to \"\n            .. \"0.9.3 or above. lua-resty-logger-socket will lose some log \"\n            .. \"messages when Nginx reloads if it works with ngx_lua module \"\n            .. \"below 0.9.3\")\nelse\n    is_exiting = ngx.worker.exiting\nend\n\n\n_M._VERSION = '0.03'\n\n-- user config\nlocal flush_limit           = 4096         -- 4KB\nlocal drop_limit            = 1048576      -- 1MB\nlocal timeout               = 1000         -- 1 sec\nlocal host\nlocal port\nlocal ssl                   = false\nlocal ssl_verify            = true\nlocal sni_host\nlocal path\nlocal max_buffer_reuse      = 10000        -- reuse buffer for at most 10000\n                                           -- times\nlocal periodic_flush        = nil\nlocal need_periodic_flush   = nil\nlocal sock_type             = 'tcp'\n\n-- internal variables\nlocal buffer_size           = 0\n-- 2nd level buffer, it stores logs ready to be sent out\nlocal send_buffer           = \"\"\n-- 1st level buffer, it stores incoming logs\nlocal log_buffer_data       = new_tab(20000, 0)\n-- number of log lines in current 1st level buffer, starts from 0\nlocal log_buffer_index      = 0\n\nlocal last_error\n\nlocal connecting\nlocal connected\nlocal exiting\nlocal retry_connect         = 0\nlocal retry_send            = 0\nlocal max_retry_times       = 3\nlocal retry_interval        = 100         -- 0.1s\nlocal pool_size             = 10\nlocal flushing\nlocal logger_initted\nlocal counter               = 0\nlocal ssl_session\n\nlocal function _write_error(msg)\n    last_error = msg\nend\n\nlocal function _do_connect()\n    local ok, err, sock\n\n    if not connected then\n        if (sock_type == 'udp') then\n            sock, err = udp()\n        else\n            sock, err = tcp()\n        end\n\n        if not sock then\n            _write_error(err)\n            return nil, err\n        end\n\n        sock:settimeout(timeout)\n    end\n\n    -- \"host\"/\"port\" and \"path\" have already been checked in init()\n    if host and port then\n        if (sock_type == 'udp') then\n            ok, err = sock:setpeername(host, port)\n        else\n            ok, err = sock:connect(host, port)\n        end\n    elseif path then\n        ok, err = sock:connect(\"unix:\" .. path)\n    end\n\n    if not ok then\n        return nil, err\n    end\n\n    return sock\nend\n\nlocal function _do_handshake(sock)\n    if not ssl then\n        return sock\n    end\n\n    local session, err = sock:sslhandshake(ssl_session, sni_host or host,\n                                           ssl_verify)\n    if not session then\n        return nil, err\n    end\n\n    ssl_session = session\n    return sock\nend\n\nlocal function _connect()\n    local err, sock\n\n    if connecting then\n        if debug then\n            ngx_log(DEBUG, \"previous connection not finished\")\n        end\n        return nil, \"previous connection not finished\"\n    end\n\n    connected = false\n    connecting = true\n\n    retry_connect = 0\n\n    while retry_connect <= max_retry_times do\n        sock, err = _do_connect()\n\n        if sock then\n            sock, err = _do_handshake(sock)\n            if sock then\n                connected = true\n                break\n            end\n        end\n\n        if debug then\n            ngx_log(DEBUG, \"reconnect to the log server: \", err)\n        end\n\n        -- ngx.sleep time is in seconds\n        if not exiting then\n            ngx_sleep(retry_interval / 1000)\n        end\n\n        retry_connect = retry_connect + 1\n    end\n\n    connecting = false\n    if not connected then\n        return nil, \"try to connect to the log server failed after \"\n                    .. max_retry_times .. \" retries: \" .. err\n    end\n\n    return sock\nend\n\nlocal function _prepare_stream_buffer()\n    local packet = concat(log_buffer_data, \"\", 1, log_buffer_index)\n    send_buffer = send_buffer .. packet\n\n    log_buffer_index = 0\n    counter = counter + 1\n    if counter > max_buffer_reuse then\n        log_buffer_data = new_tab(20000, 0)\n        counter = 0\n        if debug then\n            ngx_log(DEBUG, \"log buffer reuse limit (\" .. max_buffer_reuse\n                    .. \") reached, create a new \\\"log_buffer_data\\\"\")\n        end\n    end\nend\n\nlocal function _do_flush()\n    local ok, err, sock, bytes\n    local packet = send_buffer\n\n    sock, err = _connect()\n    if not sock then\n        return nil, err\n    end\n\n    bytes, err = sock:send(packet)\n    if not bytes then\n        -- \"sock:send\" always closes current connection on error\n        return nil, err\n    end\n\n    if debug then\n        ngx.update_time()\n        ngx_log(DEBUG, ngx.now(), \":log flush:\" .. bytes .. \":\" .. packet)\n    end\n\n    if (sock_type ~= 'udp') then\n        ok, err = sock:setkeepalive(0, pool_size)\n        if not ok then\n            return nil, err\n        end\n    end\n\n    return bytes\nend\n\nlocal function _need_flush()\n    if buffer_size > 0 then\n        return true\n    end\n\n    return false\nend\n\nlocal function _flush_lock()\n    if not flushing then\n        if debug then\n            ngx_log(DEBUG, \"flush lock acquired\")\n        end\n        flushing = true\n        return true\n    end\n    return false\nend\n\nlocal function _flush_unlock()\n    if debug then\n        ngx_log(DEBUG, \"flush lock released\")\n    end\n    flushing = false\nend\n\nlocal function _flush()\n    local err\n\n    -- pre check\n    if not _flush_lock() then\n        if debug then\n            ngx_log(DEBUG, \"previous flush not finished\")\n        end\n        -- do this later\n        return true\n    end\n\n    if not _need_flush() then\n        if debug then\n            ngx_log(DEBUG, \"no need to flush:\", log_buffer_index)\n        end\n        _flush_unlock()\n        return true\n    end\n\n    -- start flushing\n    retry_send = 0\n    if debug then\n        ngx_log(DEBUG, \"start flushing\")\n    end\n\n    local bytes\n    while retry_send <= max_retry_times do\n        if log_buffer_index > 0 then\n            _prepare_stream_buffer()\n        end\n\n        bytes, err = _do_flush()\n\n        if bytes then\n            break\n        end\n\n        if debug then\n            ngx_log(DEBUG, \"resend log messages to the log server: \", err)\n        end\n\n        -- ngx.sleep time is in seconds\n        if not exiting then\n            ngx_sleep(retry_interval / 1000)\n        end\n\n        retry_send = retry_send + 1\n    end\n\n    _flush_unlock()\n\n    if not bytes then\n        local err_msg = \"try to send log messages to the log server \"\n                        .. \"failed after \" .. max_retry_times .. \" retries: \"\n                        .. err\n        _write_error(err_msg)\n        return nil, err_msg\n    else\n        if debug then\n            ngx_log(DEBUG, \"send \" .. bytes .. \" bytes\")\n        end\n    end\n\n    buffer_size = buffer_size - #send_buffer\n    send_buffer = \"\"\n\n    return bytes\nend\n\nlocal function _periodic_flush(premature)\n    if premature then\n        exiting = true\n    end\n\n    if need_periodic_flush or exiting then\n        -- no regular flush happened after periodic flush timer had been set\n        if debug then\n            ngx_log(DEBUG, \"performing periodic flush\")\n        end\n        _flush()\n    else\n        if debug then\n            ngx_log(DEBUG, \"no need to perform periodic flush: regular flush \"\n                    .. \"happened before\")\n        end\n        need_periodic_flush = true\n    end\n\n    timer_at(periodic_flush, _periodic_flush)\nend\n\nlocal function _flush_buffer()\n    local ok, err = timer_at(0, _flush)\n\n    need_periodic_flush = false\n\n    if not ok then\n        _write_error(err)\n        return nil, err\n    end\nend\n\nlocal function _write_buffer(msg, len)\n    log_buffer_index = log_buffer_index + 1\n    log_buffer_data[log_buffer_index] = msg\n\n    buffer_size = buffer_size + len\n\n\n    return buffer_size\nend\n\nfunction _M.init(user_config)\n    if (type(user_config) ~= \"table\") then\n        return nil, \"user_config must be a table\"\n    end\n\n    for k, v in pairs(user_config) do\n        if k == \"host\" then\n            if type(v) ~= \"string\" then\n                return nil, '\"host\" must be a string'\n            end\n            host = v\n        elseif k == \"port\" then\n            if type(v) ~= \"number\" then\n                return nil, '\"port\" must be a number'\n            end\n            if v < 0 or v > MAX_PORT then\n                return nil, ('\"port\" out of range 0~%s'):format(MAX_PORT)\n            end\n            port = v\n        elseif k == \"path\" then\n            if type(v) ~= \"string\" then\n                return nil, '\"path\" must be a string'\n            end\n            path = v\n        elseif k == \"sock_type\" then\n            if type(v) ~= \"string\" then\n                return nil, '\"sock_type\" must be a string'\n            end\n            if v ~= \"tcp\" and v ~= \"udp\" then\n                return nil, '\"sock_type\" must be \"tcp\" or \"udp\"'\n            end\n            sock_type = v\n        elseif k == \"flush_limit\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"flush_limit\"'\n            end\n            flush_limit = v\n        elseif k == \"drop_limit\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"drop_limit\"'\n            end\n            drop_limit = v\n        elseif k == \"timeout\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"timeout\"'\n            end\n            timeout = v\n        elseif k == \"max_retry_times\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"max_retry_times\"'\n            end\n            max_retry_times = v\n        elseif k == \"retry_interval\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"retry_interval\"'\n            end\n            -- ngx.sleep time is in seconds\n            retry_interval = v\n        elseif k == \"pool_size\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"pool_size\"'\n            end\n            pool_size = v\n        elseif k == \"max_buffer_reuse\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"max_buffer_reuse\"'\n            end\n            max_buffer_reuse = v\n        elseif k == \"periodic_flush\" then\n            if type(v) ~= \"number\" or v < 0 then\n                return nil, 'invalid \"periodic_flush\"'\n            end\n            periodic_flush = v\n        elseif k == \"ssl\" then\n            if type(v) ~= \"boolean\" then\n                return nil, '\"ssl\" must be a boolean value'\n            end\n            ssl = v\n        elseif k == \"ssl_verify\" then\n            if type(v) ~= \"boolean\" then\n                return nil, '\"ssl_verify\" must be a boolean value'\n            end\n            ssl_verify = v\n        elseif k == \"sni_host\" then\n            if type(v) ~= \"string\" then\n                return nil, '\"sni_host\" must be a string'\n            end\n            sni_host = v\n        end\n    end\n\n    if not (host and port) and not path then\n        return nil, \"no logging server configured. \\\"host\\\"/\\\"port\\\" or \"\n                .. \"\\\"path\\\" is required.\"\n    end\n\n\n    if (flush_limit >= drop_limit) then\n        return nil, \"\\\"flush_limit\\\" should be < \\\"drop_limit\\\"\"\n    end\n\n    flushing = false\n    exiting = false\n    connecting = false\n\n    connected = false\n    retry_connect = 0\n    retry_send = 0\n\n    logger_initted = true\n\n    if periodic_flush then\n        if debug then\n            ngx_log(DEBUG, \"periodic flush enabled for every \"\n                    .. periodic_flush .. \" seconds\")\n        end\n        need_periodic_flush = true\n        timer_at(periodic_flush, _periodic_flush)\n    end\n\n    return logger_initted\nend\n\nfunction _M.log(msg)\n    if not logger_initted then\n        return nil, \"not initialized\"\n    end\n\n    local bytes\n\n    if type(msg) ~= \"string\" then\n        msg = tostring(msg)\n    end\n\n    local msg_len = #msg\n\n    if (debug) then\n        ngx.update_time()\n        ngx_log(DEBUG, ngx.now(), \":log message length: \" .. msg_len)\n    end\n\n    -- response of \"_flush_buffer\" is not checked, because it writes\n    -- error buffer\n    if (is_exiting()) then\n        exiting = true\n        _write_buffer(msg, msg_len)\n        _flush_buffer()\n        if (debug) then\n            ngx_log(DEBUG, \"Nginx worker is exiting\")\n        end\n        bytes = 0\n    elseif (msg_len + buffer_size < flush_limit) then\n        _write_buffer(msg, msg_len)\n        bytes = msg_len\n    elseif (msg_len + buffer_size <= drop_limit) then\n        _write_buffer(msg, msg_len)\n        _flush_buffer()\n        bytes = msg_len\n    else\n        _flush_buffer()\n        if (debug) then\n            ngx_log(DEBUG, \"logger buffer is full, this log message will be \"\n                    .. \"dropped\")\n        end\n        bytes = 0\n        --- this log message doesn't fit in buffer, drop it\n    end\n\n    if last_error then\n        local err = last_error\n        last_error = nil\n        return bytes, err\n    end\n\n    return bytes\nend\n\nfunction _M.initted()\n    return logger_initted\nend\n\n_M.flush = _flush\n\nreturn _M\n```\n\n## init.lua\n\n```\nrequire 'config'\nlocal match = string.match\n--ngx_lua0.9.2ngx.re.find\n--nginxlua\\d\\w\\s\n--local ngxmatch=ngx.re.match\nlocal ngxmatch=ngx.re.find\nlocal unescape=ngx.unescape_uri\nlocal get_headers = ngx.req.get_headers\nlocal optionIsOn = function (options) return options == \"on\" and true or false end\nloghack=optionIsOn(loghack)\n--socket.lualogsyslog\nlocal logger = require \"socket\"\nif loghack then\n\n\n\tif not logger.initted() then\n          local ok, err = logger.init{\n              --host = '192.168.0.1',\n              host = 'logserver.local',\n              port = 514,\n              sock_type = \"udp\", --udp\n              flush_limit = 1,\t--\n              --drop_limit = 5678,\n              pool_size = 100,--\n          }\n          if not ok then\n              ngx.log(ngx.ERR, \"failed to initialize the logger: \",\n                      err)\n              return\n          end\n end\nend\n\n\nlogpath = logdir\nrulepath = RulePath\nlogtofile = optionIsOn(logtofile)\nlogtoserver = optionIsOn(logtoserver)\nUrlDeny = optionIsOn(UrlDeny)\nPostCheck = optionIsOn(postMatch)\nCookieCheck = optionIsOn(cookieMatch)\nWhiteCheck = optionIsOn(whiteModule)\nPathInfoFix = optionIsOn(PathInfoFix)\nattacklog = optionIsOn(attacklog)\nhackipdeny = optionIsOn(hackipdeny)\nCCDeny = optionIsOn(CCDeny)\nRedirect=optionIsOn(Redirect)\nlocal file = io.open('config')\n\nfunction getClientIp()\n        IP  = ngx.var.remote_addr\n        if IP == nil then\n                IP  = \"unknown\"\n        end\n        return IP\nend\nfunction write(logfile,msg)\n    local fd = io.open(logfile,\"ab\")\n    if fd == nil then return end\n    fd:write(msg)\n    fd:flush()\n    fd:close()\nend\n\nfunction swrite(msg)\n      --nginx error_log\n\t\t\tngx.log(ngx.CRIT,msg)\n\n\n\nend\n\nfunction log(method,url,data,ruletag)\n    if attacklog then\n        local realIp = getClientIp()\n        local ua = ngx.var.http_user_agent\n        if ua == nil then\n        \tua=\"null\"\n        end\n        local servername=ngx.var.host\n        local time=ngx.localtime()\n        if logtofile then\n        local filename = logpath..'/'..servername..\"_\"..ngx.today()..\"_sec.log\"\n        line=realIp..\" [\"..time..\"]\"..\"\\\"\"..method..\" \"..servername..url..\"\\\"\"..data..\"\\\"\"..ua..\"\\\"\"..ruletag..\"\\\"\"..\"\\n\"\n        write(filename,line)\n        end\n        if logtoserver then\n        line=realIp..\"\\\"\"..method..\" \"..servername..url..\"\\\"\"..data..\"\\\"\"..ua..\"\\\"\"..ruletag..\"\\\"\"\n        --line=\"lua_waf:\"..line\n        swrite(line)\n        end\n    --ipsyslog\n    if loghack then  local bytes, err = logger.log(getClientIp()) end\n\t\t--logdenyhackipip\n\t\tif hackipdeny then  denyhackip(0) end\n    end\nend\n-------------------------------------------------------------------------------------------------------\nfunction read_rule(var)\n    file = io.open(rulepath..'/'..var,\"r\")\n    if file==nil then\n        return\n    end\n    t = {}\n    for line in file:lines() do\n        table.insert(t,line)\n    end\n    file:close()\n    return(t)\nend\n\nurlrules=read_rule('url')\nargsrules=read_rule('args')\nuarules=read_rule('user-agent')\nwturlrules=read_rule('whiteurl')\npostrules=read_rule('post')\nckrules=read_rule('cookie')\n\n\nfunction say_html()\n    if Redirect then\n        ngx.header.content_type = \"text/html\"\n        ngx.status = ngx.HTTP_FORBIDDEN\n        ngx.say(html)\n        ngx.exit(ngx.status)\n    end\nend\n\nfunction whiteurl()\n    if WhiteCheck then\n        if wturlrules ~=nil then\n\t\t\t\t\t\tlocal urlpath = string.gsub(ngx.var.request_uri, \"?.*\", \"\")\n            for _,rule in pairs(wturlrules) do\n            --site:\n\t            local sitemod,_=string.find(rule,\"site:\")\n\t        \t\tif sitemod==1 then\n\t        \t\t\trule=string.gsub(rule,\"site:\",\"\",1)\n\t        \t\t\t--whiteurl\n\t        \t\t\t--if ngx.var.host=='domino.cqhrss.gov.cn' then\n\t        \t\t\t--\tlog('debug',ngx.var.uri,\"\",rule)\n\t        \t\t\t--end\n\t        \t\t\tif ngxmatch(ngx.var.host..ngx.var.uri,rule,\"isjo\") then\n                    return true\n                end\n\t        \t\telse\n            \t\tif ngxmatch(ngx.var.uri,rule,\"isjo\") then\n                    return true\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tlocal pathmod,_=string.find(rule,\"path:\")\n\t\t\t        \t\tif pathmod==1 then\n\t\t\t        \t\t\trule=string.gsub(rule,\"path:\",\"\",1)\n\t\t\t        \t\t\tif urlpath==rule then\n\t\t                    return true\n\t\t                end\n\t\t\t\t\t\t\t\t\tend\n                end\n            \tend\n            end\n        end\n    end\n    return false\nend\n\nfunction fileExtCheck(ext)\n    local items = Set(black_fileExt)\n    ext=string.lower(ext)\n    if ext then\n        for rule,_ in pairs(items) do\n            if ngxmatch(ext,rule,\"isjo\") then\n            log('POST',ngx.var.request_uri,\"-\",\"file attack with ext \"..ext)\n            say_html()\n            end\n        end\n    end\n    return false\nend\nfunction Set (list)\n  local set = {}\n  for _, l in ipairs(list) do set[l] = true end\n  return set\nend\nfunction args()\n    for _,rule in pairs(argsrules) do\n        local args = ngx.req.get_uri_args()\n        for key, val in pairs(args) do\n            if type(val)=='table' then\n                 local t={}\n                 for k,v in pairs(val) do\n                    if v == true then\n                        v=\"\"\n                    end\n                    table.insert(t,v)\n                end\n                data=table.concat(t, \" \")\n            else\n                data=val\n            end\n            if data and type(data) ~= \"boolean\" and rule ~=\"\" and ngxmatch(unescape(data),rule,\"isjo\") then\n                log('GET',ngx.var.request_uri,\"-\",rule)\n                say_html()\n                return true\n            end\n        end\n    end\n    return false\nend\n\n\nfunction url()\n    if UrlDeny then\n        for _,rule in pairs(urlrules) do\n            if rule ~=\"\" and ngxmatch(ngx.var.request_uri,rule,\"isjo\") then\n                log('GET',ngx.var.request_uri,\"-\",rule)\n                say_html()\n                return true\n            end\n        end\n    end\n    return false\nend\n\nfunction ua()\n    local ua = ngx.var.http_user_agent\n    if ua ~= nil then\n        for _,rule in pairs(uarules) do\n            if rule ~=\"\" and ngxmatch(ua,rule,\"isjo\") then\n                log('UA',ngx.var.request_uri,\"-\",rule)\n                say_html()\n            return true\n            end\n        end\n    end\n    return false\nend\nfunction body(data)\n    for _,rule in pairs(postrules) do\n        if rule ~=\"\" and data~=\"\" and ngxmatch(unescape(data),rule,\"isjo\") then\n            log('POST',ngx.var.request_uri,data,rule)\n            say_html()\n            return true\n        end\n    end\n    return false\nend\nfunction cookie()\n    local ck = ngx.var.http_cookie\n    if CookieCheck and ck then\n        for _,rule in pairs(ckrules) do\n            if rule ~=\"\" and ngxmatch(ck,rule,\"isjo\") then\n                log('Cookie',ngx.var.request_uri,\"-\",rule)\n                say_html()\n            return true\n            end\n        end\n    end\n    return false\nend\n\nfunction denycc()\n    if CCDeny then\n        local uri=ngx.var.uri\n      \tlocal m, err = ngx.re.match(CCrate,'([0-9]+)/([0-9]+)/([0-9]+)')\n      \tlocal CCcount=tonumber(m[1]) --\n        local CCseconds=tonumber(m[2]) --\n        local CClimits=tonumber(m[3]) --\n        local token = getClientIp()..uri\n        local limit = ngx.shared.limit\n        local req,_=limit:get(token) --\n\n        if req then\n            if req > CCcount then\n                ngx.exit(404)\n                return true\n            else\n            \t\tif req == CCcount then    limit:set(token,CCcount+1,CClimits)  end\n\n                limit:incr(token,1)\n\t\t\t\t\t\t\t\t--syslog\n\t\t\t\t\t\t\t\t--swrite(':'..token..''..req..':'..CClimits)\n\n            end\n        else\n            limit:set(token,1,CCseconds)\n        end\n    end\n    return false\nend\n\n--chk1\nfunction denyhackip(chk)\n    if hackipdeny then\n\n       local m, err = ngx.re.match(hackrate,'([0-9]+)/([0-9]+)/([0-9]+)')\n      \tlocal hicount=tonumber(m[1]) --\n        local hiseconds=tonumber(m[2]) --\n        local hilimits=tonumber(m[3]) --\n        local token = \"hackip\"..getClientIp()\n        local limit = ngx.shared.limit\n        local req,_=limit:get(token) --\n        if req then\n            if req > hicount then\n                ngx.exit(404)\n                return true\n            else\n\n            \t\tif req == hicount then\n            \t\t\t\tlimit:set(token,hicount+1,hilimits)\n            \t\t\t\tswrite(\"ip:\"..getClientIp()..\"\"..hilimits..\"\")\n            \t\t\t\tend\n                 if chk ~=1 then limit:incr(token,1)      end\n                --syslog\n                --swrite(\":\"..token..\":\"..chk..\"\"..req..\":\"..hilimits)\n\n\n            end\n        else\n        \t\tif chk ~=1 then limit:set(token,1,hiseconds) \tend\n\n        end\n    end\n    return false\nend\n\nfunction get_boundary()\n    local header = get_headers()[\"content-type\"]\n    if not header then\n        return nil\n    end\n\n    if type(header) == \"table\" then\n        header = header[1]\n    end\n\n    local m = match(header, \";%s*boundary=\\\"([^\\\"]+)\\\"\")\n    if m then\n        return m\n    end\n\n    return match(header, \";%s*boundary=([^\\\",;]+)\")\nend\n\nfunction whiteip()\n    if next(ipWhitelist) ~= nil then\n        for _,ip in pairs(ipWhitelist) do\n            if getClientIp()==ip then\n                return true\n            end\n        end\n    end\n        return false\nend\n\nfunction blockip()\n     if next(ipBlocklist) ~= nil then\n         for _,ip in pairs(ipBlocklist) do\n             if getClientIp()==ip then\n                 ngx.exit(403)\n                 return true\n             end\n         end\n     end\n         return false\nend\n```\n\n## config.lua\n\n```\nRulePath = \"/usr/local/nginx/conf/waf/wafconf/\"\nattacklog = \"on\"\n--\nlogtofile = \"on\"\nlogdir = \"/site/wwwlogs/waf/\"\n--syslog,nginx\nlogtoserver = \"off\"\n--sysloghack_ip\nloghack=\"off\"\nUrlDeny=\"on\"\nRedirect=\"on\"\nCookieMatch=\"on\"\npostMatch=\"on\"\nwhiteModule=\"on\"\nblack_fileExt={\"php\",\"jsp\"}\nipWhitelist={\"127.0.0.1\",\"192.168.2.1\"}\nipBlocklist={\"1.0.0.1\"}\n--ip\n--hackrate10/5,1800\nhackipdeny=\"on\"\nhackrate=\"10/60/1800\"\n--cc\nCCDeny=\"on\"\nCCrate=\"30/60/30\"\nhtml=[[\n<html><head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no\">\n<title></title>\n<style>\np {line-height:20px;}\nul{ list-style-type:none;}\nli{ list-style-type:none;}\nbody{padding:0; margin:0; font:14px/1.5 Microsoft Yahei, ,sans-serif; color:#555;}\n</style>\n</head>\n<body>\n <div style=\"margin: 0 auto; max-width:1000px; padding-top:70px; overflow:hidden;\">\n  <div style=\"padding:0 15px;\">\n    <div style=\" height:40px; line-height:40px; color:#fff; font-size:16px; overflow:hidden; background:#6bb3f6; padding-left:20px;\"></div>\n    <div style=\"border:1px dashed #cdcece; border-top:none; font-size:14px; background:#fff; color:#555; line-height:24px; height:220px; padding:20px 20px 0 20px; overflow-y:auto;background:#f3f7f9;\">\n      <p style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\" font-weight:600; color:#fc4f03;\"></span></p>\n<p style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"></p>\n<p style=\" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;\"></p>\n<ul style=\"margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;\"><li style=\" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">1</li>\n<li style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">2</li>\n<li style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">3</li></ul>\n    </div>\n  </div>\n</div>\n</body></html>\n]]\n```\n\n## whiteurl\n\n```\n^/zhaonvpengyou\nsite:^lianxiwo\\.com/\npath:/wogeiniliuyi.html\n```\n\n## \ns\nhttps://github.com/loveshell/ngx_lua_waf/pull/136request_uri","slug":"waf","published":1,"updated":"2022-05-12T17:08:29.998Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6au7000mlvtd82b86neg","content":"<blockquote>\n<p>luanginxluawafwafwafwafDDOSCCwaf</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>wafngx_lua_waf<a href=\"https://github.com/loveshell/ngx_lua_waf\">https://github.com/loveshell/ngx_lua_waf</a><br>ngx_lua_wafgithubPull<br>requestsPull requests9Pull requests</p>\n<h2 id=\"waf-lua\"><a href=\"#waf-lua\" class=\"headerlink\" title=\"waf.lua\"></a>waf.lua</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">local content_length=tonumber(ngx.req.get_headers()[&#x27;content-length&#x27;])</span><br><span class=\"line\">local method=ngx.req.get_method()</span><br><span class=\"line\">--ngx_lua0.9.2ngx.re.find</span><br><span class=\"line\">local ngxmatch=ngx.re.match</span><br><span class=\"line\">--local ngxmatch=ngx.re.find</span><br><span class=\"line\">if whiteip() then</span><br><span class=\"line\">elseif whiteurl() then</span><br><span class=\"line\">elseif blockip() then</span><br><span class=\"line\">--ip</span><br><span class=\"line\">elseif denyhackip(1) then</span><br><span class=\"line\">elseif denycc() then</span><br><span class=\"line\">elseif ngx.var.http_Acunetix_Aspect then</span><br><span class=\"line\">    ngx.exit(444)</span><br><span class=\"line\">elseif ngx.var.http_X_Scan_Memo then</span><br><span class=\"line\">    ngx.exit(444)</span><br><span class=\"line\">elseif ua() then</span><br><span class=\"line\">elseif url() then</span><br><span class=\"line\">elseif args() then</span><br><span class=\"line\">elseif cookie() then</span><br><span class=\"line\">elseif PostCheck then</span><br><span class=\"line\">    if method==&quot;POST&quot; then</span><br><span class=\"line\">            local boundary = get_boundary()</span><br><span class=\"line\">\t    if boundary then</span><br><span class=\"line\">\t    local len = string.len</span><br><span class=\"line\">            local sock, err = ngx.req.socket()</span><br><span class=\"line\">    \t    if not sock then</span><br><span class=\"line\">\t\t\t\t\treturn</span><br><span class=\"line\">            end</span><br><span class=\"line\">\t    ngx.req.init_body(128 * 1024)</span><br><span class=\"line\">            sock:settimeout(0)</span><br><span class=\"line\">\t    local content_length = nil</span><br><span class=\"line\">    \t    content_length=tonumber(ngx.req.get_headers()[&#x27;content-length&#x27;])</span><br><span class=\"line\">    \t    local chunk_size = 4096</span><br><span class=\"line\">            if content_length &lt; chunk_size then</span><br><span class=\"line\">\t\t\t\t\tchunk_size = content_length</span><br><span class=\"line\">\t    end</span><br><span class=\"line\">            local size = 0</span><br><span class=\"line\">\t    while size &lt; content_length do</span><br><span class=\"line\">\t\tlocal data, err, partial = sock:receive(chunk_size)</span><br><span class=\"line\">\t\tdata = data or partial</span><br><span class=\"line\">\t\tif not data then</span><br><span class=\"line\">\t\t\treturn</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tngx.req.append_body(data)</span><br><span class=\"line\">        \tif body(data) then</span><br><span class=\"line\">\t   \t        return true</span><br><span class=\"line\">    \t    \tend</span><br><span class=\"line\">\t\tsize = size + len(data)</span><br><span class=\"line\">\t\tlocal m = ngxmatch(data,[[Content-Disposition: form-data;(.+)filename=&quot;(.+)\\.(.*)&quot;]],&#x27;ijo&#x27;)</span><br><span class=\"line\">        \tif m then</span><br><span class=\"line\">            \t\tfileExtCheck(m[3])</span><br><span class=\"line\">            \t\tfiletranslate = true</span><br><span class=\"line\">        \telse</span><br><span class=\"line\">            \t\tif ngxmatch(data,&quot;Content-Disposition:&quot;,&#x27;isjo&#x27;) then</span><br><span class=\"line\">                \t\tfiletranslate = false</span><br><span class=\"line\">            \t\tend</span><br><span class=\"line\">            \t\tif filetranslate==false then</span><br><span class=\"line\">            \t\t\tif body(data) then</span><br><span class=\"line\">                    \t\t\treturn true</span><br><span class=\"line\">                \t\tend</span><br><span class=\"line\">            \t\tend</span><br><span class=\"line\">        \tend</span><br><span class=\"line\">\t\tlocal less = content_length - size</span><br><span class=\"line\">\t\tif less &lt; chunk_size then</span><br><span class=\"line\">\t\t\tchunk_size = less</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t end</span><br><span class=\"line\">\t ngx.req.finish_body()</span><br><span class=\"line\">    else</span><br><span class=\"line\">\t\t\tngx.req.read_body()</span><br><span class=\"line\">\t\t\tlocal args = ngx.req.get_post_args()</span><br><span class=\"line\">\t\t\tif not args then</span><br><span class=\"line\">\t\t\t\treturn</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\tfor key, val in pairs(args) do</span><br><span class=\"line\">\t\t\t\tif type(val) == &quot;table&quot; then</span><br><span class=\"line\">\t\t\t\t\tif type(val[1]) == &quot;boolean&quot; then</span><br><span class=\"line\">\t\t\t\t\t\treturn</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\tdata=table.concat(val, &quot;, &quot;)</span><br><span class=\"line\">\t\t\t\telse</span><br><span class=\"line\">\t\t\t\t\tdata=val</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tif data and type(data) ~= &quot;boolean&quot; and body(data) then</span><br><span class=\"line\">                \t\t\tbody(key)</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\"></span><br><span class=\"line\">else</span><br><span class=\"line\">    return</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"socket-lua\"><a href=\"#socket-lua\" class=\"headerlink\" title=\"socket.lua\"></a>socket.lua</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- Copyright (C) 2013-2014 Jiale Zhi (calio), CloudFlare Inc.</span><br><span class=\"line\">--require &quot;luacov&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">local concat                = table.concat</span><br><span class=\"line\">local tcp                   = ngx.socket.tcp</span><br><span class=\"line\">local udp                   = ngx.socket.udp</span><br><span class=\"line\">local timer_at              = ngx.timer.at</span><br><span class=\"line\">local ngx_log               = ngx.log</span><br><span class=\"line\">local ngx_sleep             = ngx.sleep</span><br><span class=\"line\">local type                  = type</span><br><span class=\"line\">local pairs                 = pairs</span><br><span class=\"line\">local tostring              = tostring</span><br><span class=\"line\">local debug                 = ngx.config.debug</span><br><span class=\"line\"></span><br><span class=\"line\">local DEBUG                 = ngx.DEBUG</span><br><span class=\"line\">local CRIT                  = ngx.CRIT</span><br><span class=\"line\"></span><br><span class=\"line\">local MAX_PORT              = 65535</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-- table.new(narr, nrec)</span><br><span class=\"line\">local succ, new_tab = pcall(require, &quot;table.new&quot;)</span><br><span class=\"line\">if not succ then</span><br><span class=\"line\">    new_tab = function () return &#123;&#125; end</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local _M = new_tab(0, 5)</span><br><span class=\"line\"></span><br><span class=\"line\">local is_exiting</span><br><span class=\"line\"></span><br><span class=\"line\">if not ngx.config or not ngx.config.ngx_lua_version</span><br><span class=\"line\">    or ngx.config.ngx_lua_version &lt; 9003 then</span><br><span class=\"line\"></span><br><span class=\"line\">    is_exiting = function() return false end</span><br><span class=\"line\"></span><br><span class=\"line\">    ngx_log(CRIT, &quot;We strongly recommend you to update your ngx_lua module to &quot;</span><br><span class=\"line\">            .. &quot;0.9.3 or above. lua-resty-logger-socket will lose some log &quot;</span><br><span class=\"line\">            .. &quot;messages when Nginx reloads if it works with ngx_lua module &quot;</span><br><span class=\"line\">            .. &quot;below 0.9.3&quot;)</span><br><span class=\"line\">else</span><br><span class=\"line\">    is_exiting = ngx.worker.exiting</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">_M._VERSION = &#x27;0.03&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">-- user config</span><br><span class=\"line\">local flush_limit           = 4096         -- 4KB</span><br><span class=\"line\">local drop_limit            = 1048576      -- 1MB</span><br><span class=\"line\">local timeout               = 1000         -- 1 sec</span><br><span class=\"line\">local host</span><br><span class=\"line\">local port</span><br><span class=\"line\">local ssl                   = false</span><br><span class=\"line\">local ssl_verify            = true</span><br><span class=\"line\">local sni_host</span><br><span class=\"line\">local path</span><br><span class=\"line\">local max_buffer_reuse      = 10000        -- reuse buffer for at most 10000</span><br><span class=\"line\">                                           -- times</span><br><span class=\"line\">local periodic_flush        = nil</span><br><span class=\"line\">local need_periodic_flush   = nil</span><br><span class=\"line\">local sock_type             = &#x27;tcp&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">-- internal variables</span><br><span class=\"line\">local buffer_size           = 0</span><br><span class=\"line\">-- 2nd level buffer, it stores logs ready to be sent out</span><br><span class=\"line\">local send_buffer           = &quot;&quot;</span><br><span class=\"line\">-- 1st level buffer, it stores incoming logs</span><br><span class=\"line\">local log_buffer_data       = new_tab(20000, 0)</span><br><span class=\"line\">-- number of log lines in current 1st level buffer, starts from 0</span><br><span class=\"line\">local log_buffer_index      = 0</span><br><span class=\"line\"></span><br><span class=\"line\">local last_error</span><br><span class=\"line\"></span><br><span class=\"line\">local connecting</span><br><span class=\"line\">local connected</span><br><span class=\"line\">local exiting</span><br><span class=\"line\">local retry_connect         = 0</span><br><span class=\"line\">local retry_send            = 0</span><br><span class=\"line\">local max_retry_times       = 3</span><br><span class=\"line\">local retry_interval        = 100         -- 0.1s</span><br><span class=\"line\">local pool_size             = 10</span><br><span class=\"line\">local flushing</span><br><span class=\"line\">local logger_initted</span><br><span class=\"line\">local counter               = 0</span><br><span class=\"line\">local ssl_session</span><br><span class=\"line\"></span><br><span class=\"line\">local function _write_error(msg)</span><br><span class=\"line\">    last_error = msg</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _do_connect()</span><br><span class=\"line\">    local ok, err, sock</span><br><span class=\"line\"></span><br><span class=\"line\">    if not connected then</span><br><span class=\"line\">        if (sock_type == &#x27;udp&#x27;) then</span><br><span class=\"line\">            sock, err = udp()</span><br><span class=\"line\">        else</span><br><span class=\"line\">            sock, err = tcp()</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        if not sock then</span><br><span class=\"line\">            _write_error(err)</span><br><span class=\"line\">            return nil, err</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        sock:settimeout(timeout)</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    -- &quot;host&quot;/&quot;port&quot; and &quot;path&quot; have already been checked in init()</span><br><span class=\"line\">    if host and port then</span><br><span class=\"line\">        if (sock_type == &#x27;udp&#x27;) then</span><br><span class=\"line\">            ok, err = sock:setpeername(host, port)</span><br><span class=\"line\">        else</span><br><span class=\"line\">            ok, err = sock:connect(host, port)</span><br><span class=\"line\">        end</span><br><span class=\"line\">    elseif path then</span><br><span class=\"line\">        ok, err = sock:connect(&quot;unix:&quot; .. path)</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if not ok then</span><br><span class=\"line\">        return nil, err</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    return sock</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _do_handshake(sock)</span><br><span class=\"line\">    if not ssl then</span><br><span class=\"line\">        return sock</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    local session, err = sock:sslhandshake(ssl_session, sni_host or host,</span><br><span class=\"line\">                                           ssl_verify)</span><br><span class=\"line\">    if not session then</span><br><span class=\"line\">        return nil, err</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    ssl_session = session</span><br><span class=\"line\">    return sock</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _connect()</span><br><span class=\"line\">    local err, sock</span><br><span class=\"line\"></span><br><span class=\"line\">    if connecting then</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;previous connection not finished&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        return nil, &quot;previous connection not finished&quot;</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    connected = false</span><br><span class=\"line\">    connecting = true</span><br><span class=\"line\"></span><br><span class=\"line\">    retry_connect = 0</span><br><span class=\"line\"></span><br><span class=\"line\">    while retry_connect &lt;= max_retry_times do</span><br><span class=\"line\">        sock, err = _do_connect()</span><br><span class=\"line\"></span><br><span class=\"line\">        if sock then</span><br><span class=\"line\">            sock, err = _do_handshake(sock)</span><br><span class=\"line\">            if sock then</span><br><span class=\"line\">                connected = true</span><br><span class=\"line\">                break</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;reconnect to the log server: &quot;, err)</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        -- ngx.sleep time is in seconds</span><br><span class=\"line\">        if not exiting then</span><br><span class=\"line\">            ngx_sleep(retry_interval / 1000)</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        retry_connect = retry_connect + 1</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    connecting = false</span><br><span class=\"line\">    if not connected then</span><br><span class=\"line\">        return nil, &quot;try to connect to the log server failed after &quot;</span><br><span class=\"line\">                    .. max_retry_times .. &quot; retries: &quot; .. err</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    return sock</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _prepare_stream_buffer()</span><br><span class=\"line\">    local packet = concat(log_buffer_data, &quot;&quot;, 1, log_buffer_index)</span><br><span class=\"line\">    send_buffer = send_buffer .. packet</span><br><span class=\"line\"></span><br><span class=\"line\">    log_buffer_index = 0</span><br><span class=\"line\">    counter = counter + 1</span><br><span class=\"line\">    if counter &gt; max_buffer_reuse then</span><br><span class=\"line\">        log_buffer_data = new_tab(20000, 0)</span><br><span class=\"line\">        counter = 0</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;log buffer reuse limit (&quot; .. max_buffer_reuse</span><br><span class=\"line\">                    .. &quot;) reached, create a new \\&quot;log_buffer_data\\&quot;&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _do_flush()</span><br><span class=\"line\">    local ok, err, sock, bytes</span><br><span class=\"line\">    local packet = send_buffer</span><br><span class=\"line\"></span><br><span class=\"line\">    sock, err = _connect()</span><br><span class=\"line\">    if not sock then</span><br><span class=\"line\">        return nil, err</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    bytes, err = sock:send(packet)</span><br><span class=\"line\">    if not bytes then</span><br><span class=\"line\">        -- &quot;sock:send&quot; always closes current connection on error</span><br><span class=\"line\">        return nil, err</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if debug then</span><br><span class=\"line\">        ngx.update_time()</span><br><span class=\"line\">        ngx_log(DEBUG, ngx.now(), &quot;:log flush:&quot; .. bytes .. &quot;:&quot; .. packet)</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if (sock_type ~= &#x27;udp&#x27;) then</span><br><span class=\"line\">        ok, err = sock:setkeepalive(0, pool_size)</span><br><span class=\"line\">        if not ok then</span><br><span class=\"line\">            return nil, err</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    return bytes</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _need_flush()</span><br><span class=\"line\">    if buffer_size &gt; 0 then</span><br><span class=\"line\">        return true</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _flush_lock()</span><br><span class=\"line\">    if not flushing then</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;flush lock acquired&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        flushing = true</span><br><span class=\"line\">        return true</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _flush_unlock()</span><br><span class=\"line\">    if debug then</span><br><span class=\"line\">        ngx_log(DEBUG, &quot;flush lock released&quot;)</span><br><span class=\"line\">    end</span><br><span class=\"line\">    flushing = false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _flush()</span><br><span class=\"line\">    local err</span><br><span class=\"line\"></span><br><span class=\"line\">    -- pre check</span><br><span class=\"line\">    if not _flush_lock() then</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;previous flush not finished&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        -- do this later</span><br><span class=\"line\">        return true</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if not _need_flush() then</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;no need to flush:&quot;, log_buffer_index)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        _flush_unlock()</span><br><span class=\"line\">        return true</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    -- start flushing</span><br><span class=\"line\">    retry_send = 0</span><br><span class=\"line\">    if debug then</span><br><span class=\"line\">        ngx_log(DEBUG, &quot;start flushing&quot;)</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    local bytes</span><br><span class=\"line\">    while retry_send &lt;= max_retry_times do</span><br><span class=\"line\">        if log_buffer_index &gt; 0 then</span><br><span class=\"line\">            _prepare_stream_buffer()</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        bytes, err = _do_flush()</span><br><span class=\"line\"></span><br><span class=\"line\">        if bytes then</span><br><span class=\"line\">            break</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;resend log messages to the log server: &quot;, err)</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        -- ngx.sleep time is in seconds</span><br><span class=\"line\">        if not exiting then</span><br><span class=\"line\">            ngx_sleep(retry_interval / 1000)</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        retry_send = retry_send + 1</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    _flush_unlock()</span><br><span class=\"line\"></span><br><span class=\"line\">    if not bytes then</span><br><span class=\"line\">        local err_msg = &quot;try to send log messages to the log server &quot;</span><br><span class=\"line\">                        .. &quot;failed after &quot; .. max_retry_times .. &quot; retries: &quot;</span><br><span class=\"line\">                        .. err</span><br><span class=\"line\">        _write_error(err_msg)</span><br><span class=\"line\">        return nil, err_msg</span><br><span class=\"line\">    else</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;send &quot; .. bytes .. &quot; bytes&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    buffer_size = buffer_size - #send_buffer</span><br><span class=\"line\">    send_buffer = &quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    return bytes</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _periodic_flush(premature)</span><br><span class=\"line\">    if premature then</span><br><span class=\"line\">        exiting = true</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if need_periodic_flush or exiting then</span><br><span class=\"line\">        -- no regular flush happened after periodic flush timer had been set</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;performing periodic flush&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        _flush()</span><br><span class=\"line\">    else</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;no need to perform periodic flush: regular flush &quot;</span><br><span class=\"line\">                    .. &quot;happened before&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        need_periodic_flush = true</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    timer_at(periodic_flush, _periodic_flush)</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _flush_buffer()</span><br><span class=\"line\">    local ok, err = timer_at(0, _flush)</span><br><span class=\"line\"></span><br><span class=\"line\">    need_periodic_flush = false</span><br><span class=\"line\"></span><br><span class=\"line\">    if not ok then</span><br><span class=\"line\">        _write_error(err)</span><br><span class=\"line\">        return nil, err</span><br><span class=\"line\">    end</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _write_buffer(msg, len)</span><br><span class=\"line\">    log_buffer_index = log_buffer_index + 1</span><br><span class=\"line\">    log_buffer_data[log_buffer_index] = msg</span><br><span class=\"line\"></span><br><span class=\"line\">    buffer_size = buffer_size + len</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    return buffer_size</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function _M.init(user_config)</span><br><span class=\"line\">    if (type(user_config) ~= &quot;table&quot;) then</span><br><span class=\"line\">        return nil, &quot;user_config must be a table&quot;</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    for k, v in pairs(user_config) do</span><br><span class=\"line\">        if k == &quot;host&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;string&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;host&quot; must be a string&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            host = v</span><br><span class=\"line\">        elseif k == &quot;port&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;port&quot; must be a number&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            if v &lt; 0 or v &gt; MAX_PORT then</span><br><span class=\"line\">                return nil, (&#x27;&quot;port&quot; out of range 0~%s&#x27;):format(MAX_PORT)</span><br><span class=\"line\">            end</span><br><span class=\"line\">            port = v</span><br><span class=\"line\">        elseif k == &quot;path&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;string&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;path&quot; must be a string&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            path = v</span><br><span class=\"line\">        elseif k == &quot;sock_type&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;string&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;sock_type&quot; must be a string&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            if v ~= &quot;tcp&quot; and v ~= &quot;udp&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;sock_type&quot; must be &quot;tcp&quot; or &quot;udp&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            sock_type = v</span><br><span class=\"line\">        elseif k == &quot;flush_limit&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;flush_limit&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            flush_limit = v</span><br><span class=\"line\">        elseif k == &quot;drop_limit&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;drop_limit&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            drop_limit = v</span><br><span class=\"line\">        elseif k == &quot;timeout&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;timeout&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            timeout = v</span><br><span class=\"line\">        elseif k == &quot;max_retry_times&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;max_retry_times&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            max_retry_times = v</span><br><span class=\"line\">        elseif k == &quot;retry_interval&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;retry_interval&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            -- ngx.sleep time is in seconds</span><br><span class=\"line\">            retry_interval = v</span><br><span class=\"line\">        elseif k == &quot;pool_size&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;pool_size&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            pool_size = v</span><br><span class=\"line\">        elseif k == &quot;max_buffer_reuse&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;max_buffer_reuse&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            max_buffer_reuse = v</span><br><span class=\"line\">        elseif k == &quot;periodic_flush&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;periodic_flush&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            periodic_flush = v</span><br><span class=\"line\">        elseif k == &quot;ssl&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;boolean&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;ssl&quot; must be a boolean value&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            ssl = v</span><br><span class=\"line\">        elseif k == &quot;ssl_verify&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;boolean&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;ssl_verify&quot; must be a boolean value&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            ssl_verify = v</span><br><span class=\"line\">        elseif k == &quot;sni_host&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;string&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;sni_host&quot; must be a string&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            sni_host = v</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if not (host and port) and not path then</span><br><span class=\"line\">        return nil, &quot;no logging server configured. \\&quot;host\\&quot;/\\&quot;port\\&quot; or &quot;</span><br><span class=\"line\">                .. &quot;\\&quot;path\\&quot; is required.&quot;</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    if (flush_limit &gt;= drop_limit) then</span><br><span class=\"line\">        return nil, &quot;\\&quot;flush_limit\\&quot; should be &lt; \\&quot;drop_limit\\&quot;&quot;</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    flushing = false</span><br><span class=\"line\">    exiting = false</span><br><span class=\"line\">    connecting = false</span><br><span class=\"line\"></span><br><span class=\"line\">    connected = false</span><br><span class=\"line\">    retry_connect = 0</span><br><span class=\"line\">    retry_send = 0</span><br><span class=\"line\"></span><br><span class=\"line\">    logger_initted = true</span><br><span class=\"line\"></span><br><span class=\"line\">    if periodic_flush then</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;periodic flush enabled for every &quot;</span><br><span class=\"line\">                    .. periodic_flush .. &quot; seconds&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        need_periodic_flush = true</span><br><span class=\"line\">        timer_at(periodic_flush, _periodic_flush)</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    return logger_initted</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function _M.log(msg)</span><br><span class=\"line\">    if not logger_initted then</span><br><span class=\"line\">        return nil, &quot;not initialized&quot;</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    local bytes</span><br><span class=\"line\"></span><br><span class=\"line\">    if type(msg) ~= &quot;string&quot; then</span><br><span class=\"line\">        msg = tostring(msg)</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    local msg_len = #msg</span><br><span class=\"line\"></span><br><span class=\"line\">    if (debug) then</span><br><span class=\"line\">        ngx.update_time()</span><br><span class=\"line\">        ngx_log(DEBUG, ngx.now(), &quot;:log message length: &quot; .. msg_len)</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    -- response of &quot;_flush_buffer&quot; is not checked, because it writes</span><br><span class=\"line\">    -- error buffer</span><br><span class=\"line\">    if (is_exiting()) then</span><br><span class=\"line\">        exiting = true</span><br><span class=\"line\">        _write_buffer(msg, msg_len)</span><br><span class=\"line\">        _flush_buffer()</span><br><span class=\"line\">        if (debug) then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;Nginx worker is exiting&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        bytes = 0</span><br><span class=\"line\">    elseif (msg_len + buffer_size &lt; flush_limit) then</span><br><span class=\"line\">        _write_buffer(msg, msg_len)</span><br><span class=\"line\">        bytes = msg_len</span><br><span class=\"line\">    elseif (msg_len + buffer_size &lt;= drop_limit) then</span><br><span class=\"line\">        _write_buffer(msg, msg_len)</span><br><span class=\"line\">        _flush_buffer()</span><br><span class=\"line\">        bytes = msg_len</span><br><span class=\"line\">    else</span><br><span class=\"line\">        _flush_buffer()</span><br><span class=\"line\">        if (debug) then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;logger buffer is full, this log message will be &quot;</span><br><span class=\"line\">                    .. &quot;dropped&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        bytes = 0</span><br><span class=\"line\">        --- this log message doesn&#x27;t fit in buffer, drop it</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if last_error then</span><br><span class=\"line\">        local err = last_error</span><br><span class=\"line\">        last_error = nil</span><br><span class=\"line\">        return bytes, err</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    return bytes</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function _M.initted()</span><br><span class=\"line\">    return logger_initted</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">_M.flush = _flush</span><br><span class=\"line\"></span><br><span class=\"line\">return _M</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"init-lua\"><a href=\"#init-lua\" class=\"headerlink\" title=\"init.lua\"></a>init.lua</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">require &#x27;config&#x27;</span><br><span class=\"line\">local match = string.match</span><br><span class=\"line\">--ngx_lua0.9.2ngx.re.find</span><br><span class=\"line\">--nginxlua\\d\\w\\s</span><br><span class=\"line\">--local ngxmatch=ngx.re.match</span><br><span class=\"line\">local ngxmatch=ngx.re.find</span><br><span class=\"line\">local unescape=ngx.unescape_uri</span><br><span class=\"line\">local get_headers = ngx.req.get_headers</span><br><span class=\"line\">local optionIsOn = function (options) return options == &quot;on&quot; and true or false end</span><br><span class=\"line\">loghack=optionIsOn(loghack)</span><br><span class=\"line\">--socket.lualogsyslog</span><br><span class=\"line\">local logger = require &quot;socket&quot;</span><br><span class=\"line\">if loghack then</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tif not logger.initted() then</span><br><span class=\"line\">          local ok, err = logger.init&#123;</span><br><span class=\"line\">              --host = &#x27;192.168.0.1&#x27;,</span><br><span class=\"line\">              host = &#x27;logserver.local&#x27;,</span><br><span class=\"line\">              port = 514,</span><br><span class=\"line\">              sock_type = &quot;udp&quot;, --udp</span><br><span class=\"line\">              flush_limit = 1,\t--</span><br><span class=\"line\">              --drop_limit = 5678,</span><br><span class=\"line\">              pool_size = 100,--</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          if not ok then</span><br><span class=\"line\">              ngx.log(ngx.ERR, &quot;failed to initialize the logger: &quot;,</span><br><span class=\"line\">                      err)</span><br><span class=\"line\">              return</span><br><span class=\"line\">          end</span><br><span class=\"line\"> end</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">logpath = logdir</span><br><span class=\"line\">rulepath = RulePath</span><br><span class=\"line\">logtofile = optionIsOn(logtofile)</span><br><span class=\"line\">logtoserver = optionIsOn(logtoserver)</span><br><span class=\"line\">UrlDeny = optionIsOn(UrlDeny)</span><br><span class=\"line\">PostCheck = optionIsOn(postMatch)</span><br><span class=\"line\">CookieCheck = optionIsOn(cookieMatch)</span><br><span class=\"line\">WhiteCheck = optionIsOn(whiteModule)</span><br><span class=\"line\">PathInfoFix = optionIsOn(PathInfoFix)</span><br><span class=\"line\">attacklog = optionIsOn(attacklog)</span><br><span class=\"line\">hackipdeny = optionIsOn(hackipdeny)</span><br><span class=\"line\">CCDeny = optionIsOn(CCDeny)</span><br><span class=\"line\">Redirect=optionIsOn(Redirect)</span><br><span class=\"line\">local file = io.open(&#x27;config&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">function getClientIp()</span><br><span class=\"line\">        IP  = ngx.var.remote_addr</span><br><span class=\"line\">        if IP == nil then</span><br><span class=\"line\">                IP  = &quot;unknown&quot;</span><br><span class=\"line\">        end</span><br><span class=\"line\">        return IP</span><br><span class=\"line\">end</span><br><span class=\"line\">function write(logfile,msg)</span><br><span class=\"line\">    local fd = io.open(logfile,&quot;ab&quot;)</span><br><span class=\"line\">    if fd == nil then return end</span><br><span class=\"line\">    fd:write(msg)</span><br><span class=\"line\">    fd:flush()</span><br><span class=\"line\">    fd:close()</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function swrite(msg)</span><br><span class=\"line\">      --nginx error_log</span><br><span class=\"line\">\t\t\tngx.log(ngx.CRIT,msg)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function log(method,url,data,ruletag)</span><br><span class=\"line\">    if attacklog then</span><br><span class=\"line\">        local realIp = getClientIp()</span><br><span class=\"line\">        local ua = ngx.var.http_user_agent</span><br><span class=\"line\">        if ua == nil then</span><br><span class=\"line\">        \tua=&quot;null&quot;</span><br><span class=\"line\">        end</span><br><span class=\"line\">        local servername=ngx.var.host</span><br><span class=\"line\">        local time=ngx.localtime()</span><br><span class=\"line\">        if logtofile then</span><br><span class=\"line\">        local filename = logpath..&#x27;/&#x27;..servername..&quot;_&quot;..ngx.today()..&quot;_sec.log&quot;</span><br><span class=\"line\">        line=realIp..&quot; [&quot;..time..&quot;]&quot;..&quot;\\&quot;&quot;..method..&quot; &quot;..servername..url..&quot;\\&quot;&quot;..data..&quot;\\&quot;&quot;..ua..&quot;\\&quot;&quot;..ruletag..&quot;\\&quot;&quot;..&quot;\\n&quot;</span><br><span class=\"line\">        write(filename,line)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        if logtoserver then</span><br><span class=\"line\">        line=realIp..&quot;\\&quot;&quot;..method..&quot; &quot;..servername..url..&quot;\\&quot;&quot;..data..&quot;\\&quot;&quot;..ua..&quot;\\&quot;&quot;..ruletag..&quot;\\&quot;&quot;</span><br><span class=\"line\">        --line=&quot;lua_waf:&quot;..line</span><br><span class=\"line\">        swrite(line)</span><br><span class=\"line\">        end</span><br><span class=\"line\">    --ipsyslog</span><br><span class=\"line\">    if loghack then  local bytes, err = logger.log(getClientIp()) end</span><br><span class=\"line\">\t\t--logdenyhackipip</span><br><span class=\"line\">\t\tif hackipdeny then  denyhackip(0) end</span><br><span class=\"line\">    end</span><br><span class=\"line\">end</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">function read_rule(var)</span><br><span class=\"line\">    file = io.open(rulepath..&#x27;/&#x27;..var,&quot;r&quot;)</span><br><span class=\"line\">    if file==nil then</span><br><span class=\"line\">        return</span><br><span class=\"line\">    end</span><br><span class=\"line\">    t = &#123;&#125;</span><br><span class=\"line\">    for line in file:lines() do</span><br><span class=\"line\">        table.insert(t,line)</span><br><span class=\"line\">    end</span><br><span class=\"line\">    file:close()</span><br><span class=\"line\">    return(t)</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">urlrules=read_rule(&#x27;url&#x27;)</span><br><span class=\"line\">argsrules=read_rule(&#x27;args&#x27;)</span><br><span class=\"line\">uarules=read_rule(&#x27;user-agent&#x27;)</span><br><span class=\"line\">wturlrules=read_rule(&#x27;whiteurl&#x27;)</span><br><span class=\"line\">postrules=read_rule(&#x27;post&#x27;)</span><br><span class=\"line\">ckrules=read_rule(&#x27;cookie&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">function say_html()</span><br><span class=\"line\">    if Redirect then</span><br><span class=\"line\">        ngx.header.content_type = &quot;text/html&quot;</span><br><span class=\"line\">        ngx.status = ngx.HTTP_FORBIDDEN</span><br><span class=\"line\">        ngx.say(html)</span><br><span class=\"line\">        ngx.exit(ngx.status)</span><br><span class=\"line\">    end</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function whiteurl()</span><br><span class=\"line\">    if WhiteCheck then</span><br><span class=\"line\">        if wturlrules ~=nil then</span><br><span class=\"line\">\t\t\t\t\t\tlocal urlpath = string.gsub(ngx.var.request_uri, &quot;?.*&quot;, &quot;&quot;)</span><br><span class=\"line\">            for _,rule in pairs(wturlrules) do</span><br><span class=\"line\">            --site:</span><br><span class=\"line\">\t            local sitemod,_=string.find(rule,&quot;site:&quot;)</span><br><span class=\"line\">\t        \t\tif sitemod==1 then</span><br><span class=\"line\">\t        \t\t\trule=string.gsub(rule,&quot;site:&quot;,&quot;&quot;,1)</span><br><span class=\"line\">\t        \t\t\t--whiteurl</span><br><span class=\"line\">\t        \t\t\t--if ngx.var.host==&#x27;domino.cqhrss.gov.cn&#x27; then</span><br><span class=\"line\">\t        \t\t\t--\tlog(&#x27;debug&#x27;,ngx.var.uri,&quot;&quot;,rule)</span><br><span class=\"line\">\t        \t\t\t--end</span><br><span class=\"line\">\t        \t\t\tif ngxmatch(ngx.var.host..ngx.var.uri,rule,&quot;isjo&quot;) then</span><br><span class=\"line\">                    return true</span><br><span class=\"line\">                end</span><br><span class=\"line\">\t        \t\telse</span><br><span class=\"line\">            \t\tif ngxmatch(ngx.var.uri,rule,&quot;isjo&quot;) then</span><br><span class=\"line\">                    return true</span><br><span class=\"line\">\t\t\t\t\t\t\t\telse</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tlocal pathmod,_=string.find(rule,&quot;path:&quot;)</span><br><span class=\"line\">\t\t\t        \t\tif pathmod==1 then</span><br><span class=\"line\">\t\t\t        \t\t\trule=string.gsub(rule,&quot;path:&quot;,&quot;&quot;,1)</span><br><span class=\"line\">\t\t\t        \t\t\tif urlpath==rule then</span><br><span class=\"line\">\t\t                    return true</span><br><span class=\"line\">\t\t                end</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tend</span><br><span class=\"line\">                end</span><br><span class=\"line\">            \tend</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function fileExtCheck(ext)</span><br><span class=\"line\">    local items = Set(black_fileExt)</span><br><span class=\"line\">    ext=string.lower(ext)</span><br><span class=\"line\">    if ext then</span><br><span class=\"line\">        for rule,_ in pairs(items) do</span><br><span class=\"line\">            if ngxmatch(ext,rule,&quot;isjo&quot;) then</span><br><span class=\"line\">            log(&#x27;POST&#x27;,ngx.var.request_uri,&quot;-&quot;,&quot;file attack with ext &quot;..ext)</span><br><span class=\"line\">            say_html()</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\">function Set (list)</span><br><span class=\"line\">  local set = &#123;&#125;</span><br><span class=\"line\">  for _, l in ipairs(list) do set[l] = true end</span><br><span class=\"line\">  return set</span><br><span class=\"line\">end</span><br><span class=\"line\">function args()</span><br><span class=\"line\">    for _,rule in pairs(argsrules) do</span><br><span class=\"line\">        local args = ngx.req.get_uri_args()</span><br><span class=\"line\">        for key, val in pairs(args) do</span><br><span class=\"line\">            if type(val)==&#x27;table&#x27; then</span><br><span class=\"line\">                 local t=&#123;&#125;</span><br><span class=\"line\">                 for k,v in pairs(val) do</span><br><span class=\"line\">                    if v == true then</span><br><span class=\"line\">                        v=&quot;&quot;</span><br><span class=\"line\">                    end</span><br><span class=\"line\">                    table.insert(t,v)</span><br><span class=\"line\">                end</span><br><span class=\"line\">                data=table.concat(t, &quot; &quot;)</span><br><span class=\"line\">            else</span><br><span class=\"line\">                data=val</span><br><span class=\"line\">            end</span><br><span class=\"line\">            if data and type(data) ~= &quot;boolean&quot; and rule ~=&quot;&quot; and ngxmatch(unescape(data),rule,&quot;isjo&quot;) then</span><br><span class=\"line\">                log(&#x27;GET&#x27;,ngx.var.request_uri,&quot;-&quot;,rule)</span><br><span class=\"line\">                say_html()</span><br><span class=\"line\">                return true</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">function url()</span><br><span class=\"line\">    if UrlDeny then</span><br><span class=\"line\">        for _,rule in pairs(urlrules) do</span><br><span class=\"line\">            if rule ~=&quot;&quot; and ngxmatch(ngx.var.request_uri,rule,&quot;isjo&quot;) then</span><br><span class=\"line\">                log(&#x27;GET&#x27;,ngx.var.request_uri,&quot;-&quot;,rule)</span><br><span class=\"line\">                say_html()</span><br><span class=\"line\">                return true</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function ua()</span><br><span class=\"line\">    local ua = ngx.var.http_user_agent</span><br><span class=\"line\">    if ua ~= nil then</span><br><span class=\"line\">        for _,rule in pairs(uarules) do</span><br><span class=\"line\">            if rule ~=&quot;&quot; and ngxmatch(ua,rule,&quot;isjo&quot;) then</span><br><span class=\"line\">                log(&#x27;UA&#x27;,ngx.var.request_uri,&quot;-&quot;,rule)</span><br><span class=\"line\">                say_html()</span><br><span class=\"line\">            return true</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\">function body(data)</span><br><span class=\"line\">    for _,rule in pairs(postrules) do</span><br><span class=\"line\">        if rule ~=&quot;&quot; and data~=&quot;&quot; and ngxmatch(unescape(data),rule,&quot;isjo&quot;) then</span><br><span class=\"line\">            log(&#x27;POST&#x27;,ngx.var.request_uri,data,rule)</span><br><span class=\"line\">            say_html()</span><br><span class=\"line\">            return true</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\">function cookie()</span><br><span class=\"line\">    local ck = ngx.var.http_cookie</span><br><span class=\"line\">    if CookieCheck and ck then</span><br><span class=\"line\">        for _,rule in pairs(ckrules) do</span><br><span class=\"line\">            if rule ~=&quot;&quot; and ngxmatch(ck,rule,&quot;isjo&quot;) then</span><br><span class=\"line\">                log(&#x27;Cookie&#x27;,ngx.var.request_uri,&quot;-&quot;,rule)</span><br><span class=\"line\">                say_html()</span><br><span class=\"line\">            return true</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function denycc()</span><br><span class=\"line\">    if CCDeny then</span><br><span class=\"line\">        local uri=ngx.var.uri</span><br><span class=\"line\">      \tlocal m, err = ngx.re.match(CCrate,&#x27;([0-9]+)/([0-9]+)/([0-9]+)&#x27;)</span><br><span class=\"line\">      \tlocal CCcount=tonumber(m[1]) --</span><br><span class=\"line\">        local CCseconds=tonumber(m[2]) --</span><br><span class=\"line\">        local CClimits=tonumber(m[3]) --</span><br><span class=\"line\">        local token = getClientIp()..uri</span><br><span class=\"line\">        local limit = ngx.shared.limit</span><br><span class=\"line\">        local req,_=limit:get(token) --</span><br><span class=\"line\"></span><br><span class=\"line\">        if req then</span><br><span class=\"line\">            if req &gt; CCcount then</span><br><span class=\"line\">                ngx.exit(404)</span><br><span class=\"line\">                return true</span><br><span class=\"line\">            else</span><br><span class=\"line\">            \t\tif req == CCcount then    limit:set(token,CCcount+1,CClimits)  end</span><br><span class=\"line\"></span><br><span class=\"line\">                limit:incr(token,1)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t--syslog</span><br><span class=\"line\">\t\t\t\t\t\t\t\t--swrite(&#x27;:&#x27;..token..&#x27;&#x27;..req..&#x27;:&#x27;..CClimits)</span><br><span class=\"line\"></span><br><span class=\"line\">            end</span><br><span class=\"line\">        else</span><br><span class=\"line\">            limit:set(token,1,CCseconds)</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">--chk1</span><br><span class=\"line\">function denyhackip(chk)</span><br><span class=\"line\">    if hackipdeny then</span><br><span class=\"line\"></span><br><span class=\"line\">       local m, err = ngx.re.match(hackrate,&#x27;([0-9]+)/([0-9]+)/([0-9]+)&#x27;)</span><br><span class=\"line\">      \tlocal hicount=tonumber(m[1]) --</span><br><span class=\"line\">        local hiseconds=tonumber(m[2]) --</span><br><span class=\"line\">        local hilimits=tonumber(m[3]) --</span><br><span class=\"line\">        local token = &quot;hackip&quot;..getClientIp()</span><br><span class=\"line\">        local limit = ngx.shared.limit</span><br><span class=\"line\">        local req,_=limit:get(token) --</span><br><span class=\"line\">        if req then</span><br><span class=\"line\">            if req &gt; hicount then</span><br><span class=\"line\">                ngx.exit(404)</span><br><span class=\"line\">                return true</span><br><span class=\"line\">            else</span><br><span class=\"line\"></span><br><span class=\"line\">            \t\tif req == hicount then</span><br><span class=\"line\">            \t\t\t\tlimit:set(token,hicount+1,hilimits)</span><br><span class=\"line\">            \t\t\t\tswrite(&quot;ip:&quot;..getClientIp()..&quot;&quot;..hilimits..&quot;&quot;)</span><br><span class=\"line\">            \t\t\t\tend</span><br><span class=\"line\">                 if chk ~=1 then limit:incr(token,1)      end</span><br><span class=\"line\">                --syslog</span><br><span class=\"line\">                --swrite(&quot;:&quot;..token..&quot;:&quot;..chk..&quot;&quot;..req..&quot;:&quot;..hilimits)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            end</span><br><span class=\"line\">        else</span><br><span class=\"line\">        \t\tif chk ~=1 then limit:set(token,1,hiseconds) \tend</span><br><span class=\"line\"></span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function get_boundary()</span><br><span class=\"line\">    local header = get_headers()[&quot;content-type&quot;]</span><br><span class=\"line\">    if not header then</span><br><span class=\"line\">        return nil</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if type(header) == &quot;table&quot; then</span><br><span class=\"line\">        header = header[1]</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    local m = match(header, &quot;;%s*boundary=\\&quot;([^\\&quot;]+)\\&quot;&quot;)</span><br><span class=\"line\">    if m then</span><br><span class=\"line\">        return m</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    return match(header, &quot;;%s*boundary=([^\\&quot;,;]+)&quot;)</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function whiteip()</span><br><span class=\"line\">    if next(ipWhitelist) ~= nil then</span><br><span class=\"line\">        for _,ip in pairs(ipWhitelist) do</span><br><span class=\"line\">            if getClientIp()==ip then</span><br><span class=\"line\">                return true</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">        return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function blockip()</span><br><span class=\"line\">     if next(ipBlocklist) ~= nil then</span><br><span class=\"line\">         for _,ip in pairs(ipBlocklist) do</span><br><span class=\"line\">             if getClientIp()==ip then</span><br><span class=\"line\">                 ngx.exit(403)</span><br><span class=\"line\">                 return true</span><br><span class=\"line\">             end</span><br><span class=\"line\">         end</span><br><span class=\"line\">     end</span><br><span class=\"line\">         return false</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"config-lua\"><a href=\"#config-lua\" class=\"headerlink\" title=\"config.lua\"></a>config.lua</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RulePath = &quot;/usr/local/nginx/conf/waf/wafconf/&quot;</span><br><span class=\"line\">attacklog = &quot;on&quot;</span><br><span class=\"line\">--</span><br><span class=\"line\">logtofile = &quot;on&quot;</span><br><span class=\"line\">logdir = &quot;/site/wwwlogs/waf/&quot;</span><br><span class=\"line\">--syslog,nginx</span><br><span class=\"line\">logtoserver = &quot;off&quot;</span><br><span class=\"line\">--sysloghack_ip</span><br><span class=\"line\">loghack=&quot;off&quot;</span><br><span class=\"line\">UrlDeny=&quot;on&quot;</span><br><span class=\"line\">Redirect=&quot;on&quot;</span><br><span class=\"line\">CookieMatch=&quot;on&quot;</span><br><span class=\"line\">postMatch=&quot;on&quot;</span><br><span class=\"line\">whiteModule=&quot;on&quot;</span><br><span class=\"line\">black_fileExt=&#123;&quot;php&quot;,&quot;jsp&quot;&#125;</span><br><span class=\"line\">ipWhitelist=&#123;&quot;127.0.0.1&quot;,&quot;192.168.2.1&quot;&#125;</span><br><span class=\"line\">ipBlocklist=&#123;&quot;1.0.0.1&quot;&#125;</span><br><span class=\"line\">--ip</span><br><span class=\"line\">--hackrate10/5,1800</span><br><span class=\"line\">hackipdeny=&quot;on&quot;</span><br><span class=\"line\">hackrate=&quot;10/60/1800&quot;</span><br><span class=\"line\">--cc</span><br><span class=\"line\">CCDeny=&quot;on&quot;</span><br><span class=\"line\">CCrate=&quot;30/60/30&quot;</span><br><span class=\"line\">html=[[</span><br><span class=\"line\">&lt;html&gt;&lt;head&gt;</span><br><span class=\"line\">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;</span><br><span class=\"line\">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;&lt;/title&gt;</span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">p &#123;line-height:20px;&#125;</span><br><span class=\"line\">ul&#123; list-style-type:none;&#125;</span><br><span class=\"line\">li&#123; list-style-type:none;&#125;</span><br><span class=\"line\">body&#123;padding:0; margin:0; font:14px/1.5 Microsoft Yahei, ,sans-serif; color:#555;&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\"> &lt;div style=&quot;margin: 0 auto; max-width:1000px; padding-top:70px; overflow:hidden;&quot;&gt;</span><br><span class=\"line\">  &lt;div style=&quot;padding:0 15px;&quot;&gt;</span><br><span class=\"line\">    &lt;div style=&quot; height:40px; line-height:40px; color:#fff; font-size:16px; overflow:hidden; background:#6bb3f6; padding-left:20px;&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">    &lt;div style=&quot;border:1px dashed #cdcece; border-top:none; font-size:14px; background:#fff; color:#555; line-height:24px; height:220px; padding:20px 20px 0 20px; overflow-y:auto;background:#f3f7f9;&quot;&gt;</span><br><span class=\"line\">      &lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;&lt;span style=&quot; font-weight:600; color:#fc4f03;&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span><br><span class=\"line\">&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;&lt;/p&gt;</span><br><span class=\"line\">&lt;p style=&quot; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;&quot;&gt;&lt;/p&gt;</span><br><span class=\"line\">&lt;ul style=&quot;margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;&quot;&gt;&lt;li style=&quot; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;1&lt;/li&gt;</span><br><span class=\"line\">&lt;li style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;2&lt;/li&gt;</span><br><span class=\"line\">&lt;li style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;3&lt;/li&gt;&lt;/ul&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\">&lt;/body&gt;&lt;/html&gt;</span><br><span class=\"line\">]]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"whiteurl\"><a href=\"#whiteurl\" class=\"headerlink\" title=\"whiteurl\"></a>whiteurl</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">^/zhaonvpengyou</span><br><span class=\"line\">site:^lianxiwo\\.com/</span><br><span class=\"line\">path:/wogeiniliuyi.html</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>s<br><a href=\"https://github.com/loveshell/ngx_lua_waf/pull/136%E4%BF%AE%E6%94%B9%EF%BC%8C%E7%84%B6%E5%90%8E%E4%BE%9D%E8%99%8E%E7%94%BB%E7%8C%AB%EF%BC%8C%E5%A2%9E%E5%8A%A0%E4%BA%86%E4%B8%80%E4%B8%AA%E5%88%A4%E6%96%ADrequest_uri%E7%9A%84%E5%B0%8F%E5%8A%9F%E8%83%BD%EF%BC%81\">https://github.com/loveshell/ngx_lua_waf/pull/136request_uri</a></p>\n","site":{"data":{}},"length":25917,"excerpt":"","more":"<blockquote>\n<p>luanginxluawafwafwafwafDDOSCCwaf</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>wafngx_lua_waf<a href=\"https://github.com/loveshell/ngx_lua_waf\">https://github.com/loveshell/ngx_lua_waf</a><br>ngx_lua_wafgithubPull<br>requestsPull requests9Pull requests</p>\n<h2 id=\"waf-lua\"><a href=\"#waf-lua\" class=\"headerlink\" title=\"waf.lua\"></a>waf.lua</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">local content_length=tonumber(ngx.req.get_headers()[&#x27;content-length&#x27;])</span><br><span class=\"line\">local method=ngx.req.get_method()</span><br><span class=\"line\">--ngx_lua0.9.2ngx.re.find</span><br><span class=\"line\">local ngxmatch=ngx.re.match</span><br><span class=\"line\">--local ngxmatch=ngx.re.find</span><br><span class=\"line\">if whiteip() then</span><br><span class=\"line\">elseif whiteurl() then</span><br><span class=\"line\">elseif blockip() then</span><br><span class=\"line\">--ip</span><br><span class=\"line\">elseif denyhackip(1) then</span><br><span class=\"line\">elseif denycc() then</span><br><span class=\"line\">elseif ngx.var.http_Acunetix_Aspect then</span><br><span class=\"line\">    ngx.exit(444)</span><br><span class=\"line\">elseif ngx.var.http_X_Scan_Memo then</span><br><span class=\"line\">    ngx.exit(444)</span><br><span class=\"line\">elseif ua() then</span><br><span class=\"line\">elseif url() then</span><br><span class=\"line\">elseif args() then</span><br><span class=\"line\">elseif cookie() then</span><br><span class=\"line\">elseif PostCheck then</span><br><span class=\"line\">    if method==&quot;POST&quot; then</span><br><span class=\"line\">            local boundary = get_boundary()</span><br><span class=\"line\">\t    if boundary then</span><br><span class=\"line\">\t    local len = string.len</span><br><span class=\"line\">            local sock, err = ngx.req.socket()</span><br><span class=\"line\">    \t    if not sock then</span><br><span class=\"line\">\t\t\t\t\treturn</span><br><span class=\"line\">            end</span><br><span class=\"line\">\t    ngx.req.init_body(128 * 1024)</span><br><span class=\"line\">            sock:settimeout(0)</span><br><span class=\"line\">\t    local content_length = nil</span><br><span class=\"line\">    \t    content_length=tonumber(ngx.req.get_headers()[&#x27;content-length&#x27;])</span><br><span class=\"line\">    \t    local chunk_size = 4096</span><br><span class=\"line\">            if content_length &lt; chunk_size then</span><br><span class=\"line\">\t\t\t\t\tchunk_size = content_length</span><br><span class=\"line\">\t    end</span><br><span class=\"line\">            local size = 0</span><br><span class=\"line\">\t    while size &lt; content_length do</span><br><span class=\"line\">\t\tlocal data, err, partial = sock:receive(chunk_size)</span><br><span class=\"line\">\t\tdata = data or partial</span><br><span class=\"line\">\t\tif not data then</span><br><span class=\"line\">\t\t\treturn</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tngx.req.append_body(data)</span><br><span class=\"line\">        \tif body(data) then</span><br><span class=\"line\">\t   \t        return true</span><br><span class=\"line\">    \t    \tend</span><br><span class=\"line\">\t\tsize = size + len(data)</span><br><span class=\"line\">\t\tlocal m = ngxmatch(data,[[Content-Disposition: form-data;(.+)filename=&quot;(.+)\\.(.*)&quot;]],&#x27;ijo&#x27;)</span><br><span class=\"line\">        \tif m then</span><br><span class=\"line\">            \t\tfileExtCheck(m[3])</span><br><span class=\"line\">            \t\tfiletranslate = true</span><br><span class=\"line\">        \telse</span><br><span class=\"line\">            \t\tif ngxmatch(data,&quot;Content-Disposition:&quot;,&#x27;isjo&#x27;) then</span><br><span class=\"line\">                \t\tfiletranslate = false</span><br><span class=\"line\">            \t\tend</span><br><span class=\"line\">            \t\tif filetranslate==false then</span><br><span class=\"line\">            \t\t\tif body(data) then</span><br><span class=\"line\">                    \t\t\treturn true</span><br><span class=\"line\">                \t\tend</span><br><span class=\"line\">            \t\tend</span><br><span class=\"line\">        \tend</span><br><span class=\"line\">\t\tlocal less = content_length - size</span><br><span class=\"line\">\t\tif less &lt; chunk_size then</span><br><span class=\"line\">\t\t\tchunk_size = less</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t end</span><br><span class=\"line\">\t ngx.req.finish_body()</span><br><span class=\"line\">    else</span><br><span class=\"line\">\t\t\tngx.req.read_body()</span><br><span class=\"line\">\t\t\tlocal args = ngx.req.get_post_args()</span><br><span class=\"line\">\t\t\tif not args then</span><br><span class=\"line\">\t\t\t\treturn</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\tfor key, val in pairs(args) do</span><br><span class=\"line\">\t\t\t\tif type(val) == &quot;table&quot; then</span><br><span class=\"line\">\t\t\t\t\tif type(val[1]) == &quot;boolean&quot; then</span><br><span class=\"line\">\t\t\t\t\t\treturn</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\tdata=table.concat(val, &quot;, &quot;)</span><br><span class=\"line\">\t\t\t\telse</span><br><span class=\"line\">\t\t\t\t\tdata=val</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tif data and type(data) ~= &quot;boolean&quot; and body(data) then</span><br><span class=\"line\">                \t\t\tbody(key)</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\"></span><br><span class=\"line\">else</span><br><span class=\"line\">    return</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"socket-lua\"><a href=\"#socket-lua\" class=\"headerlink\" title=\"socket.lua\"></a>socket.lua</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- Copyright (C) 2013-2014 Jiale Zhi (calio), CloudFlare Inc.</span><br><span class=\"line\">--require &quot;luacov&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">local concat                = table.concat</span><br><span class=\"line\">local tcp                   = ngx.socket.tcp</span><br><span class=\"line\">local udp                   = ngx.socket.udp</span><br><span class=\"line\">local timer_at              = ngx.timer.at</span><br><span class=\"line\">local ngx_log               = ngx.log</span><br><span class=\"line\">local ngx_sleep             = ngx.sleep</span><br><span class=\"line\">local type                  = type</span><br><span class=\"line\">local pairs                 = pairs</span><br><span class=\"line\">local tostring              = tostring</span><br><span class=\"line\">local debug                 = ngx.config.debug</span><br><span class=\"line\"></span><br><span class=\"line\">local DEBUG                 = ngx.DEBUG</span><br><span class=\"line\">local CRIT                  = ngx.CRIT</span><br><span class=\"line\"></span><br><span class=\"line\">local MAX_PORT              = 65535</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-- table.new(narr, nrec)</span><br><span class=\"line\">local succ, new_tab = pcall(require, &quot;table.new&quot;)</span><br><span class=\"line\">if not succ then</span><br><span class=\"line\">    new_tab = function () return &#123;&#125; end</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local _M = new_tab(0, 5)</span><br><span class=\"line\"></span><br><span class=\"line\">local is_exiting</span><br><span class=\"line\"></span><br><span class=\"line\">if not ngx.config or not ngx.config.ngx_lua_version</span><br><span class=\"line\">    or ngx.config.ngx_lua_version &lt; 9003 then</span><br><span class=\"line\"></span><br><span class=\"line\">    is_exiting = function() return false end</span><br><span class=\"line\"></span><br><span class=\"line\">    ngx_log(CRIT, &quot;We strongly recommend you to update your ngx_lua module to &quot;</span><br><span class=\"line\">            .. &quot;0.9.3 or above. lua-resty-logger-socket will lose some log &quot;</span><br><span class=\"line\">            .. &quot;messages when Nginx reloads if it works with ngx_lua module &quot;</span><br><span class=\"line\">            .. &quot;below 0.9.3&quot;)</span><br><span class=\"line\">else</span><br><span class=\"line\">    is_exiting = ngx.worker.exiting</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">_M._VERSION = &#x27;0.03&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">-- user config</span><br><span class=\"line\">local flush_limit           = 4096         -- 4KB</span><br><span class=\"line\">local drop_limit            = 1048576      -- 1MB</span><br><span class=\"line\">local timeout               = 1000         -- 1 sec</span><br><span class=\"line\">local host</span><br><span class=\"line\">local port</span><br><span class=\"line\">local ssl                   = false</span><br><span class=\"line\">local ssl_verify            = true</span><br><span class=\"line\">local sni_host</span><br><span class=\"line\">local path</span><br><span class=\"line\">local max_buffer_reuse      = 10000        -- reuse buffer for at most 10000</span><br><span class=\"line\">                                           -- times</span><br><span class=\"line\">local periodic_flush        = nil</span><br><span class=\"line\">local need_periodic_flush   = nil</span><br><span class=\"line\">local sock_type             = &#x27;tcp&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">-- internal variables</span><br><span class=\"line\">local buffer_size           = 0</span><br><span class=\"line\">-- 2nd level buffer, it stores logs ready to be sent out</span><br><span class=\"line\">local send_buffer           = &quot;&quot;</span><br><span class=\"line\">-- 1st level buffer, it stores incoming logs</span><br><span class=\"line\">local log_buffer_data       = new_tab(20000, 0)</span><br><span class=\"line\">-- number of log lines in current 1st level buffer, starts from 0</span><br><span class=\"line\">local log_buffer_index      = 0</span><br><span class=\"line\"></span><br><span class=\"line\">local last_error</span><br><span class=\"line\"></span><br><span class=\"line\">local connecting</span><br><span class=\"line\">local connected</span><br><span class=\"line\">local exiting</span><br><span class=\"line\">local retry_connect         = 0</span><br><span class=\"line\">local retry_send            = 0</span><br><span class=\"line\">local max_retry_times       = 3</span><br><span class=\"line\">local retry_interval        = 100         -- 0.1s</span><br><span class=\"line\">local pool_size             = 10</span><br><span class=\"line\">local flushing</span><br><span class=\"line\">local logger_initted</span><br><span class=\"line\">local counter               = 0</span><br><span class=\"line\">local ssl_session</span><br><span class=\"line\"></span><br><span class=\"line\">local function _write_error(msg)</span><br><span class=\"line\">    last_error = msg</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _do_connect()</span><br><span class=\"line\">    local ok, err, sock</span><br><span class=\"line\"></span><br><span class=\"line\">    if not connected then</span><br><span class=\"line\">        if (sock_type == &#x27;udp&#x27;) then</span><br><span class=\"line\">            sock, err = udp()</span><br><span class=\"line\">        else</span><br><span class=\"line\">            sock, err = tcp()</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        if not sock then</span><br><span class=\"line\">            _write_error(err)</span><br><span class=\"line\">            return nil, err</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        sock:settimeout(timeout)</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    -- &quot;host&quot;/&quot;port&quot; and &quot;path&quot; have already been checked in init()</span><br><span class=\"line\">    if host and port then</span><br><span class=\"line\">        if (sock_type == &#x27;udp&#x27;) then</span><br><span class=\"line\">            ok, err = sock:setpeername(host, port)</span><br><span class=\"line\">        else</span><br><span class=\"line\">            ok, err = sock:connect(host, port)</span><br><span class=\"line\">        end</span><br><span class=\"line\">    elseif path then</span><br><span class=\"line\">        ok, err = sock:connect(&quot;unix:&quot; .. path)</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if not ok then</span><br><span class=\"line\">        return nil, err</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    return sock</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _do_handshake(sock)</span><br><span class=\"line\">    if not ssl then</span><br><span class=\"line\">        return sock</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    local session, err = sock:sslhandshake(ssl_session, sni_host or host,</span><br><span class=\"line\">                                           ssl_verify)</span><br><span class=\"line\">    if not session then</span><br><span class=\"line\">        return nil, err</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    ssl_session = session</span><br><span class=\"line\">    return sock</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _connect()</span><br><span class=\"line\">    local err, sock</span><br><span class=\"line\"></span><br><span class=\"line\">    if connecting then</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;previous connection not finished&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        return nil, &quot;previous connection not finished&quot;</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    connected = false</span><br><span class=\"line\">    connecting = true</span><br><span class=\"line\"></span><br><span class=\"line\">    retry_connect = 0</span><br><span class=\"line\"></span><br><span class=\"line\">    while retry_connect &lt;= max_retry_times do</span><br><span class=\"line\">        sock, err = _do_connect()</span><br><span class=\"line\"></span><br><span class=\"line\">        if sock then</span><br><span class=\"line\">            sock, err = _do_handshake(sock)</span><br><span class=\"line\">            if sock then</span><br><span class=\"line\">                connected = true</span><br><span class=\"line\">                break</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;reconnect to the log server: &quot;, err)</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        -- ngx.sleep time is in seconds</span><br><span class=\"line\">        if not exiting then</span><br><span class=\"line\">            ngx_sleep(retry_interval / 1000)</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        retry_connect = retry_connect + 1</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    connecting = false</span><br><span class=\"line\">    if not connected then</span><br><span class=\"line\">        return nil, &quot;try to connect to the log server failed after &quot;</span><br><span class=\"line\">                    .. max_retry_times .. &quot; retries: &quot; .. err</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    return sock</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _prepare_stream_buffer()</span><br><span class=\"line\">    local packet = concat(log_buffer_data, &quot;&quot;, 1, log_buffer_index)</span><br><span class=\"line\">    send_buffer = send_buffer .. packet</span><br><span class=\"line\"></span><br><span class=\"line\">    log_buffer_index = 0</span><br><span class=\"line\">    counter = counter + 1</span><br><span class=\"line\">    if counter &gt; max_buffer_reuse then</span><br><span class=\"line\">        log_buffer_data = new_tab(20000, 0)</span><br><span class=\"line\">        counter = 0</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;log buffer reuse limit (&quot; .. max_buffer_reuse</span><br><span class=\"line\">                    .. &quot;) reached, create a new \\&quot;log_buffer_data\\&quot;&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _do_flush()</span><br><span class=\"line\">    local ok, err, sock, bytes</span><br><span class=\"line\">    local packet = send_buffer</span><br><span class=\"line\"></span><br><span class=\"line\">    sock, err = _connect()</span><br><span class=\"line\">    if not sock then</span><br><span class=\"line\">        return nil, err</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    bytes, err = sock:send(packet)</span><br><span class=\"line\">    if not bytes then</span><br><span class=\"line\">        -- &quot;sock:send&quot; always closes current connection on error</span><br><span class=\"line\">        return nil, err</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if debug then</span><br><span class=\"line\">        ngx.update_time()</span><br><span class=\"line\">        ngx_log(DEBUG, ngx.now(), &quot;:log flush:&quot; .. bytes .. &quot;:&quot; .. packet)</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if (sock_type ~= &#x27;udp&#x27;) then</span><br><span class=\"line\">        ok, err = sock:setkeepalive(0, pool_size)</span><br><span class=\"line\">        if not ok then</span><br><span class=\"line\">            return nil, err</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    return bytes</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _need_flush()</span><br><span class=\"line\">    if buffer_size &gt; 0 then</span><br><span class=\"line\">        return true</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _flush_lock()</span><br><span class=\"line\">    if not flushing then</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;flush lock acquired&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        flushing = true</span><br><span class=\"line\">        return true</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _flush_unlock()</span><br><span class=\"line\">    if debug then</span><br><span class=\"line\">        ngx_log(DEBUG, &quot;flush lock released&quot;)</span><br><span class=\"line\">    end</span><br><span class=\"line\">    flushing = false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _flush()</span><br><span class=\"line\">    local err</span><br><span class=\"line\"></span><br><span class=\"line\">    -- pre check</span><br><span class=\"line\">    if not _flush_lock() then</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;previous flush not finished&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        -- do this later</span><br><span class=\"line\">        return true</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if not _need_flush() then</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;no need to flush:&quot;, log_buffer_index)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        _flush_unlock()</span><br><span class=\"line\">        return true</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    -- start flushing</span><br><span class=\"line\">    retry_send = 0</span><br><span class=\"line\">    if debug then</span><br><span class=\"line\">        ngx_log(DEBUG, &quot;start flushing&quot;)</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    local bytes</span><br><span class=\"line\">    while retry_send &lt;= max_retry_times do</span><br><span class=\"line\">        if log_buffer_index &gt; 0 then</span><br><span class=\"line\">            _prepare_stream_buffer()</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        bytes, err = _do_flush()</span><br><span class=\"line\"></span><br><span class=\"line\">        if bytes then</span><br><span class=\"line\">            break</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;resend log messages to the log server: &quot;, err)</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        -- ngx.sleep time is in seconds</span><br><span class=\"line\">        if not exiting then</span><br><span class=\"line\">            ngx_sleep(retry_interval / 1000)</span><br><span class=\"line\">        end</span><br><span class=\"line\"></span><br><span class=\"line\">        retry_send = retry_send + 1</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    _flush_unlock()</span><br><span class=\"line\"></span><br><span class=\"line\">    if not bytes then</span><br><span class=\"line\">        local err_msg = &quot;try to send log messages to the log server &quot;</span><br><span class=\"line\">                        .. &quot;failed after &quot; .. max_retry_times .. &quot; retries: &quot;</span><br><span class=\"line\">                        .. err</span><br><span class=\"line\">        _write_error(err_msg)</span><br><span class=\"line\">        return nil, err_msg</span><br><span class=\"line\">    else</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;send &quot; .. bytes .. &quot; bytes&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    buffer_size = buffer_size - #send_buffer</span><br><span class=\"line\">    send_buffer = &quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    return bytes</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _periodic_flush(premature)</span><br><span class=\"line\">    if premature then</span><br><span class=\"line\">        exiting = true</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if need_periodic_flush or exiting then</span><br><span class=\"line\">        -- no regular flush happened after periodic flush timer had been set</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;performing periodic flush&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        _flush()</span><br><span class=\"line\">    else</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;no need to perform periodic flush: regular flush &quot;</span><br><span class=\"line\">                    .. &quot;happened before&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        need_periodic_flush = true</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    timer_at(periodic_flush, _periodic_flush)</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _flush_buffer()</span><br><span class=\"line\">    local ok, err = timer_at(0, _flush)</span><br><span class=\"line\"></span><br><span class=\"line\">    need_periodic_flush = false</span><br><span class=\"line\"></span><br><span class=\"line\">    if not ok then</span><br><span class=\"line\">        _write_error(err)</span><br><span class=\"line\">        return nil, err</span><br><span class=\"line\">    end</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">local function _write_buffer(msg, len)</span><br><span class=\"line\">    log_buffer_index = log_buffer_index + 1</span><br><span class=\"line\">    log_buffer_data[log_buffer_index] = msg</span><br><span class=\"line\"></span><br><span class=\"line\">    buffer_size = buffer_size + len</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    return buffer_size</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function _M.init(user_config)</span><br><span class=\"line\">    if (type(user_config) ~= &quot;table&quot;) then</span><br><span class=\"line\">        return nil, &quot;user_config must be a table&quot;</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    for k, v in pairs(user_config) do</span><br><span class=\"line\">        if k == &quot;host&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;string&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;host&quot; must be a string&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            host = v</span><br><span class=\"line\">        elseif k == &quot;port&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;port&quot; must be a number&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            if v &lt; 0 or v &gt; MAX_PORT then</span><br><span class=\"line\">                return nil, (&#x27;&quot;port&quot; out of range 0~%s&#x27;):format(MAX_PORT)</span><br><span class=\"line\">            end</span><br><span class=\"line\">            port = v</span><br><span class=\"line\">        elseif k == &quot;path&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;string&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;path&quot; must be a string&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            path = v</span><br><span class=\"line\">        elseif k == &quot;sock_type&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;string&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;sock_type&quot; must be a string&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            if v ~= &quot;tcp&quot; and v ~= &quot;udp&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;sock_type&quot; must be &quot;tcp&quot; or &quot;udp&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            sock_type = v</span><br><span class=\"line\">        elseif k == &quot;flush_limit&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;flush_limit&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            flush_limit = v</span><br><span class=\"line\">        elseif k == &quot;drop_limit&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;drop_limit&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            drop_limit = v</span><br><span class=\"line\">        elseif k == &quot;timeout&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;timeout&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            timeout = v</span><br><span class=\"line\">        elseif k == &quot;max_retry_times&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;max_retry_times&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            max_retry_times = v</span><br><span class=\"line\">        elseif k == &quot;retry_interval&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;retry_interval&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            -- ngx.sleep time is in seconds</span><br><span class=\"line\">            retry_interval = v</span><br><span class=\"line\">        elseif k == &quot;pool_size&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;pool_size&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            pool_size = v</span><br><span class=\"line\">        elseif k == &quot;max_buffer_reuse&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;max_buffer_reuse&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            max_buffer_reuse = v</span><br><span class=\"line\">        elseif k == &quot;periodic_flush&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;number&quot; or v &lt; 0 then</span><br><span class=\"line\">                return nil, &#x27;invalid &quot;periodic_flush&quot;&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            periodic_flush = v</span><br><span class=\"line\">        elseif k == &quot;ssl&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;boolean&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;ssl&quot; must be a boolean value&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            ssl = v</span><br><span class=\"line\">        elseif k == &quot;ssl_verify&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;boolean&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;ssl_verify&quot; must be a boolean value&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            ssl_verify = v</span><br><span class=\"line\">        elseif k == &quot;sni_host&quot; then</span><br><span class=\"line\">            if type(v) ~= &quot;string&quot; then</span><br><span class=\"line\">                return nil, &#x27;&quot;sni_host&quot; must be a string&#x27;</span><br><span class=\"line\">            end</span><br><span class=\"line\">            sni_host = v</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if not (host and port) and not path then</span><br><span class=\"line\">        return nil, &quot;no logging server configured. \\&quot;host\\&quot;/\\&quot;port\\&quot; or &quot;</span><br><span class=\"line\">                .. &quot;\\&quot;path\\&quot; is required.&quot;</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    if (flush_limit &gt;= drop_limit) then</span><br><span class=\"line\">        return nil, &quot;\\&quot;flush_limit\\&quot; should be &lt; \\&quot;drop_limit\\&quot;&quot;</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    flushing = false</span><br><span class=\"line\">    exiting = false</span><br><span class=\"line\">    connecting = false</span><br><span class=\"line\"></span><br><span class=\"line\">    connected = false</span><br><span class=\"line\">    retry_connect = 0</span><br><span class=\"line\">    retry_send = 0</span><br><span class=\"line\"></span><br><span class=\"line\">    logger_initted = true</span><br><span class=\"line\"></span><br><span class=\"line\">    if periodic_flush then</span><br><span class=\"line\">        if debug then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;periodic flush enabled for every &quot;</span><br><span class=\"line\">                    .. periodic_flush .. &quot; seconds&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        need_periodic_flush = true</span><br><span class=\"line\">        timer_at(periodic_flush, _periodic_flush)</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    return logger_initted</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function _M.log(msg)</span><br><span class=\"line\">    if not logger_initted then</span><br><span class=\"line\">        return nil, &quot;not initialized&quot;</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    local bytes</span><br><span class=\"line\"></span><br><span class=\"line\">    if type(msg) ~= &quot;string&quot; then</span><br><span class=\"line\">        msg = tostring(msg)</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    local msg_len = #msg</span><br><span class=\"line\"></span><br><span class=\"line\">    if (debug) then</span><br><span class=\"line\">        ngx.update_time()</span><br><span class=\"line\">        ngx_log(DEBUG, ngx.now(), &quot;:log message length: &quot; .. msg_len)</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    -- response of &quot;_flush_buffer&quot; is not checked, because it writes</span><br><span class=\"line\">    -- error buffer</span><br><span class=\"line\">    if (is_exiting()) then</span><br><span class=\"line\">        exiting = true</span><br><span class=\"line\">        _write_buffer(msg, msg_len)</span><br><span class=\"line\">        _flush_buffer()</span><br><span class=\"line\">        if (debug) then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;Nginx worker is exiting&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        bytes = 0</span><br><span class=\"line\">    elseif (msg_len + buffer_size &lt; flush_limit) then</span><br><span class=\"line\">        _write_buffer(msg, msg_len)</span><br><span class=\"line\">        bytes = msg_len</span><br><span class=\"line\">    elseif (msg_len + buffer_size &lt;= drop_limit) then</span><br><span class=\"line\">        _write_buffer(msg, msg_len)</span><br><span class=\"line\">        _flush_buffer()</span><br><span class=\"line\">        bytes = msg_len</span><br><span class=\"line\">    else</span><br><span class=\"line\">        _flush_buffer()</span><br><span class=\"line\">        if (debug) then</span><br><span class=\"line\">            ngx_log(DEBUG, &quot;logger buffer is full, this log message will be &quot;</span><br><span class=\"line\">                    .. &quot;dropped&quot;)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        bytes = 0</span><br><span class=\"line\">        --- this log message doesn&#x27;t fit in buffer, drop it</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if last_error then</span><br><span class=\"line\">        local err = last_error</span><br><span class=\"line\">        last_error = nil</span><br><span class=\"line\">        return bytes, err</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    return bytes</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function _M.initted()</span><br><span class=\"line\">    return logger_initted</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">_M.flush = _flush</span><br><span class=\"line\"></span><br><span class=\"line\">return _M</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"init-lua\"><a href=\"#init-lua\" class=\"headerlink\" title=\"init.lua\"></a>init.lua</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">require &#x27;config&#x27;</span><br><span class=\"line\">local match = string.match</span><br><span class=\"line\">--ngx_lua0.9.2ngx.re.find</span><br><span class=\"line\">--nginxlua\\d\\w\\s</span><br><span class=\"line\">--local ngxmatch=ngx.re.match</span><br><span class=\"line\">local ngxmatch=ngx.re.find</span><br><span class=\"line\">local unescape=ngx.unescape_uri</span><br><span class=\"line\">local get_headers = ngx.req.get_headers</span><br><span class=\"line\">local optionIsOn = function (options) return options == &quot;on&quot; and true or false end</span><br><span class=\"line\">loghack=optionIsOn(loghack)</span><br><span class=\"line\">--socket.lualogsyslog</span><br><span class=\"line\">local logger = require &quot;socket&quot;</span><br><span class=\"line\">if loghack then</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tif not logger.initted() then</span><br><span class=\"line\">          local ok, err = logger.init&#123;</span><br><span class=\"line\">              --host = &#x27;192.168.0.1&#x27;,</span><br><span class=\"line\">              host = &#x27;logserver.local&#x27;,</span><br><span class=\"line\">              port = 514,</span><br><span class=\"line\">              sock_type = &quot;udp&quot;, --udp</span><br><span class=\"line\">              flush_limit = 1,\t--</span><br><span class=\"line\">              --drop_limit = 5678,</span><br><span class=\"line\">              pool_size = 100,--</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          if not ok then</span><br><span class=\"line\">              ngx.log(ngx.ERR, &quot;failed to initialize the logger: &quot;,</span><br><span class=\"line\">                      err)</span><br><span class=\"line\">              return</span><br><span class=\"line\">          end</span><br><span class=\"line\"> end</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">logpath = logdir</span><br><span class=\"line\">rulepath = RulePath</span><br><span class=\"line\">logtofile = optionIsOn(logtofile)</span><br><span class=\"line\">logtoserver = optionIsOn(logtoserver)</span><br><span class=\"line\">UrlDeny = optionIsOn(UrlDeny)</span><br><span class=\"line\">PostCheck = optionIsOn(postMatch)</span><br><span class=\"line\">CookieCheck = optionIsOn(cookieMatch)</span><br><span class=\"line\">WhiteCheck = optionIsOn(whiteModule)</span><br><span class=\"line\">PathInfoFix = optionIsOn(PathInfoFix)</span><br><span class=\"line\">attacklog = optionIsOn(attacklog)</span><br><span class=\"line\">hackipdeny = optionIsOn(hackipdeny)</span><br><span class=\"line\">CCDeny = optionIsOn(CCDeny)</span><br><span class=\"line\">Redirect=optionIsOn(Redirect)</span><br><span class=\"line\">local file = io.open(&#x27;config&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">function getClientIp()</span><br><span class=\"line\">        IP  = ngx.var.remote_addr</span><br><span class=\"line\">        if IP == nil then</span><br><span class=\"line\">                IP  = &quot;unknown&quot;</span><br><span class=\"line\">        end</span><br><span class=\"line\">        return IP</span><br><span class=\"line\">end</span><br><span class=\"line\">function write(logfile,msg)</span><br><span class=\"line\">    local fd = io.open(logfile,&quot;ab&quot;)</span><br><span class=\"line\">    if fd == nil then return end</span><br><span class=\"line\">    fd:write(msg)</span><br><span class=\"line\">    fd:flush()</span><br><span class=\"line\">    fd:close()</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function swrite(msg)</span><br><span class=\"line\">      --nginx error_log</span><br><span class=\"line\">\t\t\tngx.log(ngx.CRIT,msg)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function log(method,url,data,ruletag)</span><br><span class=\"line\">    if attacklog then</span><br><span class=\"line\">        local realIp = getClientIp()</span><br><span class=\"line\">        local ua = ngx.var.http_user_agent</span><br><span class=\"line\">        if ua == nil then</span><br><span class=\"line\">        \tua=&quot;null&quot;</span><br><span class=\"line\">        end</span><br><span class=\"line\">        local servername=ngx.var.host</span><br><span class=\"line\">        local time=ngx.localtime()</span><br><span class=\"line\">        if logtofile then</span><br><span class=\"line\">        local filename = logpath..&#x27;/&#x27;..servername..&quot;_&quot;..ngx.today()..&quot;_sec.log&quot;</span><br><span class=\"line\">        line=realIp..&quot; [&quot;..time..&quot;]&quot;..&quot;\\&quot;&quot;..method..&quot; &quot;..servername..url..&quot;\\&quot;&quot;..data..&quot;\\&quot;&quot;..ua..&quot;\\&quot;&quot;..ruletag..&quot;\\&quot;&quot;..&quot;\\n&quot;</span><br><span class=\"line\">        write(filename,line)</span><br><span class=\"line\">        end</span><br><span class=\"line\">        if logtoserver then</span><br><span class=\"line\">        line=realIp..&quot;\\&quot;&quot;..method..&quot; &quot;..servername..url..&quot;\\&quot;&quot;..data..&quot;\\&quot;&quot;..ua..&quot;\\&quot;&quot;..ruletag..&quot;\\&quot;&quot;</span><br><span class=\"line\">        --line=&quot;lua_waf:&quot;..line</span><br><span class=\"line\">        swrite(line)</span><br><span class=\"line\">        end</span><br><span class=\"line\">    --ipsyslog</span><br><span class=\"line\">    if loghack then  local bytes, err = logger.log(getClientIp()) end</span><br><span class=\"line\">\t\t--logdenyhackipip</span><br><span class=\"line\">\t\tif hackipdeny then  denyhackip(0) end</span><br><span class=\"line\">    end</span><br><span class=\"line\">end</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">function read_rule(var)</span><br><span class=\"line\">    file = io.open(rulepath..&#x27;/&#x27;..var,&quot;r&quot;)</span><br><span class=\"line\">    if file==nil then</span><br><span class=\"line\">        return</span><br><span class=\"line\">    end</span><br><span class=\"line\">    t = &#123;&#125;</span><br><span class=\"line\">    for line in file:lines() do</span><br><span class=\"line\">        table.insert(t,line)</span><br><span class=\"line\">    end</span><br><span class=\"line\">    file:close()</span><br><span class=\"line\">    return(t)</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">urlrules=read_rule(&#x27;url&#x27;)</span><br><span class=\"line\">argsrules=read_rule(&#x27;args&#x27;)</span><br><span class=\"line\">uarules=read_rule(&#x27;user-agent&#x27;)</span><br><span class=\"line\">wturlrules=read_rule(&#x27;whiteurl&#x27;)</span><br><span class=\"line\">postrules=read_rule(&#x27;post&#x27;)</span><br><span class=\"line\">ckrules=read_rule(&#x27;cookie&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">function say_html()</span><br><span class=\"line\">    if Redirect then</span><br><span class=\"line\">        ngx.header.content_type = &quot;text/html&quot;</span><br><span class=\"line\">        ngx.status = ngx.HTTP_FORBIDDEN</span><br><span class=\"line\">        ngx.say(html)</span><br><span class=\"line\">        ngx.exit(ngx.status)</span><br><span class=\"line\">    end</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function whiteurl()</span><br><span class=\"line\">    if WhiteCheck then</span><br><span class=\"line\">        if wturlrules ~=nil then</span><br><span class=\"line\">\t\t\t\t\t\tlocal urlpath = string.gsub(ngx.var.request_uri, &quot;?.*&quot;, &quot;&quot;)</span><br><span class=\"line\">            for _,rule in pairs(wturlrules) do</span><br><span class=\"line\">            --site:</span><br><span class=\"line\">\t            local sitemod,_=string.find(rule,&quot;site:&quot;)</span><br><span class=\"line\">\t        \t\tif sitemod==1 then</span><br><span class=\"line\">\t        \t\t\trule=string.gsub(rule,&quot;site:&quot;,&quot;&quot;,1)</span><br><span class=\"line\">\t        \t\t\t--whiteurl</span><br><span class=\"line\">\t        \t\t\t--if ngx.var.host==&#x27;domino.cqhrss.gov.cn&#x27; then</span><br><span class=\"line\">\t        \t\t\t--\tlog(&#x27;debug&#x27;,ngx.var.uri,&quot;&quot;,rule)</span><br><span class=\"line\">\t        \t\t\t--end</span><br><span class=\"line\">\t        \t\t\tif ngxmatch(ngx.var.host..ngx.var.uri,rule,&quot;isjo&quot;) then</span><br><span class=\"line\">                    return true</span><br><span class=\"line\">                end</span><br><span class=\"line\">\t        \t\telse</span><br><span class=\"line\">            \t\tif ngxmatch(ngx.var.uri,rule,&quot;isjo&quot;) then</span><br><span class=\"line\">                    return true</span><br><span class=\"line\">\t\t\t\t\t\t\t\telse</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tlocal pathmod,_=string.find(rule,&quot;path:&quot;)</span><br><span class=\"line\">\t\t\t        \t\tif pathmod==1 then</span><br><span class=\"line\">\t\t\t        \t\t\trule=string.gsub(rule,&quot;path:&quot;,&quot;&quot;,1)</span><br><span class=\"line\">\t\t\t        \t\t\tif urlpath==rule then</span><br><span class=\"line\">\t\t                    return true</span><br><span class=\"line\">\t\t                end</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tend</span><br><span class=\"line\">                end</span><br><span class=\"line\">            \tend</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function fileExtCheck(ext)</span><br><span class=\"line\">    local items = Set(black_fileExt)</span><br><span class=\"line\">    ext=string.lower(ext)</span><br><span class=\"line\">    if ext then</span><br><span class=\"line\">        for rule,_ in pairs(items) do</span><br><span class=\"line\">            if ngxmatch(ext,rule,&quot;isjo&quot;) then</span><br><span class=\"line\">            log(&#x27;POST&#x27;,ngx.var.request_uri,&quot;-&quot;,&quot;file attack with ext &quot;..ext)</span><br><span class=\"line\">            say_html()</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\">function Set (list)</span><br><span class=\"line\">  local set = &#123;&#125;</span><br><span class=\"line\">  for _, l in ipairs(list) do set[l] = true end</span><br><span class=\"line\">  return set</span><br><span class=\"line\">end</span><br><span class=\"line\">function args()</span><br><span class=\"line\">    for _,rule in pairs(argsrules) do</span><br><span class=\"line\">        local args = ngx.req.get_uri_args()</span><br><span class=\"line\">        for key, val in pairs(args) do</span><br><span class=\"line\">            if type(val)==&#x27;table&#x27; then</span><br><span class=\"line\">                 local t=&#123;&#125;</span><br><span class=\"line\">                 for k,v in pairs(val) do</span><br><span class=\"line\">                    if v == true then</span><br><span class=\"line\">                        v=&quot;&quot;</span><br><span class=\"line\">                    end</span><br><span class=\"line\">                    table.insert(t,v)</span><br><span class=\"line\">                end</span><br><span class=\"line\">                data=table.concat(t, &quot; &quot;)</span><br><span class=\"line\">            else</span><br><span class=\"line\">                data=val</span><br><span class=\"line\">            end</span><br><span class=\"line\">            if data and type(data) ~= &quot;boolean&quot; and rule ~=&quot;&quot; and ngxmatch(unescape(data),rule,&quot;isjo&quot;) then</span><br><span class=\"line\">                log(&#x27;GET&#x27;,ngx.var.request_uri,&quot;-&quot;,rule)</span><br><span class=\"line\">                say_html()</span><br><span class=\"line\">                return true</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">function url()</span><br><span class=\"line\">    if UrlDeny then</span><br><span class=\"line\">        for _,rule in pairs(urlrules) do</span><br><span class=\"line\">            if rule ~=&quot;&quot; and ngxmatch(ngx.var.request_uri,rule,&quot;isjo&quot;) then</span><br><span class=\"line\">                log(&#x27;GET&#x27;,ngx.var.request_uri,&quot;-&quot;,rule)</span><br><span class=\"line\">                say_html()</span><br><span class=\"line\">                return true</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function ua()</span><br><span class=\"line\">    local ua = ngx.var.http_user_agent</span><br><span class=\"line\">    if ua ~= nil then</span><br><span class=\"line\">        for _,rule in pairs(uarules) do</span><br><span class=\"line\">            if rule ~=&quot;&quot; and ngxmatch(ua,rule,&quot;isjo&quot;) then</span><br><span class=\"line\">                log(&#x27;UA&#x27;,ngx.var.request_uri,&quot;-&quot;,rule)</span><br><span class=\"line\">                say_html()</span><br><span class=\"line\">            return true</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\">function body(data)</span><br><span class=\"line\">    for _,rule in pairs(postrules) do</span><br><span class=\"line\">        if rule ~=&quot;&quot; and data~=&quot;&quot; and ngxmatch(unescape(data),rule,&quot;isjo&quot;) then</span><br><span class=\"line\">            log(&#x27;POST&#x27;,ngx.var.request_uri,data,rule)</span><br><span class=\"line\">            say_html()</span><br><span class=\"line\">            return true</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\">function cookie()</span><br><span class=\"line\">    local ck = ngx.var.http_cookie</span><br><span class=\"line\">    if CookieCheck and ck then</span><br><span class=\"line\">        for _,rule in pairs(ckrules) do</span><br><span class=\"line\">            if rule ~=&quot;&quot; and ngxmatch(ck,rule,&quot;isjo&quot;) then</span><br><span class=\"line\">                log(&#x27;Cookie&#x27;,ngx.var.request_uri,&quot;-&quot;,rule)</span><br><span class=\"line\">                say_html()</span><br><span class=\"line\">            return true</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function denycc()</span><br><span class=\"line\">    if CCDeny then</span><br><span class=\"line\">        local uri=ngx.var.uri</span><br><span class=\"line\">      \tlocal m, err = ngx.re.match(CCrate,&#x27;([0-9]+)/([0-9]+)/([0-9]+)&#x27;)</span><br><span class=\"line\">      \tlocal CCcount=tonumber(m[1]) --</span><br><span class=\"line\">        local CCseconds=tonumber(m[2]) --</span><br><span class=\"line\">        local CClimits=tonumber(m[3]) --</span><br><span class=\"line\">        local token = getClientIp()..uri</span><br><span class=\"line\">        local limit = ngx.shared.limit</span><br><span class=\"line\">        local req,_=limit:get(token) --</span><br><span class=\"line\"></span><br><span class=\"line\">        if req then</span><br><span class=\"line\">            if req &gt; CCcount then</span><br><span class=\"line\">                ngx.exit(404)</span><br><span class=\"line\">                return true</span><br><span class=\"line\">            else</span><br><span class=\"line\">            \t\tif req == CCcount then    limit:set(token,CCcount+1,CClimits)  end</span><br><span class=\"line\"></span><br><span class=\"line\">                limit:incr(token,1)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t--syslog</span><br><span class=\"line\">\t\t\t\t\t\t\t\t--swrite(&#x27;:&#x27;..token..&#x27;&#x27;..req..&#x27;:&#x27;..CClimits)</span><br><span class=\"line\"></span><br><span class=\"line\">            end</span><br><span class=\"line\">        else</span><br><span class=\"line\">            limit:set(token,1,CCseconds)</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">--chk1</span><br><span class=\"line\">function denyhackip(chk)</span><br><span class=\"line\">    if hackipdeny then</span><br><span class=\"line\"></span><br><span class=\"line\">       local m, err = ngx.re.match(hackrate,&#x27;([0-9]+)/([0-9]+)/([0-9]+)&#x27;)</span><br><span class=\"line\">      \tlocal hicount=tonumber(m[1]) --</span><br><span class=\"line\">        local hiseconds=tonumber(m[2]) --</span><br><span class=\"line\">        local hilimits=tonumber(m[3]) --</span><br><span class=\"line\">        local token = &quot;hackip&quot;..getClientIp()</span><br><span class=\"line\">        local limit = ngx.shared.limit</span><br><span class=\"line\">        local req,_=limit:get(token) --</span><br><span class=\"line\">        if req then</span><br><span class=\"line\">            if req &gt; hicount then</span><br><span class=\"line\">                ngx.exit(404)</span><br><span class=\"line\">                return true</span><br><span class=\"line\">            else</span><br><span class=\"line\"></span><br><span class=\"line\">            \t\tif req == hicount then</span><br><span class=\"line\">            \t\t\t\tlimit:set(token,hicount+1,hilimits)</span><br><span class=\"line\">            \t\t\t\tswrite(&quot;ip:&quot;..getClientIp()..&quot;&quot;..hilimits..&quot;&quot;)</span><br><span class=\"line\">            \t\t\t\tend</span><br><span class=\"line\">                 if chk ~=1 then limit:incr(token,1)      end</span><br><span class=\"line\">                --syslog</span><br><span class=\"line\">                --swrite(&quot;:&quot;..token..&quot;:&quot;..chk..&quot;&quot;..req..&quot;:&quot;..hilimits)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            end</span><br><span class=\"line\">        else</span><br><span class=\"line\">        \t\tif chk ~=1 then limit:set(token,1,hiseconds) \tend</span><br><span class=\"line\"></span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">    return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function get_boundary()</span><br><span class=\"line\">    local header = get_headers()[&quot;content-type&quot;]</span><br><span class=\"line\">    if not header then</span><br><span class=\"line\">        return nil</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    if type(header) == &quot;table&quot; then</span><br><span class=\"line\">        header = header[1]</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    local m = match(header, &quot;;%s*boundary=\\&quot;([^\\&quot;]+)\\&quot;&quot;)</span><br><span class=\"line\">    if m then</span><br><span class=\"line\">        return m</span><br><span class=\"line\">    end</span><br><span class=\"line\"></span><br><span class=\"line\">    return match(header, &quot;;%s*boundary=([^\\&quot;,;]+)&quot;)</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function whiteip()</span><br><span class=\"line\">    if next(ipWhitelist) ~= nil then</span><br><span class=\"line\">        for _,ip in pairs(ipWhitelist) do</span><br><span class=\"line\">            if getClientIp()==ip then</span><br><span class=\"line\">                return true</span><br><span class=\"line\">            end</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end</span><br><span class=\"line\">        return false</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">function blockip()</span><br><span class=\"line\">     if next(ipBlocklist) ~= nil then</span><br><span class=\"line\">         for _,ip in pairs(ipBlocklist) do</span><br><span class=\"line\">             if getClientIp()==ip then</span><br><span class=\"line\">                 ngx.exit(403)</span><br><span class=\"line\">                 return true</span><br><span class=\"line\">             end</span><br><span class=\"line\">         end</span><br><span class=\"line\">     end</span><br><span class=\"line\">         return false</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"config-lua\"><a href=\"#config-lua\" class=\"headerlink\" title=\"config.lua\"></a>config.lua</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RulePath = &quot;/usr/local/nginx/conf/waf/wafconf/&quot;</span><br><span class=\"line\">attacklog = &quot;on&quot;</span><br><span class=\"line\">--</span><br><span class=\"line\">logtofile = &quot;on&quot;</span><br><span class=\"line\">logdir = &quot;/site/wwwlogs/waf/&quot;</span><br><span class=\"line\">--syslog,nginx</span><br><span class=\"line\">logtoserver = &quot;off&quot;</span><br><span class=\"line\">--sysloghack_ip</span><br><span class=\"line\">loghack=&quot;off&quot;</span><br><span class=\"line\">UrlDeny=&quot;on&quot;</span><br><span class=\"line\">Redirect=&quot;on&quot;</span><br><span class=\"line\">CookieMatch=&quot;on&quot;</span><br><span class=\"line\">postMatch=&quot;on&quot;</span><br><span class=\"line\">whiteModule=&quot;on&quot;</span><br><span class=\"line\">black_fileExt=&#123;&quot;php&quot;,&quot;jsp&quot;&#125;</span><br><span class=\"line\">ipWhitelist=&#123;&quot;127.0.0.1&quot;,&quot;192.168.2.1&quot;&#125;</span><br><span class=\"line\">ipBlocklist=&#123;&quot;1.0.0.1&quot;&#125;</span><br><span class=\"line\">--ip</span><br><span class=\"line\">--hackrate10/5,1800</span><br><span class=\"line\">hackipdeny=&quot;on&quot;</span><br><span class=\"line\">hackrate=&quot;10/60/1800&quot;</span><br><span class=\"line\">--cc</span><br><span class=\"line\">CCDeny=&quot;on&quot;</span><br><span class=\"line\">CCrate=&quot;30/60/30&quot;</span><br><span class=\"line\">html=[[</span><br><span class=\"line\">&lt;html&gt;&lt;head&gt;</span><br><span class=\"line\">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;</span><br><span class=\"line\">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;&lt;/title&gt;</span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">p &#123;line-height:20px;&#125;</span><br><span class=\"line\">ul&#123; list-style-type:none;&#125;</span><br><span class=\"line\">li&#123; list-style-type:none;&#125;</span><br><span class=\"line\">body&#123;padding:0; margin:0; font:14px/1.5 Microsoft Yahei, ,sans-serif; color:#555;&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\"> &lt;div style=&quot;margin: 0 auto; max-width:1000px; padding-top:70px; overflow:hidden;&quot;&gt;</span><br><span class=\"line\">  &lt;div style=&quot;padding:0 15px;&quot;&gt;</span><br><span class=\"line\">    &lt;div style=&quot; height:40px; line-height:40px; color:#fff; font-size:16px; overflow:hidden; background:#6bb3f6; padding-left:20px;&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">    &lt;div style=&quot;border:1px dashed #cdcece; border-top:none; font-size:14px; background:#fff; color:#555; line-height:24px; height:220px; padding:20px 20px 0 20px; overflow-y:auto;background:#f3f7f9;&quot;&gt;</span><br><span class=\"line\">      &lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;&lt;span style=&quot; font-weight:600; color:#fc4f03;&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span><br><span class=\"line\">&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;&lt;/p&gt;</span><br><span class=\"line\">&lt;p style=&quot; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;&quot;&gt;&lt;/p&gt;</span><br><span class=\"line\">&lt;ul style=&quot;margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;&quot;&gt;&lt;li style=&quot; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;1&lt;/li&gt;</span><br><span class=\"line\">&lt;li style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;2&lt;/li&gt;</span><br><span class=\"line\">&lt;li style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;3&lt;/li&gt;&lt;/ul&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\">&lt;/body&gt;&lt;/html&gt;</span><br><span class=\"line\">]]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"whiteurl\"><a href=\"#whiteurl\" class=\"headerlink\" title=\"whiteurl\"></a>whiteurl</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">^/zhaonvpengyou</span><br><span class=\"line\">site:^lianxiwo\\.com/</span><br><span class=\"line\">path:/wogeiniliuyi.html</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>s<br><a href=\"https://github.com/loveshell/ngx_lua_waf/pull/136%E4%BF%AE%E6%94%B9%EF%BC%8C%E7%84%B6%E5%90%8E%E4%BE%9D%E8%99%8E%E7%94%BB%E7%8C%AB%EF%BC%8C%E5%A2%9E%E5%8A%A0%E4%BA%86%E4%B8%80%E4%B8%AA%E5%88%A4%E6%96%ADrequest_uri%E7%9A%84%E5%B0%8F%E5%8A%9F%E8%83%BD%EF%BC%81\">https://github.com/loveshell/ngx_lua_waf/pull/136request_uri</a></p>\n"},{"title":"Google Chrome","date":"2018-10-28T14:20:13.000Z","url":"install-google-chrome-local-extensions","description":"Google ChromeGoogleGoogle ChromeGoogle Chrome","_content":"\n> Google ChromeGoogleGoogle ChromeGoogle Chrome\n\n## \n\nGoogleGoogle\nChrome\n\n## Windows\n\nGoogle Chrome\n\n 1. Google\n    Chromechrome://extensions\n 2. crxID\n 3. http://www.chromium.org/administrators/policy-templates  [](https://dl.google.com/dl/edgedl/chrome/policy/policy_templates.zip)windowsadmchrome.admgpedit.mscenter\n 4. /(A)/chrome.adm\n 5. --ADM-Google-Google Chrome-2ID\n 6. Google Chrome\n\n## Mac\n\n22\n\n## Linux\n\nwindows12<http://www.chromium.org/administrators/policy-templates>","source":"_posts/Google Chrome.md","raw":"---\ntitle: Google Chrome\ndate: 2018-10-28 22:20:13\ntags: \n  - google chrome\ncategories:\n  - \nurl: install-google-chrome-local-extensions\ndescription: Google ChromeGoogleGoogle ChromeGoogle Chrome\n---\n\n> Google ChromeGoogleGoogle ChromeGoogle Chrome\n\n## \n\nGoogleGoogle\nChrome\n\n## Windows\n\nGoogle Chrome\n\n 1. Google\n    Chromechrome://extensions\n 2. crxID\n 3. http://www.chromium.org/administrators/policy-templates  [](https://dl.google.com/dl/edgedl/chrome/policy/policy_templates.zip)windowsadmchrome.admgpedit.mscenter\n 4. /(A)/chrome.adm\n 5. --ADM-Google-Google Chrome-2ID\n 6. Google Chrome\n\n## Mac\n\n22\n\n## Linux\n\nwindows12<http://www.chromium.org/administrators/policy-templates>","slug":"Google Chrome","published":1,"updated":"2022-05-12T17:06:34.355Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6au8000plvtd3kjt1zbq","content":"<blockquote>\n<p>Google ChromeGoogleGoogle ChromeGoogle Chrome</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>GoogleGoogle<br>Chrome</p>\n<h2 id=\"Windows\"><a href=\"#Windows\" class=\"headerlink\" title=\"Windows\"></a>Windows</h2><p>Google Chrome</p>\n<ol>\n<li>Google<br>Chromechrome:&#x2F;&#x2F;extensions</li>\n<li>crxID</li>\n<li><a href=\"http://www.chromium.org/administrators/policy-templates\">http://www.chromium.org/administrators/policy-templates</a>  <a href=\"https://dl.google.com/dl/edgedl/chrome/policy/policy_templates.zip\"></a>windowsadmchrome.admgpedit.mscenter</li>\n<li>&#x2F;(A)&#x2F;chrome.adm</li>\n<li>--ADM-Google-Google Chrome-2ID</li>\n<li>Google Chrome</li>\n</ol>\n<h2 id=\"Mac\"><a href=\"#Mac\" class=\"headerlink\" title=\"Mac\"></a>Mac</h2><p>22</p>\n<h2 id=\"Linux\"><a href=\"#Linux\" class=\"headerlink\" title=\"Linux\"></a>Linux</h2><p>windows12<a href=\"http://www.chromium.org/administrators/policy-templates\">http://www.chromium.org/administrators/policy-templates</a></p>\n","site":{"data":{}},"length":1212,"excerpt":"","more":"<blockquote>\n<p>Google ChromeGoogleGoogle ChromeGoogle Chrome</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>GoogleGoogle<br>Chrome</p>\n<h2 id=\"Windows\"><a href=\"#Windows\" class=\"headerlink\" title=\"Windows\"></a>Windows</h2><p>Google Chrome</p>\n<ol>\n<li>Google<br>Chromechrome:&#x2F;&#x2F;extensions</li>\n<li>crxID</li>\n<li><a href=\"http://www.chromium.org/administrators/policy-templates\">http://www.chromium.org/administrators/policy-templates</a>  <a href=\"https://dl.google.com/dl/edgedl/chrome/policy/policy_templates.zip\"></a>windowsadmchrome.admgpedit.mscenter</li>\n<li>&#x2F;(A)&#x2F;chrome.adm</li>\n<li>--ADM-Google-Google Chrome-2ID</li>\n<li>Google Chrome</li>\n</ol>\n<h2 id=\"Mac\"><a href=\"#Mac\" class=\"headerlink\" title=\"Mac\"></a>Mac</h2><p>22</p>\n<h2 id=\"Linux\"><a href=\"#Linux\" class=\"headerlink\" title=\"Linux\"></a>Linux</h2><p>windows12<a href=\"http://www.chromium.org/administrators/policy-templates\">http://www.chromium.org/administrators/policy-templates</a></p>\n"},{"title":"ipsetiptables","date":"2018-01-12T23:10:00.000Z","url":"talking-about-iptables-and-ipset","description":"ipsetIPipsetiptables","_content":"\n> ipsetIPipsetiptables\n\n\n## iptables\n\n[centos7iptables](/install-iptables-as-firewall-on-centos7)\n\n## ipset\n\n```\nyum -y install ipset\n```\n\n\n## \n\n```\nwget ftp://ftp.pbone.net/mirror/ftp5.gwdg.de/pub/opensuse/repositories/home:/mludvig:/elml/CentOS_CentOS-6/noarch/ipset-init-1.0-10.1.noarch.rpm\nrpm -ivh ipset-init-1.0-10.1.noarch.rpm\n```\n\nipset-initcentos6.5ipsetinit.dipset-init\n\n```\n/etc/rc.d/init.d/ipset\n/etc/sysconfig/ipset\n/etc/sysconfig/ipset-config\n```\n\nchkconfig\n\n\n```\nchkconfig --add ipset\n```\n\n## ipset\n\nipset\n\n```\nipset create babe hash:ip hashsize 1024 maxelem 1000000 timeout 86400\nservice ipset save\n```\n\nbabehash,ipset\n--helphashsizemaxelemtimeouthashtimeout\n\nIPipset\n\n```\nipset add babe 1.1.1.1 timeout 3600\n```\n\ntimeoutIPtimeout\n\n```\nipset add babe 1.1.1.1\n```\n\n\n\n```\nservice ipset save\n```\n\nipsethash\n/data/some/block.listIPIPipsetbabe\nblock.sh/data/some/block.sh\n\n```\ngrep -o '[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}' /data/some/block.list | awk '{print \"ipset add bklist\",$0}'|sh\nservice ipset save\nservice iptables reload\n```\n\n\n\n```\ncrontab -e\n0,30 */1 * * * /data/some/block.sh > /dev/null 2>&1\n```\n\n\n\n## iptables\n\n\n\n```\niptables -I INPUT -m set --match-set babe src -j DROP\n```\n\n\n\n```\niptables -I INPUT -m set ! --match-set babe src -j DROP\n```\n\n\n\n```\nservice iptables save\nservice iptables reload\n```","source":"_posts/ipsetiptables.md","raw":"---\ntitle: ipsetiptables\ndate: 2018-01-13 07:10:00\ntags: \n  - ipset\n  - iptables\n  - \ncategories:\n  - \nurl: talking-about-iptables-and-ipset\ndescription: ipsetIPipsetiptables\n---\n\n> ipsetIPipsetiptables\n\n\n## iptables\n\n[centos7iptables](/install-iptables-as-firewall-on-centos7)\n\n## ipset\n\n```\nyum -y install ipset\n```\n\n\n## \n\n```\nwget ftp://ftp.pbone.net/mirror/ftp5.gwdg.de/pub/opensuse/repositories/home:/mludvig:/elml/CentOS_CentOS-6/noarch/ipset-init-1.0-10.1.noarch.rpm\nrpm -ivh ipset-init-1.0-10.1.noarch.rpm\n```\n\nipset-initcentos6.5ipsetinit.dipset-init\n\n```\n/etc/rc.d/init.d/ipset\n/etc/sysconfig/ipset\n/etc/sysconfig/ipset-config\n```\n\nchkconfig\n\n\n```\nchkconfig --add ipset\n```\n\n## ipset\n\nipset\n\n```\nipset create babe hash:ip hashsize 1024 maxelem 1000000 timeout 86400\nservice ipset save\n```\n\nbabehash,ipset\n--helphashsizemaxelemtimeouthashtimeout\n\nIPipset\n\n```\nipset add babe 1.1.1.1 timeout 3600\n```\n\ntimeoutIPtimeout\n\n```\nipset add babe 1.1.1.1\n```\n\n\n\n```\nservice ipset save\n```\n\nipsethash\n/data/some/block.listIPIPipsetbabe\nblock.sh/data/some/block.sh\n\n```\ngrep -o '[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}' /data/some/block.list | awk '{print \"ipset add bklist\",$0}'|sh\nservice ipset save\nservice iptables reload\n```\n\n\n\n```\ncrontab -e\n0,30 */1 * * * /data/some/block.sh > /dev/null 2>&1\n```\n\n\n\n## iptables\n\n\n\n```\niptables -I INPUT -m set --match-set babe src -j DROP\n```\n\n\n\n```\niptables -I INPUT -m set ! --match-set babe src -j DROP\n```\n\n\n\n```\nservice iptables save\nservice iptables reload\n```","slug":"ipsetiptables","published":1,"updated":"2022-05-12T17:07:02.795Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6aua000slvtd2tmwdch4","content":"<blockquote>\n<p>ipsetIPipsetiptables</p>\n</blockquote>\n<h2 id=\"iptables\"><a href=\"#iptables\" class=\"headerlink\" title=\"iptables\"></a>iptables</h2><p><a href=\"/install-iptables-as-firewall-on-centos7\">centos7iptables</a></p>\n<h2 id=\"ipset\"><a href=\"#ipset\" class=\"headerlink\" title=\"ipset\"></a>ipset</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install ipset</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget ftp://ftp.pbone.net/mirror/ftp5.gwdg.de/pub/opensuse/repositories/home:/mludvig:/elml/CentOS_CentOS-6/noarch/ipset-init-1.0-10.1.noarch.rpm</span><br><span class=\"line\">rpm -ivh ipset-init-1.0-10.1.noarch.rpm</span><br></pre></td></tr></table></figure>\n\n<p>ipset-initcentos6.5ipsetinit.dipset-init</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/rc.d/init.d/ipset</span><br><span class=\"line\">/etc/sysconfig/ipset</span><br><span class=\"line\">/etc/sysconfig/ipset-config</span><br></pre></td></tr></table></figure>\n\n<p>chkconfig</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chkconfig --add ipset</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ipset\"><a href=\"#ipset\" class=\"headerlink\" title=\"ipset\"></a>ipset</h2><p>ipset</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipset create babe hash:ip hashsize 1024 maxelem 1000000 timeout 86400</span><br><span class=\"line\">service ipset save</span><br></pre></td></tr></table></figure>\n\n<p>babehash,ipset<br>helphashsizemaxelemtimeouthashtimeout</p>\n<p>IPipset</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipset add babe 1.1.1.1 timeout 3600</span><br></pre></td></tr></table></figure>\n\n<p>timeoutIPtimeout</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipset add babe 1.1.1.1</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service ipset save</span><br></pre></td></tr></table></figure>\n\n<p>ipsethash<br>&#x2F;data&#x2F;some&#x2F;block.listIPIPipsetbabe<br>block.sh&#x2F;data&#x2F;some&#x2F;block.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep -o &#x27;[0-9]\\&#123;1,3\\&#125;\\.[0-9]\\&#123;1,3\\&#125;\\.[0-9]\\&#123;1,3\\&#125;\\.[0-9]\\&#123;1,3\\&#125;&#x27; /data/some/block.list | awk &#x27;&#123;print &quot;ipset add bklist&quot;,$0&#125;&#x27;|sh</span><br><span class=\"line\">service ipset save</span><br><span class=\"line\">service iptables reload</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -e</span><br><span class=\"line\">0,30 */1 * * * /data/some/block.sh &gt; /dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h2 id=\"iptables\"><a href=\"#iptables\" class=\"headerlink\" title=\"iptables\"></a>iptables</h2><p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -I INPUT -m set --match-set babe src -j DROP</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -I INPUT -m set ! --match-set babe src -j DROP</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service iptables save</span><br><span class=\"line\">service iptables reload</span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":1666,"excerpt":"","more":"<blockquote>\n<p>ipsetIPipsetiptables</p>\n</blockquote>\n<h2 id=\"iptables\"><a href=\"#iptables\" class=\"headerlink\" title=\"iptables\"></a>iptables</h2><p><a href=\"/install-iptables-as-firewall-on-centos7\">centos7iptables</a></p>\n<h2 id=\"ipset\"><a href=\"#ipset\" class=\"headerlink\" title=\"ipset\"></a>ipset</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install ipset</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget ftp://ftp.pbone.net/mirror/ftp5.gwdg.de/pub/opensuse/repositories/home:/mludvig:/elml/CentOS_CentOS-6/noarch/ipset-init-1.0-10.1.noarch.rpm</span><br><span class=\"line\">rpm -ivh ipset-init-1.0-10.1.noarch.rpm</span><br></pre></td></tr></table></figure>\n\n<p>ipset-initcentos6.5ipsetinit.dipset-init</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/rc.d/init.d/ipset</span><br><span class=\"line\">/etc/sysconfig/ipset</span><br><span class=\"line\">/etc/sysconfig/ipset-config</span><br></pre></td></tr></table></figure>\n\n<p>chkconfig</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chkconfig --add ipset</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ipset\"><a href=\"#ipset\" class=\"headerlink\" title=\"ipset\"></a>ipset</h2><p>ipset</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipset create babe hash:ip hashsize 1024 maxelem 1000000 timeout 86400</span><br><span class=\"line\">service ipset save</span><br></pre></td></tr></table></figure>\n\n<p>babehash,ipset<br>helphashsizemaxelemtimeouthashtimeout</p>\n<p>IPipset</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipset add babe 1.1.1.1 timeout 3600</span><br></pre></td></tr></table></figure>\n\n<p>timeoutIPtimeout</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipset add babe 1.1.1.1</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service ipset save</span><br></pre></td></tr></table></figure>\n\n<p>ipsethash<br>&#x2F;data&#x2F;some&#x2F;block.listIPIPipsetbabe<br>block.sh&#x2F;data&#x2F;some&#x2F;block.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep -o &#x27;[0-9]\\&#123;1,3\\&#125;\\.[0-9]\\&#123;1,3\\&#125;\\.[0-9]\\&#123;1,3\\&#125;\\.[0-9]\\&#123;1,3\\&#125;&#x27; /data/some/block.list | awk &#x27;&#123;print &quot;ipset add bklist&quot;,$0&#125;&#x27;|sh</span><br><span class=\"line\">service ipset save</span><br><span class=\"line\">service iptables reload</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -e</span><br><span class=\"line\">0,30 */1 * * * /data/some/block.sh &gt; /dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h2 id=\"iptables\"><a href=\"#iptables\" class=\"headerlink\" title=\"iptables\"></a>iptables</h2><p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -I INPUT -m set --match-set babe src -j DROP</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -I INPUT -m set ! --match-set babe src -j DROP</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service iptables save</span><br><span class=\"line\">service iptables reload</span><br></pre></td></tr></table></figure>"},{"title":"sshLinux","date":"2018-02-04T23:26:00.000Z","url":"logining-ssh-without-password-on-linux","description":"sshLinux","_content":"\n> sshLinux\n\n## \n\n\n\n## .ssh\n\n.ssh700authorized_keys600.sshid_rsa\n\n## \n\n.sshauthorized_keys\n\n## \n\n[Google AuthenticatorLinux SSH](/login-ssh-with-2fa-authentication-by-google-authencator)SSHdenyhosts","source":"_posts/sshLinux.md","raw":"---\ntitle: sshLinux\ndate: 2018-02-05 07:26:00\ntags: \n  - ssh\ncategories:\n  - \nurl: logining-ssh-without-password-on-linux\ndescription: sshLinux\n---\n\n> sshLinux\n\n## \n\n\n\n## .ssh\n\n.ssh700authorized_keys600.sshid_rsa\n\n## \n\n.sshauthorized_keys\n\n## \n\n[Google AuthenticatorLinux SSH](/login-ssh-with-2fa-authentication-by-google-authencator)SSHdenyhosts","slug":"sshLinux","published":1,"updated":"2022-05-12T17:06:53.924Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6auc000ulvtde4mmh7h4","content":"<blockquote>\n<p>sshLinux</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<h2 id=\"ssh\"><a href=\"#ssh\" class=\"headerlink\" title=\".ssh\"></a>.ssh</h2><p>.ssh700authorized_keys600.sshid_rsa</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>.sshauthorized_keys</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"/login-ssh-with-2fa-authentication-by-google-authencator\">Google AuthenticatorLinux SSH</a>SSHdenyhosts</p>\n","site":{"data":{}},"length":753,"excerpt":"","more":"<blockquote>\n<p>sshLinux</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<h2 id=\"ssh\"><a href=\"#ssh\" class=\"headerlink\" title=\".ssh\"></a>.ssh</h2><p>.ssh700authorized_keys600.sshid_rsa</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>.sshauthorized_keys</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"/login-ssh-with-2fa-authentication-by-google-authencator\">Google AuthenticatorLinux SSH</a>SSHdenyhosts</p>\n"},{"title":"inotify+rsync","date":"2018-10-29T08:48:47.000Z","url":"sync-data-realtime-with-inotify-rsync","description":"inotify+rsync","_content":"\n> inotify+rsync\n\nAIP192.168.1.1\nBIP192.168.1.2\nCentos 7.3 64bit\n\n## rsync\n\n```\nrpm -qa|grep rsync #rsyncwhereis rsync\nyum install rsync -y #yumrsync\n```\n\n\nABrsyncCentosrsyncrsync --versionrsync -h\n\n## Ainotify\n\n```\nwget http://cloud.github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz  \ntar zxvf inotify-tools-3.14.tar.gz  \ncd inotify-tools-3.14  \n./configure --prefix=/usr/local/inotify  \nmake  \nmake install\n```\n\n\n## Arsync\n\n```\nmkdir -p /usr/local/rsync\ntouch /usr/local/rsync/exclude.list\necho 'testpassword' >/usr/local/rsync/rsync.passwd\nchmod 600 /usr/local/rsync/rsync.passwd\n```\n\n\nexclude.listrsync.passwd\n\n## Brsync\n\n```\nmkdir -p /usr/local/rsync\necho 'user:testpassword' >/usr/local/rsync/rsync.passwd\nchmod 600 /usr/local/rsync/rsync.passwd\ntouch /usr/local/rsync/rsync.conf\n```\n\nrsync.passwdusertestpasswordtestpasswordArsync.passwdrsync.conf\n\n```\npid file = /var/run/rsyncd.pid  \nlock file = /var/run/rsync.lock  \nlog file = /var/log/rsyncd.log \nport = 873\naddress = 192.168.1.2\nsecrets file=/usr/local/rsync/rsync.passwd\nuid = root\ngid = root\nuse chroot = yes\nread only = no\nwrite only = no\n#rsyncdipipip\nhosts allow = 192.168.1.1\n#rsyncdip*(hosts allowiphosts allow)\nhosts deny = *\n#\nmax connections = 5\n#\n#    log file rsyncsyslogsyslog\n#    transfer logging \n#    log format google\n#    syslog facility rsyncsyslog\n#    timeout\nlog file = /usr/local/logs/rsync.log\ntransfer logging = yes\nlog format = %t %a %m %f %b\nsyslog facility = local3\ntimeout = 300\n[leo]\n# B\npath=/data/leo/\n#\nlist=yes\n#\nignore errors\n#\nauth users = user\n#\ncomment = some description about this moudle\n# A\n#exclude = test1/ test2/\n```\n\n\n\n\n```\nuid = root \ngid = root \nuse chroot = no \nmax connections = 10 \nstrict modes = yes \npid file = /var/run/rsyncd.pid  \nlock file = /var/run/rsync.lock  \nlog file = /var/log/rsyncd.log  \n[leo]  \npath = /data/leo/  \ncomment = backup wwwroot  \nignore errors  \nread only = no \nwrite only = no \nhosts allow = 192.168.1.1  \nhosts deny = *  \nlist = false \nuid = root \ngid = root \nauth users = user\nsecrets file = /usr/local/rsync/rsync.passwd\n```\n\n## Brsync\n\n```\n/usr/bin/rsync --daemon --config=/usr/local/rsync/rsync.conf\n```\n\n\nBrsync/etc/rc.local\n\n```\necho '/usr/bin/rsync --daemon --config=/usr/local/rsync/rsync.conf' >> /etc/rc.local\nchmod +x /etc/rc.local\n```\n\nchmod +x /etc/rc.localnetstat -an | grep 873 rsync\n\n## Brsync\n\n```\niptables -I INPUT 3 -p tcp -m state --state NEW  -m tcp --dport 873 -j ACCEPT\nservice iptables save\nservice iptables reload\n```\n\n\n## A\n\n/data/leo/data/leo/root/data/leo/sh.sh\n/data/leorsync.sh\n\n```\n#!/bin/bash\nhost=192.168.1.2\nsrc=/data/leo/\ndes=leo\nuser=user\n/usr/local/inotify/bin/inotifywait -mrq --timefmt '%d/%m/%y %H:%M' --format '%T %w%f%e' -e modify,delete,create,attrib $src | while read files\ndo\n/usr/bin/rsync -vzrtopg --delete --progress --exclude-from=/usr/local/rsync/exclude.list --password-file=/usr/local/rsync/rsync.passwd $src $user@$host::$des\necho \"${files} was rsynced\" >>/data/wwwlogs/rsync.log 2>&1\ndone\n```\n\nhostBIPsrcAdesB/usr/local/rsync/rsync.conf[leo]leoBAB--delete\n\n/data/leo/root/data/leo/sh.sh\n\n```\necho 'root/' >> /usr/local/rsync/exclude.list\necho 'sh.sh' >>/usr/local/rsync/exclude.list\n```\n\n\n\n## A\n\n```\necho 'bash /data/leo/rsync.sh &' >> /etc/rc.local\nchmod +x /etc/rc.local\nchmod 744 /data/leo/rsync.sh\n```\n\n\n## \n\n1.rsync: failed to connect to X.X.X.X: No route to host\nB873AB\n\n2.rsync failed Connection refused 111\nBrsync","source":"_posts/inotify+rsync.md","raw":"---\ntitle: inotify+rsync\ndate: 2018-10-29 16:48:47\ntags: \n  - inotify\n  - rsync\n  - \ncategories:\n  - \nurl: sync-data-realtime-with-inotify-rsync\ndescription: inotify+rsync\n---\n\n> inotify+rsync\n\nAIP192.168.1.1\nBIP192.168.1.2\nCentos 7.3 64bit\n\n## rsync\n\n```\nrpm -qa|grep rsync #rsyncwhereis rsync\nyum install rsync -y #yumrsync\n```\n\n\nABrsyncCentosrsyncrsync --versionrsync -h\n\n## Ainotify\n\n```\nwget http://cloud.github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz  \ntar zxvf inotify-tools-3.14.tar.gz  \ncd inotify-tools-3.14  \n./configure --prefix=/usr/local/inotify  \nmake  \nmake install\n```\n\n\n## Arsync\n\n```\nmkdir -p /usr/local/rsync\ntouch /usr/local/rsync/exclude.list\necho 'testpassword' >/usr/local/rsync/rsync.passwd\nchmod 600 /usr/local/rsync/rsync.passwd\n```\n\n\nexclude.listrsync.passwd\n\n## Brsync\n\n```\nmkdir -p /usr/local/rsync\necho 'user:testpassword' >/usr/local/rsync/rsync.passwd\nchmod 600 /usr/local/rsync/rsync.passwd\ntouch /usr/local/rsync/rsync.conf\n```\n\nrsync.passwdusertestpasswordtestpasswordArsync.passwdrsync.conf\n\n```\npid file = /var/run/rsyncd.pid  \nlock file = /var/run/rsync.lock  \nlog file = /var/log/rsyncd.log \nport = 873\naddress = 192.168.1.2\nsecrets file=/usr/local/rsync/rsync.passwd\nuid = root\ngid = root\nuse chroot = yes\nread only = no\nwrite only = no\n#rsyncdipipip\nhosts allow = 192.168.1.1\n#rsyncdip*(hosts allowiphosts allow)\nhosts deny = *\n#\nmax connections = 5\n#\n#    log file rsyncsyslogsyslog\n#    transfer logging \n#    log format google\n#    syslog facility rsyncsyslog\n#    timeout\nlog file = /usr/local/logs/rsync.log\ntransfer logging = yes\nlog format = %t %a %m %f %b\nsyslog facility = local3\ntimeout = 300\n[leo]\n# B\npath=/data/leo/\n#\nlist=yes\n#\nignore errors\n#\nauth users = user\n#\ncomment = some description about this moudle\n# A\n#exclude = test1/ test2/\n```\n\n\n\n\n```\nuid = root \ngid = root \nuse chroot = no \nmax connections = 10 \nstrict modes = yes \npid file = /var/run/rsyncd.pid  \nlock file = /var/run/rsync.lock  \nlog file = /var/log/rsyncd.log  \n[leo]  \npath = /data/leo/  \ncomment = backup wwwroot  \nignore errors  \nread only = no \nwrite only = no \nhosts allow = 192.168.1.1  \nhosts deny = *  \nlist = false \nuid = root \ngid = root \nauth users = user\nsecrets file = /usr/local/rsync/rsync.passwd\n```\n\n## Brsync\n\n```\n/usr/bin/rsync --daemon --config=/usr/local/rsync/rsync.conf\n```\n\n\nBrsync/etc/rc.local\n\n```\necho '/usr/bin/rsync --daemon --config=/usr/local/rsync/rsync.conf' >> /etc/rc.local\nchmod +x /etc/rc.local\n```\n\nchmod +x /etc/rc.localnetstat -an | grep 873 rsync\n\n## Brsync\n\n```\niptables -I INPUT 3 -p tcp -m state --state NEW  -m tcp --dport 873 -j ACCEPT\nservice iptables save\nservice iptables reload\n```\n\n\n## A\n\n/data/leo/data/leo/root/data/leo/sh.sh\n/data/leorsync.sh\n\n```\n#!/bin/bash\nhost=192.168.1.2\nsrc=/data/leo/\ndes=leo\nuser=user\n/usr/local/inotify/bin/inotifywait -mrq --timefmt '%d/%m/%y %H:%M' --format '%T %w%f%e' -e modify,delete,create,attrib $src | while read files\ndo\n/usr/bin/rsync -vzrtopg --delete --progress --exclude-from=/usr/local/rsync/exclude.list --password-file=/usr/local/rsync/rsync.passwd $src $user@$host::$des\necho \"${files} was rsynced\" >>/data/wwwlogs/rsync.log 2>&1\ndone\n```\n\nhostBIPsrcAdesB/usr/local/rsync/rsync.conf[leo]leoBAB--delete\n\n/data/leo/root/data/leo/sh.sh\n\n```\necho 'root/' >> /usr/local/rsync/exclude.list\necho 'sh.sh' >>/usr/local/rsync/exclude.list\n```\n\n\n\n## A\n\n```\necho 'bash /data/leo/rsync.sh &' >> /etc/rc.local\nchmod +x /etc/rc.local\nchmod 744 /data/leo/rsync.sh\n```\n\n\n## \n\n1.rsync: failed to connect to X.X.X.X: No route to host\nB873AB\n\n2.rsync failed Connection refused 111\nBrsync","slug":"inotify+rsync","published":1,"updated":"2022-05-12T17:05:41.269Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6auc000wlvtd2b37b5m1","content":"<blockquote>\n<p>inotify+rsync</p>\n</blockquote>\n<p>AIP192.168.1.1<br>BIP192.168.1.2<br>Centos 7.3 64bit</p>\n<h2 id=\"rsync\"><a href=\"#rsync\" class=\"headerlink\" title=\"rsync\"></a>rsync</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qa|grep rsync #rsyncwhereis rsync</span><br><span class=\"line\">yum install rsync -y #yumrsync</span><br></pre></td></tr></table></figure>\n\n\n<p>ABrsyncCentosrsyncrsync versionrsync -h</p>\n<h2 id=\"Ainotify\"><a href=\"#Ainotify\" class=\"headerlink\" title=\"Ainotify\"></a>Ainotify</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://cloud.github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz  </span><br><span class=\"line\">tar zxvf inotify-tools-3.14.tar.gz  </span><br><span class=\"line\">cd inotify-tools-3.14  </span><br><span class=\"line\">./configure --prefix=/usr/local/inotify  </span><br><span class=\"line\">make  </span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"Arsync\"><a href=\"#Arsync\" class=\"headerlink\" title=\"Arsync\"></a>Arsync</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /usr/local/rsync</span><br><span class=\"line\">touch /usr/local/rsync/exclude.list</span><br><span class=\"line\">echo &#x27;testpassword&#x27; &gt;/usr/local/rsync/rsync.passwd</span><br><span class=\"line\">chmod 600 /usr/local/rsync/rsync.passwd</span><br></pre></td></tr></table></figure>\n\n\n<p>exclude.listrsync.passwd</p>\n<h2 id=\"Brsync\"><a href=\"#Brsync\" class=\"headerlink\" title=\"Brsync\"></a>Brsync</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /usr/local/rsync</span><br><span class=\"line\">echo &#x27;user:testpassword&#x27; &gt;/usr/local/rsync/rsync.passwd</span><br><span class=\"line\">chmod 600 /usr/local/rsync/rsync.passwd</span><br><span class=\"line\">touch /usr/local/rsync/rsync.conf</span><br></pre></td></tr></table></figure>\n\n<p>rsync.passwdusertestpasswordtestpasswordArsync.passwdrsync.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pid file = /var/run/rsyncd.pid  </span><br><span class=\"line\">lock file = /var/run/rsync.lock  </span><br><span class=\"line\">log file = /var/log/rsyncd.log </span><br><span class=\"line\">port = 873</span><br><span class=\"line\">address = 192.168.1.2</span><br><span class=\"line\">secrets file=/usr/local/rsync/rsync.passwd</span><br><span class=\"line\">uid = root</span><br><span class=\"line\">gid = root</span><br><span class=\"line\">use chroot = yes</span><br><span class=\"line\">read only = no</span><br><span class=\"line\">write only = no</span><br><span class=\"line\">#rsyncdipipip</span><br><span class=\"line\">hosts allow = 192.168.1.1</span><br><span class=\"line\">#rsyncdip*(hosts allowiphosts allow)</span><br><span class=\"line\">hosts deny = *</span><br><span class=\"line\">#</span><br><span class=\"line\">max connections = 5</span><br><span class=\"line\">#</span><br><span class=\"line\">#    log file rsyncsyslogsyslog</span><br><span class=\"line\">#    transfer logging </span><br><span class=\"line\">#    log format google</span><br><span class=\"line\">#    syslog facility rsyncsyslog</span><br><span class=\"line\">#    timeout</span><br><span class=\"line\">log file = /usr/local/logs/rsync.log</span><br><span class=\"line\">transfer logging = yes</span><br><span class=\"line\">log format = %t %a %m %f %b</span><br><span class=\"line\">syslog facility = local3</span><br><span class=\"line\">timeout = 300</span><br><span class=\"line\">[leo]</span><br><span class=\"line\"># B</span><br><span class=\"line\">path=/data/leo/</span><br><span class=\"line\">#</span><br><span class=\"line\">list=yes</span><br><span class=\"line\">#</span><br><span class=\"line\">ignore errors</span><br><span class=\"line\">#</span><br><span class=\"line\">auth users = user</span><br><span class=\"line\">#</span><br><span class=\"line\">comment = some description about this moudle</span><br><span class=\"line\"># A</span><br><span class=\"line\">#exclude = test1/ test2/</span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uid = root </span><br><span class=\"line\">gid = root </span><br><span class=\"line\">use chroot = no </span><br><span class=\"line\">max connections = 10 </span><br><span class=\"line\">strict modes = yes </span><br><span class=\"line\">pid file = /var/run/rsyncd.pid  </span><br><span class=\"line\">lock file = /var/run/rsync.lock  </span><br><span class=\"line\">log file = /var/log/rsyncd.log  </span><br><span class=\"line\">[leo]  </span><br><span class=\"line\">path = /data/leo/  </span><br><span class=\"line\">comment = backup wwwroot  </span><br><span class=\"line\">ignore errors  </span><br><span class=\"line\">read only = no </span><br><span class=\"line\">write only = no </span><br><span class=\"line\">hosts allow = 192.168.1.1  </span><br><span class=\"line\">hosts deny = *  </span><br><span class=\"line\">list = false </span><br><span class=\"line\">uid = root </span><br><span class=\"line\">gid = root </span><br><span class=\"line\">auth users = user</span><br><span class=\"line\">secrets file = /usr/local/rsync/rsync.passwd</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Brsync\"><a href=\"#Brsync\" class=\"headerlink\" title=\"Brsync\"></a>Brsync</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/bin/rsync --daemon --config=/usr/local/rsync/rsync.conf</span><br></pre></td></tr></table></figure>\n\n\n<p>Brsync&#x2F;etc&#x2F;rc.local</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;/usr/bin/rsync --daemon --config=/usr/local/rsync/rsync.conf&#x27; &gt;&gt; /etc/rc.local</span><br><span class=\"line\">chmod +x /etc/rc.local</span><br></pre></td></tr></table></figure>\n\n<p>chmod +x &#x2F;etc&#x2F;rc.localnetstat -an | grep 873 rsync</p>\n<h2 id=\"Brsync\"><a href=\"#Brsync\" class=\"headerlink\" title=\"Brsync\"></a>Brsync</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -I INPUT 3 -p tcp -m state --state NEW  -m tcp --dport 873 -j ACCEPT</span><br><span class=\"line\">service iptables save</span><br><span class=\"line\">service iptables reload</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"A\"><a href=\"#A\" class=\"headerlink\" title=\"A\"></a>A</h2><p>&#x2F;data&#x2F;leo&#x2F;data&#x2F;leo&#x2F;root&#x2F;data&#x2F;leo&#x2F;sh.sh<br>&#x2F;data&#x2F;leorsync.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">host=192.168.1.2</span><br><span class=\"line\">src=/data/leo/</span><br><span class=\"line\">des=leo</span><br><span class=\"line\">user=user</span><br><span class=\"line\">/usr/local/inotify/bin/inotifywait -mrq --timefmt &#x27;%d/%m/%y %H:%M&#x27; --format &#x27;%T %w%f%e&#x27; -e modify,delete,create,attrib $src | while read files</span><br><span class=\"line\">do</span><br><span class=\"line\">/usr/bin/rsync -vzrtopg --delete --progress --exclude-from=/usr/local/rsync/exclude.list --password-file=/usr/local/rsync/rsync.passwd $src $user@$host::$des</span><br><span class=\"line\">echo &quot;$&#123;files&#125; was rsynced&quot; &gt;&gt;/data/wwwlogs/rsync.log 2&gt;&amp;1</span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n\n<p>hostBIPsrcAdesB&#x2F;usr&#x2F;local&#x2F;rsync&#x2F;rsync.conf[leo]leoBABdelete</p>\n<p>&#x2F;data&#x2F;leo&#x2F;root&#x2F;data&#x2F;leo&#x2F;sh.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;root/&#x27; &gt;&gt; /usr/local/rsync/exclude.list</span><br><span class=\"line\">echo &#x27;sh.sh&#x27; &gt;&gt;/usr/local/rsync/exclude.list</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h2 id=\"A\"><a href=\"#A\" class=\"headerlink\" title=\"A\"></a>A</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;bash /data/leo/rsync.sh &amp;&#x27; &gt;&gt; /etc/rc.local</span><br><span class=\"line\">chmod +x /etc/rc.local</span><br><span class=\"line\">chmod 744 /data/leo/rsync.sh</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>1.rsync: failed to connect to X.X.X.X: No route to host<br>B873AB</p>\n<p>2.rsync failed Connection refused 111<br>Brsync</p>\n","site":{"data":{}},"length":4046,"excerpt":"","more":"<blockquote>\n<p>inotify+rsync</p>\n</blockquote>\n<p>AIP192.168.1.1<br>BIP192.168.1.2<br>Centos 7.3 64bit</p>\n<h2 id=\"rsync\"><a href=\"#rsync\" class=\"headerlink\" title=\"rsync\"></a>rsync</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qa|grep rsync #rsyncwhereis rsync</span><br><span class=\"line\">yum install rsync -y #yumrsync</span><br></pre></td></tr></table></figure>\n\n\n<p>ABrsyncCentosrsyncrsync versionrsync -h</p>\n<h2 id=\"Ainotify\"><a href=\"#Ainotify\" class=\"headerlink\" title=\"Ainotify\"></a>Ainotify</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://cloud.github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz  </span><br><span class=\"line\">tar zxvf inotify-tools-3.14.tar.gz  </span><br><span class=\"line\">cd inotify-tools-3.14  </span><br><span class=\"line\">./configure --prefix=/usr/local/inotify  </span><br><span class=\"line\">make  </span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"Arsync\"><a href=\"#Arsync\" class=\"headerlink\" title=\"Arsync\"></a>Arsync</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /usr/local/rsync</span><br><span class=\"line\">touch /usr/local/rsync/exclude.list</span><br><span class=\"line\">echo &#x27;testpassword&#x27; &gt;/usr/local/rsync/rsync.passwd</span><br><span class=\"line\">chmod 600 /usr/local/rsync/rsync.passwd</span><br></pre></td></tr></table></figure>\n\n\n<p>exclude.listrsync.passwd</p>\n<h2 id=\"Brsync\"><a href=\"#Brsync\" class=\"headerlink\" title=\"Brsync\"></a>Brsync</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /usr/local/rsync</span><br><span class=\"line\">echo &#x27;user:testpassword&#x27; &gt;/usr/local/rsync/rsync.passwd</span><br><span class=\"line\">chmod 600 /usr/local/rsync/rsync.passwd</span><br><span class=\"line\">touch /usr/local/rsync/rsync.conf</span><br></pre></td></tr></table></figure>\n\n<p>rsync.passwdusertestpasswordtestpasswordArsync.passwdrsync.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pid file = /var/run/rsyncd.pid  </span><br><span class=\"line\">lock file = /var/run/rsync.lock  </span><br><span class=\"line\">log file = /var/log/rsyncd.log </span><br><span class=\"line\">port = 873</span><br><span class=\"line\">address = 192.168.1.2</span><br><span class=\"line\">secrets file=/usr/local/rsync/rsync.passwd</span><br><span class=\"line\">uid = root</span><br><span class=\"line\">gid = root</span><br><span class=\"line\">use chroot = yes</span><br><span class=\"line\">read only = no</span><br><span class=\"line\">write only = no</span><br><span class=\"line\">#rsyncdipipip</span><br><span class=\"line\">hosts allow = 192.168.1.1</span><br><span class=\"line\">#rsyncdip*(hosts allowiphosts allow)</span><br><span class=\"line\">hosts deny = *</span><br><span class=\"line\">#</span><br><span class=\"line\">max connections = 5</span><br><span class=\"line\">#</span><br><span class=\"line\">#    log file rsyncsyslogsyslog</span><br><span class=\"line\">#    transfer logging </span><br><span class=\"line\">#    log format google</span><br><span class=\"line\">#    syslog facility rsyncsyslog</span><br><span class=\"line\">#    timeout</span><br><span class=\"line\">log file = /usr/local/logs/rsync.log</span><br><span class=\"line\">transfer logging = yes</span><br><span class=\"line\">log format = %t %a %m %f %b</span><br><span class=\"line\">syslog facility = local3</span><br><span class=\"line\">timeout = 300</span><br><span class=\"line\">[leo]</span><br><span class=\"line\"># B</span><br><span class=\"line\">path=/data/leo/</span><br><span class=\"line\">#</span><br><span class=\"line\">list=yes</span><br><span class=\"line\">#</span><br><span class=\"line\">ignore errors</span><br><span class=\"line\">#</span><br><span class=\"line\">auth users = user</span><br><span class=\"line\">#</span><br><span class=\"line\">comment = some description about this moudle</span><br><span class=\"line\"># A</span><br><span class=\"line\">#exclude = test1/ test2/</span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uid = root </span><br><span class=\"line\">gid = root </span><br><span class=\"line\">use chroot = no </span><br><span class=\"line\">max connections = 10 </span><br><span class=\"line\">strict modes = yes </span><br><span class=\"line\">pid file = /var/run/rsyncd.pid  </span><br><span class=\"line\">lock file = /var/run/rsync.lock  </span><br><span class=\"line\">log file = /var/log/rsyncd.log  </span><br><span class=\"line\">[leo]  </span><br><span class=\"line\">path = /data/leo/  </span><br><span class=\"line\">comment = backup wwwroot  </span><br><span class=\"line\">ignore errors  </span><br><span class=\"line\">read only = no </span><br><span class=\"line\">write only = no </span><br><span class=\"line\">hosts allow = 192.168.1.1  </span><br><span class=\"line\">hosts deny = *  </span><br><span class=\"line\">list = false </span><br><span class=\"line\">uid = root </span><br><span class=\"line\">gid = root </span><br><span class=\"line\">auth users = user</span><br><span class=\"line\">secrets file = /usr/local/rsync/rsync.passwd</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Brsync\"><a href=\"#Brsync\" class=\"headerlink\" title=\"Brsync\"></a>Brsync</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/bin/rsync --daemon --config=/usr/local/rsync/rsync.conf</span><br></pre></td></tr></table></figure>\n\n\n<p>Brsync&#x2F;etc&#x2F;rc.local</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;/usr/bin/rsync --daemon --config=/usr/local/rsync/rsync.conf&#x27; &gt;&gt; /etc/rc.local</span><br><span class=\"line\">chmod +x /etc/rc.local</span><br></pre></td></tr></table></figure>\n\n<p>chmod +x &#x2F;etc&#x2F;rc.localnetstat -an | grep 873 rsync</p>\n<h2 id=\"Brsync\"><a href=\"#Brsync\" class=\"headerlink\" title=\"Brsync\"></a>Brsync</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -I INPUT 3 -p tcp -m state --state NEW  -m tcp --dport 873 -j ACCEPT</span><br><span class=\"line\">service iptables save</span><br><span class=\"line\">service iptables reload</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"A\"><a href=\"#A\" class=\"headerlink\" title=\"A\"></a>A</h2><p>&#x2F;data&#x2F;leo&#x2F;data&#x2F;leo&#x2F;root&#x2F;data&#x2F;leo&#x2F;sh.sh<br>&#x2F;data&#x2F;leorsync.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">host=192.168.1.2</span><br><span class=\"line\">src=/data/leo/</span><br><span class=\"line\">des=leo</span><br><span class=\"line\">user=user</span><br><span class=\"line\">/usr/local/inotify/bin/inotifywait -mrq --timefmt &#x27;%d/%m/%y %H:%M&#x27; --format &#x27;%T %w%f%e&#x27; -e modify,delete,create,attrib $src | while read files</span><br><span class=\"line\">do</span><br><span class=\"line\">/usr/bin/rsync -vzrtopg --delete --progress --exclude-from=/usr/local/rsync/exclude.list --password-file=/usr/local/rsync/rsync.passwd $src $user@$host::$des</span><br><span class=\"line\">echo &quot;$&#123;files&#125; was rsynced&quot; &gt;&gt;/data/wwwlogs/rsync.log 2&gt;&amp;1</span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n\n<p>hostBIPsrcAdesB&#x2F;usr&#x2F;local&#x2F;rsync&#x2F;rsync.conf[leo]leoBABdelete</p>\n<p>&#x2F;data&#x2F;leo&#x2F;root&#x2F;data&#x2F;leo&#x2F;sh.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;root/&#x27; &gt;&gt; /usr/local/rsync/exclude.list</span><br><span class=\"line\">echo &#x27;sh.sh&#x27; &gt;&gt;/usr/local/rsync/exclude.list</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h2 id=\"A\"><a href=\"#A\" class=\"headerlink\" title=\"A\"></a>A</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;bash /data/leo/rsync.sh &amp;&#x27; &gt;&gt; /etc/rc.local</span><br><span class=\"line\">chmod +x /etc/rc.local</span><br><span class=\"line\">chmod 744 /data/leo/rsync.sh</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>1.rsync: failed to connect to X.X.X.X: No route to host<br>B873AB</p>\n<p>2.rsync failed Connection refused 111<br>Brsync</p>\n"},{"title":"inotify+rsync","date":"2018-06-21T23:47:00.000Z","url":"sync-data-realtime-with-inotify-rsync-v2","description":"inotifyinotify3.20.1","_content":"\n> inotifyinotify3.20.1Github<https://github.com/rvoicilas/inotify-tools>\n\ninotify+rsync[inotify+rsync](/sync-data-realtime-with-inotify-rsync)inotifyinotify/etc/rc.localsupervisor\n\n## inotify\n\ninotifyconfigureconfigureinotifygithubconfigure\n\nautogen.shshellconfigure\n\n```\nwget https://github.com/rvoicilas/inotify-tools/archive/3.20.1.tar.gz  \ntar zxvf 3.20.1.tar.gz \ncd inotify-tools-3.20.1 \n./autogen.sh\n./configure --prefix=/usr/local/inotify  \nmake  \nmake install \n```\n\nautogen.sh\n\n## supervisorBrsync\n\n```\n[program:rsync]\ncommand=/usr/bin/rsync --daemon --config=/usr/local/rsync/rsync.conf\nnumprocs=1\nautostart=true\nautorestart=true\nstartretries=10\nexitcodes=0\nstopsignal=KILL\nstopwaitsecs=10\nredirect_stderr=true\nstdout_logfile=logfile\nuser=root\nredirect_stderr=true\nstdout_logfile=/data/supervisor/log/rsync.log\nloglevel=error\n```\n\n\nBrsyncrsync\n\n## supervisorA\n\n```\n[program:rsync]\ncommand=bash /data/leo/rsync.sh\nnumprocs=1\nautostart=true\nautorestart=true\nstartretries=10\nexitcodes=0\nstopsignal=KILL\nstopwaitsecs=10\nredirect_stderr=true\nstdout_logfile=logfile\nuser=root\nredirect_stderr=true\nstdout_logfile=/data/supervisor/log/rsync.log\nloglevel=error\nstdout_logfile_maxbytes=5MB\nstdout_logfile_backups=3\n```\n\ninotifyrsyncB\n\n## \n\nsupervisor[Linuxsupervisor](/run-daemon-process-with-supervisor-on-linux)","source":"_posts/inotify+rsync.md","raw":"---\ntitle: inotify+rsync\ndate: 2018-06-22 07:47:00\ntags: \n  - inotify\n  - \ncategories:\n  - \nurl: sync-data-realtime-with-inotify-rsync-v2\ndescription: inotifyinotify3.20.1\n---\n\n> inotifyinotify3.20.1Github<https://github.com/rvoicilas/inotify-tools>\n\ninotify+rsync[inotify+rsync](/sync-data-realtime-with-inotify-rsync)inotifyinotify/etc/rc.localsupervisor\n\n## inotify\n\ninotifyconfigureconfigureinotifygithubconfigure\n\nautogen.shshellconfigure\n\n```\nwget https://github.com/rvoicilas/inotify-tools/archive/3.20.1.tar.gz  \ntar zxvf 3.20.1.tar.gz \ncd inotify-tools-3.20.1 \n./autogen.sh\n./configure --prefix=/usr/local/inotify  \nmake  \nmake install \n```\n\nautogen.sh\n\n## supervisorBrsync\n\n```\n[program:rsync]\ncommand=/usr/bin/rsync --daemon --config=/usr/local/rsync/rsync.conf\nnumprocs=1\nautostart=true\nautorestart=true\nstartretries=10\nexitcodes=0\nstopsignal=KILL\nstopwaitsecs=10\nredirect_stderr=true\nstdout_logfile=logfile\nuser=root\nredirect_stderr=true\nstdout_logfile=/data/supervisor/log/rsync.log\nloglevel=error\n```\n\n\nBrsyncrsync\n\n## supervisorA\n\n```\n[program:rsync]\ncommand=bash /data/leo/rsync.sh\nnumprocs=1\nautostart=true\nautorestart=true\nstartretries=10\nexitcodes=0\nstopsignal=KILL\nstopwaitsecs=10\nredirect_stderr=true\nstdout_logfile=logfile\nuser=root\nredirect_stderr=true\nstdout_logfile=/data/supervisor/log/rsync.log\nloglevel=error\nstdout_logfile_maxbytes=5MB\nstdout_logfile_backups=3\n```\n\ninotifyrsyncB\n\n## \n\nsupervisor[Linuxsupervisor](/run-daemon-process-with-supervisor-on-linux)","slug":"inotify+rsync","published":1,"updated":"2022-05-12T17:05:47.586Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6aue0010lvtdeab97br8","content":"<blockquote>\n<p>inotifyinotify3.20.1Github<a href=\"https://github.com/rvoicilas/inotify-tools\">https://github.com/rvoicilas/inotify-tools</a></p>\n</blockquote>\n<p>inotify+rsync<a href=\"/sync-data-realtime-with-inotify-rsync\">inotify+rsync</a>inotifyinotify&#x2F;etc&#x2F;rc.localsupervisor</p>\n<h2 id=\"inotify\"><a href=\"#inotify\" class=\"headerlink\" title=\"inotify\"></a>inotify</h2><p>inotifyconfigureconfigureinotifygithubconfigure</p>\n<p>autogen.shshellconfigure</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/rvoicilas/inotify-tools/archive/3.20.1.tar.gz  </span><br><span class=\"line\">tar zxvf 3.20.1.tar.gz </span><br><span class=\"line\">cd inotify-tools-3.20.1 </span><br><span class=\"line\">./autogen.sh</span><br><span class=\"line\">./configure --prefix=/usr/local/inotify  </span><br><span class=\"line\">make  </span><br><span class=\"line\">make install </span><br></pre></td></tr></table></figure>\n\n<p>autogen.sh</p>\n<h2 id=\"supervisorBrsync\"><a href=\"#supervisorBrsync\" class=\"headerlink\" title=\"supervisorBrsync\"></a>supervisorBrsync</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:rsync]</span><br><span class=\"line\">command=/usr/bin/rsync --daemon --config=/usr/local/rsync/rsync.conf</span><br><span class=\"line\">numprocs=1</span><br><span class=\"line\">autostart=true</span><br><span class=\"line\">autorestart=true</span><br><span class=\"line\">startretries=10</span><br><span class=\"line\">exitcodes=0</span><br><span class=\"line\">stopsignal=KILL</span><br><span class=\"line\">stopwaitsecs=10</span><br><span class=\"line\">redirect_stderr=true</span><br><span class=\"line\">stdout_logfile=logfile</span><br><span class=\"line\">user=root</span><br><span class=\"line\">redirect_stderr=true</span><br><span class=\"line\">stdout_logfile=/data/supervisor/log/rsync.log</span><br><span class=\"line\">loglevel=error</span><br></pre></td></tr></table></figure>\n\n\n<p>Brsyncrsync</p>\n<h2 id=\"supervisorA\"><a href=\"#supervisorA\" class=\"headerlink\" title=\"supervisorA\"></a>supervisorA</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:rsync]</span><br><span class=\"line\">command=bash /data/leo/rsync.sh</span><br><span class=\"line\">numprocs=1</span><br><span class=\"line\">autostart=true</span><br><span class=\"line\">autorestart=true</span><br><span class=\"line\">startretries=10</span><br><span class=\"line\">exitcodes=0</span><br><span class=\"line\">stopsignal=KILL</span><br><span class=\"line\">stopwaitsecs=10</span><br><span class=\"line\">redirect_stderr=true</span><br><span class=\"line\">stdout_logfile=logfile</span><br><span class=\"line\">user=root</span><br><span class=\"line\">redirect_stderr=true</span><br><span class=\"line\">stdout_logfile=/data/supervisor/log/rsync.log</span><br><span class=\"line\">loglevel=error</span><br><span class=\"line\">stdout_logfile_maxbytes=5MB</span><br><span class=\"line\">stdout_logfile_backups=3</span><br></pre></td></tr></table></figure>\n\n<p>inotifyrsyncB</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>supervisor<a href=\"/run-daemon-process-with-supervisor-on-linux\">Linuxsupervisor</a></p>\n","site":{"data":{}},"length":1574,"excerpt":"","more":"<blockquote>\n<p>inotifyinotify3.20.1Github<a href=\"https://github.com/rvoicilas/inotify-tools\">https://github.com/rvoicilas/inotify-tools</a></p>\n</blockquote>\n<p>inotify+rsync<a href=\"/sync-data-realtime-with-inotify-rsync\">inotify+rsync</a>inotifyinotify&#x2F;etc&#x2F;rc.localsupervisor</p>\n<h2 id=\"inotify\"><a href=\"#inotify\" class=\"headerlink\" title=\"inotify\"></a>inotify</h2><p>inotifyconfigureconfigureinotifygithubconfigure</p>\n<p>autogen.shshellconfigure</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/rvoicilas/inotify-tools/archive/3.20.1.tar.gz  </span><br><span class=\"line\">tar zxvf 3.20.1.tar.gz </span><br><span class=\"line\">cd inotify-tools-3.20.1 </span><br><span class=\"line\">./autogen.sh</span><br><span class=\"line\">./configure --prefix=/usr/local/inotify  </span><br><span class=\"line\">make  </span><br><span class=\"line\">make install </span><br></pre></td></tr></table></figure>\n\n<p>autogen.sh</p>\n<h2 id=\"supervisorBrsync\"><a href=\"#supervisorBrsync\" class=\"headerlink\" title=\"supervisorBrsync\"></a>supervisorBrsync</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:rsync]</span><br><span class=\"line\">command=/usr/bin/rsync --daemon --config=/usr/local/rsync/rsync.conf</span><br><span class=\"line\">numprocs=1</span><br><span class=\"line\">autostart=true</span><br><span class=\"line\">autorestart=true</span><br><span class=\"line\">startretries=10</span><br><span class=\"line\">exitcodes=0</span><br><span class=\"line\">stopsignal=KILL</span><br><span class=\"line\">stopwaitsecs=10</span><br><span class=\"line\">redirect_stderr=true</span><br><span class=\"line\">stdout_logfile=logfile</span><br><span class=\"line\">user=root</span><br><span class=\"line\">redirect_stderr=true</span><br><span class=\"line\">stdout_logfile=/data/supervisor/log/rsync.log</span><br><span class=\"line\">loglevel=error</span><br></pre></td></tr></table></figure>\n\n\n<p>Brsyncrsync</p>\n<h2 id=\"supervisorA\"><a href=\"#supervisorA\" class=\"headerlink\" title=\"supervisorA\"></a>supervisorA</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:rsync]</span><br><span class=\"line\">command=bash /data/leo/rsync.sh</span><br><span class=\"line\">numprocs=1</span><br><span class=\"line\">autostart=true</span><br><span class=\"line\">autorestart=true</span><br><span class=\"line\">startretries=10</span><br><span class=\"line\">exitcodes=0</span><br><span class=\"line\">stopsignal=KILL</span><br><span class=\"line\">stopwaitsecs=10</span><br><span class=\"line\">redirect_stderr=true</span><br><span class=\"line\">stdout_logfile=logfile</span><br><span class=\"line\">user=root</span><br><span class=\"line\">redirect_stderr=true</span><br><span class=\"line\">stdout_logfile=/data/supervisor/log/rsync.log</span><br><span class=\"line\">loglevel=error</span><br><span class=\"line\">stdout_logfile_maxbytes=5MB</span><br><span class=\"line\">stdout_logfile_backups=3</span><br></pre></td></tr></table></figure>\n\n<p>inotifyrsyncB</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>supervisor<a href=\"/run-daemon-process-with-supervisor-on-linux\">Linuxsupervisor</a></p>\n"},{"title":"Google AuthenticatorLinux SSH","date":"2018-11-02T02:48:47.000Z","url":"login-ssh-with-2fa-authentication-by-google-authencator","description":"LinuxSSHLinuxCentos7Google AuthenticatorSSH","_content":"\n> LinuxSSHLinuxCentos7Google AuthenticatorSSH\n\n## ntpd\n\n```\nyum install -y ntpdate\nsystemctl start ntpd\nsystemctl enable ntpd\n```\n\n\nntpdate \n\n## \n\n```\nyum install -y git make gcc libtool pam-devel\n```\n\n## Google Authenticator\n\n```\ngit clone https://github.com/google/google-authenticator\ncd google-authenticator/libpam\n./bootstrap.sh\n./configure\nmake\nmake install\nln -s /usr/local/lib/security/pam_google_authenticator.so /usr/lib64/security/\n```\n\nepel-releaseyum install google-authenticator\n\n##  SSH \n\n /etc/ssh/sshd_config \n\n```\nvim /etc/ssh/sshd_config\n```\n\n\n\n```\nChallengeResponseAuthentication yes\nPasswordAuthentication no\nPubkeyAuthentication yes\nUsePAM yes\n```\n\n sshd \n\n```\nsystemctl restart sshd\n```\n\n\n PubkeyAuthentication  yes  Google Authenticator\n Google Authenticator \n\n##  PAM\n\n /etc/pam.d/sshd \n\n```\nvim /etc/pam.d/sshd\n```\n\n\n\n```\nauth required pam_google_authenticator.so nullok\n```\n\n\n##  Google Authenticator\n\n Google Authenticator \n\n```\ngoogle-authenticator\n```\n\nYinteractivepasswordGoogle Authenticator\n\n\n\n","source":"_posts/Google AuthenticatorLinux SSH.md","raw":"---\ntitle: Google AuthenticatorLinux SSH\ndate: 2018-11-02 10:48:47\ntags: \n  - SSH\n  - \ncategories:\n  - \nurl: login-ssh-with-2fa-authentication-by-google-authencator\ndescription: LinuxSSHLinuxCentos7Google AuthenticatorSSH\n---\n\n> LinuxSSHLinuxCentos7Google AuthenticatorSSH\n\n## ntpd\n\n```\nyum install -y ntpdate\nsystemctl start ntpd\nsystemctl enable ntpd\n```\n\n\nntpdate \n\n## \n\n```\nyum install -y git make gcc libtool pam-devel\n```\n\n## Google Authenticator\n\n```\ngit clone https://github.com/google/google-authenticator\ncd google-authenticator/libpam\n./bootstrap.sh\n./configure\nmake\nmake install\nln -s /usr/local/lib/security/pam_google_authenticator.so /usr/lib64/security/\n```\n\nepel-releaseyum install google-authenticator\n\n##  SSH \n\n /etc/ssh/sshd_config \n\n```\nvim /etc/ssh/sshd_config\n```\n\n\n\n```\nChallengeResponseAuthentication yes\nPasswordAuthentication no\nPubkeyAuthentication yes\nUsePAM yes\n```\n\n sshd \n\n```\nsystemctl restart sshd\n```\n\n\n PubkeyAuthentication  yes  Google Authenticator\n Google Authenticator \n\n##  PAM\n\n /etc/pam.d/sshd \n\n```\nvim /etc/pam.d/sshd\n```\n\n\n\n```\nauth required pam_google_authenticator.so nullok\n```\n\n\n##  Google Authenticator\n\n Google Authenticator \n\n```\ngoogle-authenticator\n```\n\nYinteractivepasswordGoogle Authenticator\n\n\n\n","slug":"Google AuthenticatorLinux SSH","published":1,"updated":"2022-05-12T17:05:53.269Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6auf0013lvtd59b7amy5","content":"<blockquote>\n<p>LinuxSSHLinuxCentos7Google AuthenticatorSSH</p>\n</blockquote>\n<h2 id=\"ntpd\"><a href=\"#ntpd\" class=\"headerlink\" title=\"ntpd\"></a>ntpd</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y ntpdate</span><br><span class=\"line\">systemctl start ntpd</span><br><span class=\"line\">systemctl enable ntpd</span><br></pre></td></tr></table></figure>\n\n\n<p>ntpdate </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y git make gcc libtool pam-devel</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Google-Authenticator\"><a href=\"#Google-Authenticator\" class=\"headerlink\" title=\"Google Authenticator\"></a>Google Authenticator</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/google/google-authenticator</span><br><span class=\"line\">cd google-authenticator/libpam</span><br><span class=\"line\">./bootstrap.sh</span><br><span class=\"line\">./configure</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br><span class=\"line\">ln -s /usr/local/lib/security/pam_google_authenticator.so /usr/lib64/security/</span><br></pre></td></tr></table></figure>\n\n<p>epel-releaseyum install google-authenticator</p>\n<h2 id=\"-SSH-\"><a href=\"#-SSH-\" class=\"headerlink\" title=\" SSH \"></a> SSH </h2><p> &#x2F;etc&#x2F;ssh&#x2F;sshd_config </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ChallengeResponseAuthentication yes</span><br><span class=\"line\">PasswordAuthentication no</span><br><span class=\"line\">PubkeyAuthentication yes</span><br><span class=\"line\">UsePAM yes</span><br></pre></td></tr></table></figure>\n\n<p> sshd </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart sshd</span><br></pre></td></tr></table></figure>\n\n\n<p> PubkeyAuthentication  yes  Google Authenticator<br> Google Authenticator </p>\n<h2 id=\"-PAM\"><a href=\"#-PAM\" class=\"headerlink\" title=\" PAM\"></a> PAM</h2><p> &#x2F;etc&#x2F;pam.d&#x2F;sshd </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/pam.d/sshd</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">auth required pam_google_authenticator.so nullok</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"-Google-Authenticator\"><a href=\"#-Google-Authenticator\" class=\"headerlink\" title=\" Google Authenticator\"></a> Google Authenticator</h2><p> Google Authenticator </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">google-authenticator</span><br></pre></td></tr></table></figure>\n\n<p>YinteractivepasswordGoogle Authenticator</p>\n","site":{"data":{}},"length":1149,"excerpt":"","more":"<blockquote>\n<p>LinuxSSHLinuxCentos7Google AuthenticatorSSH</p>\n</blockquote>\n<h2 id=\"ntpd\"><a href=\"#ntpd\" class=\"headerlink\" title=\"ntpd\"></a>ntpd</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y ntpdate</span><br><span class=\"line\">systemctl start ntpd</span><br><span class=\"line\">systemctl enable ntpd</span><br></pre></td></tr></table></figure>\n\n\n<p>ntpdate </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y git make gcc libtool pam-devel</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Google-Authenticator\"><a href=\"#Google-Authenticator\" class=\"headerlink\" title=\"Google Authenticator\"></a>Google Authenticator</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/google/google-authenticator</span><br><span class=\"line\">cd google-authenticator/libpam</span><br><span class=\"line\">./bootstrap.sh</span><br><span class=\"line\">./configure</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br><span class=\"line\">ln -s /usr/local/lib/security/pam_google_authenticator.so /usr/lib64/security/</span><br></pre></td></tr></table></figure>\n\n<p>epel-releaseyum install google-authenticator</p>\n<h2 id=\"-SSH-\"><a href=\"#-SSH-\" class=\"headerlink\" title=\" SSH \"></a> SSH </h2><p> &#x2F;etc&#x2F;ssh&#x2F;sshd_config </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ChallengeResponseAuthentication yes</span><br><span class=\"line\">PasswordAuthentication no</span><br><span class=\"line\">PubkeyAuthentication yes</span><br><span class=\"line\">UsePAM yes</span><br></pre></td></tr></table></figure>\n\n<p> sshd </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart sshd</span><br></pre></td></tr></table></figure>\n\n\n<p> PubkeyAuthentication  yes  Google Authenticator<br> Google Authenticator </p>\n<h2 id=\"-PAM\"><a href=\"#-PAM\" class=\"headerlink\" title=\" PAM\"></a> PAM</h2><p> &#x2F;etc&#x2F;pam.d&#x2F;sshd </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/pam.d/sshd</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">auth required pam_google_authenticator.so nullok</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"-Google-Authenticator\"><a href=\"#-Google-Authenticator\" class=\"headerlink\" title=\" Google Authenticator\"></a> Google Authenticator</h2><p> Google Authenticator </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">google-authenticator</span><br></pre></td></tr></table></figure>\n\n<p>YinteractivepasswordGoogle Authenticator</p>\n"},{"title":"Centos7ffmpegffmpeg-devel","date":"2018-04-19T23:41:00.000Z","url":"install-ffpmeg-and-ffmpeg-devel-on-centos7","description":"ffmpegffmpegcentosffmpegffmpeg-evel","_content":"\n> ffmpegffmpegcentosffmpegffmpeg-evel\n\n## \n\nCentos 7.4 64bitLinuxmacOS\n\n## yum\n\n1. EPEL\n\n```\nyum -y install epel-release\n```\n\n\n2. EPELNux Dextop\n\n```\nrpm -Uvh http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-1.el7.nux.noarch.rpm\n```\n\n3. \n\n```\nyum -y install ffmpeg ffmpeg-devel\n```\n\n\n## shell\n\nffmpeg\n\n1. shell\n\n```\nwget https://raw.githubusercontent.com/q3aql/ffmpeg-install/master/ffmpeg-install\n```\n\n2. \n\n```\nchmod a+x ffmpeg-install\n```\n\n3. ffmpeg\n\n```\n./ffmpeg-install --install release\n```\n\n## \n\nffmpeg\n\n```\nffmpeg -version\n```","source":"_posts/Centos7ffmpegffmpeg-devel.md","raw":"---\ntitle: Centos7ffmpegffmpeg-devel\ndate: 2018-04-20 07:41:00\ntags: \n  - ffmpeg\ncategories:\n  - \nurl: install-ffpmeg-and-ffmpeg-devel-on-centos7\ndescription: ffmpegffmpegcentosffmpegffmpeg-evel\n---\n\n> ffmpegffmpegcentosffmpegffmpeg-evel\n\n## \n\nCentos 7.4 64bitLinuxmacOS\n\n## yum\n\n1. EPEL\n\n```\nyum -y install epel-release\n```\n\n\n2. EPELNux Dextop\n\n```\nrpm -Uvh http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-1.el7.nux.noarch.rpm\n```\n\n3. \n\n```\nyum -y install ffmpeg ffmpeg-devel\n```\n\n\n## shell\n\nffmpeg\n\n1. shell\n\n```\nwget https://raw.githubusercontent.com/q3aql/ffmpeg-install/master/ffmpeg-install\n```\n\n2. \n\n```\nchmod a+x ffmpeg-install\n```\n\n3. ffmpeg\n\n```\n./ffmpeg-install --install release\n```\n\n## \n\nffmpeg\n\n```\nffmpeg -version\n```","slug":"Centos7ffmpegffmpeg-devel","published":1,"updated":"2022-05-12T17:07:23.196Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6aug0017lvtd1of2f3xe","content":"<blockquote>\n<p>ffmpegffmpegcentosffmpegffmpeg-evel</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Centos 7.4 64bitLinuxmacOS</p>\n<h2 id=\"yum\"><a href=\"#yum\" class=\"headerlink\" title=\"yum\"></a>yum</h2><ol>\n<li>EPEL</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install epel-release</span><br></pre></td></tr></table></figure>\n\n\n<ol start=\"2\">\n<li>EPELNux Dextop</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -Uvh http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-1.el7.nux.noarch.rpm</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install ffmpeg ffmpeg-devel</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"shell\"><a href=\"#shell\" class=\"headerlink\" title=\"shell\"></a>shell</h2><p>ffmpeg</p>\n<ol>\n<li>shell</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://raw.githubusercontent.com/q3aql/ffmpeg-install/master/ffmpeg-install</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod a+x ffmpeg-install</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>ffmpeg</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./ffmpeg-install --install release</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>ffmpeg</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -version</span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":649,"excerpt":"","more":"<blockquote>\n<p>ffmpegffmpegcentosffmpegffmpeg-evel</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Centos 7.4 64bitLinuxmacOS</p>\n<h2 id=\"yum\"><a href=\"#yum\" class=\"headerlink\" title=\"yum\"></a>yum</h2><ol>\n<li>EPEL</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install epel-release</span><br></pre></td></tr></table></figure>\n\n\n<ol start=\"2\">\n<li>EPELNux Dextop</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -Uvh http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-1.el7.nux.noarch.rpm</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install ffmpeg ffmpeg-devel</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"shell\"><a href=\"#shell\" class=\"headerlink\" title=\"shell\"></a>shell</h2><p>ffmpeg</p>\n<ol>\n<li>shell</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://raw.githubusercontent.com/q3aql/ffmpeg-install/master/ffmpeg-install</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod a+x ffmpeg-install</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>ffmpeg</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./ffmpeg-install --install release</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>ffmpeg</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -version</span><br></pre></td></tr></table></figure>"},{"title":"centos7OpenCCPHP Copencc4php","date":"2018-03-30T23:39:00.000Z","url":"install-the-php-c-extension-opencc","description":"PHPC/C++PHPOpenCCcentos7OpenCCPHPPHP7.1.12Zend OPcache","_content":"\n> PHPC/C++PHPOpenCCcentos7OpenCCPHPPHP7.1.12Zend OPcache\n\n## EPEL\n\nEPELExtra Packages for Enterprise\nLinuxepel\n\n```\nyum -y install epel-release\n```\n\n## Doxygen\n\nDoxygenOpenCCCould NOT find Doxygen (missing:\nDOXYGEN_EXECUTABLE)Doxygen\n\n```\nyum -y install doxygen\n```\n\n## OpenCC\n\n```\ngit clone https://github.com/BYVoid/OpenCC.git --depth 1\ncd OpenCC\nmake\nsudo make install\n```\n\n## opencc4php\n\n```\ngit clone https://github.com/NauxLiu/opencc4php.git --depth 1\ncd opencc4php\nphpize\n./configure\nmake && sudo make install\n```\n\n## \n\nopencc.sophp.iniphp-fpmOK\n\n```\nphp -m\n```\n\nopencc\n\n```\n**PHP Startup: Unable to load dynamic library\n'/usr/local/php/lib/php/extensions/no-debug-non-zts-20160303/opencc.so' -\nlibopencc.so.2: cannot open shared object file: No such file or directory in\nUnknown on line 0\n**\n```\n\nlibopencc.so.2\n\n```\nln -s /usr/lib/libopencc.so.2 /usr/lib64/libopencc.so.2\n```\n\nphp-fpmphpopencc","source":"_posts/centos7OpenCCPHP Copencc4php.md","raw":"---\ntitle: centos7OpenCCPHP Copencc4php\ndate: 2018-03-31 07:39:00\ntags: \n  - OpenCC\ncategories:\n  - \nurl: install-the-php-c-extension-opencc\ndescription: PHPC/C++PHPOpenCCcentos7OpenCCPHPPHP7.1.12Zend OPcache\n---\n\n> PHPC/C++PHPOpenCCcentos7OpenCCPHPPHP7.1.12Zend OPcache\n\n## EPEL\n\nEPELExtra Packages for Enterprise\nLinuxepel\n\n```\nyum -y install epel-release\n```\n\n## Doxygen\n\nDoxygenOpenCCCould NOT find Doxygen (missing:\nDOXYGEN_EXECUTABLE)Doxygen\n\n```\nyum -y install doxygen\n```\n\n## OpenCC\n\n```\ngit clone https://github.com/BYVoid/OpenCC.git --depth 1\ncd OpenCC\nmake\nsudo make install\n```\n\n## opencc4php\n\n```\ngit clone https://github.com/NauxLiu/opencc4php.git --depth 1\ncd opencc4php\nphpize\n./configure\nmake && sudo make install\n```\n\n## \n\nopencc.sophp.iniphp-fpmOK\n\n```\nphp -m\n```\n\nopencc\n\n```\n**PHP Startup: Unable to load dynamic library\n'/usr/local/php/lib/php/extensions/no-debug-non-zts-20160303/opencc.so' -\nlibopencc.so.2: cannot open shared object file: No such file or directory in\nUnknown on line 0\n**\n```\n\nlibopencc.so.2\n\n```\nln -s /usr/lib/libopencc.so.2 /usr/lib64/libopencc.so.2\n```\n\nphp-fpmphpopencc","slug":"centos7OpenCCPHP Copencc4php","published":1,"updated":"2022-05-12T17:07:15.065Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6aug0019lvtd4ev37ibn","content":"<blockquote>\n<p>PHPC&#x2F;C++PHPOpenCCcentos7OpenCCPHPPHP7.1.12Zend OPcache</p>\n</blockquote>\n<h2 id=\"EPEL\"><a href=\"#EPEL\" class=\"headerlink\" title=\"EPEL\"></a>EPEL</h2><p>EPELExtra Packages for Enterprise<br>Linuxepel</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install epel-release</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Doxygen\"><a href=\"#Doxygen\" class=\"headerlink\" title=\"Doxygen\"></a>Doxygen</h2><p>DoxygenOpenCCCould NOT find Doxygen (missing:<br>DOXYGEN_EXECUTABLE)Doxygen</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install doxygen</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"OpenCC\"><a href=\"#OpenCC\" class=\"headerlink\" title=\"OpenCC\"></a>OpenCC</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/BYVoid/OpenCC.git --depth 1</span><br><span class=\"line\">cd OpenCC</span><br><span class=\"line\">make</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"opencc4php\"><a href=\"#opencc4php\" class=\"headerlink\" title=\"opencc4php\"></a>opencc4php</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/NauxLiu/opencc4php.git --depth 1</span><br><span class=\"line\">cd opencc4php</span><br><span class=\"line\">phpize</span><br><span class=\"line\">./configure</span><br><span class=\"line\">make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>opencc.sophp.iniphp-fpmOK</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php -m</span><br></pre></td></tr></table></figure>\n\n<p>opencc</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">**PHP Startup: Unable to load dynamic library</span><br><span class=\"line\">&#x27;/usr/local/php/lib/php/extensions/no-debug-non-zts-20160303/opencc.so&#x27; -</span><br><span class=\"line\">libopencc.so.2: cannot open shared object file: No such file or directory in</span><br><span class=\"line\">Unknown on line 0</span><br><span class=\"line\">**</span><br></pre></td></tr></table></figure>\n\n<p>libopencc.so.2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s /usr/lib/libopencc.so.2 /usr/lib64/libopencc.so.2</span><br></pre></td></tr></table></figure>\n\n<p>php-fpmphpopencc</p>\n","site":{"data":{}},"length":1097,"excerpt":"","more":"<blockquote>\n<p>PHPC&#x2F;C++PHPOpenCCcentos7OpenCCPHPPHP7.1.12Zend OPcache</p>\n</blockquote>\n<h2 id=\"EPEL\"><a href=\"#EPEL\" class=\"headerlink\" title=\"EPEL\"></a>EPEL</h2><p>EPELExtra Packages for Enterprise<br>Linuxepel</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install epel-release</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Doxygen\"><a href=\"#Doxygen\" class=\"headerlink\" title=\"Doxygen\"></a>Doxygen</h2><p>DoxygenOpenCCCould NOT find Doxygen (missing:<br>DOXYGEN_EXECUTABLE)Doxygen</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install doxygen</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"OpenCC\"><a href=\"#OpenCC\" class=\"headerlink\" title=\"OpenCC\"></a>OpenCC</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/BYVoid/OpenCC.git --depth 1</span><br><span class=\"line\">cd OpenCC</span><br><span class=\"line\">make</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"opencc4php\"><a href=\"#opencc4php\" class=\"headerlink\" title=\"opencc4php\"></a>opencc4php</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/NauxLiu/opencc4php.git --depth 1</span><br><span class=\"line\">cd opencc4php</span><br><span class=\"line\">phpize</span><br><span class=\"line\">./configure</span><br><span class=\"line\">make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>opencc.sophp.iniphp-fpmOK</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php -m</span><br></pre></td></tr></table></figure>\n\n<p>opencc</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">**PHP Startup: Unable to load dynamic library</span><br><span class=\"line\">&#x27;/usr/local/php/lib/php/extensions/no-debug-non-zts-20160303/opencc.so&#x27; -</span><br><span class=\"line\">libopencc.so.2: cannot open shared object file: No such file or directory in</span><br><span class=\"line\">Unknown on line 0</span><br><span class=\"line\">**</span><br></pre></td></tr></table></figure>\n\n<p>libopencc.so.2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s /usr/lib/libopencc.so.2 /usr/lib64/libopencc.so.2</span><br></pre></td></tr></table></figure>\n\n<p>php-fpmphpopencc</p>\n"},{"title":"centos7iptables","date":"2018-01-29T23:15:00.000Z","url":"install-iptables-as-firewall-on-centos7","description":"centos7centosfirewalldiptables","_content":"\n> centos7centosfirewalldiptables\n\n## iptables\n\n```\nyum install iptables -y\nyum update iptables  -y\nyum install iptables-services -y\n/usr/sbin/iptables\n```\n\n## firewalld\n\n```\nsystemctl stop firewalld\nsystemctl mask firewalld\n```\n\n## iptables\n\n```\niptables -P INPUT ACCEPT\niptables -F\niptables -X\niptables -Z\niptables -A INPUT -i lo -j ACCEPT\niptables -A INPUT -p tcp --dport 22 -j ACCEPT\niptables -A INPUT -p tcp --dport 21 -j ACCEPT\niptables -A INPUT -p tcp --dport 80 -j ACCEPT\niptables -A INPUT -p tcp --dport 443 -j ACCEPT\niptables -A INPUT -m state --state  RELATED,ESTABLISHED -j ACCEPT\niptables -P INPUT DROP\niptables -P OUTPUT ACCEPT\niptables -P FORWARD DROP\n```\n\n## iptables\n\n```\nservice iptables save\n```\n\n## iptables\n\n```\nsystemctl enable iptables.service\nsystemctl start iptables.service\n```\n\n## \n\n/etc/sysconfig/iptables\n\n```\n# Firewall configuration written by system-config-securitylevel\n# Manual customization of this file is not recommended.\n*filter\n:INPUT DROP [0:0]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [0:0]\n:syn-flood - [0:0]\n-A INPUT -i lo -j ACCEPT\n-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT\n-A INPUT -p icmp -m limit --limit 1/sec --limit-burst 10 -j ACCEPT\n-A INPUT -f -m limit --limit 100/sec --limit-burst 100 -j ACCEPT\n-A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j syn-flood\n-A INPUT -j REJECT --reject-with icmp-host-prohibited\n-A syn-flood -p tcp -m limit --limit 3/sec --limit-burst 6 -j RETURN\n-A syn-flood -j REJECT --reject-with icmp-port-unreachable\nCOMMIT\n```\n\niptablesiptablesservice iptables save\n\n```\nsystemctl enable iptables.service #centos7\nchkconfig --level 3 iptables on #centos7\nservice iptables restart\nreboot\n```","source":"_posts/centos7iptables.md","raw":"---\ntitle: centos7iptables\ndate: 2018-01-30 07:15:00\ntags: \n  - iptables\n  - \ncategories:\n  - \nurl: install-iptables-as-firewall-on-centos7\ndescription: centos7centosfirewalldiptables\n---\n\n> centos7centosfirewalldiptables\n\n## iptables\n\n```\nyum install iptables -y\nyum update iptables  -y\nyum install iptables-services -y\n/usr/sbin/iptables\n```\n\n## firewalld\n\n```\nsystemctl stop firewalld\nsystemctl mask firewalld\n```\n\n## iptables\n\n```\niptables -P INPUT ACCEPT\niptables -F\niptables -X\niptables -Z\niptables -A INPUT -i lo -j ACCEPT\niptables -A INPUT -p tcp --dport 22 -j ACCEPT\niptables -A INPUT -p tcp --dport 21 -j ACCEPT\niptables -A INPUT -p tcp --dport 80 -j ACCEPT\niptables -A INPUT -p tcp --dport 443 -j ACCEPT\niptables -A INPUT -m state --state  RELATED,ESTABLISHED -j ACCEPT\niptables -P INPUT DROP\niptables -P OUTPUT ACCEPT\niptables -P FORWARD DROP\n```\n\n## iptables\n\n```\nservice iptables save\n```\n\n## iptables\n\n```\nsystemctl enable iptables.service\nsystemctl start iptables.service\n```\n\n## \n\n/etc/sysconfig/iptables\n\n```\n# Firewall configuration written by system-config-securitylevel\n# Manual customization of this file is not recommended.\n*filter\n:INPUT DROP [0:0]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [0:0]\n:syn-flood - [0:0]\n-A INPUT -i lo -j ACCEPT\n-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT\n-A INPUT -p icmp -m limit --limit 1/sec --limit-burst 10 -j ACCEPT\n-A INPUT -f -m limit --limit 100/sec --limit-burst 100 -j ACCEPT\n-A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j syn-flood\n-A INPUT -j REJECT --reject-with icmp-host-prohibited\n-A syn-flood -p tcp -m limit --limit 3/sec --limit-burst 6 -j RETURN\n-A syn-flood -j REJECT --reject-with icmp-port-unreachable\nCOMMIT\n```\n\niptablesiptablesservice iptables save\n\n```\nsystemctl enable iptables.service #centos7\nchkconfig --level 3 iptables on #centos7\nservice iptables restart\nreboot\n```","slug":"centos7iptables","published":1,"updated":"2022-05-12T17:07:09.612Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6auj001clvtd0c1m7lib","content":"<blockquote>\n<p>centos7centosfirewalldiptables</p>\n</blockquote>\n<h2 id=\"iptables\"><a href=\"#iptables\" class=\"headerlink\" title=\"iptables\"></a>iptables</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install iptables -y</span><br><span class=\"line\">yum update iptables  -y</span><br><span class=\"line\">yum install iptables-services -y</span><br><span class=\"line\">/usr/sbin/iptables</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"firewalld\"><a href=\"#firewalld\" class=\"headerlink\" title=\"firewalld\"></a>firewalld</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl stop firewalld</span><br><span class=\"line\">systemctl mask firewalld</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"iptables\"><a href=\"#iptables\" class=\"headerlink\" title=\"iptables\"></a>iptables</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -P INPUT ACCEPT</span><br><span class=\"line\">iptables -F</span><br><span class=\"line\">iptables -X</span><br><span class=\"line\">iptables -Z</span><br><span class=\"line\">iptables -A INPUT -i lo -j ACCEPT</span><br><span class=\"line\">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class=\"line\">iptables -A INPUT -p tcp --dport 21 -j ACCEPT</span><br><span class=\"line\">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class=\"line\">iptables -A INPUT -p tcp --dport 443 -j ACCEPT</span><br><span class=\"line\">iptables -A INPUT -m state --state  RELATED,ESTABLISHED -j ACCEPT</span><br><span class=\"line\">iptables -P INPUT DROP</span><br><span class=\"line\">iptables -P OUTPUT ACCEPT</span><br><span class=\"line\">iptables -P FORWARD DROP</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"iptables\"><a href=\"#iptables\" class=\"headerlink\" title=\"iptables\"></a>iptables</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service iptables save</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"iptables\"><a href=\"#iptables\" class=\"headerlink\" title=\"iptables\"></a>iptables</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl enable iptables.service</span><br><span class=\"line\">systemctl start iptables.service</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>&#x2F;etc&#x2F;sysconfig&#x2F;iptables</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Firewall configuration written by system-config-securitylevel</span><br><span class=\"line\"># Manual customization of this file is not recommended.</span><br><span class=\"line\">*filter</span><br><span class=\"line\">:INPUT DROP [0:0]</span><br><span class=\"line\">:FORWARD ACCEPT [0:0]</span><br><span class=\"line\">:OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">:syn-flood - [0:0]</span><br><span class=\"line\">-A INPUT -i lo -j ACCEPT</span><br><span class=\"line\">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class=\"line\">-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</span><br><span class=\"line\">-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT</span><br><span class=\"line\">-A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT</span><br><span class=\"line\">-A INPUT -p icmp -m limit --limit 1/sec --limit-burst 10 -j ACCEPT</span><br><span class=\"line\">-A INPUT -f -m limit --limit 100/sec --limit-burst 100 -j ACCEPT</span><br><span class=\"line\">-A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j syn-flood</span><br><span class=\"line\">-A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class=\"line\">-A syn-flood -p tcp -m limit --limit 3/sec --limit-burst 6 -j RETURN</span><br><span class=\"line\">-A syn-flood -j REJECT --reject-with icmp-port-unreachable</span><br><span class=\"line\">COMMIT</span><br></pre></td></tr></table></figure>\n\n<p>iptablesiptablesservice iptables save</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl enable iptables.service #centos7</span><br><span class=\"line\">chkconfig --level 3 iptables on #centos7</span><br><span class=\"line\">service iptables restart</span><br><span class=\"line\">reboot</span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":1723,"excerpt":"","more":"<blockquote>\n<p>centos7centosfirewalldiptables</p>\n</blockquote>\n<h2 id=\"iptables\"><a href=\"#iptables\" class=\"headerlink\" title=\"iptables\"></a>iptables</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install iptables -y</span><br><span class=\"line\">yum update iptables  -y</span><br><span class=\"line\">yum install iptables-services -y</span><br><span class=\"line\">/usr/sbin/iptables</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"firewalld\"><a href=\"#firewalld\" class=\"headerlink\" title=\"firewalld\"></a>firewalld</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl stop firewalld</span><br><span class=\"line\">systemctl mask firewalld</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"iptables\"><a href=\"#iptables\" class=\"headerlink\" title=\"iptables\"></a>iptables</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -P INPUT ACCEPT</span><br><span class=\"line\">iptables -F</span><br><span class=\"line\">iptables -X</span><br><span class=\"line\">iptables -Z</span><br><span class=\"line\">iptables -A INPUT -i lo -j ACCEPT</span><br><span class=\"line\">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class=\"line\">iptables -A INPUT -p tcp --dport 21 -j ACCEPT</span><br><span class=\"line\">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class=\"line\">iptables -A INPUT -p tcp --dport 443 -j ACCEPT</span><br><span class=\"line\">iptables -A INPUT -m state --state  RELATED,ESTABLISHED -j ACCEPT</span><br><span class=\"line\">iptables -P INPUT DROP</span><br><span class=\"line\">iptables -P OUTPUT ACCEPT</span><br><span class=\"line\">iptables -P FORWARD DROP</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"iptables\"><a href=\"#iptables\" class=\"headerlink\" title=\"iptables\"></a>iptables</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service iptables save</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"iptables\"><a href=\"#iptables\" class=\"headerlink\" title=\"iptables\"></a>iptables</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl enable iptables.service</span><br><span class=\"line\">systemctl start iptables.service</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>&#x2F;etc&#x2F;sysconfig&#x2F;iptables</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Firewall configuration written by system-config-securitylevel</span><br><span class=\"line\"># Manual customization of this file is not recommended.</span><br><span class=\"line\">*filter</span><br><span class=\"line\">:INPUT DROP [0:0]</span><br><span class=\"line\">:FORWARD ACCEPT [0:0]</span><br><span class=\"line\">:OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">:syn-flood - [0:0]</span><br><span class=\"line\">-A INPUT -i lo -j ACCEPT</span><br><span class=\"line\">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class=\"line\">-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</span><br><span class=\"line\">-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT</span><br><span class=\"line\">-A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT</span><br><span class=\"line\">-A INPUT -p icmp -m limit --limit 1/sec --limit-burst 10 -j ACCEPT</span><br><span class=\"line\">-A INPUT -f -m limit --limit 100/sec --limit-burst 100 -j ACCEPT</span><br><span class=\"line\">-A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j syn-flood</span><br><span class=\"line\">-A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class=\"line\">-A syn-flood -p tcp -m limit --limit 3/sec --limit-burst 6 -j RETURN</span><br><span class=\"line\">-A syn-flood -j REJECT --reject-with icmp-port-unreachable</span><br><span class=\"line\">COMMIT</span><br></pre></td></tr></table></figure>\n\n<p>iptablesiptablesservice iptables save</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl enable iptables.service #centos7</span><br><span class=\"line\">chkconfig --level 3 iptables on #centos7</span><br><span class=\"line\">service iptables restart</span><br><span class=\"line\">reboot</span><br></pre></td></tr></table></figure>"},{"title":"centos7Kafka","date":"2018-01-02T23:03:00.000Z","url":"install-kafka-on-centos-7","description":"KafkaKafkaJava HadoopStormSpark","_content":"\n## \n\nKafkaKafkaJava HadoopStormSpark\n\nKafka Centos 7\n\n## JDK\n\nKafka Zookeeper KafkaZookeeper Java oracleJDK \n\n```\ntar zxvf jdk-8u65-linux-x64.tar.gz\nmv jdk1.8.0_65 java\n```\n\nJava \n\n```\nJAVA_HOME=/opt/java\nPATH=$PATH:$JAVA_HOME/bin\nexport JAVA_HOME PATH\n```\n\nyum install\n\n## Kafka\n\nKafka \n\n```\ntar zxvf kafka_2.11-0.8.2.2.tgz\nmv kafka_2.11-0.8.2.2 kafka\ncd kafka\n```\n\n## \n\n1.Zookeeper\n\nZookeeper \n\n```\nbin/zookeeper-server-start.sh -daemon config/zookeeper.properties\n[2015-10-26 04:26:59,585] INFO Reading configuration from: config/zookeeper.properties (org.apache.zookeeper.server.quorum.QuorumPeerConfig)....\n```\n\n2.Kafka \n\nkafka-server-start.sh kafka \n\n```\nbin/kafka-server-start.sh config/server.properties\n[2015-10-26 04:28:56,115] INFO Verifying properties (kafka.utils.VerifiableProperties) [2015-10-26 04:28:56,141] INFO Property broker.id is overridden to 0 (kafka.utils.VerifiableProperties)\n```\n\n3.topic\n\nkafka-topics.sh topic test\n\n```\nbin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test\n```\n\n\n4. topic\n\n```\nbin/kafka-topics.sh --list --zookeeper localhost:2181\ntest\n```\n\n\n5. \n\nkafka-console-producer.sh \n\n```\nbin/kafka-console-producer.sh --broker-list localhost:9092 --topic test\nHello world Hello Kafka\n```\n\n6. \n\nkafka-console-consumer.sh \n\n```\nbin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic test --from-beginning\n```\n\n## \n\n ### broker \n\nbroker broker  id \n\n```\ncp config/server.properties config/server-1.properties\n```\n\n\n\n```\nconfig/server-1.properties:\n    broker.id=1\n    port=9093\n    log.dir=/tmp/kafka-logs-1\n```\n\nKafka\n\n```\nbin/kafka-server-start.sh config/server-1.properties &\n```\n\n\n\n### broker \n\nKafkaZookeeper  \n10.4.253.2210.4.253.2310.4.253.24Zookeeper\n\n```\ninitLimit=5\nsyncLimit=2\nserver.1=10.4.253.22:2888:3888\nserver.2=10.4.253.23:2888:3888\nserver.3=10.4.253.24:2888:3888\n```\n\nKafka broke idzookeeper.connect:\n\n```\nzookeeper.connect=10.4.253.22:2181,10.4.253.23:2181,10.4.253.24:2181\n```\n\nZookeeperKafka","source":"_posts/centos7Kafka.md","raw":"---\ntitle: centos7Kafka\ndate: 2018-01-03 07:03:00\ntags: \n  - kafka\n  - \ncategories:\n  - \nurl: install-kafka-on-centos-7\ndescription: KafkaKafkaJava HadoopStormSpark\n---\n\n## \n\nKafkaKafkaJava HadoopStormSpark\n\nKafka Centos 7\n\n## JDK\n\nKafka Zookeeper KafkaZookeeper Java oracleJDK \n\n```\ntar zxvf jdk-8u65-linux-x64.tar.gz\nmv jdk1.8.0_65 java\n```\n\nJava \n\n```\nJAVA_HOME=/opt/java\nPATH=$PATH:$JAVA_HOME/bin\nexport JAVA_HOME PATH\n```\n\nyum install\n\n## Kafka\n\nKafka \n\n```\ntar zxvf kafka_2.11-0.8.2.2.tgz\nmv kafka_2.11-0.8.2.2 kafka\ncd kafka\n```\n\n## \n\n1.Zookeeper\n\nZookeeper \n\n```\nbin/zookeeper-server-start.sh -daemon config/zookeeper.properties\n[2015-10-26 04:26:59,585] INFO Reading configuration from: config/zookeeper.properties (org.apache.zookeeper.server.quorum.QuorumPeerConfig)....\n```\n\n2.Kafka \n\nkafka-server-start.sh kafka \n\n```\nbin/kafka-server-start.sh config/server.properties\n[2015-10-26 04:28:56,115] INFO Verifying properties (kafka.utils.VerifiableProperties) [2015-10-26 04:28:56,141] INFO Property broker.id is overridden to 0 (kafka.utils.VerifiableProperties)\n```\n\n3.topic\n\nkafka-topics.sh topic test\n\n```\nbin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test\n```\n\n\n4. topic\n\n```\nbin/kafka-topics.sh --list --zookeeper localhost:2181\ntest\n```\n\n\n5. \n\nkafka-console-producer.sh \n\n```\nbin/kafka-console-producer.sh --broker-list localhost:9092 --topic test\nHello world Hello Kafka\n```\n\n6. \n\nkafka-console-consumer.sh \n\n```\nbin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic test --from-beginning\n```\n\n## \n\n ### broker \n\nbroker broker  id \n\n```\ncp config/server.properties config/server-1.properties\n```\n\n\n\n```\nconfig/server-1.properties:\n    broker.id=1\n    port=9093\n    log.dir=/tmp/kafka-logs-1\n```\n\nKafka\n\n```\nbin/kafka-server-start.sh config/server-1.properties &\n```\n\n\n\n### broker \n\nKafkaZookeeper  \n10.4.253.2210.4.253.2310.4.253.24Zookeeper\n\n```\ninitLimit=5\nsyncLimit=2\nserver.1=10.4.253.22:2888:3888\nserver.2=10.4.253.23:2888:3888\nserver.3=10.4.253.24:2888:3888\n```\n\nKafka broke idzookeeper.connect:\n\n```\nzookeeper.connect=10.4.253.22:2181,10.4.253.23:2181,10.4.253.24:2181\n```\n\nZookeeperKafka","slug":"centos7Kafka","published":1,"updated":"2022-05-12T17:07:28.941Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6auk001elvtdflv469n2","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>KafkaKafkaJava HadoopStormSpark</p>\n<p>Kafka Centos 7</p>\n<h2 id=\"JDK\"><a href=\"#JDK\" class=\"headerlink\" title=\"JDK\"></a>JDK</h2><p>Kafka Zookeeper KafkaZookeeper Java oracleJDK </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxvf jdk-8u65-linux-x64.tar.gz</span><br><span class=\"line\">mv jdk1.8.0_65 java</span><br></pre></td></tr></table></figure>\n\n<p>Java </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JAVA_HOME=/opt/java</span><br><span class=\"line\">PATH=$PATH:$JAVA_HOME/bin</span><br><span class=\"line\">export JAVA_HOME PATH</span><br></pre></td></tr></table></figure>\n\n<p>yum install</p>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><p>Kafka </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxvf kafka_2.11-0.8.2.2.tgz</span><br><span class=\"line\">mv kafka_2.11-0.8.2.2 kafka</span><br><span class=\"line\">cd kafka</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>1.Zookeeper</p>\n<p>Zookeeper </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/zookeeper-server-start.sh -daemon config/zookeeper.properties</span><br><span class=\"line\">[2015-10-26 04:26:59,585] INFO Reading configuration from: config/zookeeper.properties (org.apache.zookeeper.server.quorum.QuorumPeerConfig)....</span><br></pre></td></tr></table></figure>\n\n<p>2.Kafka </p>\n<p>kafka-server-start.sh kafka </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-server-start.sh config/server.properties</span><br><span class=\"line\">[2015-10-26 04:28:56,115] INFO Verifying properties (kafka.utils.VerifiableProperties) [2015-10-26 04:28:56,141] INFO Property broker.id is overridden to 0 (kafka.utils.VerifiableProperties)</span><br></pre></td></tr></table></figure>\n\n<p>3.topic</p>\n<p>kafka-topics.sh topic test</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test</span><br></pre></td></tr></table></figure>\n\n\n<ol start=\"4\">\n<li>topic</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-topics.sh --list --zookeeper localhost:2181</span><br><span class=\"line\">test</span><br></pre></td></tr></table></figure>\n\n\n<ol start=\"5\">\n<li></li>\n</ol>\n<p>kafka-console-producer.sh </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test</span><br><span class=\"line\">Hello world Hello Kafka</span><br></pre></td></tr></table></figure>\n\n<ol start=\"6\">\n<li></li>\n</ol>\n<p>kafka-console-consumer.sh </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic test --from-beginning</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"broker-\"><a href=\"#broker-\" class=\"headerlink\" title=\"broker \"></a>broker </h3><p>broker broker  id </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp config/server.properties config/server-1.properties</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config/server-1.properties:</span><br><span class=\"line\">    broker.id=1</span><br><span class=\"line\">    port=9093</span><br><span class=\"line\">    log.dir=/tmp/kafka-logs-1</span><br></pre></td></tr></table></figure>\n\n<p>Kafka</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-server-start.sh config/server-1.properties &amp;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h3 id=\"broker-\"><a href=\"#broker-\" class=\"headerlink\" title=\"broker \"></a>broker </h3><p>KafkaZookeeper  <br>10.4.253.2210.4.253.2310.4.253.24Zookeeper</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">initLimit=5</span><br><span class=\"line\">syncLimit=2</span><br><span class=\"line\">server.1=10.4.253.22:2888:3888</span><br><span class=\"line\">server.2=10.4.253.23:2888:3888</span><br><span class=\"line\">server.3=10.4.253.24:2888:3888</span><br></pre></td></tr></table></figure>\n\n<p>Kafka broke idzookeeper.connect:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zookeeper.connect=10.4.253.22:2181,10.4.253.23:2181,10.4.253.24:2181</span><br></pre></td></tr></table></figure>\n\n<p>ZookeeperKafka</p>\n","site":{"data":{}},"length":2168,"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>KafkaKafkaJava HadoopStormSpark</p>\n<p>Kafka Centos 7</p>\n<h2 id=\"JDK\"><a href=\"#JDK\" class=\"headerlink\" title=\"JDK\"></a>JDK</h2><p>Kafka Zookeeper KafkaZookeeper Java oracleJDK </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxvf jdk-8u65-linux-x64.tar.gz</span><br><span class=\"line\">mv jdk1.8.0_65 java</span><br></pre></td></tr></table></figure>\n\n<p>Java </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JAVA_HOME=/opt/java</span><br><span class=\"line\">PATH=$PATH:$JAVA_HOME/bin</span><br><span class=\"line\">export JAVA_HOME PATH</span><br></pre></td></tr></table></figure>\n\n<p>yum install</p>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><p>Kafka </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxvf kafka_2.11-0.8.2.2.tgz</span><br><span class=\"line\">mv kafka_2.11-0.8.2.2 kafka</span><br><span class=\"line\">cd kafka</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>1.Zookeeper</p>\n<p>Zookeeper </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/zookeeper-server-start.sh -daemon config/zookeeper.properties</span><br><span class=\"line\">[2015-10-26 04:26:59,585] INFO Reading configuration from: config/zookeeper.properties (org.apache.zookeeper.server.quorum.QuorumPeerConfig)....</span><br></pre></td></tr></table></figure>\n\n<p>2.Kafka </p>\n<p>kafka-server-start.sh kafka </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-server-start.sh config/server.properties</span><br><span class=\"line\">[2015-10-26 04:28:56,115] INFO Verifying properties (kafka.utils.VerifiableProperties) [2015-10-26 04:28:56,141] INFO Property broker.id is overridden to 0 (kafka.utils.VerifiableProperties)</span><br></pre></td></tr></table></figure>\n\n<p>3.topic</p>\n<p>kafka-topics.sh topic test</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test</span><br></pre></td></tr></table></figure>\n\n\n<ol start=\"4\">\n<li>topic</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-topics.sh --list --zookeeper localhost:2181</span><br><span class=\"line\">test</span><br></pre></td></tr></table></figure>\n\n\n<ol start=\"5\">\n<li></li>\n</ol>\n<p>kafka-console-producer.sh </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test</span><br><span class=\"line\">Hello world Hello Kafka</span><br></pre></td></tr></table></figure>\n\n<ol start=\"6\">\n<li></li>\n</ol>\n<p>kafka-console-consumer.sh </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic test --from-beginning</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"broker-\"><a href=\"#broker-\" class=\"headerlink\" title=\"broker \"></a>broker </h3><p>broker broker  id </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp config/server.properties config/server-1.properties</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config/server-1.properties:</span><br><span class=\"line\">    broker.id=1</span><br><span class=\"line\">    port=9093</span><br><span class=\"line\">    log.dir=/tmp/kafka-logs-1</span><br></pre></td></tr></table></figure>\n\n<p>Kafka</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-server-start.sh config/server-1.properties &amp;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h3 id=\"broker-\"><a href=\"#broker-\" class=\"headerlink\" title=\"broker \"></a>broker </h3><p>KafkaZookeeper  <br>10.4.253.2210.4.253.2310.4.253.24Zookeeper</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">initLimit=5</span><br><span class=\"line\">syncLimit=2</span><br><span class=\"line\">server.1=10.4.253.22:2888:3888</span><br><span class=\"line\">server.2=10.4.253.23:2888:3888</span><br><span class=\"line\">server.3=10.4.253.24:2888:3888</span><br></pre></td></tr></table></figure>\n\n<p>Kafka broke idzookeeper.connect:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zookeeper.connect=10.4.253.22:2181,10.4.253.23:2181,10.4.253.24:2181</span><br></pre></td></tr></table></figure>\n\n<p>ZookeeperKafka</p>\n"},{"title":"linuxrabbitmq","date":"2018-08-17T00:00:00.000Z","url":"install-rabbitmq-on-linux","description":"RabbitMQRabbitMQ","_content":"\nRabbitMQRabbitMQ\n\n## \n\ncentos7.464bituname -a3.10.0-693.2.2.el7.x86_64PHP\nCPHP7.1.19\n\n## RabbitMQ\n\nRabbitMQyumRabbitMQ.\n\n```\nyum install rabbitmq-server -y\nsystemctl start rabbitmq-server\n```\n\nRabbitMQEPEL\n\n```\nyum install epel-release -y\n```\n\nEPELRPMRPMRPMRHEL\n CentOSScientific Linux\n\n## rabbitmq-c\n\nRabbitMQPHP CamqpCrabbitmq-camqprabbitmq-cv0.9.0\n\n```\nwget https://github.com/alanxz/rabbitmq-c/archive/v0.9.0.tar.gz\ntar xzf v0.9.0.tar.gz\ncd rabbitmq-c*\nmkdir build\ncd build\ncmake -DCMAKE_INSTALL_PREFIX=/usr/local/rabbitmq-c ..\ncmake --build .  --target install\nln -s /usr/local/rabbitmq-c/lib64 /usr/local/rabbitmq-c/lib\n```\n\ncmakecmakeMakefile-DCMAKE_INSTALL_PREFIX-DCMAKE_INSTALL_PREFIXCMAKE_INSTALL_PREFIXconfigurePREFIX\n\nlib64amqp/usr/local/rabbitmq-c/lib/usr/local/rabbitmq-c/lib\n\n## amqp\n\n```\nwget https://pecl.php.net/get/amqp-1.9.3.tgz\ncd amqp-1.9.3\nphpize\n./configure --with-php-config=/usr/local/php/bin/php-config --with-amqp --with-librabbitmq-dir=/usr/local/rabbitmq-c\nmake\nmake install\n```\n\n## amqp\n\n```\necho 'extension=amqp.so' >> /usr/local/php/etc/php.ini\nservice php-fpm restart\n```\n\n## amqp\n\n```\nphp -m\n```\n\namqpOK","source":"_posts/linuxrabbitmq.md","raw":"---\ntitle: linuxrabbitmq\ndate: 2018-08-17 08:00:00\ntags: \n  - rabbitmq\n  - \ncategories:\n  - \nurl: install-rabbitmq-on-linux\ndescription: RabbitMQRabbitMQ\n---\n\nRabbitMQRabbitMQ\n\n## \n\ncentos7.464bituname -a3.10.0-693.2.2.el7.x86_64PHP\nCPHP7.1.19\n\n## RabbitMQ\n\nRabbitMQyumRabbitMQ.\n\n```\nyum install rabbitmq-server -y\nsystemctl start rabbitmq-server\n```\n\nRabbitMQEPEL\n\n```\nyum install epel-release -y\n```\n\nEPELRPMRPMRPMRHEL\n CentOSScientific Linux\n\n## rabbitmq-c\n\nRabbitMQPHP CamqpCrabbitmq-camqprabbitmq-cv0.9.0\n\n```\nwget https://github.com/alanxz/rabbitmq-c/archive/v0.9.0.tar.gz\ntar xzf v0.9.0.tar.gz\ncd rabbitmq-c*\nmkdir build\ncd build\ncmake -DCMAKE_INSTALL_PREFIX=/usr/local/rabbitmq-c ..\ncmake --build .  --target install\nln -s /usr/local/rabbitmq-c/lib64 /usr/local/rabbitmq-c/lib\n```\n\ncmakecmakeMakefile-DCMAKE_INSTALL_PREFIX-DCMAKE_INSTALL_PREFIXCMAKE_INSTALL_PREFIXconfigurePREFIX\n\nlib64amqp/usr/local/rabbitmq-c/lib/usr/local/rabbitmq-c/lib\n\n## amqp\n\n```\nwget https://pecl.php.net/get/amqp-1.9.3.tgz\ncd amqp-1.9.3\nphpize\n./configure --with-php-config=/usr/local/php/bin/php-config --with-amqp --with-librabbitmq-dir=/usr/local/rabbitmq-c\nmake\nmake install\n```\n\n## amqp\n\n```\necho 'extension=amqp.so' >> /usr/local/php/etc/php.ini\nservice php-fpm restart\n```\n\n## amqp\n\n```\nphp -m\n```\n\namqpOK","slug":"linuxrabbitmq","published":1,"updated":"2022-05-12T17:07:33.763Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6aul001hlvtdby89cx0d","content":"<p>RabbitMQRabbitMQ</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>centos7.464bituname -a3.10.0-693.2.2.el7.x86_64PHP<br>CPHP7.1.19</p>\n<h2 id=\"RabbitMQ\"><a href=\"#RabbitMQ\" class=\"headerlink\" title=\"RabbitMQ\"></a>RabbitMQ</h2><p>RabbitMQyumRabbitMQ.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install rabbitmq-server -y</span><br><span class=\"line\">systemctl start rabbitmq-server</span><br></pre></td></tr></table></figure>\n\n<p>RabbitMQEPEL</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install epel-release -y</span><br></pre></td></tr></table></figure>\n\n<p>EPELRPMRPMRPMRHEL<br> CentOSScientific Linux</p>\n<h2 id=\"rabbitmq-c\"><a href=\"#rabbitmq-c\" class=\"headerlink\" title=\"rabbitmq-c\"></a>rabbitmq-c</h2><p>RabbitMQPHP CamqpCrabbitmq-camqprabbitmq-cv0.9.0</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/alanxz/rabbitmq-c/archive/v0.9.0.tar.gz</span><br><span class=\"line\">tar xzf v0.9.0.tar.gz</span><br><span class=\"line\">cd rabbitmq-c*</span><br><span class=\"line\">mkdir build</span><br><span class=\"line\">cd build</span><br><span class=\"line\">cmake -DCMAKE_INSTALL_PREFIX=/usr/local/rabbitmq-c ..</span><br><span class=\"line\">cmake --build .  --target install</span><br><span class=\"line\">ln -s /usr/local/rabbitmq-c/lib64 /usr/local/rabbitmq-c/lib</span><br></pre></td></tr></table></figure>\n\n<p>cmakecmakeMakefile-DCMAKE_INSTALL_PREFIX-DCMAKE_INSTALL_PREFIXCMAKE_INSTALL_PREFIXconfigurePREFIX</p>\n<p>lib64amqp&#x2F;usr&#x2F;local&#x2F;rabbitmq-c&#x2F;lib&#x2F;usr&#x2F;local&#x2F;rabbitmq-c&#x2F;lib</p>\n<h2 id=\"amqp\"><a href=\"#amqp\" class=\"headerlink\" title=\"amqp\"></a>amqp</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://pecl.php.net/get/amqp-1.9.3.tgz</span><br><span class=\"line\">cd amqp-1.9.3</span><br><span class=\"line\">phpize</span><br><span class=\"line\">./configure --with-php-config=/usr/local/php/bin/php-config --with-amqp --with-librabbitmq-dir=/usr/local/rabbitmq-c</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"amqp\"><a href=\"#amqp\" class=\"headerlink\" title=\"amqp\"></a>amqp</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;extension=amqp.so&#x27; &gt;&gt; /usr/local/php/etc/php.ini</span><br><span class=\"line\">service php-fpm restart</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"amqp\"><a href=\"#amqp\" class=\"headerlink\" title=\"amqp\"></a>amqp</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php -m</span><br></pre></td></tr></table></figure>\n\n<p>amqpOK</p>\n","site":{"data":{}},"length":1497,"excerpt":"","more":"<p>RabbitMQRabbitMQ</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>centos7.464bituname -a3.10.0-693.2.2.el7.x86_64PHP<br>CPHP7.1.19</p>\n<h2 id=\"RabbitMQ\"><a href=\"#RabbitMQ\" class=\"headerlink\" title=\"RabbitMQ\"></a>RabbitMQ</h2><p>RabbitMQyumRabbitMQ.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install rabbitmq-server -y</span><br><span class=\"line\">systemctl start rabbitmq-server</span><br></pre></td></tr></table></figure>\n\n<p>RabbitMQEPEL</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install epel-release -y</span><br></pre></td></tr></table></figure>\n\n<p>EPELRPMRPMRPMRHEL<br> CentOSScientific Linux</p>\n<h2 id=\"rabbitmq-c\"><a href=\"#rabbitmq-c\" class=\"headerlink\" title=\"rabbitmq-c\"></a>rabbitmq-c</h2><p>RabbitMQPHP CamqpCrabbitmq-camqprabbitmq-cv0.9.0</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/alanxz/rabbitmq-c/archive/v0.9.0.tar.gz</span><br><span class=\"line\">tar xzf v0.9.0.tar.gz</span><br><span class=\"line\">cd rabbitmq-c*</span><br><span class=\"line\">mkdir build</span><br><span class=\"line\">cd build</span><br><span class=\"line\">cmake -DCMAKE_INSTALL_PREFIX=/usr/local/rabbitmq-c ..</span><br><span class=\"line\">cmake --build .  --target install</span><br><span class=\"line\">ln -s /usr/local/rabbitmq-c/lib64 /usr/local/rabbitmq-c/lib</span><br></pre></td></tr></table></figure>\n\n<p>cmakecmakeMakefile-DCMAKE_INSTALL_PREFIX-DCMAKE_INSTALL_PREFIXCMAKE_INSTALL_PREFIXconfigurePREFIX</p>\n<p>lib64amqp&#x2F;usr&#x2F;local&#x2F;rabbitmq-c&#x2F;lib&#x2F;usr&#x2F;local&#x2F;rabbitmq-c&#x2F;lib</p>\n<h2 id=\"amqp\"><a href=\"#amqp\" class=\"headerlink\" title=\"amqp\"></a>amqp</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://pecl.php.net/get/amqp-1.9.3.tgz</span><br><span class=\"line\">cd amqp-1.9.3</span><br><span class=\"line\">phpize</span><br><span class=\"line\">./configure --with-php-config=/usr/local/php/bin/php-config --with-amqp --with-librabbitmq-dir=/usr/local/rabbitmq-c</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"amqp\"><a href=\"#amqp\" class=\"headerlink\" title=\"amqp\"></a>amqp</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;extension=amqp.so&#x27; &gt;&gt; /usr/local/php/etc/php.ini</span><br><span class=\"line\">service php-fpm restart</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"amqp\"><a href=\"#amqp\" class=\"headerlink\" title=\"amqp\"></a>amqp</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php -m</span><br></pre></td></tr></table></figure>\n\n<p>amqpOK</p>\n"},{"title":"NPS","date":"2020-03-04T00:16:00.000Z","photos":["/images/b9be3cae2d0a1c308d21909145aebf70.jpeg"],"url":"a-light-weight-network-penetration-tool-nps","description":"FRPngrokDDNSLEDEKool DDNSNPSNPS","_content":"\n> FRPngrokDDNSLEDEKool DDNSNPSNPS\n\n## \n\nWOLUDP\n\n## \n\nNPSLinux 64BitNPS0.26.4\n\n```\nmkdir -p /data/nps #\nwget https://github.com/ehang-io/nps/releases/download/v0.26.4/linux_amd64_server.tar.gz -O /data/linux_amd64_server.tar.gz #\ntar xzf /data/linux_amd64_server.tar.gz -C /data/nps/ #\n```\n\n/data/nps/conf/nps.confpublic_vkeyweb_usernameweb_passwordweb\n\n```\nappname = nps\n#Boot mode(dev|pro)\nrunmode = pro\n\n#HTTP(S) proxy port, no startup if empty\nhttp_proxy_ip=0.0.0.0\nhttp_proxy_port=20080\nhttps_proxy_port=20443\nhttps_just_proxy=true\n#default https certificate setting\nhttps_default_cert_file=conf/server.pem\nhttps_default_key_file=conf/server.key\n\n##bridge\nbridge_type=tcp\nbridge_port=8024\nbridge_ip=0.0.0.0\n\n# Public password, which clients can use to connect to the server\n# After the connection, the server will be able to open relevant ports and parse related domain names according to its own configuration file.\npublic_vkey=leochan1234556789\n\n#Traffic data persistence interval(minute)\n#Ignorance means no persistence\n#flow_store_interval=1\n\n# log level LevelEmergency->0  LevelAlert->1 LevelCritical->2 LevelError->3 LevelWarning->4 LevelNotice->5 LevelInformational->6 LevelDebug->7\nlog_level=7\n#log_path=nps.log\n\n#Whether to restrict IP access, true or false or ignore\n#ip_limit=true\n\n#p2p\n#p2p_ip=127.0.0.1\n#p2p_port=6000\n\n#web\n#web_host=host\nweb_username=yonghuming\nweb_password=mima123456\nweb_port = 8080\nweb_ip=0.0.0.0\nweb_base_url=\nweb_open_ssl=false\nweb_cert_file=conf/server.pem\nweb_key_file=conf/server.key\n# if web under proxy use sub path. like http://host/nps need this.\n#web_base_url=/nps\n\n#Web API unauthenticated IP address(the len of auth_crypt_key must be 16)\n#Remove comments if needed\n#auth_key=test\nauth_crypt_key =1234567812345678\n\n#allow_ports=9001-9009,10001,11000-12000\n\n#Web management multi-user login\nallow_user_login=false\nallow_user_register=false\nallow_user_change_username=false\n\n\n#extension\nallow_flow_limit=false\nallow_rate_limit=false\nallow_tunnel_num_limit=false\nallow_local_proxy=false\nallow_connection_num_limit=false\nallow_multi_ip=false\nsystem_info_display=false\n\n#c\nhttp_cache=true\nhttp_cache_length=100\n\n#get origin ip\nhttp_add_origin_header=false\n\n#pprof debug options\n#pprof_ip=0.0.0.0\n#pprof_port=9999\n```\n\n\n\n\n```\ncd /data/nps #\n./nps install #\nnps start #\n```\n\n\n## \n\nCaddySSLCaddy2.0beta1.0Caddycentos 7.4 64bitinit/linux-systemd/caddy.servicecaddy/usr/local/bin/etc/caddy/Caddyfile\n\n```\nmkdir -p /data/caddy #\nwget https://github.com/caddyserver/caddy/releases/download/v1.0.3/caddy_v1.0.3_linux_amd64.tar.gz -O /data/caddy/caddy_v1.0.3_linux_amd64.tar.gz #\ncp /data/caddy/caddy /usr/local/bin/ #\nchmod a+x /usr/local/bin/caddy #\ncat /data/caddy/init/linux-systemd/caddy.service > /etc/systemd/system/caddy.service #\nsed -i  s/www-data/root/g /etc/systemd/system/caddy.service #caddy\nchmod 755 /etc/systemd/system/caddy.service #\nsystemctl enable caddy.service #\nmkdir -p /etc/ssl/caddy #caddy\nmkdir -p /var/log/caddy #\nmkdir -p /etc/caddy #\ntouch /etc/caddy/Caddyfile #\n```\n\n/etc/caddy/Caddyfilenps.domain.tls10000@163.com\n\n\n```\nnps.domain.tls{\n  gzip\n  redir 301{\n    if {>X-Forwarded-Proto} is http\n    / https://nps.domain.ltd{uri}                  \n  }\n  tls 10000@163.com                                                    \n  log /var/log/caddy/nps.domain.tls.log{\n    rotate_size 5\n    rotate_age 5\n    rotate_keep 2\n    rotate_compress\n  }\n  proxy / 127.0.0.1:8080{\n    transparent\n  }\n}\n```\n\n## \n\n```\necho $PATH #/usr/local/bin\necho PATH=$PATH:/usr/local/bin >> ~/.bash_profile #\necho export PATH >> ~/.bash_profile #\nsource ~/.bash_profile #\nsystemctl start caddy.service #caddy\n```\n\n## caddy\n\nhttps://nps.domain.tlsweb_usernameweb_password\n\n![](/images/nps1.jpg \"\")\n\n![ID](/images/nps3.jpg \"ID\")\n\n## \n\nLinux 64Bit\n\n```\nmkdir -p /data/npc #\nwget https://github.com/ehang-io/nps/releases/download/v0.26.4/linux_amd64_client.tar.gz -O /data/linux_amd64_client.tar.gz #\ntar xzf /data/linux_amd64_client.tar.gz -C /data/npc/ #\n```\n\n/data/npc/conf/npc.confvkeycaddy8.8.8.8IP\n\n```\n[common]\nserver_addr=8.8.8.8:8024\nconn_type=tcp\nvkey=leochan.me\nauto_reconnection=true\nmax_conn=1000\nflow_limit=1000\nrate_limit=1000\ncrypt=true\ncompress=true\n```\n\n\n\n```\ncd /data/npc #\n./npc install -config=/data/npc/conf/npc.conf #\nnpc start #\n```\n\n## \n\nIP192.168.2.505000file.domain.tls\n\n![](/images/nps2.jpg \"\")\n\n\n/etc/caddy/Caddyfile\n\n```\nfile.domain.tls {\n  gzip\n  redir  301 {\n    if {>X-Forwarded-Proto} is http\n    / https://{host}{uri}\n  }\n  tls 10000@163.com\n  log /var/log/caddy/nps.log {\n    rotate_size 5\n    rotate_age 5\n    rotate_keep 2\n    rotate_compress\n  }\n  proxy / 127.0.0.1:20080 {\n    ransparent\n  }\n}\n```\n\ncaddy\n\n## \n\nnps","source":"_posts/NPS.md","raw":"---\ntitle: NPS\ndate: 2020-03-04 08:16:00\ntags: \n  - nps\n  - \ncategories:\n  - \nphotos:\n  - \"/images/b9be3cae2d0a1c308d21909145aebf70.jpeg\"\nurl: a-light-weight-network-penetration-tool-nps\ndescription: FRPngrokDDNSLEDEKool DDNSNPSNPS\n---\n\n> FRPngrokDDNSLEDEKool DDNSNPSNPS\n\n## \n\nWOLUDP\n\n## \n\nNPSLinux 64BitNPS0.26.4\n\n```\nmkdir -p /data/nps #\nwget https://github.com/ehang-io/nps/releases/download/v0.26.4/linux_amd64_server.tar.gz -O /data/linux_amd64_server.tar.gz #\ntar xzf /data/linux_amd64_server.tar.gz -C /data/nps/ #\n```\n\n/data/nps/conf/nps.confpublic_vkeyweb_usernameweb_passwordweb\n\n```\nappname = nps\n#Boot mode(dev|pro)\nrunmode = pro\n\n#HTTP(S) proxy port, no startup if empty\nhttp_proxy_ip=0.0.0.0\nhttp_proxy_port=20080\nhttps_proxy_port=20443\nhttps_just_proxy=true\n#default https certificate setting\nhttps_default_cert_file=conf/server.pem\nhttps_default_key_file=conf/server.key\n\n##bridge\nbridge_type=tcp\nbridge_port=8024\nbridge_ip=0.0.0.0\n\n# Public password, which clients can use to connect to the server\n# After the connection, the server will be able to open relevant ports and parse related domain names according to its own configuration file.\npublic_vkey=leochan1234556789\n\n#Traffic data persistence interval(minute)\n#Ignorance means no persistence\n#flow_store_interval=1\n\n# log level LevelEmergency->0  LevelAlert->1 LevelCritical->2 LevelError->3 LevelWarning->4 LevelNotice->5 LevelInformational->6 LevelDebug->7\nlog_level=7\n#log_path=nps.log\n\n#Whether to restrict IP access, true or false or ignore\n#ip_limit=true\n\n#p2p\n#p2p_ip=127.0.0.1\n#p2p_port=6000\n\n#web\n#web_host=host\nweb_username=yonghuming\nweb_password=mima123456\nweb_port = 8080\nweb_ip=0.0.0.0\nweb_base_url=\nweb_open_ssl=false\nweb_cert_file=conf/server.pem\nweb_key_file=conf/server.key\n# if web under proxy use sub path. like http://host/nps need this.\n#web_base_url=/nps\n\n#Web API unauthenticated IP address(the len of auth_crypt_key must be 16)\n#Remove comments if needed\n#auth_key=test\nauth_crypt_key =1234567812345678\n\n#allow_ports=9001-9009,10001,11000-12000\n\n#Web management multi-user login\nallow_user_login=false\nallow_user_register=false\nallow_user_change_username=false\n\n\n#extension\nallow_flow_limit=false\nallow_rate_limit=false\nallow_tunnel_num_limit=false\nallow_local_proxy=false\nallow_connection_num_limit=false\nallow_multi_ip=false\nsystem_info_display=false\n\n#c\nhttp_cache=true\nhttp_cache_length=100\n\n#get origin ip\nhttp_add_origin_header=false\n\n#pprof debug options\n#pprof_ip=0.0.0.0\n#pprof_port=9999\n```\n\n\n\n\n```\ncd /data/nps #\n./nps install #\nnps start #\n```\n\n\n## \n\nCaddySSLCaddy2.0beta1.0Caddycentos 7.4 64bitinit/linux-systemd/caddy.servicecaddy/usr/local/bin/etc/caddy/Caddyfile\n\n```\nmkdir -p /data/caddy #\nwget https://github.com/caddyserver/caddy/releases/download/v1.0.3/caddy_v1.0.3_linux_amd64.tar.gz -O /data/caddy/caddy_v1.0.3_linux_amd64.tar.gz #\ncp /data/caddy/caddy /usr/local/bin/ #\nchmod a+x /usr/local/bin/caddy #\ncat /data/caddy/init/linux-systemd/caddy.service > /etc/systemd/system/caddy.service #\nsed -i  s/www-data/root/g /etc/systemd/system/caddy.service #caddy\nchmod 755 /etc/systemd/system/caddy.service #\nsystemctl enable caddy.service #\nmkdir -p /etc/ssl/caddy #caddy\nmkdir -p /var/log/caddy #\nmkdir -p /etc/caddy #\ntouch /etc/caddy/Caddyfile #\n```\n\n/etc/caddy/Caddyfilenps.domain.tls10000@163.com\n\n\n```\nnps.domain.tls{\n  gzip\n  redir 301{\n    if {>X-Forwarded-Proto} is http\n    / https://nps.domain.ltd{uri}                  \n  }\n  tls 10000@163.com                                                    \n  log /var/log/caddy/nps.domain.tls.log{\n    rotate_size 5\n    rotate_age 5\n    rotate_keep 2\n    rotate_compress\n  }\n  proxy / 127.0.0.1:8080{\n    transparent\n  }\n}\n```\n\n## \n\n```\necho $PATH #/usr/local/bin\necho PATH=$PATH:/usr/local/bin >> ~/.bash_profile #\necho export PATH >> ~/.bash_profile #\nsource ~/.bash_profile #\nsystemctl start caddy.service #caddy\n```\n\n## caddy\n\nhttps://nps.domain.tlsweb_usernameweb_password\n\n![](/images/nps1.jpg \"\")\n\n![ID](/images/nps3.jpg \"ID\")\n\n## \n\nLinux 64Bit\n\n```\nmkdir -p /data/npc #\nwget https://github.com/ehang-io/nps/releases/download/v0.26.4/linux_amd64_client.tar.gz -O /data/linux_amd64_client.tar.gz #\ntar xzf /data/linux_amd64_client.tar.gz -C /data/npc/ #\n```\n\n/data/npc/conf/npc.confvkeycaddy8.8.8.8IP\n\n```\n[common]\nserver_addr=8.8.8.8:8024\nconn_type=tcp\nvkey=leochan.me\nauto_reconnection=true\nmax_conn=1000\nflow_limit=1000\nrate_limit=1000\ncrypt=true\ncompress=true\n```\n\n\n\n```\ncd /data/npc #\n./npc install -config=/data/npc/conf/npc.conf #\nnpc start #\n```\n\n## \n\nIP192.168.2.505000file.domain.tls\n\n![](/images/nps2.jpg \"\")\n\n\n/etc/caddy/Caddyfile\n\n```\nfile.domain.tls {\n  gzip\n  redir  301 {\n    if {>X-Forwarded-Proto} is http\n    / https://{host}{uri}\n  }\n  tls 10000@163.com\n  log /var/log/caddy/nps.log {\n    rotate_size 5\n    rotate_age 5\n    rotate_keep 2\n    rotate_compress\n  }\n  proxy / 127.0.0.1:20080 {\n    ransparent\n  }\n}\n```\n\ncaddy\n\n## \n\nnps","slug":"NPS","published":1,"updated":"2022-05-22T05:55:11.471Z","comments":1,"layout":"post","link":"","_id":"cl3in6av4003qlvtddrz1dvxk","content":"<blockquote>\n<p>FRPngrokDDNSLEDEKool DDNSNPSNPS</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>WOLUDP</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>NPSLinux 64BitNPS0.26.4</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /data/nps #</span><br><span class=\"line\">wget https://github.com/ehang-io/nps/releases/download/v0.26.4/linux_amd64_server.tar.gz -O /data/linux_amd64_server.tar.gz #</span><br><span class=\"line\">tar xzf /data/linux_amd64_server.tar.gz -C /data/nps/ #</span><br></pre></td></tr></table></figure>\n\n<p>&#x2F;data&#x2F;nps&#x2F;conf&#x2F;nps.confpublic_vkeyweb_usernameweb_passwordweb</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">appname = nps</span><br><span class=\"line\">#Boot mode(dev|pro)</span><br><span class=\"line\">runmode = pro</span><br><span class=\"line\"></span><br><span class=\"line\">#HTTP(S) proxy port, no startup if empty</span><br><span class=\"line\">http_proxy_ip=0.0.0.0</span><br><span class=\"line\">http_proxy_port=20080</span><br><span class=\"line\">https_proxy_port=20443</span><br><span class=\"line\">https_just_proxy=true</span><br><span class=\"line\">#default https certificate setting</span><br><span class=\"line\">https_default_cert_file=conf/server.pem</span><br><span class=\"line\">https_default_key_file=conf/server.key</span><br><span class=\"line\"></span><br><span class=\"line\">##bridge</span><br><span class=\"line\">bridge_type=tcp</span><br><span class=\"line\">bridge_port=8024</span><br><span class=\"line\">bridge_ip=0.0.0.0</span><br><span class=\"line\"></span><br><span class=\"line\"># Public password, which clients can use to connect to the server</span><br><span class=\"line\"># After the connection, the server will be able to open relevant ports and parse related domain names according to its own configuration file.</span><br><span class=\"line\">public_vkey=leochan1234556789</span><br><span class=\"line\"></span><br><span class=\"line\">#Traffic data persistence interval(minute)</span><br><span class=\"line\">#Ignorance means no persistence</span><br><span class=\"line\">#flow_store_interval=1</span><br><span class=\"line\"></span><br><span class=\"line\"># log level LevelEmergency-&gt;0  LevelAlert-&gt;1 LevelCritical-&gt;2 LevelError-&gt;3 LevelWarning-&gt;4 LevelNotice-&gt;5 LevelInformational-&gt;6 LevelDebug-&gt;7</span><br><span class=\"line\">log_level=7</span><br><span class=\"line\">#log_path=nps.log</span><br><span class=\"line\"></span><br><span class=\"line\">#Whether to restrict IP access, true or false or ignore</span><br><span class=\"line\">#ip_limit=true</span><br><span class=\"line\"></span><br><span class=\"line\">#p2p</span><br><span class=\"line\">#p2p_ip=127.0.0.1</span><br><span class=\"line\">#p2p_port=6000</span><br><span class=\"line\"></span><br><span class=\"line\">#web</span><br><span class=\"line\">#web_host=host</span><br><span class=\"line\">web_username=yonghuming</span><br><span class=\"line\">web_password=mima123456</span><br><span class=\"line\">web_port = 8080</span><br><span class=\"line\">web_ip=0.0.0.0</span><br><span class=\"line\">web_base_url=</span><br><span class=\"line\">web_open_ssl=false</span><br><span class=\"line\">web_cert_file=conf/server.pem</span><br><span class=\"line\">web_key_file=conf/server.key</span><br><span class=\"line\"># if web under proxy use sub path. like http://host/nps need this.</span><br><span class=\"line\">#web_base_url=/nps</span><br><span class=\"line\"></span><br><span class=\"line\">#Web API unauthenticated IP address(the len of auth_crypt_key must be 16)</span><br><span class=\"line\">#Remove comments if needed</span><br><span class=\"line\">#auth_key=test</span><br><span class=\"line\">auth_crypt_key =1234567812345678</span><br><span class=\"line\"></span><br><span class=\"line\">#allow_ports=9001-9009,10001,11000-12000</span><br><span class=\"line\"></span><br><span class=\"line\">#Web management multi-user login</span><br><span class=\"line\">allow_user_login=false</span><br><span class=\"line\">allow_user_register=false</span><br><span class=\"line\">allow_user_change_username=false</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#extension</span><br><span class=\"line\">allow_flow_limit=false</span><br><span class=\"line\">allow_rate_limit=false</span><br><span class=\"line\">allow_tunnel_num_limit=false</span><br><span class=\"line\">allow_local_proxy=false</span><br><span class=\"line\">allow_connection_num_limit=false</span><br><span class=\"line\">allow_multi_ip=false</span><br><span class=\"line\">system_info_display=false</span><br><span class=\"line\"></span><br><span class=\"line\">#c</span><br><span class=\"line\">http_cache=true</span><br><span class=\"line\">http_cache_length=100</span><br><span class=\"line\"></span><br><span class=\"line\">#get origin ip</span><br><span class=\"line\">http_add_origin_header=false</span><br><span class=\"line\"></span><br><span class=\"line\">#pprof debug options</span><br><span class=\"line\">#pprof_ip=0.0.0.0</span><br><span class=\"line\">#pprof_port=9999</span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /data/nps #</span><br><span class=\"line\">./nps install #</span><br><span class=\"line\">nps start #</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>CaddySSLCaddy2.0beta1.0Caddycentos 7.4 64bitinit&#x2F;linux-systemd&#x2F;caddy.servicecaddy&#x2F;usr&#x2F;local&#x2F;bin&#x2F;etc&#x2F;caddy&#x2F;Caddyfile</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /data/caddy #</span><br><span class=\"line\">wget https://github.com/caddyserver/caddy/releases/download/v1.0.3/caddy_v1.0.3_linux_amd64.tar.gz -O /data/caddy/caddy_v1.0.3_linux_amd64.tar.gz #</span><br><span class=\"line\">cp /data/caddy/caddy /usr/local/bin/ #</span><br><span class=\"line\">chmod a+x /usr/local/bin/caddy #</span><br><span class=\"line\">cat /data/caddy/init/linux-systemd/caddy.service &gt; /etc/systemd/system/caddy.service #</span><br><span class=\"line\">sed -i  s/www-data/root/g /etc/systemd/system/caddy.service #caddy</span><br><span class=\"line\">chmod 755 /etc/systemd/system/caddy.service #</span><br><span class=\"line\">systemctl enable caddy.service #</span><br><span class=\"line\">mkdir -p /etc/ssl/caddy #caddy</span><br><span class=\"line\">mkdir -p /var/log/caddy #</span><br><span class=\"line\">mkdir -p /etc/caddy #</span><br><span class=\"line\">touch /etc/caddy/Caddyfile #</span><br></pre></td></tr></table></figure>\n\n<p>&#x2F;etc&#x2F;caddy&#x2F;Caddyfilenps.domain.tls<a href=\"mailto:&#49;&#x30;&#48;&#48;&#48;&#64;&#49;&#54;&#51;&#46;&#99;&#x6f;&#x6d;\">&#49;&#x30;&#48;&#48;&#48;&#64;&#49;&#54;&#51;&#46;&#99;&#x6f;&#x6d;</a><br></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nps.domain.tls&#123;</span><br><span class=\"line\">  gzip</span><br><span class=\"line\">  redir 301&#123;</span><br><span class=\"line\">    if &#123;&gt;X-Forwarded-Proto&#125; is http</span><br><span class=\"line\">    / https://nps.domain.ltd&#123;uri&#125;                  </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  tls 10000@163.com                                                    </span><br><span class=\"line\">  log /var/log/caddy/nps.domain.tls.log&#123;</span><br><span class=\"line\">    rotate_size 5</span><br><span class=\"line\">    rotate_age 5</span><br><span class=\"line\">    rotate_keep 2</span><br><span class=\"line\">    rotate_compress</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  proxy / 127.0.0.1:8080&#123;</span><br><span class=\"line\">    transparent</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo $PATH #/usr/local/bin</span><br><span class=\"line\">echo PATH=$PATH:/usr/local/bin &gt;&gt; ~/.bash_profile #</span><br><span class=\"line\">echo export PATH &gt;&gt; ~/.bash_profile #</span><br><span class=\"line\">source ~/.bash_profile #</span><br><span class=\"line\">systemctl start caddy.service #caddy</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"caddy\"><a href=\"#caddy\" class=\"headerlink\" title=\"caddy\"></a>caddy</h2><p><a href=\"https://nps.domain.tls,web_usernameweb_password.,.,,./\">https://nps.domain.tlsweb_usernameweb_password</a></p>\n<p><img src=\"/images/nps1.jpg\" alt=\"\" title=\"\"></p>\n<p><img src=\"/images/nps3.jpg\" alt=\"ID\" title=\"ID\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Linux 64Bit</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /data/npc #</span><br><span class=\"line\">wget https://github.com/ehang-io/nps/releases/download/v0.26.4/linux_amd64_client.tar.gz -O /data/linux_amd64_client.tar.gz #</span><br><span class=\"line\">tar xzf /data/linux_amd64_client.tar.gz -C /data/npc/ #</span><br></pre></td></tr></table></figure>\n\n<p>&#x2F;data&#x2F;npc&#x2F;conf&#x2F;npc.confvkeycaddy8.8.8.8IP</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[common]</span><br><span class=\"line\">server_addr=8.8.8.8:8024</span><br><span class=\"line\">conn_type=tcp</span><br><span class=\"line\">vkey=leochan.me</span><br><span class=\"line\">auto_reconnection=true</span><br><span class=\"line\">max_conn=1000</span><br><span class=\"line\">flow_limit=1000</span><br><span class=\"line\">rate_limit=1000</span><br><span class=\"line\">crypt=true</span><br><span class=\"line\">compress=true</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /data/npc #</span><br><span class=\"line\">./npc install -config=/data/npc/conf/npc.conf #</span><br><span class=\"line\">npc start #</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>IP192.168.2.505000file.domain.tls</p>\n<p><img src=\"/images/nps2.jpg\" alt=\"\" title=\"\"></p>\n<p>&#x2F;etc&#x2F;caddy&#x2F;Caddyfile</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">file.domain.tls &#123;</span><br><span class=\"line\">  gzip</span><br><span class=\"line\">  redir  301 &#123;</span><br><span class=\"line\">    if &#123;&gt;X-Forwarded-Proto&#125; is http</span><br><span class=\"line\">    / https://&#123;host&#125;&#123;uri&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  tls 10000@163.com</span><br><span class=\"line\">  log /var/log/caddy/nps.log &#123;</span><br><span class=\"line\">    rotate_size 5</span><br><span class=\"line\">    rotate_age 5</span><br><span class=\"line\">    rotate_keep 2</span><br><span class=\"line\">    rotate_compress</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  proxy / 127.0.0.1:20080 &#123;</span><br><span class=\"line\">    ransparent</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>caddy</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>nps</p>\n","site":{"data":{}},"length":5621,"excerpt":"","more":"<blockquote>\n<p>FRPngrokDDNSLEDEKool DDNSNPSNPS</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>WOLUDP</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>NPSLinux 64BitNPS0.26.4</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /data/nps #</span><br><span class=\"line\">wget https://github.com/ehang-io/nps/releases/download/v0.26.4/linux_amd64_server.tar.gz -O /data/linux_amd64_server.tar.gz #</span><br><span class=\"line\">tar xzf /data/linux_amd64_server.tar.gz -C /data/nps/ #</span><br></pre></td></tr></table></figure>\n\n<p>&#x2F;data&#x2F;nps&#x2F;conf&#x2F;nps.confpublic_vkeyweb_usernameweb_passwordweb</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">appname = nps</span><br><span class=\"line\">#Boot mode(dev|pro)</span><br><span class=\"line\">runmode = pro</span><br><span class=\"line\"></span><br><span class=\"line\">#HTTP(S) proxy port, no startup if empty</span><br><span class=\"line\">http_proxy_ip=0.0.0.0</span><br><span class=\"line\">http_proxy_port=20080</span><br><span class=\"line\">https_proxy_port=20443</span><br><span class=\"line\">https_just_proxy=true</span><br><span class=\"line\">#default https certificate setting</span><br><span class=\"line\">https_default_cert_file=conf/server.pem</span><br><span class=\"line\">https_default_key_file=conf/server.key</span><br><span class=\"line\"></span><br><span class=\"line\">##bridge</span><br><span class=\"line\">bridge_type=tcp</span><br><span class=\"line\">bridge_port=8024</span><br><span class=\"line\">bridge_ip=0.0.0.0</span><br><span class=\"line\"></span><br><span class=\"line\"># Public password, which clients can use to connect to the server</span><br><span class=\"line\"># After the connection, the server will be able to open relevant ports and parse related domain names according to its own configuration file.</span><br><span class=\"line\">public_vkey=leochan1234556789</span><br><span class=\"line\"></span><br><span class=\"line\">#Traffic data persistence interval(minute)</span><br><span class=\"line\">#Ignorance means no persistence</span><br><span class=\"line\">#flow_store_interval=1</span><br><span class=\"line\"></span><br><span class=\"line\"># log level LevelEmergency-&gt;0  LevelAlert-&gt;1 LevelCritical-&gt;2 LevelError-&gt;3 LevelWarning-&gt;4 LevelNotice-&gt;5 LevelInformational-&gt;6 LevelDebug-&gt;7</span><br><span class=\"line\">log_level=7</span><br><span class=\"line\">#log_path=nps.log</span><br><span class=\"line\"></span><br><span class=\"line\">#Whether to restrict IP access, true or false or ignore</span><br><span class=\"line\">#ip_limit=true</span><br><span class=\"line\"></span><br><span class=\"line\">#p2p</span><br><span class=\"line\">#p2p_ip=127.0.0.1</span><br><span class=\"line\">#p2p_port=6000</span><br><span class=\"line\"></span><br><span class=\"line\">#web</span><br><span class=\"line\">#web_host=host</span><br><span class=\"line\">web_username=yonghuming</span><br><span class=\"line\">web_password=mima123456</span><br><span class=\"line\">web_port = 8080</span><br><span class=\"line\">web_ip=0.0.0.0</span><br><span class=\"line\">web_base_url=</span><br><span class=\"line\">web_open_ssl=false</span><br><span class=\"line\">web_cert_file=conf/server.pem</span><br><span class=\"line\">web_key_file=conf/server.key</span><br><span class=\"line\"># if web under proxy use sub path. like http://host/nps need this.</span><br><span class=\"line\">#web_base_url=/nps</span><br><span class=\"line\"></span><br><span class=\"line\">#Web API unauthenticated IP address(the len of auth_crypt_key must be 16)</span><br><span class=\"line\">#Remove comments if needed</span><br><span class=\"line\">#auth_key=test</span><br><span class=\"line\">auth_crypt_key =1234567812345678</span><br><span class=\"line\"></span><br><span class=\"line\">#allow_ports=9001-9009,10001,11000-12000</span><br><span class=\"line\"></span><br><span class=\"line\">#Web management multi-user login</span><br><span class=\"line\">allow_user_login=false</span><br><span class=\"line\">allow_user_register=false</span><br><span class=\"line\">allow_user_change_username=false</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#extension</span><br><span class=\"line\">allow_flow_limit=false</span><br><span class=\"line\">allow_rate_limit=false</span><br><span class=\"line\">allow_tunnel_num_limit=false</span><br><span class=\"line\">allow_local_proxy=false</span><br><span class=\"line\">allow_connection_num_limit=false</span><br><span class=\"line\">allow_multi_ip=false</span><br><span class=\"line\">system_info_display=false</span><br><span class=\"line\"></span><br><span class=\"line\">#c</span><br><span class=\"line\">http_cache=true</span><br><span class=\"line\">http_cache_length=100</span><br><span class=\"line\"></span><br><span class=\"line\">#get origin ip</span><br><span class=\"line\">http_add_origin_header=false</span><br><span class=\"line\"></span><br><span class=\"line\">#pprof debug options</span><br><span class=\"line\">#pprof_ip=0.0.0.0</span><br><span class=\"line\">#pprof_port=9999</span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /data/nps #</span><br><span class=\"line\">./nps install #</span><br><span class=\"line\">nps start #</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>CaddySSLCaddy2.0beta1.0Caddycentos 7.4 64bitinit&#x2F;linux-systemd&#x2F;caddy.servicecaddy&#x2F;usr&#x2F;local&#x2F;bin&#x2F;etc&#x2F;caddy&#x2F;Caddyfile</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /data/caddy #</span><br><span class=\"line\">wget https://github.com/caddyserver/caddy/releases/download/v1.0.3/caddy_v1.0.3_linux_amd64.tar.gz -O /data/caddy/caddy_v1.0.3_linux_amd64.tar.gz #</span><br><span class=\"line\">cp /data/caddy/caddy /usr/local/bin/ #</span><br><span class=\"line\">chmod a+x /usr/local/bin/caddy #</span><br><span class=\"line\">cat /data/caddy/init/linux-systemd/caddy.service &gt; /etc/systemd/system/caddy.service #</span><br><span class=\"line\">sed -i  s/www-data/root/g /etc/systemd/system/caddy.service #caddy</span><br><span class=\"line\">chmod 755 /etc/systemd/system/caddy.service #</span><br><span class=\"line\">systemctl enable caddy.service #</span><br><span class=\"line\">mkdir -p /etc/ssl/caddy #caddy</span><br><span class=\"line\">mkdir -p /var/log/caddy #</span><br><span class=\"line\">mkdir -p /etc/caddy #</span><br><span class=\"line\">touch /etc/caddy/Caddyfile #</span><br></pre></td></tr></table></figure>\n\n<p>&#x2F;etc&#x2F;caddy&#x2F;Caddyfilenps.domain.tls<a href=\"mailto:&#49;&#x30;&#48;&#48;&#48;&#64;&#49;&#54;&#51;&#46;&#99;&#x6f;&#x6d;\">&#49;&#x30;&#48;&#48;&#48;&#64;&#49;&#54;&#51;&#46;&#99;&#x6f;&#x6d;</a><br></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nps.domain.tls&#123;</span><br><span class=\"line\">  gzip</span><br><span class=\"line\">  redir 301&#123;</span><br><span class=\"line\">    if &#123;&gt;X-Forwarded-Proto&#125; is http</span><br><span class=\"line\">    / https://nps.domain.ltd&#123;uri&#125;                  </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  tls 10000@163.com                                                    </span><br><span class=\"line\">  log /var/log/caddy/nps.domain.tls.log&#123;</span><br><span class=\"line\">    rotate_size 5</span><br><span class=\"line\">    rotate_age 5</span><br><span class=\"line\">    rotate_keep 2</span><br><span class=\"line\">    rotate_compress</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  proxy / 127.0.0.1:8080&#123;</span><br><span class=\"line\">    transparent</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo $PATH #/usr/local/bin</span><br><span class=\"line\">echo PATH=$PATH:/usr/local/bin &gt;&gt; ~/.bash_profile #</span><br><span class=\"line\">echo export PATH &gt;&gt; ~/.bash_profile #</span><br><span class=\"line\">source ~/.bash_profile #</span><br><span class=\"line\">systemctl start caddy.service #caddy</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"caddy\"><a href=\"#caddy\" class=\"headerlink\" title=\"caddy\"></a>caddy</h2><p><a href=\"https://nps.domain.tls,web_usernameweb_password.,.,,./\">https://nps.domain.tlsweb_usernameweb_password</a></p>\n<p><img src=\"/images/nps1.jpg\" alt=\"\" title=\"\"></p>\n<p><img src=\"/images/nps3.jpg\" alt=\"ID\" title=\"ID\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Linux 64Bit</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /data/npc #</span><br><span class=\"line\">wget https://github.com/ehang-io/nps/releases/download/v0.26.4/linux_amd64_client.tar.gz -O /data/linux_amd64_client.tar.gz #</span><br><span class=\"line\">tar xzf /data/linux_amd64_client.tar.gz -C /data/npc/ #</span><br></pre></td></tr></table></figure>\n\n<p>&#x2F;data&#x2F;npc&#x2F;conf&#x2F;npc.confvkeycaddy8.8.8.8IP</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[common]</span><br><span class=\"line\">server_addr=8.8.8.8:8024</span><br><span class=\"line\">conn_type=tcp</span><br><span class=\"line\">vkey=leochan.me</span><br><span class=\"line\">auto_reconnection=true</span><br><span class=\"line\">max_conn=1000</span><br><span class=\"line\">flow_limit=1000</span><br><span class=\"line\">rate_limit=1000</span><br><span class=\"line\">crypt=true</span><br><span class=\"line\">compress=true</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /data/npc #</span><br><span class=\"line\">./npc install -config=/data/npc/conf/npc.conf #</span><br><span class=\"line\">npc start #</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>IP192.168.2.505000file.domain.tls</p>\n<p><img src=\"/images/nps2.jpg\" alt=\"\" title=\"\"></p>\n<p>&#x2F;etc&#x2F;caddy&#x2F;Caddyfile</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">file.domain.tls &#123;</span><br><span class=\"line\">  gzip</span><br><span class=\"line\">  redir  301 &#123;</span><br><span class=\"line\">    if &#123;&gt;X-Forwarded-Proto&#125; is http</span><br><span class=\"line\">    / https://&#123;host&#125;&#123;uri&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  tls 10000@163.com</span><br><span class=\"line\">  log /var/log/caddy/nps.log &#123;</span><br><span class=\"line\">    rotate_size 5</span><br><span class=\"line\">    rotate_age 5</span><br><span class=\"line\">    rotate_keep 2</span><br><span class=\"line\">    rotate_compress</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  proxy / 127.0.0.1:20080 &#123;</span><br><span class=\"line\">    ransparent</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>caddy</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>nps</p>\n"},{"title":"OpenWRTLED","date":"2020-03-03T15:46:07.000Z","url":"ding-shi-kai-guan-openwrtde-led","description":"OpenWRTOpenWRT666OpenWRTLED","_content":"\n> OpenWRTOpenWRT666OpenWRTLED\n \n## \n\nGoogle[OpenWRTLED](https://openwrt.org/docs/guide-user/base-system/led_configuration)triggerbrightnessLEDLED\n\n## \n\n0\n\n```\nmkdir -p /data/leds #\ntouch switch.sh #\nchmod a+x switch.sh\n```\n\n\nswitch.sh\n\n```\n#!/bin/bash\n#\n# author: Leo Chan\n# Blog: https://leochan.me\n#\n\nbackPath=\"/data/leds/backup/\"\nledsPath=\"/sys/class/leds/\"\n\nbackupConfig(){\n\tif [ ! -d $backPath ]; then\n\t\tmkdir -p $backPath\n\t\tfor i in `find / -name brightness`; do\n\t\t\tname=`dirname $i | grep -o '[^/]*$'`\n\t\t\tcat $i > $backPath$name\n\t\tdone\n\tfi\n}\n\nturnOff(){\n\tfor i in `ls \"$backPath\"`\n\tdo\n\t  \techo 0 > \"$ledsPath$i/brightness\"\n\tdone\n}\n\nturnOn(){\n\tfor i in `ls \"$backPath\"`\n\tdo\n\t  \tcat $backPath$i > \"$ledsPath$i/brightness\"\n\tdone\n}\n\nswitchLed(){\n\tif [ `date +%H` -gt 19 ]; then\n\t\tturnOff\n\telse\n\t\tturnOn\n\tfi\n}\n\nbackupConfig\nswitchLed\n```\n\n\n## \n\ncrontab8\n\n```\n* 8 * * * /data/leds/switch.sh >/dev/null 2>&1\n* 20 * * * /data/leds/switch.sh >/dev/null 2>&1\n```","source":"_posts/OpenWRTLED.md","raw":"---\ntitle: OpenWRTLED\ndate: 2020-03-03 23:46:07\ntags: \n  - \n  - OpenWRT\ncategories:\n  - \nurl: ding-shi-kai-guan-openwrtde-led\ndescription: OpenWRTOpenWRT666OpenWRTLED\n---\n\n> OpenWRTOpenWRT666OpenWRTLED\n \n## \n\nGoogle[OpenWRTLED](https://openwrt.org/docs/guide-user/base-system/led_configuration)triggerbrightnessLEDLED\n\n## \n\n0\n\n```\nmkdir -p /data/leds #\ntouch switch.sh #\nchmod a+x switch.sh\n```\n\n\nswitch.sh\n\n```\n#!/bin/bash\n#\n# author: Leo Chan\n# Blog: https://leochan.me\n#\n\nbackPath=\"/data/leds/backup/\"\nledsPath=\"/sys/class/leds/\"\n\nbackupConfig(){\n\tif [ ! -d $backPath ]; then\n\t\tmkdir -p $backPath\n\t\tfor i in `find / -name brightness`; do\n\t\t\tname=`dirname $i | grep -o '[^/]*$'`\n\t\t\tcat $i > $backPath$name\n\t\tdone\n\tfi\n}\n\nturnOff(){\n\tfor i in `ls \"$backPath\"`\n\tdo\n\t  \techo 0 > \"$ledsPath$i/brightness\"\n\tdone\n}\n\nturnOn(){\n\tfor i in `ls \"$backPath\"`\n\tdo\n\t  \tcat $backPath$i > \"$ledsPath$i/brightness\"\n\tdone\n}\n\nswitchLed(){\n\tif [ `date +%H` -gt 19 ]; then\n\t\tturnOff\n\telse\n\t\tturnOn\n\tfi\n}\n\nbackupConfig\nswitchLed\n```\n\n\n## \n\ncrontab8\n\n```\n* 8 * * * /data/leds/switch.sh >/dev/null 2>&1\n* 20 * * * /data/leds/switch.sh >/dev/null 2>&1\n```","slug":"OpenWRTLED","published":1,"updated":"2022-05-14T01:40:58.752Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6av5003rlvtd07fv0wkb","content":"<blockquote>\n<p>OpenWRTOpenWRT666OpenWRTLED</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Google<a href=\"https://openwrt.org/docs/guide-user/base-system/led_configuration\">OpenWRTLED</a>triggerbrightnessLEDLED</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>0</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /data/leds #</span><br><span class=\"line\">touch switch.sh #</span><br><span class=\"line\">chmod a+x switch.sh</span><br></pre></td></tr></table></figure>\n\n\n<p>switch.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">#</span><br><span class=\"line\"># author: Leo Chan</span><br><span class=\"line\"># Blog: https://leochan.me</span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\">backPath=&quot;/data/leds/backup/&quot;</span><br><span class=\"line\">ledsPath=&quot;/sys/class/leds/&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">backupConfig()&#123;</span><br><span class=\"line\">\tif [ ! -d $backPath ]; then</span><br><span class=\"line\">\t\tmkdir -p $backPath</span><br><span class=\"line\">\t\tfor i in `find / -name brightness`; do</span><br><span class=\"line\">\t\t\tname=`dirname $i | grep -o &#x27;[^/]*$&#x27;`</span><br><span class=\"line\">\t\t\tcat $i &gt; $backPath$name</span><br><span class=\"line\">\t\tdone</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">turnOff()&#123;</span><br><span class=\"line\">\tfor i in `ls &quot;$backPath&quot;`</span><br><span class=\"line\">\tdo</span><br><span class=\"line\">\t  \techo 0 &gt; &quot;$ledsPath$i/brightness&quot;</span><br><span class=\"line\">\tdone</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">turnOn()&#123;</span><br><span class=\"line\">\tfor i in `ls &quot;$backPath&quot;`</span><br><span class=\"line\">\tdo</span><br><span class=\"line\">\t  \tcat $backPath$i &gt; &quot;$ledsPath$i/brightness&quot;</span><br><span class=\"line\">\tdone</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">switchLed()&#123;</span><br><span class=\"line\">\tif [ `date +%H` -gt 19 ]; then</span><br><span class=\"line\">\t\tturnOff</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\tturnOn</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">backupConfig</span><br><span class=\"line\">switchLed</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>crontab8</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* 8 * * * /data/leds/switch.sh &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\">* 20 * * * /data/leds/switch.sh &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":1240,"excerpt":"","more":"<blockquote>\n<p>OpenWRTOpenWRT666OpenWRTLED</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Google<a href=\"https://openwrt.org/docs/guide-user/base-system/led_configuration\">OpenWRTLED</a>triggerbrightnessLEDLED</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>0</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /data/leds #</span><br><span class=\"line\">touch switch.sh #</span><br><span class=\"line\">chmod a+x switch.sh</span><br></pre></td></tr></table></figure>\n\n\n<p>switch.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">#</span><br><span class=\"line\"># author: Leo Chan</span><br><span class=\"line\"># Blog: https://leochan.me</span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\">backPath=&quot;/data/leds/backup/&quot;</span><br><span class=\"line\">ledsPath=&quot;/sys/class/leds/&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">backupConfig()&#123;</span><br><span class=\"line\">\tif [ ! -d $backPath ]; then</span><br><span class=\"line\">\t\tmkdir -p $backPath</span><br><span class=\"line\">\t\tfor i in `find / -name brightness`; do</span><br><span class=\"line\">\t\t\tname=`dirname $i | grep -o &#x27;[^/]*$&#x27;`</span><br><span class=\"line\">\t\t\tcat $i &gt; $backPath$name</span><br><span class=\"line\">\t\tdone</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">turnOff()&#123;</span><br><span class=\"line\">\tfor i in `ls &quot;$backPath&quot;`</span><br><span class=\"line\">\tdo</span><br><span class=\"line\">\t  \techo 0 &gt; &quot;$ledsPath$i/brightness&quot;</span><br><span class=\"line\">\tdone</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">turnOn()&#123;</span><br><span class=\"line\">\tfor i in `ls &quot;$backPath&quot;`</span><br><span class=\"line\">\tdo</span><br><span class=\"line\">\t  \tcat $backPath$i &gt; &quot;$ledsPath$i/brightness&quot;</span><br><span class=\"line\">\tdone</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">switchLed()&#123;</span><br><span class=\"line\">\tif [ `date +%H` -gt 19 ]; then</span><br><span class=\"line\">\t\tturnOff</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\tturnOn</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">backupConfig</span><br><span class=\"line\">switchLed</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>crontab8</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* 8 * * * /data/leds/switch.sh &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\">* 20 * * * /data/leds/switch.sh &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>"},{"title":"mysql","date":"2018-07-11T23:57:00.000Z","url":"a-backup-method-for-mini-mysql-database","description":"xtrabackup","_content":"\n> xtrabackup\n\n## \n\nLinuxcentos7.464bituname -a3.10.0-693.2.2.el7.x86_64mysqlmysqldump\n\n```\nshell\n#!/bin/sh\n#mysql\nmysql_user=\"leo\"\n#mysql\nmysql_password=\"leo123456789\"\n#mysql\nmysql_dir=/usr/local/mysql/bin\n#\nmysql_databases=\"leo\"\n#\nbackup_dir=/data/backup/mysql/leo\n#\ntoday=$(date +%Y%m%d_%H%M%S)\n# \nlog_dir=/data/logs/mysql/leo\n#\nlog_file=backup.log\n#\necho -e '['$(date +\"%Y-%m-%d %H:%M:%S\")'] - '$mysql_databases' - '\"\\n\" >> $log_dir/$log_file\n#mysqldump\n$mysql_dir/mysqldump -u$mysql_user -p$mysql_password --apply-slave-statements --hex-blob --routines --single-transaction --databases $mysql_databases | gzip > $backup_dir/$today.sql.gz\n#\necho -e '['$(date +\"%Y-%m-%d %H:%M:%S\")'] - '$mysql_databases' - '\"\\n\" >> $log_dir/$log_file\n#\ndays=3\n# \nfind $full_backup_dir -mtime +$days -name \"*.sql.gz\" -exec rm -f {} \\;\n#\nsleep 600\n```\n\nbackup.sh/data/data/backup.sh/bin/shLinuxUnix\n\n## \n\n```\ncrontab -e\n```\n\ni6\n\n```\n1 */6 * * * /data/backup.sh >> /dev/null\n```\n\nEsc:wq!\n\necho\n\n```\necho '1 */6 * * * /data/backup.sh >> /dev/null' >> /var/spool/cron/root\n```\n\n\ncentos /var/spool/cron\n\n## \n\n6[inotify+rsync](/sync-data-realtime-with-inotify-rsync-v2)","source":"_posts/mysql.md","raw":"---\ntitle: mysql\ndate: 2018-07-12 07:57:00\ntags: \n  - mysql\n  - \ncategories:\n  - \nurl: a-backup-method-for-mini-mysql-database\ndescription: xtrabackup\n---\n\n> xtrabackup\n\n## \n\nLinuxcentos7.464bituname -a3.10.0-693.2.2.el7.x86_64mysqlmysqldump\n\n```\nshell\n#!/bin/sh\n#mysql\nmysql_user=\"leo\"\n#mysql\nmysql_password=\"leo123456789\"\n#mysql\nmysql_dir=/usr/local/mysql/bin\n#\nmysql_databases=\"leo\"\n#\nbackup_dir=/data/backup/mysql/leo\n#\ntoday=$(date +%Y%m%d_%H%M%S)\n# \nlog_dir=/data/logs/mysql/leo\n#\nlog_file=backup.log\n#\necho -e '['$(date +\"%Y-%m-%d %H:%M:%S\")'] - '$mysql_databases' - '\"\\n\" >> $log_dir/$log_file\n#mysqldump\n$mysql_dir/mysqldump -u$mysql_user -p$mysql_password --apply-slave-statements --hex-blob --routines --single-transaction --databases $mysql_databases | gzip > $backup_dir/$today.sql.gz\n#\necho -e '['$(date +\"%Y-%m-%d %H:%M:%S\")'] - '$mysql_databases' - '\"\\n\" >> $log_dir/$log_file\n#\ndays=3\n# \nfind $full_backup_dir -mtime +$days -name \"*.sql.gz\" -exec rm -f {} \\;\n#\nsleep 600\n```\n\nbackup.sh/data/data/backup.sh/bin/shLinuxUnix\n\n## \n\n```\ncrontab -e\n```\n\ni6\n\n```\n1 */6 * * * /data/backup.sh >> /dev/null\n```\n\nEsc:wq!\n\necho\n\n```\necho '1 */6 * * * /data/backup.sh >> /dev/null' >> /var/spool/cron/root\n```\n\n\ncentos /var/spool/cron\n\n## \n\n6[inotify+rsync](/sync-data-realtime-with-inotify-rsync-v2)","slug":"mysql","published":1,"updated":"2022-05-12T17:06:48.791Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6av5003tlvtd4ogy95e4","content":"<blockquote>\n<p>xtrabackup</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Linuxcentos7.464bituname -a3.10.0-693.2.2.el7.x86_64mysqlmysqldump</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shell</span><br><span class=\"line\">#!/bin/sh</span><br><span class=\"line\">#mysql</span><br><span class=\"line\">mysql_user=&quot;leo&quot;</span><br><span class=\"line\">#mysql</span><br><span class=\"line\">mysql_password=&quot;leo123456789&quot;</span><br><span class=\"line\">#mysql</span><br><span class=\"line\">mysql_dir=/usr/local/mysql/bin</span><br><span class=\"line\">#</span><br><span class=\"line\">mysql_databases=&quot;leo&quot;</span><br><span class=\"line\">#</span><br><span class=\"line\">backup_dir=/data/backup/mysql/leo</span><br><span class=\"line\">#</span><br><span class=\"line\">today=$(date +%Y%m%d_%H%M%S)</span><br><span class=\"line\"># </span><br><span class=\"line\">log_dir=/data/logs/mysql/leo</span><br><span class=\"line\">#</span><br><span class=\"line\">log_file=backup.log</span><br><span class=\"line\">#</span><br><span class=\"line\">echo -e &#x27;[&#x27;$(date +&quot;%Y-%m-%d %H:%M:%S&quot;)&#x27;] - &#x27;$mysql_databases&#x27; - &#x27;&quot;\\n&quot; &gt;&gt; $log_dir/$log_file</span><br><span class=\"line\">#mysqldump</span><br><span class=\"line\">$mysql_dir/mysqldump -u$mysql_user -p$mysql_password --apply-slave-statements --hex-blob --routines --single-transaction --databases $mysql_databases | gzip &gt; $backup_dir/$today.sql.gz</span><br><span class=\"line\">#</span><br><span class=\"line\">echo -e &#x27;[&#x27;$(date +&quot;%Y-%m-%d %H:%M:%S&quot;)&#x27;] - &#x27;$mysql_databases&#x27; - &#x27;&quot;\\n&quot; &gt;&gt; $log_dir/$log_file</span><br><span class=\"line\">#</span><br><span class=\"line\">days=3</span><br><span class=\"line\"># </span><br><span class=\"line\">find $full_backup_dir -mtime +$days -name &quot;*.sql.gz&quot; -exec rm -f &#123;&#125; \\;</span><br><span class=\"line\">#</span><br><span class=\"line\">sleep 600</span><br></pre></td></tr></table></figure>\n\n<p>backup.sh&#x2F;data&#x2F;data&#x2F;backup.sh&#x2F;bin&#x2F;shLinuxUnix</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -e</span><br></pre></td></tr></table></figure>\n\n<p>i6</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 */6 * * * /data/backup.sh &gt;&gt; /dev/null</span><br></pre></td></tr></table></figure>\n\n<p>Esc:wq!</p>\n<p>echo</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;1 */6 * * * /data/backup.sh &gt;&gt; /dev/null&#x27; &gt;&gt; /var/spool/cron/root</span><br></pre></td></tr></table></figure>\n\n\n<p>centos &#x2F;var&#x2F;spool&#x2F;cron</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>6<a href=\"/sync-data-realtime-with-inotify-rsync-v2\">inotify+rsync</a></p>\n","site":{"data":{}},"length":1754,"excerpt":"","more":"<blockquote>\n<p>xtrabackup</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Linuxcentos7.464bituname -a3.10.0-693.2.2.el7.x86_64mysqlmysqldump</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shell</span><br><span class=\"line\">#!/bin/sh</span><br><span class=\"line\">#mysql</span><br><span class=\"line\">mysql_user=&quot;leo&quot;</span><br><span class=\"line\">#mysql</span><br><span class=\"line\">mysql_password=&quot;leo123456789&quot;</span><br><span class=\"line\">#mysql</span><br><span class=\"line\">mysql_dir=/usr/local/mysql/bin</span><br><span class=\"line\">#</span><br><span class=\"line\">mysql_databases=&quot;leo&quot;</span><br><span class=\"line\">#</span><br><span class=\"line\">backup_dir=/data/backup/mysql/leo</span><br><span class=\"line\">#</span><br><span class=\"line\">today=$(date +%Y%m%d_%H%M%S)</span><br><span class=\"line\"># </span><br><span class=\"line\">log_dir=/data/logs/mysql/leo</span><br><span class=\"line\">#</span><br><span class=\"line\">log_file=backup.log</span><br><span class=\"line\">#</span><br><span class=\"line\">echo -e &#x27;[&#x27;$(date +&quot;%Y-%m-%d %H:%M:%S&quot;)&#x27;] - &#x27;$mysql_databases&#x27; - &#x27;&quot;\\n&quot; &gt;&gt; $log_dir/$log_file</span><br><span class=\"line\">#mysqldump</span><br><span class=\"line\">$mysql_dir/mysqldump -u$mysql_user -p$mysql_password --apply-slave-statements --hex-blob --routines --single-transaction --databases $mysql_databases | gzip &gt; $backup_dir/$today.sql.gz</span><br><span class=\"line\">#</span><br><span class=\"line\">echo -e &#x27;[&#x27;$(date +&quot;%Y-%m-%d %H:%M:%S&quot;)&#x27;] - &#x27;$mysql_databases&#x27; - &#x27;&quot;\\n&quot; &gt;&gt; $log_dir/$log_file</span><br><span class=\"line\">#</span><br><span class=\"line\">days=3</span><br><span class=\"line\"># </span><br><span class=\"line\">find $full_backup_dir -mtime +$days -name &quot;*.sql.gz&quot; -exec rm -f &#123;&#125; \\;</span><br><span class=\"line\">#</span><br><span class=\"line\">sleep 600</span><br></pre></td></tr></table></figure>\n\n<p>backup.sh&#x2F;data&#x2F;data&#x2F;backup.sh&#x2F;bin&#x2F;shLinuxUnix</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -e</span><br></pre></td></tr></table></figure>\n\n<p>i6</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 */6 * * * /data/backup.sh &gt;&gt; /dev/null</span><br></pre></td></tr></table></figure>\n\n<p>Esc:wq!</p>\n<p>echo</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;1 */6 * * * /data/backup.sh &gt;&gt; /dev/null&#x27; &gt;&gt; /var/spool/cron/root</span><br></pre></td></tr></table></figure>\n\n\n<p>centos &#x2F;var&#x2F;spool&#x2F;cron</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>6<a href=\"/sync-data-realtime-with-inotify-rsync-v2\">inotify+rsync</a></p>\n"},{"title":"Docker","date":"2018-10-28T22:48:47.000Z","url":"quickly-delete-dockers-containtor-and-images","description":"DockerDockerDocker","_content":"\n> DockerDockerDocker\n\n\n## \n\n```\ndocker kill $(docker ps -a -q)\n```\n\n\n## \n\n```\ndocker rm $(docker ps -a -q)\n```\n\n\n##  dangling \n\n```\ndocker rmi $(docker images -q -f dangling=true)\n```\n\n\n## \n\n```\ndocker rmi $(docker images -q)\n```\n\n\n## \n\n```\nvi ~/.bash_aliases\n.\nalias dockerkill=\"docker kill $(docker ps -a -q)\"\n.\nalias dockercleanc=\"docker rm $(docker ps -a -q)\"\n.\nalias dockercleani=\"docker rmi $(docker images -q -f dangling=true)\"\n.\nalias dockerclean=\"dockercleanc || true && dockercleani\"\n```\n\n","source":"_posts/Docker.md","raw":"---\ntitle: Docker\ndate: 2018-10-29 06:48:47\ntags: \n  - Docker\ncategories:\n  - \nurl: quickly-delete-dockers-containtor-and-images\ndescription: DockerDockerDocker\n---\n\n> DockerDockerDocker\n\n\n## \n\n```\ndocker kill $(docker ps -a -q)\n```\n\n\n## \n\n```\ndocker rm $(docker ps -a -q)\n```\n\n\n##  dangling \n\n```\ndocker rmi $(docker images -q -f dangling=true)\n```\n\n\n## \n\n```\ndocker rmi $(docker images -q)\n```\n\n\n## \n\n```\nvi ~/.bash_aliases\n.\nalias dockerkill=\"docker kill $(docker ps -a -q)\"\n.\nalias dockercleanc=\"docker rm $(docker ps -a -q)\"\n.\nalias dockercleani=\"docker rmi $(docker images -q -f dangling=true)\"\n.\nalias dockerclean=\"dockercleanc || true && dockercleani\"\n```\n\n","slug":"Docker","published":1,"updated":"2022-05-12T17:05:36.443Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6av6003ulvtd02vw9tkt","content":"<blockquote>\n<p>DockerDockerDocker</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker kill $(docker ps -a -q)</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rm $(docker ps -a -q)</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"-dangling-\"><a href=\"#-dangling-\" class=\"headerlink\" title=\" dangling \"></a> dangling </h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rmi $(docker images -q -f dangling=true)</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rmi $(docker images -q)</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi ~/.bash_aliases</span><br><span class=\"line\">.</span><br><span class=\"line\">alias dockerkill=&quot;docker kill $(docker ps -a -q)&quot;</span><br><span class=\"line\">.</span><br><span class=\"line\">alias dockercleanc=&quot;docker rm $(docker ps -a -q)&quot;</span><br><span class=\"line\">.</span><br><span class=\"line\">alias dockercleani=&quot;docker rmi $(docker images -q -f dangling=true)&quot;</span><br><span class=\"line\">.</span><br><span class=\"line\">alias dockerclean=&quot;dockercleanc || true &amp;&amp; dockercleani&quot;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"length":580,"excerpt":"","more":"<blockquote>\n<p>DockerDockerDocker</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker kill $(docker ps -a -q)</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rm $(docker ps -a -q)</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"-dangling-\"><a href=\"#-dangling-\" class=\"headerlink\" title=\" dangling \"></a> dangling </h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rmi $(docker images -q -f dangling=true)</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rmi $(docker images -q)</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi ~/.bash_aliases</span><br><span class=\"line\">.</span><br><span class=\"line\">alias dockerkill=&quot;docker kill $(docker ps -a -q)&quot;</span><br><span class=\"line\">.</span><br><span class=\"line\">alias dockercleanc=&quot;docker rm $(docker ps -a -q)&quot;</span><br><span class=\"line\">.</span><br><span class=\"line\">alias dockercleani=&quot;docker rmi $(docker images -q -f dangling=true)&quot;</span><br><span class=\"line\">.</span><br><span class=\"line\">alias dockerclean=&quot;dockercleanc || true &amp;&amp; dockercleani&quot;</span><br></pre></td></tr></table></figure>\n\n"},{"title":"","date":"2022-04-18T16:49:18.000Z","photos":["/images/1617782228929766s.png"],"url":"ransom-email","description":"Gmail","_content":"\n> Gmail\n\n# \n\n\n\n# \n\nAPP\n\n# \n\nMITOTPOTPOTPGoogle AuthenticatorAPPGoogle Authenticator\n\n<img src=\"/images/qrcode.jpeg\" style=\"border-radius:50%;\" width=\"200\" height=\"200\" alt=\"\" />","source":"_posts/.md","raw":"---\ntitle: \ndate: 2022-04-19 00:49:18\ntags: \n  - \n  - \ncategories:\n  - \nphotos:\n  - \"/images/1617782228929766s.png\"\nurl: ransom-email\ndescription: Gmail\n---\n\n> Gmail\n\n# \n\n\n\n# \n\nAPP\n\n# \n\nMITOTPOTPOTPGoogle AuthenticatorAPPGoogle Authenticator\n\n<img src=\"/images/qrcode.jpeg\" style=\"border-radius:50%;\" width=\"200\" height=\"200\" alt=\"\" />","slug":"","published":1,"updated":"2022-05-22T05:44:15.595Z","comments":1,"layout":"post","link":"","_id":"cl3in6av7003wlvtdadmvdvea","content":"<blockquote>\n<p>Gmail</p>\n</blockquote>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>APP</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>MITOTPOTPOTPGoogle AuthenticatorAPPGoogle Authenticator</p>\n<img src=\"/images/qrcode.jpeg\" style=\"border-radius:50%;\" width=\"200\" height=\"200\" alt=\"\" />","site":{"data":{}},"length":816,"excerpt":"","more":"<blockquote>\n<p>Gmail</p>\n</blockquote>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>APP</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>MITOTPOTPOTPGoogle AuthenticatorAPPGoogle Authenticator</p>\n<img src=\"/images/qrcode.jpeg\" style=\"border-radius:50%;\" width=\"200\" height=\"200\" alt=\"\" />"},{"title":"Safari","date":"2018-02-02T23:22:00.000Z","url":"delete-all-safari-bookmarks","description":"SafariGoogleSafari","_content":"\n> SafariGoogleSafari\n\nFinderNASChrome\n\nChrome3352[Bookmark Sentry](https://chrome.google.com/webstore/detail/bookmark-sentry-scanner/dkedglkmgegjehpknhbplkbfknlneomb)\nChrome404403IP\n\nSafariChromeSafariSafariSafariSafariChrome\n\n\n","source":"_posts/Safari.md","raw":"---\ntitle: Safari\ndate: 2018-02-03 07:22:00\ntags: \n  - safari\ncategories:\n  - \nurl: delete-all-safari-bookmarks\ndescription: SafariGoogleSafari\n---\n\n> SafariGoogleSafari\n\nFinderNASChrome\n\nChrome3352[Bookmark Sentry](https://chrome.google.com/webstore/detail/bookmark-sentry-scanner/dkedglkmgegjehpknhbplkbfknlneomb)\nChrome404403IP\n\nSafariChromeSafariSafariSafariSafariChrome\n\n\n","slug":"Safari","published":1,"updated":"2022-05-12T17:06:41.915Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6av8003zlvtd9sh03poc","content":"<blockquote>\n<p>SafariGoogleSafari</p>\n</blockquote>\n<p>FinderNASChrome</p>\n<p>Chrome3352<a href=\"https://chrome.google.com/webstore/detail/bookmark-sentry-scanner/dkedglkmgegjehpknhbplkbfknlneomb\">Bookmark Sentry</a><br>Chrome404403IP</p>\n<p>SafariChromeSafariSafariSafariSafariChrome<br></p>\n<p></p>\n","site":{"data":{}},"length":716,"excerpt":"","more":"<blockquote>\n<p>SafariGoogleSafari</p>\n</blockquote>\n<p>FinderNASChrome</p>\n<p>Chrome3352<a href=\"https://chrome.google.com/webstore/detail/bookmark-sentry-scanner/dkedglkmgegjehpknhbplkbfknlneomb\">Bookmark Sentry</a><br>Chrome404403IP</p>\n<p>SafariChromeSafariSafariSafariSafariChrome<br></p>\n<p></p>\n"},{"title":"ESXIUSB","date":"2018-11-06T23:13:02.000Z","url":"create-and-remove-use-partition-on-esxi","description":"ESXIESXIESXI","_content":"\n> ESXIESXIESXI\n\n## \n\n+LedeSSDU\n\n## SSH\n\nESXISSHESXIWeb\nUI-TSMTSM-ShellSSH\n\n## \n\nUSB\n\n```\n/etc/init.d/usbarbitrator stop\n```\n\nUSB\n\n```\nchkconfig usbarbitrator off\n```\n\nUUmpx.vmhbaXX\n\n```\nls /dev/disks/\n```\n\nGPTUmpx.vmhba33\n\n```\npartedUtil mklabel /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0 gpt\n```\n\nUSBUSBGUID\n\n```\npartedUtil getptbl /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0\n```\n\nUSB\n\n```\neval expr $(partedUtil getptbl /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0 | tail -1 | awk '{print $1 \" \\\\* \" $2 \" \\\\* \" $3}') - 1\n```\n\n\n\n```\npartedUtil setptbl /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0 gpt \"1 2048 31278554 AA31E02A400F11DB9590000C2911D1B8 0\"\n```\n\nVMFS5\n\n```\nvmkfstools -C vmfs5 -S USB-STORE /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0:1\n```\n\nESXIUSB-STORE\n\n## USB\n\nUSB\n\n```\nchkconfig usbarbitrator on\n```\n\n\nUSB\n\n```\n/etc/init.d/usbarbitrator start\n```","source":"_posts/ESXIUSB.md","raw":"---\ntitle: ESXIUSB\ndate: 2018-11-07 07:13:02\ntags: \n  - esxi\n  - \ncategories:\n  - \nurl: create-and-remove-use-partition-on-esxi\ndescription: ESXIESXIESXI\n---\n\n> ESXIESXIESXI\n\n## \n\n+LedeSSDU\n\n## SSH\n\nESXISSHESXIWeb\nUI-TSMTSM-ShellSSH\n\n## \n\nUSB\n\n```\n/etc/init.d/usbarbitrator stop\n```\n\nUSB\n\n```\nchkconfig usbarbitrator off\n```\n\nUUmpx.vmhbaXX\n\n```\nls /dev/disks/\n```\n\nGPTUmpx.vmhba33\n\n```\npartedUtil mklabel /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0 gpt\n```\n\nUSBUSBGUID\n\n```\npartedUtil getptbl /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0\n```\n\nUSB\n\n```\neval expr $(partedUtil getptbl /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0 | tail -1 | awk '{print $1 \" \\\\* \" $2 \" \\\\* \" $3}') - 1\n```\n\n\n\n```\npartedUtil setptbl /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0 gpt \"1 2048 31278554 AA31E02A400F11DB9590000C2911D1B8 0\"\n```\n\nVMFS5\n\n```\nvmkfstools -C vmfs5 -S USB-STORE /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0:1\n```\n\nESXIUSB-STORE\n\n## USB\n\nUSB\n\n```\nchkconfig usbarbitrator on\n```\n\n\nUSB\n\n```\n/etc/init.d/usbarbitrator start\n```","slug":"ESXIUSB","published":1,"updated":"2022-05-12T17:05:22.123Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6av90041lvtddmc02p6a","content":"<blockquote>\n<p>ESXIESXIESXI</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>+LedeSSDU</p>\n<h2 id=\"SSH\"><a href=\"#SSH\" class=\"headerlink\" title=\"SSH\"></a>SSH</h2><p>ESXISSHESXIWeb<br>UI-TSMTSM-ShellSSH</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>USB</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/usbarbitrator stop</span><br></pre></td></tr></table></figure>\n\n<p>USB</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chkconfig usbarbitrator off</span><br></pre></td></tr></table></figure>\n\n<p>UUmpx.vmhbaXX</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls /dev/disks/</span><br></pre></td></tr></table></figure>\n\n<p>GPTUmpx.vmhba33</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">partedUtil mklabel /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0 gpt</span><br></pre></td></tr></table></figure>\n\n<p>USBUSBGUID</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">partedUtil getptbl /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0</span><br></pre></td></tr></table></figure>\n\n<p>USB</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">eval expr $(partedUtil getptbl /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0 | tail -1 | awk &#x27;&#123;print $1 &quot; \\\\* &quot; $2 &quot; \\\\* &quot; $3&#125;&#x27;) - 1</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">partedUtil setptbl /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0 gpt &quot;1 2048 31278554 AA31E02A400F11DB9590000C2911D1B8 0&quot;</span><br></pre></td></tr></table></figure>\n\n<p>VMFS5</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vmkfstools -C vmfs5 -S USB-STORE /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0:1</span><br></pre></td></tr></table></figure>\n\n<p>ESXIUSB-STORE</p>\n<h2 id=\"USB\"><a href=\"#USB\" class=\"headerlink\" title=\"USB\"></a>USB</h2><p>USB</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chkconfig usbarbitrator on</span><br></pre></td></tr></table></figure>\n\n\n<p>USB</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/usbarbitrator start</span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":1334,"excerpt":"","more":"<blockquote>\n<p>ESXIESXIESXI</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>+LedeSSDU</p>\n<h2 id=\"SSH\"><a href=\"#SSH\" class=\"headerlink\" title=\"SSH\"></a>SSH</h2><p>ESXISSHESXIWeb<br>UI-TSMTSM-ShellSSH</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>USB</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/usbarbitrator stop</span><br></pre></td></tr></table></figure>\n\n<p>USB</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chkconfig usbarbitrator off</span><br></pre></td></tr></table></figure>\n\n<p>UUmpx.vmhbaXX</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls /dev/disks/</span><br></pre></td></tr></table></figure>\n\n<p>GPTUmpx.vmhba33</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">partedUtil mklabel /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0 gpt</span><br></pre></td></tr></table></figure>\n\n<p>USBUSBGUID</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">partedUtil getptbl /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0</span><br></pre></td></tr></table></figure>\n\n<p>USB</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">eval expr $(partedUtil getptbl /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0 | tail -1 | awk &#x27;&#123;print $1 &quot; \\\\* &quot; $2 &quot; \\\\* &quot; $3&#125;&#x27;) - 1</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">partedUtil setptbl /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0 gpt &quot;1 2048 31278554 AA31E02A400F11DB9590000C2911D1B8 0&quot;</span><br></pre></td></tr></table></figure>\n\n<p>VMFS5</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vmkfstools -C vmfs5 -S USB-STORE /dev/disks/mpx.vmhba33\\:C0\\:T0\\:L0:1</span><br></pre></td></tr></table></figure>\n\n<p>ESXIUSB-STORE</p>\n<h2 id=\"USB\"><a href=\"#USB\" class=\"headerlink\" title=\"USB\"></a>USB</h2><p>USB</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chkconfig usbarbitrator on</span><br></pre></td></tr></table></figure>\n\n\n<p>USB</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/usbarbitrator start</span><br></pre></td></tr></table></figure>"},{"title":"OpenWRT","date":"2020-02-19T10:37:44.000Z","url":"zi-ding-yi-openwrtde-qi-dong-jiao-ben","description":"OpenWRTLedeOpenWRTOpenWRTOpenWRT","_content":"\n> OpenWRTLedeOpenWRTOpenWRTOpenWRT\n\n## \n\nshell/tmp/homeleochan.me.sh\n\n```\ncd /home\necho '#!/bin/sh' > leochan.me.sh\necho '/bin/echo leochan.me > /home/leochan.me.log' >> leochan.me.sh\nchmod +x leochan.me.sh\n```\n\n\n\n## procd\n\nOpenWRTprocdprocd\n\n```\ncat << EOF > /etc/init.d/leochan\n#!/bin/sh /etc/rc.common\nUSE_PROCD=1\nSTART=95\nSTOP=01\nstart_service() {\n    procd_open_instance\n    procd_set_param command /bin/sh \"/home/leochan.me.sh\"\n    procd_close_instance\n}\nEOF\nchmod 755 /etc/init.d/leochan\n```\nchmod 755 /etc/init.d/leochan\n\n## \n\n\n\n```\n/etc/init.d/leochan enable\n```\n#\n\n```\nls -la /etc/rc.d/S*\n```\n\n\n```\n/etc/init.d/leochan start\n```\n \n\n/home/leochan.me.logleochan.me\n\n```\ncat /home/leochan.me.log\n```\n\n## \n\n/etc/init.dOpenWRT WebUISSH/etc/init.d","source":"_posts/OpenWRT.md","raw":"---\ntitle: OpenWRT\ndate: 2020-02-19 18:37:44\ntags: \n  - OpenWRT\n  - \ncategories:\n  - \nurl: zi-ding-yi-openwrtde-qi-dong-jiao-ben\ndescription: OpenWRTLedeOpenWRTOpenWRTOpenWRT\n---\n\n> OpenWRTLedeOpenWRTOpenWRTOpenWRT\n\n## \n\nshell/tmp/homeleochan.me.sh\n\n```\ncd /home\necho '#!/bin/sh' > leochan.me.sh\necho '/bin/echo leochan.me > /home/leochan.me.log' >> leochan.me.sh\nchmod +x leochan.me.sh\n```\n\n\n\n## procd\n\nOpenWRTprocdprocd\n\n```\ncat << EOF > /etc/init.d/leochan\n#!/bin/sh /etc/rc.common\nUSE_PROCD=1\nSTART=95\nSTOP=01\nstart_service() {\n    procd_open_instance\n    procd_set_param command /bin/sh \"/home/leochan.me.sh\"\n    procd_close_instance\n}\nEOF\nchmod 755 /etc/init.d/leochan\n```\nchmod 755 /etc/init.d/leochan\n\n## \n\n\n\n```\n/etc/init.d/leochan enable\n```\n#\n\n```\nls -la /etc/rc.d/S*\n```\n\n\n```\n/etc/init.d/leochan start\n```\n \n\n/home/leochan.me.logleochan.me\n\n```\ncat /home/leochan.me.log\n```\n\n## \n\n/etc/init.dOpenWRT WebUISSH/etc/init.d","slug":"OpenWRT","published":1,"updated":"2022-05-12T17:07:38.532Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6ava0044lvtd39hl3aiv","content":"<blockquote>\n<p>OpenWRTLedeOpenWRTOpenWRTOpenWRT</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>shell&#x2F;tmp&#x2F;homeleochan.me.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home</span><br><span class=\"line\">echo &#x27;#!/bin/sh&#x27; &gt; leochan.me.sh</span><br><span class=\"line\">echo &#x27;/bin/echo leochan.me &gt; /home/leochan.me.log&#x27; &gt;&gt; leochan.me.sh</span><br><span class=\"line\">chmod +x leochan.me.sh</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h2 id=\"procd\"><a href=\"#procd\" class=\"headerlink\" title=\"procd\"></a>procd</h2><p>OpenWRTprocdprocd</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &lt;&lt; EOF &gt; /etc/init.d/leochan</span><br><span class=\"line\">#!/bin/sh /etc/rc.common</span><br><span class=\"line\">USE_PROCD=1</span><br><span class=\"line\">START=95</span><br><span class=\"line\">STOP=01</span><br><span class=\"line\">start_service() &#123;</span><br><span class=\"line\">    procd_open_instance</span><br><span class=\"line\">    procd_set_param command /bin/sh &quot;/home/leochan.me.sh&quot;</span><br><span class=\"line\">    procd_close_instance</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\">chmod 755 /etc/init.d/leochan</span><br></pre></td></tr></table></figure>\n<p>chmod 755 &#x2F;etc&#x2F;init.d&#x2F;leochan</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/leochan enable</span><br></pre></td></tr></table></figure>\n<p>#</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls -la /etc/rc.d/S*</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/leochan start</span><br></pre></td></tr></table></figure>\n<p> </p>\n<p>&#x2F;home&#x2F;leochan.me.logleochan.me</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /home/leochan.me.log</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>&#x2F;etc&#x2F;init.dOpenWRT WebUISSH&#x2F;etc&#x2F;init.d</p>\n","site":{"data":{}},"length":1077,"excerpt":"","more":"<blockquote>\n<p>OpenWRTLedeOpenWRTOpenWRTOpenWRT</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>shell&#x2F;tmp&#x2F;homeleochan.me.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home</span><br><span class=\"line\">echo &#x27;#!/bin/sh&#x27; &gt; leochan.me.sh</span><br><span class=\"line\">echo &#x27;/bin/echo leochan.me &gt; /home/leochan.me.log&#x27; &gt;&gt; leochan.me.sh</span><br><span class=\"line\">chmod +x leochan.me.sh</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h2 id=\"procd\"><a href=\"#procd\" class=\"headerlink\" title=\"procd\"></a>procd</h2><p>OpenWRTprocdprocd</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &lt;&lt; EOF &gt; /etc/init.d/leochan</span><br><span class=\"line\">#!/bin/sh /etc/rc.common</span><br><span class=\"line\">USE_PROCD=1</span><br><span class=\"line\">START=95</span><br><span class=\"line\">STOP=01</span><br><span class=\"line\">start_service() &#123;</span><br><span class=\"line\">    procd_open_instance</span><br><span class=\"line\">    procd_set_param command /bin/sh &quot;/home/leochan.me.sh&quot;</span><br><span class=\"line\">    procd_close_instance</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\">chmod 755 /etc/init.d/leochan</span><br></pre></td></tr></table></figure>\n<p>chmod 755 &#x2F;etc&#x2F;init.d&#x2F;leochan</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/leochan enable</span><br></pre></td></tr></table></figure>\n<p>#</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls -la /etc/rc.d/S*</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/leochan start</span><br></pre></td></tr></table></figure>\n<p> </p>\n<p>&#x2F;home&#x2F;leochan.me.logleochan.me</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /home/leochan.me.log</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>&#x2F;etc&#x2F;init.dOpenWRT WebUISSH&#x2F;etc&#x2F;init.d</p>\n"},{"title":"denyhostsIP","date":"2018-01-12T23:07:00.000Z","url":"remove-the-ip-blocked-by-denyhosts","description":"denyhostsIPCentos7.3IPLinux","_content":"\n> denyhostsIPCentos7.3IPLinux\n\n## \n\n```\necho '' > /usr/share/denyhosts/data/hosts\necho '' > /usr/share/denyhosts/data/hosts-restricted\necho '' > /usr/share/denyhosts/data/hosts-root\necho '' > /usr/share/denyhosts/data/hosts-valid\necho '' > /usr/share/denyhosts/data/users-hosts\necho '' > /etc/hosts.deny\necho '' > /var/log/secure\n```\n\n\nshellteeecho\n\n```\necho '' | tee /usr/share/denyhosts/data/hosts /usr/share/denyhosts/data/hosts-restricted /usr/share/denyhosts/data/hosts-root /usr/share/denyhosts/data/hosts-valid /usr/share/denyhosts/data/users-hosts /etc/hosts.deny /var/log/secure\n```\n\nIP\n\n## \n\n```\nsed -i '/192.168.1.1/d' /usr/share/denyhosts/data/hosts\nsed -i '/192.168.1.1/d' /usr/share/denyhosts/data/hosts-restricted \nsed -i '/192.168.1.1/d' /usr/share/denyhosts/data/hosts-root\nsed -i '/192.168.1.1/d' /usr/share/denyhosts/data/hosts-valid\nsed -i '/192.168.1.1/d' /usr/share/denyhosts/data/users-hosts\nsed -i '/192.168.1.1/d' /etc/hosts.deny\nsed -i '/192.168.1.1/d' /var/log/secure\n```\n\nshell192.168.1.1","source":"_posts/denyhostsIP.md","raw":"---\ntitle: denyhostsIP\ndate: 2018-01-13 07:07:00\ntags: \n  - denyhosts\ncategories:\n  - \nurl: remove-the-ip-blocked-by-denyhosts\ndescription: denyhostsIPCentos7.3IPLinux\n---\n\n> denyhostsIPCentos7.3IPLinux\n\n## \n\n```\necho '' > /usr/share/denyhosts/data/hosts\necho '' > /usr/share/denyhosts/data/hosts-restricted\necho '' > /usr/share/denyhosts/data/hosts-root\necho '' > /usr/share/denyhosts/data/hosts-valid\necho '' > /usr/share/denyhosts/data/users-hosts\necho '' > /etc/hosts.deny\necho '' > /var/log/secure\n```\n\n\nshellteeecho\n\n```\necho '' | tee /usr/share/denyhosts/data/hosts /usr/share/denyhosts/data/hosts-restricted /usr/share/denyhosts/data/hosts-root /usr/share/denyhosts/data/hosts-valid /usr/share/denyhosts/data/users-hosts /etc/hosts.deny /var/log/secure\n```\n\nIP\n\n## \n\n```\nsed -i '/192.168.1.1/d' /usr/share/denyhosts/data/hosts\nsed -i '/192.168.1.1/d' /usr/share/denyhosts/data/hosts-restricted \nsed -i '/192.168.1.1/d' /usr/share/denyhosts/data/hosts-root\nsed -i '/192.168.1.1/d' /usr/share/denyhosts/data/hosts-valid\nsed -i '/192.168.1.1/d' /usr/share/denyhosts/data/users-hosts\nsed -i '/192.168.1.1/d' /etc/hosts.deny\nsed -i '/192.168.1.1/d' /var/log/secure\n```\n\nshell192.168.1.1","slug":"denyhostsIP","published":1,"updated":"2022-05-12T17:05:31.169Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6ava0047lvtdfh1i5y6d","content":"<blockquote>\n<p>denyhostsIPCentos7.3IPLinux</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;&#x27; &gt; /usr/share/denyhosts/data/hosts</span><br><span class=\"line\">echo &#x27;&#x27; &gt; /usr/share/denyhosts/data/hosts-restricted</span><br><span class=\"line\">echo &#x27;&#x27; &gt; /usr/share/denyhosts/data/hosts-root</span><br><span class=\"line\">echo &#x27;&#x27; &gt; /usr/share/denyhosts/data/hosts-valid</span><br><span class=\"line\">echo &#x27;&#x27; &gt; /usr/share/denyhosts/data/users-hosts</span><br><span class=\"line\">echo &#x27;&#x27; &gt; /etc/hosts.deny</span><br><span class=\"line\">echo &#x27;&#x27; &gt; /var/log/secure</span><br></pre></td></tr></table></figure>\n\n\n<p>shellteeecho</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;&#x27; | tee /usr/share/denyhosts/data/hosts /usr/share/denyhosts/data/hosts-restricted /usr/share/denyhosts/data/hosts-root /usr/share/denyhosts/data/hosts-valid /usr/share/denyhosts/data/users-hosts /etc/hosts.deny /var/log/secure</span><br></pre></td></tr></table></figure>\n\n<p>IP</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &#x27;/192.168.1.1/d&#x27; /usr/share/denyhosts/data/hosts</span><br><span class=\"line\">sed -i &#x27;/192.168.1.1/d&#x27; /usr/share/denyhosts/data/hosts-restricted </span><br><span class=\"line\">sed -i &#x27;/192.168.1.1/d&#x27; /usr/share/denyhosts/data/hosts-root</span><br><span class=\"line\">sed -i &#x27;/192.168.1.1/d&#x27; /usr/share/denyhosts/data/hosts-valid</span><br><span class=\"line\">sed -i &#x27;/192.168.1.1/d&#x27; /usr/share/denyhosts/data/users-hosts</span><br><span class=\"line\">sed -i &#x27;/192.168.1.1/d&#x27; /etc/hosts.deny</span><br><span class=\"line\">sed -i &#x27;/192.168.1.1/d&#x27; /var/log/secure</span><br></pre></td></tr></table></figure>\n\n<p>shell192.168.1.1</p>\n","site":{"data":{}},"length":1308,"excerpt":"","more":"<blockquote>\n<p>denyhostsIPCentos7.3IPLinux</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;&#x27; &gt; /usr/share/denyhosts/data/hosts</span><br><span class=\"line\">echo &#x27;&#x27; &gt; /usr/share/denyhosts/data/hosts-restricted</span><br><span class=\"line\">echo &#x27;&#x27; &gt; /usr/share/denyhosts/data/hosts-root</span><br><span class=\"line\">echo &#x27;&#x27; &gt; /usr/share/denyhosts/data/hosts-valid</span><br><span class=\"line\">echo &#x27;&#x27; &gt; /usr/share/denyhosts/data/users-hosts</span><br><span class=\"line\">echo &#x27;&#x27; &gt; /etc/hosts.deny</span><br><span class=\"line\">echo &#x27;&#x27; &gt; /var/log/secure</span><br></pre></td></tr></table></figure>\n\n\n<p>shellteeecho</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;&#x27; | tee /usr/share/denyhosts/data/hosts /usr/share/denyhosts/data/hosts-restricted /usr/share/denyhosts/data/hosts-root /usr/share/denyhosts/data/hosts-valid /usr/share/denyhosts/data/users-hosts /etc/hosts.deny /var/log/secure</span><br></pre></td></tr></table></figure>\n\n<p>IP</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &#x27;/192.168.1.1/d&#x27; /usr/share/denyhosts/data/hosts</span><br><span class=\"line\">sed -i &#x27;/192.168.1.1/d&#x27; /usr/share/denyhosts/data/hosts-restricted </span><br><span class=\"line\">sed -i &#x27;/192.168.1.1/d&#x27; /usr/share/denyhosts/data/hosts-root</span><br><span class=\"line\">sed -i &#x27;/192.168.1.1/d&#x27; /usr/share/denyhosts/data/hosts-valid</span><br><span class=\"line\">sed -i &#x27;/192.168.1.1/d&#x27; /usr/share/denyhosts/data/users-hosts</span><br><span class=\"line\">sed -i &#x27;/192.168.1.1/d&#x27; /etc/hosts.deny</span><br><span class=\"line\">sed -i &#x27;/192.168.1.1/d&#x27; /var/log/secure</span><br></pre></td></tr></table></figure>\n\n<p>shell192.168.1.1</p>\n"},{"title":"NAS","date":"2018-08-23T00:03:00.000Z","url":"shutdown-after-offline-on-pc-and-nas","description":"NASUPS","_content":"\n> NASUPS\n\n## NAS\n\nUPSUPSUPSNASlinuxDSMLinuxshell\n\n```\n#!/bin/bash\n  \nIP=\"192.168.1.1\"\nNUM=1\nwhile [ $NUM -le 5 ]; do\n    if ping -c 1 $IP > /dev/null; then\n        echo \"$IP Ping is successful.\"\n        break\n    else\n        let NUM++\n    fi\ndone\nif [ $NUM -ge 5 ];then\n    echo \"Power Off\"\n    poweroff\nelse\n    echo \"Power On\"\nfi\n```\n\nIPIPNUMNUM5PINGPINGPINGNUM1NUM5Linuxshellpoweroff.sh\n\n 1. NASFile Stationshellshell\n 2. \n 3. \n 4. tab00:0023:595\n 5. tab\"bash /volume1/shell/poweroff.sh\"\n 6. \n\n## windows\n\nwindowswindows\n\n 1.  \n 2.  ID\n 3.  MicrosoftWindowsNetworkProfileOperational\n 4.  IDIDtabID\n 5.  \n 6.  \n 7.  tabWI\n 8.  tabGOMicrosoft-Windows-NetworkProfile/OperationalSNetworkProfileIDT234ID\n 9.  tabIPC:\\Windows\\System32\\shutdown.exeA-f\n     -s -t 60 /c \"1\"\n 10. \n\nUPSwindows","source":"_posts/NAS.md","raw":"---\ntitle: NAS\ndate: 2018-08-23 08:03:00\ntags: \n  - ups\n  - NAS\n  - \ncategories:\n  - \nurl: shutdown-after-offline-on-pc-and-nas\ndescription: NASUPS\n---\n\n> NASUPS\n\n## NAS\n\nUPSUPSUPSNASlinuxDSMLinuxshell\n\n```\n#!/bin/bash\n  \nIP=\"192.168.1.1\"\nNUM=1\nwhile [ $NUM -le 5 ]; do\n    if ping -c 1 $IP > /dev/null; then\n        echo \"$IP Ping is successful.\"\n        break\n    else\n        let NUM++\n    fi\ndone\nif [ $NUM -ge 5 ];then\n    echo \"Power Off\"\n    poweroff\nelse\n    echo \"Power On\"\nfi\n```\n\nIPIPNUMNUM5PINGPINGPINGNUM1NUM5Linuxshellpoweroff.sh\n\n 1. NASFile Stationshellshell\n 2. \n 3. \n 4. tab00:0023:595\n 5. tab\"bash /volume1/shell/poweroff.sh\"\n 6. \n\n## windows\n\nwindowswindows\n\n 1.  \n 2.  ID\n 3.  MicrosoftWindowsNetworkProfileOperational\n 4.  IDIDtabID\n 5.  \n 6.  \n 7.  tabWI\n 8.  tabGOMicrosoft-Windows-NetworkProfile/OperationalSNetworkProfileIDT234ID\n 9.  tabIPC:\\Windows\\System32\\shutdown.exeA-f\n     -s -t 60 /c \"1\"\n 10. \n\nUPSwindows","slug":"NAS","published":1,"updated":"2022-05-12T17:05:57.910Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6avb004blvtd4tvdbiah","content":"<blockquote>\n<p>NASUPS</p>\n</blockquote>\n<h2 id=\"NAS\"><a href=\"#NAS\" class=\"headerlink\" title=\"NAS\"></a>NAS</h2><p>UPSUPSUPSNASlinuxDSMLinuxshell</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">  </span><br><span class=\"line\">IP=&quot;192.168.1.1&quot;</span><br><span class=\"line\">NUM=1</span><br><span class=\"line\">while [ $NUM -le 5 ]; do</span><br><span class=\"line\">    if ping -c 1 $IP &gt; /dev/null; then</span><br><span class=\"line\">        echo &quot;$IP Ping is successful.&quot;</span><br><span class=\"line\">        break</span><br><span class=\"line\">    else</span><br><span class=\"line\">        let NUM++</span><br><span class=\"line\">    fi</span><br><span class=\"line\">done</span><br><span class=\"line\">if [ $NUM -ge 5 ];then</span><br><span class=\"line\">    echo &quot;Power Off&quot;</span><br><span class=\"line\">    poweroff</span><br><span class=\"line\">else</span><br><span class=\"line\">    echo &quot;Power On&quot;</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n\n<p>IPIPNUMNUM5PINGPINGPINGNUM1NUM5Linuxshellpoweroff.sh</p>\n<ol>\n<li>NASFile Stationshellshell</li>\n<li></li>\n<li></li>\n<li>tab00:0023:595</li>\n<li>tabbash &#x2F;volume1&#x2F;shell&#x2F;poweroff.sh</li>\n<li></li>\n</ol>\n<h2 id=\"windows\"><a href=\"#windows\" class=\"headerlink\" title=\"windows\"></a>windows</h2><p>windowswindows</p>\n<ol>\n<li></li>\n<li>ID</li>\n<li>MicrosoftWindowsNetworkProfileOperational</li>\n<li>IDIDtabID</li>\n<li></li>\n<li></li>\n<li>tabWI</li>\n<li>tabGOMicrosoft-Windows-NetworkProfile&#x2F;OperationalSNetworkProfileIDT234ID</li>\n<li>tabIPC:\\Windows\\System32\\shutdown.exeA-f<br>-s -t 60 &#x2F;c 1</li>\n<li></li>\n</ol>\n<p>UPSwindows</p>\n","site":{"data":{}},"length":1879,"excerpt":"","more":"<blockquote>\n<p>NASUPS</p>\n</blockquote>\n<h2 id=\"NAS\"><a href=\"#NAS\" class=\"headerlink\" title=\"NAS\"></a>NAS</h2><p>UPSUPSUPSNASlinuxDSMLinuxshell</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">  </span><br><span class=\"line\">IP=&quot;192.168.1.1&quot;</span><br><span class=\"line\">NUM=1</span><br><span class=\"line\">while [ $NUM -le 5 ]; do</span><br><span class=\"line\">    if ping -c 1 $IP &gt; /dev/null; then</span><br><span class=\"line\">        echo &quot;$IP Ping is successful.&quot;</span><br><span class=\"line\">        break</span><br><span class=\"line\">    else</span><br><span class=\"line\">        let NUM++</span><br><span class=\"line\">    fi</span><br><span class=\"line\">done</span><br><span class=\"line\">if [ $NUM -ge 5 ];then</span><br><span class=\"line\">    echo &quot;Power Off&quot;</span><br><span class=\"line\">    poweroff</span><br><span class=\"line\">else</span><br><span class=\"line\">    echo &quot;Power On&quot;</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n\n<p>IPIPNUMNUM5PINGPINGPINGNUM1NUM5Linuxshellpoweroff.sh</p>\n<ol>\n<li>NASFile Stationshellshell</li>\n<li></li>\n<li></li>\n<li>tab00:0023:595</li>\n<li>tabbash &#x2F;volume1&#x2F;shell&#x2F;poweroff.sh</li>\n<li></li>\n</ol>\n<h2 id=\"windows\"><a href=\"#windows\" class=\"headerlink\" title=\"windows\"></a>windows</h2><p>windowswindows</p>\n<ol>\n<li></li>\n<li>ID</li>\n<li>MicrosoftWindowsNetworkProfileOperational</li>\n<li>IDIDtabID</li>\n<li></li>\n<li></li>\n<li>tabWI</li>\n<li>tabGOMicrosoft-Windows-NetworkProfile&#x2F;OperationalSNetworkProfileIDT234ID</li>\n<li>tabIPC:\\Windows\\System32\\shutdown.exeA-f<br>-s -t 60 &#x2F;c 1</li>\n<li></li>\n</ol>\n<p>UPSwindows</p>\n"},{"title":"Leanote","date":"2018-04-04T23:30:00.000Z","url":"the-use-of-feelings-on-leanote","description":"LeanoteLeanoteLeanote","_content":"\n> LeanoteLeanoteLeanote\n\n## Leanote\n\n * LeanoteLeanote\n * LeanoteGoLeanote666\n * Leanote\n * LeanoteGitlab\n * Leanote\n\n## Leanote\n\n * Leanote\n * LeanoteChromeLeanote\n * LeanotePDFBUG\n * MD\n\nLeanoteMDPDFLeanote","source":"_posts/Leanote.md","raw":"---\ntitle: Leanote\ndate: 2018-04-05 07:30:00\ntags: \n  - Leanote\ncategories:\n  - \nurl: the-use-of-feelings-on-leanote\ndescription: LeanoteLeanoteLeanote\n---\n\n> LeanoteLeanoteLeanote\n\n## Leanote\n\n * LeanoteLeanote\n * LeanoteGoLeanote666\n * Leanote\n * LeanoteGitlab\n * Leanote\n\n## Leanote\n\n * Leanote\n * LeanoteChromeLeanote\n * LeanotePDFBUG\n * MD\n\nLeanoteMDPDFLeanote","slug":"Leanote","published":1,"updated":"2022-05-12T17:06:21.445Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6avc004dlvtdflgleur4","content":"<blockquote>\n<p>LeanoteLeanoteLeanote</p>\n</blockquote>\n<h2 id=\"Leanote\"><a href=\"#Leanote\" class=\"headerlink\" title=\"Leanote\"></a>Leanote</h2><ul>\n<li>LeanoteLeanote</li>\n<li>LeanoteGoLeanote666</li>\n<li>Leanote</li>\n<li>LeanoteGitlab</li>\n<li>Leanote</li>\n</ul>\n<h2 id=\"Leanote\"><a href=\"#Leanote\" class=\"headerlink\" title=\"Leanote\"></a>Leanote</h2><ul>\n<li>Leanote</li>\n<li>LeanoteChromeLeanote</li>\n<li>LeanotePDFBUG</li>\n<li>MD</li>\n</ul>\n<p>LeanoteMDPDFLeanote</p>\n","site":{"data":{}},"length":732,"excerpt":"","more":"<blockquote>\n<p>LeanoteLeanoteLeanote</p>\n</blockquote>\n<h2 id=\"Leanote\"><a href=\"#Leanote\" class=\"headerlink\" title=\"Leanote\"></a>Leanote</h2><ul>\n<li>LeanoteLeanote</li>\n<li>LeanoteGoLeanote666</li>\n<li>Leanote</li>\n<li>LeanoteGitlab</li>\n<li>Leanote</li>\n</ul>\n<h2 id=\"Leanote\"><a href=\"#Leanote\" class=\"headerlink\" title=\"Leanote\"></a>Leanote</h2><ul>\n<li>Leanote</li>\n<li>LeanoteChromeLeanote</li>\n<li>LeanotePDFBUG</li>\n<li>MD</li>\n</ul>\n<p>LeanoteMDPDFLeanote</p>\n"},{"title":"swoole","date":"2018-08-30T00:07:00.000Z","url":"about-swoole-installtion","description":"swooleswooleCPHPswooleswoole","_content":"\n> swooleswooleCPHPswooleswoole\n\n## \n\ncentos7.464bituname\n-a3.10.0-693.2.2.el7.x86_64PHP\nCPHP7.1.19swoolev4.0.4RedisHTTP2Redisredis1.2\n\n## hiredis\n\nswooleredishiredishiredisCredisredis1.2github<https://github.com/redis/hiredis>\n\n```\nwget https://github.com/redis/hiredis/archive/v0.13.3.tar.gz\ntar xzf v0.13.3.tar.gz\ncd hiredis*\nmake\nsudo make install\n```\n\n## nghttp2\n\nnghttp2swoolehttp2github<https://github.com/nghttp2/nghttp2>\n\n```\nwget https://github.com/nghttp2/nghttp2/releases/download/v1.32.0/nghttp2-1.32.0.tar.bz2\ntar -jxvf nghttp2-1.32.0.tar.bz2\ncd nghttp2*\n./configure\nmake\nsudo make install\n```\n\n## swoole\n\nswoole1.2.x4.x1.x2.x4.x4.xboost.context1.x2.x4.x\n\n```\nwget https://github.com/swoole/swoole-src/archive/v4.0.4.tar.gz\ntar xzf v4.0.4.tar.gz\ncd swoole*\nphpize\n./configure --enable-sockets --enable-openssl --enable-http2 --enable-async-redis --enable-mysqlnd\nmake\nsudo make install\n```\n\n## swoole\n\n```\necho 'extension=swoole.so' >> /usr/local/php/etc/php.ini\nservice php-fpm restart\n```\n\nphp -m | grep swoole\n\n## \n\nphp fpmlibhiredis.so.0.13: cannot open shared object\nfileswoole\nswoole\n\n```\n./configure --enable-sockets --enable-openssl --enable-http2 --enable-async-redis=/usr/local --enable-mysqlnd\n```\n\n\nld.so.conf\n\n```\necho '/usr/local/lib' >> /etc/ld.so.conf\nsudo ldconfig\n```\n\nphp-fpm","source":"_posts/swoole.md","raw":"---\ntitle: swoole\ndate: 2018-08-30 08:07:00\ntags: \n  - swoole\ncategories:\n  - \nurl: about-swoole-installtion\ndescription: swooleswooleCPHPswooleswoole\n---\n\n> swooleswooleCPHPswooleswoole\n\n## \n\ncentos7.464bituname\n-a3.10.0-693.2.2.el7.x86_64PHP\nCPHP7.1.19swoolev4.0.4RedisHTTP2Redisredis1.2\n\n## hiredis\n\nswooleredishiredishiredisCredisredis1.2github<https://github.com/redis/hiredis>\n\n```\nwget https://github.com/redis/hiredis/archive/v0.13.3.tar.gz\ntar xzf v0.13.3.tar.gz\ncd hiredis*\nmake\nsudo make install\n```\n\n## nghttp2\n\nnghttp2swoolehttp2github<https://github.com/nghttp2/nghttp2>\n\n```\nwget https://github.com/nghttp2/nghttp2/releases/download/v1.32.0/nghttp2-1.32.0.tar.bz2\ntar -jxvf nghttp2-1.32.0.tar.bz2\ncd nghttp2*\n./configure\nmake\nsudo make install\n```\n\n## swoole\n\nswoole1.2.x4.x1.x2.x4.x4.xboost.context1.x2.x4.x\n\n```\nwget https://github.com/swoole/swoole-src/archive/v4.0.4.tar.gz\ntar xzf v4.0.4.tar.gz\ncd swoole*\nphpize\n./configure --enable-sockets --enable-openssl --enable-http2 --enable-async-redis --enable-mysqlnd\nmake\nsudo make install\n```\n\n## swoole\n\n```\necho 'extension=swoole.so' >> /usr/local/php/etc/php.ini\nservice php-fpm restart\n```\n\nphp -m | grep swoole\n\n## \n\nphp fpmlibhiredis.so.0.13: cannot open shared object\nfileswoole\nswoole\n\n```\n./configure --enable-sockets --enable-openssl --enable-http2 --enable-async-redis=/usr/local --enable-mysqlnd\n```\n\n\nld.so.conf\n\n```\necho '/usr/local/lib' >> /etc/ld.so.conf\nsudo ldconfig\n```\n\nphp-fpm","slug":"swoole","published":1,"updated":"2022-05-12T17:06:28.208Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6avd004glvtdhn2h47ej","content":"<blockquote>\n<p>swooleswooleCPHPswooleswoole</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>centos7.464bituname<br>-a3.10.0-693.2.2.el7.x86_64PHP<br>CPHP7.1.19swoolev4.0.4RedisHTTP2Redisredis1.2</p>\n<h2 id=\"hiredis\"><a href=\"#hiredis\" class=\"headerlink\" title=\"hiredis\"></a>hiredis</h2><p>swooleredishiredishiredisCredisredis1.2github<a href=\"https://github.com/redis/hiredis\">https://github.com/redis/hiredis</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/redis/hiredis/archive/v0.13.3.tar.gz</span><br><span class=\"line\">tar xzf v0.13.3.tar.gz</span><br><span class=\"line\">cd hiredis*</span><br><span class=\"line\">make</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"nghttp2\"><a href=\"#nghttp2\" class=\"headerlink\" title=\"nghttp2\"></a>nghttp2</h2><p>nghttp2swoolehttp2github<a href=\"https://github.com/nghttp2/nghttp2\">https://github.com/nghttp2/nghttp2</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/nghttp2/nghttp2/releases/download/v1.32.0/nghttp2-1.32.0.tar.bz2</span><br><span class=\"line\">tar -jxvf nghttp2-1.32.0.tar.bz2</span><br><span class=\"line\">cd nghttp2*</span><br><span class=\"line\">./configure</span><br><span class=\"line\">make</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"swoole\"><a href=\"#swoole\" class=\"headerlink\" title=\"swoole\"></a>swoole</h2><p>swoole1.2.x4.x1.x2.x4.x4.xboost.context1.x2.x4.x</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/swoole/swoole-src/archive/v4.0.4.tar.gz</span><br><span class=\"line\">tar xzf v4.0.4.tar.gz</span><br><span class=\"line\">cd swoole*</span><br><span class=\"line\">phpize</span><br><span class=\"line\">./configure --enable-sockets --enable-openssl --enable-http2 --enable-async-redis --enable-mysqlnd</span><br><span class=\"line\">make</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"swoole\"><a href=\"#swoole\" class=\"headerlink\" title=\"swoole\"></a>swoole</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;extension=swoole.so&#x27; &gt;&gt; /usr/local/php/etc/php.ini</span><br><span class=\"line\">service php-fpm restart</span><br></pre></td></tr></table></figure>\n\n<p>php -m | grep swoole</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>php fpmlibhiredis.so.0.13: cannot open shared object<br>fileswoole<br>swoole</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure --enable-sockets --enable-openssl --enable-http2 --enable-async-redis=/usr/local --enable-mysqlnd</span><br></pre></td></tr></table></figure>\n\n\n<p>ld.so.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;/usr/local/lib&#x27; &gt;&gt; /etc/ld.so.conf</span><br><span class=\"line\">sudo ldconfig</span><br></pre></td></tr></table></figure>\n\n<p>php-fpm</p>\n","site":{"data":{}},"length":1674,"excerpt":"","more":"<blockquote>\n<p>swooleswooleCPHPswooleswoole</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>centos7.464bituname<br>-a3.10.0-693.2.2.el7.x86_64PHP<br>CPHP7.1.19swoolev4.0.4RedisHTTP2Redisredis1.2</p>\n<h2 id=\"hiredis\"><a href=\"#hiredis\" class=\"headerlink\" title=\"hiredis\"></a>hiredis</h2><p>swooleredishiredishiredisCredisredis1.2github<a href=\"https://github.com/redis/hiredis\">https://github.com/redis/hiredis</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/redis/hiredis/archive/v0.13.3.tar.gz</span><br><span class=\"line\">tar xzf v0.13.3.tar.gz</span><br><span class=\"line\">cd hiredis*</span><br><span class=\"line\">make</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"nghttp2\"><a href=\"#nghttp2\" class=\"headerlink\" title=\"nghttp2\"></a>nghttp2</h2><p>nghttp2swoolehttp2github<a href=\"https://github.com/nghttp2/nghttp2\">https://github.com/nghttp2/nghttp2</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/nghttp2/nghttp2/releases/download/v1.32.0/nghttp2-1.32.0.tar.bz2</span><br><span class=\"line\">tar -jxvf nghttp2-1.32.0.tar.bz2</span><br><span class=\"line\">cd nghttp2*</span><br><span class=\"line\">./configure</span><br><span class=\"line\">make</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"swoole\"><a href=\"#swoole\" class=\"headerlink\" title=\"swoole\"></a>swoole</h2><p>swoole1.2.x4.x1.x2.x4.x4.xboost.context1.x2.x4.x</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/swoole/swoole-src/archive/v4.0.4.tar.gz</span><br><span class=\"line\">tar xzf v4.0.4.tar.gz</span><br><span class=\"line\">cd swoole*</span><br><span class=\"line\">phpize</span><br><span class=\"line\">./configure --enable-sockets --enable-openssl --enable-http2 --enable-async-redis --enable-mysqlnd</span><br><span class=\"line\">make</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"swoole\"><a href=\"#swoole\" class=\"headerlink\" title=\"swoole\"></a>swoole</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;extension=swoole.so&#x27; &gt;&gt; /usr/local/php/etc/php.ini</span><br><span class=\"line\">service php-fpm restart</span><br></pre></td></tr></table></figure>\n\n<p>php -m | grep swoole</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>php fpmlibhiredis.so.0.13: cannot open shared object<br>fileswoole<br>swoole</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure --enable-sockets --enable-openssl --enable-http2 --enable-async-redis=/usr/local --enable-mysqlnd</span><br></pre></td></tr></table></figure>\n\n\n<p>ld.so.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;/usr/local/lib&#x27; &gt;&gt; /etc/ld.so.conf</span><br><span class=\"line\">sudo ldconfig</span><br></pre></td></tr></table></figure>\n\n<p>php-fpm</p>\n"},{"title":"inotify+rsync","date":"2020-02-19T10:22:50.000Z","url":"shuo-yi-shuo-qun-hui-ban-ben-de-inotify-rsynctong-bu","description":"NASNASNAS","_content":"\n> NASNASNAS\n\n## \n\ninotifydockerDSMlinux\n\n1. root\n\n```\nsudo -i\n```\n\n2. \n\n```\ncd /\n```\n\n3. \n\n```\nfind . -type f ( -iname \"yum\" -o -iname \"apt-get\" -o -iname \"ipkg\" -o -iname \"opkg\" -o -iname \"dpkg\" )\n```\n\nipkgopkgdpkg\n\n## ipkg\n\nipkg\n\n1. \n\n```\nipkg update\n```\n\n2. inotify-tools\n\n```\nipkg list | grep inotify-tools\n```\n\n3. \n\n```\nipkg install inotify-tools\n```\n\n4. \n\n```\nwhich inotifywatch\n```\n\n## opkg\n\nopkg\n\n1. \n\n```\nopkg update\n```\n\n2. inotify-tools\n\n```\nopkg list | grep inotify-tools\n```\n\n3. \n\n```\nopkg install inotify-tools\n```\n\n4. \n\n```\nwhich inotifywatch\n```\n\n## dpkg\n\ndpkg\n\n1. \n\n```\nwget http://ftp.br.debian.org/debian/pool/main/i/inotify-tools/inotify-tools_3.14-2_amd64.deb\n```\n\n2. \n\n```\ndpkg -i inotify-tools_3.14-2_amd64.deb\n```\n\n3. \n\n```\nwhich inotifywatch\n```\n\n## inotify-toolsrsync\n\nrsyncDSMinotify-toolsrsync[inotify+rsync](/sync-data-realtime-with-inotify-rsync/)\n\n## \n\nipkgopkgdpkg","source":"_posts/inotify+rsync.md","raw":"---\ntitle: inotify+rsync\ndate: 2020-02-19 18:22:50\ntags: \n  - inotify\n  - \n  - \ncategories:\n  - \nurl: shuo-yi-shuo-qun-hui-ban-ben-de-inotify-rsynctong-bu\ndescription: NASNASNAS\n---\n\n> NASNASNAS\n\n## \n\ninotifydockerDSMlinux\n\n1. root\n\n```\nsudo -i\n```\n\n2. \n\n```\ncd /\n```\n\n3. \n\n```\nfind . -type f ( -iname \"yum\" -o -iname \"apt-get\" -o -iname \"ipkg\" -o -iname \"opkg\" -o -iname \"dpkg\" )\n```\n\nipkgopkgdpkg\n\n## ipkg\n\nipkg\n\n1. \n\n```\nipkg update\n```\n\n2. inotify-tools\n\n```\nipkg list | grep inotify-tools\n```\n\n3. \n\n```\nipkg install inotify-tools\n```\n\n4. \n\n```\nwhich inotifywatch\n```\n\n## opkg\n\nopkg\n\n1. \n\n```\nopkg update\n```\n\n2. inotify-tools\n\n```\nopkg list | grep inotify-tools\n```\n\n3. \n\n```\nopkg install inotify-tools\n```\n\n4. \n\n```\nwhich inotifywatch\n```\n\n## dpkg\n\ndpkg\n\n1. \n\n```\nwget http://ftp.br.debian.org/debian/pool/main/i/inotify-tools/inotify-tools_3.14-2_amd64.deb\n```\n\n2. \n\n```\ndpkg -i inotify-tools_3.14-2_amd64.deb\n```\n\n3. \n\n```\nwhich inotifywatch\n```\n\n## inotify-toolsrsync\n\nrsyncDSMinotify-toolsrsync[inotify+rsync](/sync-data-realtime-with-inotify-rsync/)\n\n## \n\nipkgopkgdpkg","slug":"inotify+rsync","published":1,"updated":"2022-05-12T17:06:16.341Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6avf004jlvtdf59s6z2r","content":"<blockquote>\n<p>NASNASNAS</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>inotifydockerDSMlinux</p>\n<ol>\n<li>root</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo -i</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find . -type f ( -iname &quot;yum&quot; -o -iname &quot;apt-get&quot; -o -iname &quot;ipkg&quot; -o -iname &quot;opkg&quot; -o -iname &quot;dpkg&quot; )</span><br></pre></td></tr></table></figure>\n\n<p>ipkgopkgdpkg</p>\n<h2 id=\"ipkg\"><a href=\"#ipkg\" class=\"headerlink\" title=\"ipkg\"></a>ipkg</h2><p>ipkg</p>\n<ol>\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipkg update</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>inotify-tools</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipkg list | grep inotify-tools</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipkg install inotify-tools</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which inotifywatch</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"opkg\"><a href=\"#opkg\" class=\"headerlink\" title=\"opkg\"></a>opkg</h2><p>opkg</p>\n<ol>\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">opkg update</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>inotify-tools</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">opkg list | grep inotify-tools</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">opkg install inotify-tools</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which inotifywatch</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"dpkg\"><a href=\"#dpkg\" class=\"headerlink\" title=\"dpkg\"></a>dpkg</h2><p>dpkg</p>\n<ol>\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://ftp.br.debian.org/debian/pool/main/i/inotify-tools/inotify-tools_3.14-2_amd64.deb</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dpkg -i inotify-tools_3.14-2_amd64.deb</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which inotifywatch</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"inotify-toolsrsync\"><a href=\"#inotify-toolsrsync\" class=\"headerlink\" title=\"inotify-toolsrsync\"></a>inotify-toolsrsync</h2><p>rsyncDSMinotify-toolsrsync<a href=\"/sync-data-realtime-with-inotify-rsync/\">inotify+rsync</a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>ipkgopkgdpkg</p>\n","site":{"data":{}},"length":1096,"excerpt":"","more":"<blockquote>\n<p>NASNASNAS</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>inotifydockerDSMlinux</p>\n<ol>\n<li>root</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo -i</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find . -type f ( -iname &quot;yum&quot; -o -iname &quot;apt-get&quot; -o -iname &quot;ipkg&quot; -o -iname &quot;opkg&quot; -o -iname &quot;dpkg&quot; )</span><br></pre></td></tr></table></figure>\n\n<p>ipkgopkgdpkg</p>\n<h2 id=\"ipkg\"><a href=\"#ipkg\" class=\"headerlink\" title=\"ipkg\"></a>ipkg</h2><p>ipkg</p>\n<ol>\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipkg update</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>inotify-tools</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipkg list | grep inotify-tools</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipkg install inotify-tools</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which inotifywatch</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"opkg\"><a href=\"#opkg\" class=\"headerlink\" title=\"opkg\"></a>opkg</h2><p>opkg</p>\n<ol>\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">opkg update</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>inotify-tools</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">opkg list | grep inotify-tools</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">opkg install inotify-tools</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which inotifywatch</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"dpkg\"><a href=\"#dpkg\" class=\"headerlink\" title=\"dpkg\"></a>dpkg</h2><p>dpkg</p>\n<ol>\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://ftp.br.debian.org/debian/pool/main/i/inotify-tools/inotify-tools_3.14-2_amd64.deb</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dpkg -i inotify-tools_3.14-2_amd64.deb</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which inotifywatch</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"inotify-toolsrsync\"><a href=\"#inotify-toolsrsync\" class=\"headerlink\" title=\"inotify-toolsrsync\"></a>inotify-toolsrsync</h2><p>rsyncDSMinotify-toolsrsync<a href=\"/sync-data-realtime-with-inotify-rsync/\">inotify+rsync</a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>ipkgopkgdpkg</p>\n"},{"title":"frmibdibdata1mysql","date":"2018-03-23T23:34:00.000Z","url":"recovering-mysql-database-with-frm-ibd-ibdata1","description":"mysqldowncentosmysqlGooglemysql","_content":"\n> mysqldowncentosmysqlGooglemysql\n\n## \n\nSFTPmysqlfrmibdibdata1frmibdInnoDBibdata1mysqlmysql\n\n## \n\nmysqlfrmibdmysql\n\n## \n\nmysql\n\n## \n\nInnoDBibdmysql\n5.6.6innodb_file_per_table","source":"_posts/frmibdibdata1mysql.md","raw":"---\ntitle: frmibdibdata1mysql\ndate: 2018-03-24 07:34:00\ntags: \n  - mysql\n  - \ncategories:\n  - \nurl: recovering-mysql-database-with-frm-ibd-ibdata1\ndescription: mysqldowncentosmysqlGooglemysql\n---\n\n> mysqldowncentosmysqlGooglemysql\n\n## \n\nSFTPmysqlfrmibdibdata1frmibdInnoDBibdata1mysqlmysql\n\n## \n\nmysqlfrmibdmysql\n\n## \n\nmysql\n\n## \n\nInnoDBibdmysql\n5.6.6innodb_file_per_table","slug":"frmibdibdata1mysql","published":1,"updated":"2022-05-12T17:06:09.142Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3in6avf004mlvtdcrzcd2qh","content":"<blockquote>\n<p>mysqldowncentosmysqlGooglemysql</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>SFTPmysqlfrmibdibdata1frmibdInnoDBibdata1mysqlmysql</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>mysqlfrmibdmysql</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>mysql</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>InnoDBibdmysql<br>5.6.6innodb_file_per_table</p>\n","site":{"data":{}},"length":642,"excerpt":"","more":"<blockquote>\n<p>mysqldowncentosmysqlGooglemysql</p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>SFTPmysqlfrmibdibdata1frmibdInnoDBibdata1mysqlmysql</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>mysqlfrmibdmysql</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>mysql</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>InnoDBibdmysql<br>5.6.6innodb_file_per_table</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cl3in6aty0005lvtd2d4l01yv","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6au4000blvtda2z7hgi9"},{"post_id":"cl3in6atq0000lvtdg9zkf6jo","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6au5000glvtd0a3i85kw"},{"post_id":"cl3in6atz0006lvtdhslsbhtr","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6au7000jlvtdhqwy6tbc"},{"post_id":"cl3in6au20009lvtd3uyx113d","category_id":"cl16op5qv00036itd16gc2ooy","_id":"cl3in6au8000nlvtd2wnbdjbv"},{"post_id":"cl3in6atu0001lvtdfh2c3tpa","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6aua000qlvtd8xsicw19"},{"post_id":"cl3in6au3000alvtd17vg7h3r","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6aub000tlvtd5oq0bec2"},{"post_id":"cl3in6au5000flvtdg2zu9w43","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6auc000vlvtdhn6c4fab"},{"post_id":"cl3in6atx0004lvtdcle9f4b9","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6aud000xlvtd6jxlc7qb"},{"post_id":"cl3in6au6000ilvtddzs83rvb","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6aue0011lvtd5xya3v21"},{"post_id":"cl3in6au7000mlvtd82b86neg","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6auf0014lvtddxlv5z3x"},{"post_id":"cl3in6au8000plvtd3kjt1zbq","category_id":"cl16op5qv00036itd16gc2ooy","_id":"cl3in6aug0018lvtdaq97eph2"},{"post_id":"cl3in6aua000slvtd2tmwdch4","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6auh001alvtd9myd67c0"},{"post_id":"cl3in6auc000ulvtde4mmh7h4","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6auk001dlvtdhek90g2j"},{"post_id":"cl3in6auc000wlvtd2b37b5m1","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6auk001flvtdfc8o5rrs"},{"post_id":"cl3in6aue0010lvtdeab97br8","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6aul001ilvtd5255hijp"},{"post_id":"cl3in6auf0013lvtd59b7amy5","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6aum001jlvtdabgcap0a"},{"post_id":"cl3in6aug0017lvtd1of2f3xe","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6aum001klvtd0jvs2en6"},{"post_id":"cl3in6aug0019lvtd4ev37ibn","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6aum001nlvtd63j0erxe"},{"post_id":"cl3in6auj001clvtd0c1m7lib","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6aun001plvtdgf2yc3ri"},{"post_id":"cl3in6auk001elvtdflv469n2","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6aun001slvtd8bi88451"},{"post_id":"cl3in6aul001hlvtdby89cx0d","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6aun001ulvtddota2syz"},{"post_id":"cl3in6av4003qlvtddrz1dvxk","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6av7003vlvtd36c22pro"},{"post_id":"cl3in6av5003rlvtd07fv0wkb","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6av8003xlvtd0xl153vr"},{"post_id":"cl3in6av5003tlvtd4ogy95e4","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6av80040lvtd4verbm7n"},{"post_id":"cl3in6av6003ulvtd02vw9tkt","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6av90042lvtd5bgn49tz"},{"post_id":"cl3in6av7003wlvtdadmvdvea","category_id":"cl16op5qv00036itd16gc2ooy","_id":"cl3in6ava0045lvtd5bqd1p4g"},{"post_id":"cl3in6av8003zlvtd9sh03poc","category_id":"cl16op5qv00036itd16gc2ooy","_id":"cl3in6avb0048lvtdbitb8lt4"},{"post_id":"cl3in6av90041lvtddmc02p6a","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6avc004clvtd0197ajvw"},{"post_id":"cl3in6ava0044lvtd39hl3aiv","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6avc004elvtdg65t6f0r"},{"post_id":"cl3in6ava0047lvtdfh1i5y6d","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6avd004hlvtdf1m5chdf"},{"post_id":"cl3in6avb004blvtd4tvdbiah","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6avf004klvtd69l93xpz"},{"post_id":"cl3in6avc004dlvtdflgleur4","category_id":"cl16op5qv00036itd16gc2ooy","_id":"cl3in6avg004nlvtdg12h2zjc"},{"post_id":"cl3in6avd004glvtdhn2h47ej","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6avh004qlvtdat6s7idg"},{"post_id":"cl3in6avf004jlvtdf59s6z2r","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6avh004slvtdg4v7ad3g"},{"post_id":"cl3in6avf004mlvtdcrzcd2qh","category_id":"cl3in6atv0002lvtdaeui7ixh","_id":"cl3in6avj004ulvtd1woean4c"}],"PostTag":[{"post_id":"cl3in6au20009lvtd3uyx113d","tag_id":"cl16op5qw00046itd10nvduyr","_id":"cl3in6au5000elvtd39ofdpem"},{"post_id":"cl3in6au20009lvtd3uyx113d","tag_id":"cl16op5qz00066itd67gnfacx","_id":"cl3in6au6000hlvtdem9s8dgz"},{"post_id":"cl3in6atq0000lvtdg9zkf6jo","tag_id":"cl3in6atx0003lvtd03wp8ia0","_id":"cl3in6au7000llvtdfc5jfutq"},{"post_id":"cl3in6atq0000lvtdg9zkf6jo","tag_id":"cl3in6au00008lvtd9dzs5qt0","_id":"cl3in6au8000olvtd8lc33sue"},{"post_id":"cl3in6atu0001lvtdfh2c3tpa","tag_id":"cl3in6au4000dlvtdhbwcegfy","_id":"cl3in6aue000zlvtdecsqae6r"},{"post_id":"cl3in6atu0001lvtdfh2c3tpa","tag_id":"cl3in6au7000klvtd46s0cg9v","_id":"cl3in6aue0012lvtd5go0bzcr"},{"post_id":"cl3in6atu0001lvtdfh2c3tpa","tag_id":"cl3in6aua000rlvtd3dfpgnwg","_id":"cl3in6aug0016lvtd1dqkdzza"},{"post_id":"cl3in6atx0004lvtdcle9f4b9","tag_id":"cl3in6aud000ylvtdh96qgesb","_id":"cl3in6aum001mlvtd07p7c4tw"},{"post_id":"cl3in6atx0004lvtdcle9f4b9","tag_id":"cl3in6auf0015lvtdecz45tg8","_id":"cl3in6aun001olvtd4fxihtm1"},{"post_id":"cl3in6atx0004lvtdcle9f4b9","tag_id":"cl3in6auh001blvtd1cwrgrbn","_id":"cl3in6aun001rlvtd8ol9312i"},{"post_id":"cl3in6atx0004lvtdcle9f4b9","tag_id":"cl3in6aul001glvtd6k793jzk","_id":"cl3in6aun001tlvtd94zigend"},{"post_id":"cl3in6aty0005lvtd2d4l01yv","tag_id":"cl3in6aum001llvtddaiiefzr","_id":"cl3in6aun001wlvtd96c44arp"},{"post_id":"cl3in6aty0005lvtd2d4l01yv","tag_id":"cl3in6aun001qlvtd1fdmdv0r","_id":"cl3in6aun001xlvtdbyyj3iv3"},{"post_id":"cl3in6atz0006lvtdhslsbhtr","tag_id":"cl3in6aun001vlvtd9i8t77o5","_id":"cl3in6auo0020lvtd1b7ncpyn"},{"post_id":"cl3in6atz0006lvtdhslsbhtr","tag_id":"cl3in6aun001ylvtd0vd49qa6","_id":"cl3in6auo0021lvtdfkb15366"},{"post_id":"cl3in6au3000alvtd17vg7h3r","tag_id":"cl3in6auo001zlvtd3ijvg4v0","_id":"cl3in6aup0025lvtd41duae42"},{"post_id":"cl3in6au3000alvtd17vg7h3r","tag_id":"cl3in6auo0022lvtd3dsshwbg","_id":"cl3in6aup0026lvtdb2269ipy"},{"post_id":"cl3in6au3000alvtd17vg7h3r","tag_id":"cl3in6auo0023lvtdaar6enme","_id":"cl3in6aup0028lvtdc7oqfnh8"},{"post_id":"cl3in6au5000flvtdg2zu9w43","tag_id":"cl3in6aup0024lvtd1nf4gjou","_id":"cl3in6aup002alvtdfy7sabae"},{"post_id":"cl3in6au5000flvtdg2zu9w43","tag_id":"cl3in6aup0027lvtd32tgccsw","_id":"cl3in6auq002blvtd5ppfchxb"},{"post_id":"cl3in6au6000ilvtddzs83rvb","tag_id":"cl3in6aup0029lvtddt933lll","_id":"cl3in6aur002flvtdgwnacwnv"},{"post_id":"cl3in6au6000ilvtddzs83rvb","tag_id":"cl3in6auq002clvtd2s0qbx85","_id":"cl3in6aur002glvtd9z7bbp1d"},{"post_id":"cl3in6au6000ilvtddzs83rvb","tag_id":"cl3in6auf0015lvtdecz45tg8","_id":"cl3in6aur002ilvtd52gk6jvq"},{"post_id":"cl3in6au7000mlvtd82b86neg","tag_id":"cl3in6auq002elvtd0qkbcpo5","_id":"cl3in6aus002llvtd65imfmjb"},{"post_id":"cl3in6au7000mlvtd82b86neg","tag_id":"cl3in6auq002clvtd2s0qbx85","_id":"cl3in6aus002mlvtdf7qv5opx"},{"post_id":"cl3in6au7000mlvtd82b86neg","tag_id":"cl3in6auf0015lvtdecz45tg8","_id":"cl3in6aus002olvtd2rgk6hwk"},{"post_id":"cl3in6au8000plvtd3kjt1zbq","tag_id":"cl3in6aur002klvtdhgbcgfgf","_id":"cl3in6aus002plvtd9clt15fu"},{"post_id":"cl3in6aua000slvtd2tmwdch4","tag_id":"cl3in6auh001blvtd1cwrgrbn","_id":"cl3in6aut002tlvtdgjdl6i1s"},{"post_id":"cl3in6aua000slvtd2tmwdch4","tag_id":"cl3in6aus002qlvtd6n59awno","_id":"cl3in6aut002ulvtdfk0p57mr"},{"post_id":"cl3in6aua000slvtd2tmwdch4","tag_id":"cl3in6auf0015lvtdecz45tg8","_id":"cl3in6aut002wlvtd6gko663k"},{"post_id":"cl3in6auc000ulvtde4mmh7h4","tag_id":"cl3in6aut002slvtdberd2jfa","_id":"cl3in6aut002xlvtdg5xi1c60"},{"post_id":"cl3in6auc000wlvtd2b37b5m1","tag_id":"cl3in6aut002vlvtd4al7gmmn","_id":"cl3in6auv0031lvtd98vcbixy"},{"post_id":"cl3in6auc000wlvtd2b37b5m1","tag_id":"cl3in6aut002ylvtd15zyf3we","_id":"cl3in6auv0032lvtd8x2yfyh2"},{"post_id":"cl3in6auc000wlvtd2b37b5m1","tag_id":"cl3in6auu002zlvtdbb4q96l1","_id":"cl3in6auw0034lvtdc9f11p3x"},{"post_id":"cl3in6aue0010lvtdeab97br8","tag_id":"cl3in6aut002vlvtd4al7gmmn","_id":"cl3in6auw0036lvtdd17l2y74"},{"post_id":"cl3in6aue0010lvtdeab97br8","tag_id":"cl3in6auu002zlvtdbb4q96l1","_id":"cl3in6aux0037lvtd2cidfyv2"},{"post_id":"cl3in6auf0013lvtd59b7amy5","tag_id":"cl3in6auw0035lvtd2ctyczr0","_id":"cl3in6aux003alvtdgzz0cebw"},{"post_id":"cl3in6auf0013lvtd59b7amy5","tag_id":"cl3in6aux0038lvtd9csr4smi","_id":"cl3in6aux003blvtd74jngya7"},{"post_id":"cl3in6aug0017lvtd1of2f3xe","tag_id":"cl3in6aux0039lvtd557vc1i2","_id":"cl3in6auy003dlvtd3a8r4o0k"},{"post_id":"cl3in6aug0019lvtd4ev37ibn","tag_id":"cl3in6aux003clvtd7ei58b5a","_id":"cl3in6auy003flvtd5a7bds80"},{"post_id":"cl3in6auj001clvtd0c1m7lib","tag_id":"cl3in6aus002qlvtd6n59awno","_id":"cl3in6auz003hlvtdb164hjrd"},{"post_id":"cl3in6auj001clvtd0c1m7lib","tag_id":"cl3in6auf0015lvtdecz45tg8","_id":"cl3in6auz003ilvtdavuka8ed"},{"post_id":"cl3in6auk001elvtdflv469n2","tag_id":"cl3in6auy003glvtddzqveuyf","_id":"cl3in6av0003llvtdgsos6dyc"},{"post_id":"cl3in6auk001elvtdflv469n2","tag_id":"cl3in6auz003jlvtd41i99rmb","_id":"cl3in6av0003mlvtdcmm7fktx"},{"post_id":"cl3in6aul001hlvtdby89cx0d","tag_id":"cl3in6auz003klvtdgyh0eg3j","_id":"cl3in6av0003olvtd82bc7x3h"},{"post_id":"cl3in6aul001hlvtdby89cx0d","tag_id":"cl3in6auz003jlvtd41i99rmb","_id":"cl3in6av0003plvtdfttr7v8q"},{"post_id":"cl3in6av4003qlvtddrz1dvxk","tag_id":"cl3in6av5003slvtd3rivajd4","_id":"cl3in6ava0046lvtdgbk167rc"},{"post_id":"cl3in6av4003qlvtddrz1dvxk","tag_id":"cl3in6av8003ylvtdha61f886","_id":"cl3in6avb0049lvtddxpr08g0"},{"post_id":"cl3in6av5003rlvtd07fv0wkb","tag_id":"cl3in6av90043lvtdbl833qpa","_id":"cl3in6ave004ilvtd2nnr1137"},{"post_id":"cl3in6av5003rlvtd07fv0wkb","tag_id":"cl3in6avb004alvtdg4ev0455","_id":"cl3in6avf004llvtd3m8x3x3q"},{"post_id":"cl3in6av5003tlvtd4ogy95e4","tag_id":"cl3in6aup0024lvtd1nf4gjou","_id":"cl3in6avh004plvtd3t685sdt"},{"post_id":"cl3in6av5003tlvtd4ogy95e4","tag_id":"cl3in6avc004flvtd847ohuob","_id":"cl3in6avh004rlvtdh6be55my"},{"post_id":"cl3in6av6003ulvtd02vw9tkt","tag_id":"cl3in6avg004olvtd5k2lhpml","_id":"cl3in6avj004vlvtd1r4t70c9"},{"post_id":"cl3in6av7003wlvtdadmvdvea","tag_id":"cl3in6avh004tlvtd1o6e9bez","_id":"cl3in6avj004ylvtd1ahq60lg"},{"post_id":"cl3in6av7003wlvtdadmvdvea","tag_id":"cl3in6avj004wlvtd4xiugk03","_id":"cl3in6avj004zlvtd6yfmbd4l"},{"post_id":"cl3in6av8003zlvtd9sh03poc","tag_id":"cl3in6avj004xlvtd3aa4gt08","_id":"cl3in6avk0051lvtd3le43hog"},{"post_id":"cl3in6av90041lvtddmc02p6a","tag_id":"cl3in6avj0050lvtd6ghd1yan","_id":"cl3in6avk0054lvtddl0o5me9"},{"post_id":"cl3in6av90041lvtddmc02p6a","tag_id":"cl3in6avk0052lvtd0r3v5si9","_id":"cl3in6avk0055lvtd3w228gci"},{"post_id":"cl3in6ava0044lvtd39hl3aiv","tag_id":"cl3in6avb004alvtdg4ev0455","_id":"cl3in6avl0058lvtd81id7rry"},{"post_id":"cl3in6ava0044lvtd39hl3aiv","tag_id":"cl3in6avk0056lvtd3s38eom5","_id":"cl3in6avl0059lvtdb9y511wi"},{"post_id":"cl3in6ava0047lvtdfh1i5y6d","tag_id":"cl3in6avl0057lvtd97ng55ib","_id":"cl3in6avl005blvtd1h80gbzo"},{"post_id":"cl3in6avb004blvtd4tvdbiah","tag_id":"cl3in6avl005alvtdd17xaqdj","_id":"cl3in6avm005flvtd6ooo91t6"},{"post_id":"cl3in6avb004blvtd4tvdbiah","tag_id":"cl3in6avl005clvtd0pr0274v","_id":"cl3in6avm005glvtd7ycdhtl3"},{"post_id":"cl3in6avb004blvtd4tvdbiah","tag_id":"cl3in6avl005dlvtd7s58aerr","_id":"cl3in6avm005ilvtd2hcg0ndr"},{"post_id":"cl3in6avc004dlvtdflgleur4","tag_id":"cl3in6avm005elvtd3glb1nbk","_id":"cl3in6avn005jlvtdg8gvhmtl"},{"post_id":"cl3in6avd004glvtdhn2h47ej","tag_id":"cl3in6avm005hlvtdb7z45jub","_id":"cl3in6avn005llvtdhuuq1xkt"},{"post_id":"cl3in6avf004jlvtdf59s6z2r","tag_id":"cl3in6aut002vlvtd4al7gmmn","_id":"cl3in6avo005nlvtd369lbdtc"},{"post_id":"cl3in6avf004jlvtdf59s6z2r","tag_id":"cl3in6avn005klvtdf66d9tfw","_id":"cl3in6avo005olvtd7ya231q9"},{"post_id":"cl3in6avf004jlvtdf59s6z2r","tag_id":"cl3in6auu002zlvtdbb4q96l1","_id":"cl3in6avo005plvtdem2m77fz"},{"post_id":"cl3in6avf004mlvtdcrzcd2qh","tag_id":"cl3in6aup0024lvtd1nf4gjou","_id":"cl3in6avo005qlvtd7u944rch"},{"post_id":"cl3in6avf004mlvtdcrzcd2qh","tag_id":"cl3in6avn005mlvtdh2cc915v","_id":"cl3in6avo005rlvtd96bjgjja"}],"Tag":[{"name":"hello","_id":"cl16op5qw00046itd10nvduyr"},{"name":"hi","_id":"cl16op5qz00066itd67gnfacx"},{"name":"Atom","_id":"cl3in6atx0003lvtd03wp8ia0"},{"name":"SSH","_id":"cl3in6au00008lvtd9dzs5qt0"},{"name":"docker","_id":"cl3in6au4000dlvtdhbwcegfy"},{"name":"pm2","_id":"cl3in6au7000klvtd46s0cg9v"},{"name":"","_id":"cl3in6aua000rlvtd3dfpgnwg"},{"name":"Firewalld","_id":"cl3in6aud000ylvtdh96qgesb"},{"name":"","_id":"cl3in6auf0015lvtdecz45tg8"},{"name":"ipset","_id":"cl3in6auh001blvtd1cwrgrbn"},{"name":"","_id":"cl3in6aul001glvtd6k793jzk"},{"name":"supervisor","_id":"cl3in6aum001llvtddaiiefzr"},{"name":"","_id":"cl3in6aun001qlvtd1fdmdv0r"},{"name":"echo","_id":"cl3in6aun001vlvtd9i8t77o5"},{"name":"tee","_id":"cl3in6aun001ylvtd0vd49qa6"},{"name":"","_id":"cl3in6auo001zlvtd3ijvg4v0"},{"name":"iframe","_id":"cl3in6auo0022lvtd3dsshwbg"},{"name":"","_id":"cl3in6auo0023lvtdaar6enme"},{"name":"mysql","_id":"cl3in6aup0024lvtd1nf4gjou"},{"name":"emoji","_id":"cl3in6aup0027lvtd32tgccsw"},{"name":"nginx","_id":"cl3in6aup0029lvtddt933lll"},{"name":"lua","_id":"cl3in6auq002clvtd2s0qbx85"},{"name":"waf","_id":"cl3in6auq002elvtd0qkbcpo5"},{"name":"google chrome","_id":"cl3in6aur002klvtdhgbcgfgf"},{"name":"iptables","_id":"cl3in6aus002qlvtd6n59awno"},{"name":"ssh","_id":"cl3in6aut002slvtdberd2jfa"},{"name":"inotify","_id":"cl3in6aut002vlvtd4al7gmmn"},{"name":"rsync","_id":"cl3in6aut002ylvtd15zyf3we"},{"name":"","_id":"cl3in6auu002zlvtdbb4q96l1"},{"name":"SSH","_id":"cl3in6auw0035lvtd2ctyczr0"},{"name":"","_id":"cl3in6aux0038lvtd9csr4smi"},{"name":"ffmpeg","_id":"cl3in6aux0039lvtd557vc1i2"},{"name":"OpenCC","_id":"cl3in6aux003clvtd7ei58b5a"},{"name":"kafka","_id":"cl3in6auy003glvtddzqveuyf"},{"name":"","_id":"cl3in6auz003jlvtd41i99rmb"},{"name":"rabbitmq","_id":"cl3in6auz003klvtdgyh0eg3j"},{"name":"nps","_id":"cl3in6av5003slvtd3rivajd4"},{"name":"","_id":"cl3in6av8003ylvtdha61f886"},{"name":"","_id":"cl3in6av90043lvtdbl833qpa"},{"name":"OpenWRT","_id":"cl3in6avb004alvtdg4ev0455"},{"name":"","_id":"cl3in6avc004flvtd847ohuob"},{"name":"Docker","_id":"cl3in6avg004olvtd5k2lhpml"},{"name":"","_id":"cl3in6avh004tlvtd1o6e9bez"},{"name":"","_id":"cl3in6avj004wlvtd4xiugk03"},{"name":"safari","_id":"cl3in6avj004xlvtd3aa4gt08"},{"name":"esxi","_id":"cl3in6avj0050lvtd6ghd1yan"},{"name":"","_id":"cl3in6avk0052lvtd0r3v5si9"},{"name":"","_id":"cl3in6avk0056lvtd3s38eom5"},{"name":"denyhosts","_id":"cl3in6avl0057lvtd97ng55ib"},{"name":"ups","_id":"cl3in6avl005alvtdd17xaqdj"},{"name":"NAS","_id":"cl3in6avl005clvtd0pr0274v"},{"name":"","_id":"cl3in6avl005dlvtd7s58aerr"},{"name":"Leanote","_id":"cl3in6avm005elvtd3glb1nbk"},{"name":"swoole","_id":"cl3in6avm005hlvtdb7z45jub"},{"name":"","_id":"cl3in6avn005klvtdf66d9tfw"},{"name":"","_id":"cl3in6avn005mlvtdh2cc915v"}]}}